head	1.46;
access;
symbols
	PublicRelease_1_2e:1.46
	Interim_Release_1-2e_RC1:1.46
	PublicRelease_1_2d:1.46
	Interim_Release_1-2d_RC1:1.46
	Interim_Release_1-2d_beta1:1.46
	PublicRelease_1_2c:1.44
	Interim_Release_1-2c_RC1:1.44
	Interim_Release_1-2c_beta1:1.43
	PublicRelease_1_2b:1.43
	Interim_Release_1-2b_RC1:1.43
	PublicRelease_1_2a:1.43
	Interim_Release_1-2a_RC1:1.43
	Interim_Release_1-2a_beta2:1.42
	Interim_Release_1-2a_beta1:1.42
	PublicRelease_1_2:1.42
	Interim_Release_1-2_RC1:1.42
	Interim_Release_1-2_beta1:1.42
	PublicRelease_1_1g:1.42
	Interim_Release_1-1g_RC3:1.42
	Interim_Release_1-1g_RC2:1.42
	Interim_Release_1-1g_RC1:1.42
	Interim_Release_1-1g_beta2:1.40
	Interim_Release_1-1g_beta1:1.40
	PublicRelease_1_1f:1.40
	Interim_Release_1-1f_RC1:1.40
	PublicRelease_1_1e:1.40
	Interim_Release_1-1e_RC2:1.40
	Interim_Release_1-1e_RC1:1.40
	Interim_Release_1-1e_beta1:1.40
	PublicRelease_1_1d:1.40
	Interim_Release_1-1d_RC1:1.40
	PublicRelease_1_1c:1.40
	Interim_Release_1-1c_RC1:1.40
	Interim_Release_1-1c_beta2:1.40
	Interim_Release_1-1c_beta1:1.40
	PublicRelease_1_1b:1.40
	Interim_Release_1-1b_RC1:1.40
	PublicRelease_1_1a:1.40
	Interim_Release_1-1a_RC2:1.40
	Interim_Release_1-1a_RC1:1.40
	Interim_Release_1-1a_beta2:1.40
	Interim_Release_1-1a_beta1:1.40
	PublicRelease_1_1:1.40
	Interim_Release_1-1_beta1:1.40
	PublicRelease_1o:1.40
	Interim_Release_1o_RC1:1.40
	Interim_Release_1o_beta1:1.40
	PublicRelease_1n:1.40
	Interim_Release_1n_RC2:1.40
	Interim_Release_1n_RC1:1.40
	Interim_Release_1n_beta2:1.40
	Interim_Release_1n_beta1:1.40
	PublicRelease_1m:1.40
	Interim_Release_1m_beta1:1.40
	PublicRelease_1l:1.39
	Interim_Release_1l_RC3:1.39
	Interim_Release_1l_RC2:1.39
	Interim_Release_1l_RC1:1.39
	Interim_Release_1l_beta2:1.39
	Interim_Release_1l_beta1:1.39
	PublicRelease_1k:1.37
	Interim_Release_1k_RC4:1.37
	Interim_1k_RC3:1.37
	Interim_1k_RC2:1.37
	Interim_Release_1k_RC1:1.37
	Interim_Release_1k_beta5:1.36
	Intrerim_Release_1k_beta4:1.36
	Interim_Release_1k_beta1:1.34
	PublicRelease_1j:1.31
	Interim_Release_1J_RC3:1.31
	Interim_Release_1j_RC3:1.31
	Interim_Release_1j_RC2:1.31
	Interim_Release_1j_RC1:1.31
	Interim_Release_1j_beta2:1.31
	Interim_Release_1j_beta1:1.31
	PublicRelease_1i:1.31
	Interim_Release_1i_RC6:1.31
	Interim_Release_1i_RC3:1.31
	Interim_Release_1i_RC2:1.31
	Interim_Release_1i_RC1:1.31
	Interim_Release_1i_beta3:1.29
	Interim_Release_1i_beta2:1.28
	Interim_Release_1i_beta1:1.27
	PublicRelease_1h:1.25
	Interim_Release_1h_rc2:1.25
	Interim_Release_1h_RC1:1.25
	Interim_Release_1h_beta2:1.25
	Interim_Release_1h_beta1_now:1.25
	Interim_Release_1h_beta1:1.25
	PublicRelease_1g:1.25
	Interim_Release_1g_RC6_Final:1.25
	Interim_Release_1g_RC6:1.25
	Interim_Release_1g_RC5:1.25
	Interim_Release_1g_RC4:1.24
	Interim_Release_1g_RC3:1.23
	Interim_Release_1g_beta2:1.20
	Interim_Release_1g_beta1:1.19
	Interim_Release_1f_RC4:1.18
	Interim_Release_1f_RC3:1.18
	Interim_Release_1f_RC2:1.17
	Interim_Release_1f_RC:1.17
	Interim_Release_1f_beta2:1.17
	Interim_Release_1f_beta1:1.17
	PublicRelease_1e:1.17
	Interim_Release_1e_RC2:1.17
	Interim_Release_1e_RC:1.17
	Interim_Release_1e_beta3:1.17
	Interim_Release_1e_beta2:1.17
	Interim_Release_1e_beta2_before_kuchin:1.17
	Interim_Release_1e_beta1:1.17
	PublicRelease_1c:1.17
	featurestest:1.17.0.2
	Interim_Release_1c_RC:1.17
	Interim_Release_1c_beta2:1.16
	Interim_Release_1c_beta1:1.16
	threaded_downloadqueue:1.16.0.2
	PublicRelease_1b:1.15
	Interim_Release_1b_beta2:1.15
	Interim_Release_1b_beta1:1.14
	proxydeadlake:1.10.0.2
	PublicRelease_1a:1.10
	Interim_Release_1a_beta2:1.10
	BerkeleyDb:1.9.0.2
	Interim_Release_1a_beta1:1.8
	PublicRelease_1:1.6
	goldfish:1.6
	eMulePlus_1_RC2:1.6
	eMulePlus_26b_1RC1:1.6
	PreRelease_26b_i0e:1.6
	before_26d_merge:1.6
	Interim_Release_26b_i0d:1.5
	Interim_Release_26b_i0c:1.3
	Interim_Release_26b_i0b:1.3
	Interim_Release_26b_i0a:1.3
	systraydlg:1.3.0.4
	plus26based:1.3.0.2
	Interim_Release_25b_i0b:1.3
	Proxy_Dev:1.2
	Interim_Release_25b_i0a:1.1.4.1
	proxytest:1.1.4.1.0.2
	official_sockets:1.1.0.4
	eMulePlus_024b_5b:1.1.0.2;
locks; strict;
comment	@// @;


1.46
date	2008.02.03.06.33.23;	author aw3;	state Exp;
branches;
next	1.45;

1.45
date	2008.02.03.03.58.56;	author aw3;	state Exp;
branches;
next	1.44;

1.44
date	2007.04.02.23.14.13;	author kush_eplus;	state Exp;
branches;
next	1.43;

1.43
date	2006.06.24.02.40.21;	author aw3;	state Exp;
branches;
next	1.42;

1.42
date	2005.11.27.22.11.48;	author eklmn;	state Exp;
branches;
next	1.41;

1.41
date	2005.11.27.20.31.05;	author eklmn;	state Exp;
branches;
next	1.40;

1.40
date	2004.06.19.05.34.24;	author aw3;	state Exp;
branches;
next	1.39;

1.39
date	2004.05.04.11.28.00;	author netwolf1;	state Exp;
branches;
next	1.38;

1.38
date	2004.04.17.15.22.25;	author dongato;	state Exp;
branches;
next	1.37;

1.37
date	2004.03.23.18.14.55;	author aw3;	state Exp;
branches;
next	1.36;

1.36
date	2004.03.14.21.10.11;	author aw3;	state Exp;
branches;
next	1.35;

1.35
date	2004.03.13.05.33.36;	author aw3;	state Exp;
branches;
next	1.34;

1.34
date	2004.02.11.23.41.06;	author aw3;	state Exp;
branches;
next	1.33;

1.33
date	2004.02.06.15.40.42;	author netwolf1;	state Exp;
branches;
next	1.32;

1.32
date	2004.02.03.01.20.31;	author double_t;	state Exp;
branches;
next	1.31;

1.31
date	2003.11.04.09.20.49;	author kuchin;	state Exp;
branches;
next	1.30;

1.30
date	2003.10.31.22.36.52;	author dongato;	state Exp;
branches;
next	1.29;

1.29
date	2003.10.26.13.50.16;	author morevit;	state Exp;
branches;
next	1.28;

1.28
date	2003.10.21.14.33.58;	author dongato;	state Exp;
branches;
next	1.27;

1.27
date	2003.09.22.16.35.08;	author morevit;	state Exp;
branches;
next	1.26;

1.26
date	2003.09.20.15.39.31;	author morevit;	state Exp;
branches;
next	1.25;

1.25
date	2003.07.09.15.08.21;	author netwolf1;	state Exp;
branches;
next	1.24;

1.24
date	2003.07.05.11.53.08;	author dongato;	state Exp;
branches;
next	1.23;

1.23
date	2003.07.01.22.16.02;	author partyckip;	state Exp;
branches;
next	1.22;

1.22
date	2003.06.15.09.10.04;	author partyckip;	state Exp;
branches;
next	1.21;

1.21
date	2003.06.09.15.24.04;	author syrus77;	state Exp;
branches;
next	1.20;

1.20
date	2003.06.08.23.58.37;	author syrus77;	state Exp;
branches;
next	1.19;

1.19
date	2003.06.01.10.08.44;	author partyckip;	state Exp;
branches;
next	1.18;

1.18
date	2003.05.16.01.14.46;	author syrus77;	state Exp;
branches;
next	1.17;

1.17
date	2003.03.21.18.55.16;	author dongato;	state Exp;
branches;
next	1.16;

1.16
date	2003.03.10.22.20.34;	author dongato;	state Exp;
branches;
next	1.15;

1.15
date	2003.03.08.23.43.43;	author dongato;	state Exp;
branches;
next	1.14;

1.14
date	2003.03.04.15.24.15;	author dongato;	state Exp;
branches;
next	1.13;

1.13
date	2003.03.03.14.15.55;	author dongato;	state Exp;
branches;
next	1.12;

1.12
date	2003.03.03.13.01.37;	author dongato;	state Exp;
branches;
next	1.11;

1.11
date	2003.03.03.03.23.51;	author dongato;	state Exp;
branches;
next	1.10;

1.10
date	2003.02.26.10.39.54;	author dongato;	state Exp;
branches;
next	1.9;

1.9
date	2003.02.24.21.01.23;	author dongato;	state Exp;
branches
	1.9.2.1;
next	1.8;

1.8
date	2003.02.23.19.16.13;	author cax2;	state Exp;
branches;
next	1.7;

1.7
date	2003.02.22.16.22.35;	author obaldin;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.16.22.01.47;	author lord_kiron;	state Exp;
branches;
next	1.5;

1.5
date	2003.02.12.21.23.30;	author obaldin;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.12.00.19.46;	author cax2;	state Exp;
branches;
next	1.3;

1.3
date	2003.02.02.13.27.42;	author kuchin;	state Exp;
branches;
next	1.2;

1.2
date	2003.02.01.14.45.39;	author dongato;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.21.18.21.20;	author cax2;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2003.01.28.16.54.19;	author cax2;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2003.02.02.02.36.26;	author cax2;	state Exp;
branches;
next	;

1.9.2.1
date	2003.02.28.22.44.55;	author obaldin;	state Exp;
branches;
next	;


desc
@@


1.46
log
@Fixed Ban Request Interval configuration for locales with comma as decimal-point (seconds couldn't be set).
@
text
@//	This file is part of eMule Plus
//
//	This program is free software; you can redistribute it and/or
//	modify it under the terms of the GNU General Public License
//	as published by the Free Software Foundation; either
//	version 2 of the License, or (at your option) any later version.
//
//	This program is distributed in the hope that it will be useful,
//	but WITHOUT ANY WARRANTY; without even the implied warranty of
//	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//	GNU General Public License for more details.
//
//	You should have received a copy of the GNU General Public License
//	along with this program; if not, write to the Free Software
//	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include "stdafx.h"
#include "emule.h"
#include "PPgAdvanced.h"
#include "Inputbox.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

IMPLEMENT_DYNAMIC(CPPgAdvanced, CPropertyPage)
CPPgAdvanced::CPPgAdvanced()
	: CPropertyPage(CPPgAdvanced::IDD)
	, m_bBanMessage(FALSE)
	, m_bBanEnabled(FALSE)
	, m_bNoBanEnabled(FALSE)
	, m_bComEnabled(FALSE)
	, m_bSlsEnabled(FALSE)
	, m_bFNameCleanup(FALSE)
	, m_bFNameCleanupTag(FALSE)
	, m_bCountermeasures(FALSE)
	, m_bAutoNewVerChk(FALSE)
{
}

CPPgAdvanced::~CPPgAdvanced()
{
}

void CPPgAdvanced::DoDataExchange(CDataExchange* pDX)
{
	CPropertyPage::DoDataExchange(pDX);
	DDX_Text(pDX, IDC_BANTIMES, m_strBanTimes);
	DDX_Text(pDX, IDC_MINREQUESTTIME, m_strMinRequestTime);
	DDX_Text(pDX, IDC_BANTIMEINMINS, m_strBanTimeInMins);
	DDX_Check(pDX, IDC_BANMESSAGE, m_bBanMessage);
	DDX_Check(pDX, IDC_BANENABLED, m_bBanEnabled);
	DDX_Text(pDX, IDC_COMSTRING, m_strComString);
	DDX_Check(pDX, IDC_NOBANENABLED, m_bNoBanEnabled);
	DDX_Check(pDX, IDC_COMENABLED, m_bComEnabled);
	DDX_Text(pDX, IDC_SLSMAXSOURCES, m_strSlsMaxSources);
	DDX_Text(pDX, IDC_OUTDATED, m_strOutdated);
	DDX_Check(pDX, IDC_SLSENABLED, m_bSlsEnabled);
	DDX_Check(pDX, IDC_FNCLEANUP, m_bFNameCleanup);
	DDX_Check(pDX, IDC_FNCLEANUPTAG, m_bFNameCleanupTag);
	DDX_Check(pDX, IDC_COUNTERMEASURES, m_bCountermeasures);
	DDX_Check(pDX, IDC_AUTO_CHECK_NEW, m_bAutoNewVerChk);
}

BEGIN_MESSAGE_MAP(CPPgAdvanced, CPropertyPage)
	ON_BN_CLICKED(IDC_BANENABLED, OnBnClickedBanEnabled)
	ON_EN_CHANGE(IDC_BANTIMES, OnSettingsChange)
	ON_EN_CHANGE(IDC_MINREQUESTTIME, OnSettingsChange)
	ON_EN_CHANGE(IDC_BANTIMEINMINS, OnSettingsChange)
	ON_BN_CLICKED(IDC_BANMESSAGE, OnSettingsChange)
	ON_BN_CLICKED(IDC_COMENABLED, OnBnClickedComEnabled)
	ON_EN_CHANGE(IDC_COMSTRING, OnSettingsChange)
	ON_BN_CLICKED(IDC_NOBANENABLED, OnSettingsChange)
	ON_EN_CHANGE(IDC_SLSMAXSOURCES, OnSettingsChange)
	ON_EN_CHANGE(IDC_OUTDATED, OnSettingsChange)
	ON_BN_CLICKED(IDC_SLSENABLED, OnBnClickedSLSEnabled)
	ON_BN_CLICKED(IDC_COUNTERMEASURES, OnSettingsChange)
	ON_BN_CLICKED(IDC_AUTO_CHECK_NEW, OnSettingsChange)
	ON_BN_CLICKED(IDC_FNCLEANUP, OnSettingsChange)
	ON_BN_CLICKED(IDC_FNCLEANUPTAG, OnSettingsChange)
	ON_BN_CLICKED(IDC_FNC, OnSetCleanupFilter)
END_MESSAGE_MAP()

BOOL CPPgAdvanced::OnInitDialog()
{
	CPropertyPage::OnInitDialog();

	LoadSettings();
	Localize();

	return TRUE;
}

void CPPgAdvanced::LoadSettings(void)
{
	m_strBanTimes.Format(_T("%u"), m_pPrefs->BadClientMinRequestNum());
	m_strBanTimeInMins.Format(_T("%u"), m_pPrefs->BadClientBanTime() / 60000);
	
//	Don't add "mins" into textbox (don't use CastSecondsToHM)
	uint32		dwSecs = m_pPrefs->BadClientMinRequestTime() / 1000;

	m_strMinRequestTime.Format(_T("%u:%02u"), dwSecs / 60, dwSecs - (dwSecs / 60) * 60);
	m_bBanMessage = m_pPrefs->IsBanMessageEnabled();
	m_bBanEnabled = m_pPrefs->BanEnabled();
	m_strComString = m_pPrefs->CommunityString();
	m_bComEnabled = m_pPrefs->CommunityEnabled();
	m_bNoBanEnabled = m_pPrefs->CommunityNoBanEnabled();
	m_strSlsMaxSources.Format(_T("%u"), m_pPrefs->SLSMaxSourcesPerFile());
	m_strOutdated.Format(_T("%u"), m_pPrefs->WhenSourcesOutdated());
	m_bSlsEnabled = m_pPrefs->SLSEnable();
	m_bCountermeasures = m_pPrefs->IsCounterMeasures();
	m_bAutoNewVerChk = m_pPrefs->IsAutoCheckForNewVersion();
	m_bFNameCleanup = m_pPrefs->GetAutoFilenameCleanup();
	m_bFNameCleanupTag = m_pPrefs->GetFilenameCleanupTags();

	UpdateData(FALSE);

	OnBnClickedBanEnabled();
	OnBnClickedComEnabled();
	OnBnClickedSLSEnabled();

	SetModified(FALSE);
}

BOOL CPPgAdvanced::OnApply()
{
	if(m_bModified)
	{
		UpdateData(TRUE);
		
		uint32	dwTmp;
		
		dwTmp = static_cast<uint32>(_tstoi(m_strBanTimes));
		if (dwTmp < PREF_MIN_BANTIMES)
			dwTmp = PREF_MIN_BANTIMES;
		if (dwTmp > PREF_MAX_BANTIMES)
			dwTmp = PREF_MAX_BANTIMES;
		m_pPrefs->SetBadClientMinRequestNum(static_cast<byte>(dwTmp));
		m_strBanTimes.Format(_T("%u"), dwTmp);
			
		dwTmp = static_cast<uint32>(_tstoi(m_strBanTimeInMins));
		if (dwTmp > PREF_MAX_MINS2BAN)
			dwTmp = PREF_MAX_MINS2BAN;
		if (dwTmp < PREF_MIN_MINS2BAN)
			dwTmp = PREF_MIN_MINS2BAN;
		m_pPrefs->SetBadClientBanTime(MIN2MS(dwTmp));
		m_strBanTimeInMins.Format(_T("%u"), dwTmp);

		m_pPrefs->SetBanMessageEnabled(B2b(m_bBanMessage));

		uint32	dwSec, dwMin = static_cast<uint32>(_tstoi(m_strMinRequestTime));

		CString strBuffer(m_strMinRequestTime);

		strBuffer.Replace(_T(":"), GetLocalDecimalPoint());
		if ((dwSec = static_cast<uint32>(_tstof(strBuffer) * 100.0 + .05) - dwMin * 100) > 59)
			dwSec = 59;
		if ((dwMin > 9) || ((dwMin == 9) && (dwSec > 50)))
		{
			dwMin = 9;
			dwSec = 50;
		}
		if (dwMin < 2)
		{
			dwMin = 2;
			dwSec = 0;
		}
		m_pPrefs->SetBadClientMinRequestTime((dwMin * 60 + dwSec) * 1000);
	//	Don't add "mins" for textbox (don't use CastSecondsToHM)
		m_strMinRequestTime.Format(_T("%u:%02u"), dwMin, dwSec);
		
		m_pPrefs->SetBanEnable(B2b(m_bBanEnabled));
		m_pPrefs->SetCommunityString(m_strComString);
		m_pPrefs->SetCommunityEnabled(B2b(m_bComEnabled));
		m_pPrefs->SetCommunityNoBanEnabled(B2b(m_bNoBanEnabled));

		dwTmp = static_cast<uint32>(_tstoi(m_strSlsMaxSources));
		if (dwTmp > PREF_MAX_MAXFILESLS)
			dwTmp = PREF_MAX_MAXFILESLS;
		if (dwTmp < PREF_MIN_MAXFILESLS)
			dwTmp = PREF_MIN_MAXFILESLS;
		m_pPrefs->SetSLSMaxSourcesPerFile(dwTmp);
		m_strSlsMaxSources.Format(_T("%u"), dwTmp);

		dwTmp = static_cast<uint32>(_tstoi(m_strOutdated));
		if (dwTmp > PREF_MAX_FILESLSDAYS)
			dwTmp = PREF_MAX_FILESLSDAYS;
		if (dwTmp < PREF_MIN_FILESLSDAYS)
			dwTmp = PREF_MIN_FILESLSDAYS;
		m_pPrefs->SetWhenSourcesOutdated(dwTmp);
		m_strOutdated.Format(_T("%u"), dwTmp);

		m_pPrefs->SetSLSEnable(B2b(m_bSlsEnabled));
		m_pPrefs->SetCounterMeasures(B2b(m_bCountermeasures));
		m_pPrefs->SetAutoCheckForNewVersion(B2b(m_bAutoNewVerChk));
		m_pPrefs->SetAutoFilenameCleanup(B2b(m_bFNameCleanup));
		m_pPrefs->SetFilenameCleanupTags(B2b(m_bFNameCleanupTag));

		UpdateData(FALSE);
		SetModified(FALSE);
	}
	return CPropertyPage::OnApply();
}

void CPPgAdvanced::Localize(void)
{
	static const uint16 s_auResTbl[][2] =
	{
		{ IDC_BAN, IDS_BAN },
		{ IDC_BANENABLED, IDS_ENABLED },
		{ IDC_CLIENTREQUESTLBL, IDS_CLIENTREQUESTLBL },
		{ IDC_BANFORLABEL, IDS_BANFORLABEL },
		{ IDC_TIMESINLBL, IDS_TIMESINLBL },
		{ IDC_MINUTES_BAN1, IDS_MINS },
		{ IDC_MINUTES_BAN2, IDS_MINS },
		{ IDC_COM, IDS_COM },
		{ IDC_COMENABLED, IDS_ENABLED },
		{ IDC_NOBANENABLED, IDS_NOBANENABLED },
		{ IDC_BANMESSAGE, IDS_BANMESSAGE },
		{ IDC_SAVELOADSOURCESGROUPBOX, IDS_SAVELOADSOURCESGROUPBOX },
		{ IDC_SLSMAXSOURCESLBL, IDS_PW_MAXSOURCES },
		{ IDC_SLS_OUTDATED, IDS_SLS_OUTDATED },
		{ IDC_SLS_SOURCES, IDS_SOURCES_PF_FILES },
		{ IDC_SLS_DAYS, IDS_LONGDAYS },
		{ IDC_SLSENABLED, IDS_ENABLED },
		{ IDC_COUNTERMEASURES, IDS_COUNTERMEASURES },
		{ IDC_AUTO_CHECK_NEW, IDS_AUTO_CHECK_NEW },
		{ IDC_FNCLEANUPGROUPBOX, IDS_FNCLEANUPGROUPBOX },
		{ IDC_FNC, IDS_FNCEDIT },
		{ IDC_FNCLEANUP, IDS_AUTOCLEANUPFN },
		{ IDC_FNCLEANUPTAG, IDS_CLEANUPTAGS }
	};

	if (::IsWindow(m_hWnd))
	{
		CString	strRes;

		for (uint32 i = 0; i < ARRSIZE(s_auResTbl); i++)
		{
			::GetResString(&strRes, static_cast<UINT>(s_auResTbl[i][1]));
			SetDlgItemText(s_auResTbl[i][0], strRes);
		}
	}
}

void CPPgAdvanced::OnBnClickedComEnabled()
{
	UpdateData(TRUE);

	GetDlgItem(IDC_COMSTRING)->EnableWindow(m_bComEnabled);
	GetDlgItem(IDC_NOBANENABLED)->EnableWindow(m_bComEnabled);

	SetModified();
}

void CPPgAdvanced::OnBnClickedSLSEnabled()
{
	UpdateData(TRUE);

	GetDlgItem(IDC_SLSMAXSOURCES)->EnableWindow(m_bSlsEnabled);
	GetDlgItem(IDC_OUTDATED)->EnableWindow(m_bSlsEnabled);

	SetModified();
}

void CPPgAdvanced::OnSetCleanupFilter()
{
	InputBox inputbox(GetResString(IDS_FNFILTERTITLE), g_App.m_pPrefs->GetFilenameCleanups());

	inputbox.DoModal();
	if (!inputbox.WasCancelled())
	{
		g_App.m_pPrefs->SetFilenameCleanups(inputbox.GetInput());
		SetModified();
	}
}

void CPPgAdvanced::OnBnClickedBanEnabled()
{
	UpdateData(TRUE);

	GetDlgItem(IDC_BANTIMES)->EnableWindow(m_bBanEnabled);
	GetDlgItem(IDC_MINREQUESTTIME)->EnableWindow(m_bBanEnabled);
	GetDlgItem(IDC_BANTIMEINMINS)->EnableWindow(m_bBanEnabled);
	GetDlgItem(IDC_BANMESSAGE)->EnableWindow(m_bBanEnabled);
	
	SetModified();
}
@


1.45
log
@Optimized dialog regarding required memory and speed;
Removed old not used localization;
Suppressed compiler warnings; Formatting.
@
text
@d157 1
a157 1
		strBuffer.Replace(_T(':'), _T('.'));
@


1.44
log
@Removed unneeded CString initializations.
@
text
@d1 15
a15 1
// PPgAdvanced.cpp : implementation file
a27 2
// CPPgAdvanced dialog

d31 9
a39 9
	, banMessage(FALSE)
	, banEnabled(FALSE)
	, noBanEnabled(FALSE)
	, comEnabled(FALSE)
	, slsEnabled(FALSE)
	, fnCleanup(FALSE)
	, fnCleanUpTag(FALSE)
	, counterMeasures(FALSE)
	, newAuto(FALSE)
d50 15
a64 44
	DDX_Text(pDX, IDC_BANTIMES, banTimes);
	DDX_Text(pDX, IDC_MINREQUESTTIME, minRequestTime);
	DDX_Text(pDX, IDC_BANTIMEINMINS, banTimeInMins);
	DDX_Check(pDX, IDC_BANMESSAGE, banMessage);
	DDX_Check(pDX, IDC_BANENABLED, banEnabled);
	DDX_Text(pDX, IDC_COMSTRING, comString);
	DDX_Check(pDX, IDC_NOBANENABLED, noBanEnabled);
	DDX_Check(pDX, IDC_COMENABLED, comEnabled);
	DDX_Text(pDX, IDC_SLSMAXSOURCES, slsMaxSources);
	DDX_Text(pDX, IDC_OUTDATED, outdated);
	DDX_Check(pDX, IDC_SLSENABLED, slsEnabled);
	DDX_Check(pDX, IDC_FNCLEANUP, fnCleanup);
	DDX_Check(pDX, IDC_FNCLEANUPTAG, fnCleanUpTag);
	DDX_Check(pDX, IDC_COUNTERMEASURES, counterMeasures);
	DDX_Check(pDX, IDC_AUTO_CHECK_NEW, newAuto);
	DDX_Control(pDX, IDC_BANTIMES, banTimesEdit);
	DDX_Control(pDX, IDC_MINREQUESTTIME, minRequestTimeEdit);
	DDX_Control(pDX, IDC_BANMESSAGE, banMessageCheck);
	DDX_Control(pDX, IDC_BANTIMEINMINS, banTimeInMinsEdit);
	DDX_Control(pDX, IDC_SLSMAXSOURCES, slsMaxSourcesEdit);
	DDX_Control(pDX, IDC_OUTDATED, outdatedEdit);
	DDX_Control(pDX, IDC_COMSTRING, comStringEdit);
	DDX_Control(pDX, IDC_NOBANENABLED, noBanEnabledCheck);
	DDX_Text(pDX, IDC_BAN, banDesc);
	DDX_Control(pDX, IDC_BANENABLED, banEnabledCheck);
	DDX_Text(pDX, IDC_CLIENTREQUESTLBL, clientRequestDesc);
	DDX_Text(pDX, IDC_BANFORLABEL, banForDesc);
	DDX_Text(pDX, IDC_TIMESINLBL, timesInDesc);
	DDX_Text(pDX, IDC_MINUTES_BAN1, minutesBan1Desc);
	DDX_Text(pDX, IDC_MINUTES_BAN2, minutesBan2Desc);
	DDX_Text(pDX, IDC_COM, comDesc);
	DDX_Control(pDX, IDC_COMENABLED, comEnabledCheck);
	DDX_Text(pDX, IDC_SAVELOADSOURCESGROUPBOX, saveLoadSourcesDesc);
	DDX_Text(pDX, IDC_SLSMAXSOURCESLBL, slsMaxSourcesDesc);
	DDX_Text(pDX, IDC_SLS_OUTDATED, slsOutdatedDesc);
	DDX_Text(pDX, IDC_SLS_SOURCES, slsSourcesDesc);
	DDX_Text(pDX, IDC_SLS_DAYS, slsDaysDesc);
	DDX_Control(pDX, IDC_SLSENABLED, slsEnabledCheck);
	DDX_Control(pDX, IDC_COUNTERMEASURES, counterMeasuresCheck);
	DDX_Control(pDX, IDC_AUTO_CHECK_NEW, newAutoCheck);
	DDX_Text(pDX, IDC_FNCLEANUPGROUPBOX, fnCleanUpDesc);
	DDX_Control(pDX, IDC_FNC, fncButton);
	DDX_Control(pDX, IDC_FNCLEANUP, fnCleanUpCheck);
	DDX_Control(pDX, IDC_FNCLEANUPTAG, fnCleanUpTagCheck);
d98 2
a99 2
	banTimes.Format(_T("%u"), m_pPrefs->BadClientMinRequestNum());
	banTimeInMins.Format(_T("%u"), m_pPrefs->BadClientBanTime() / 60000);
d104 13
a116 13
	minRequestTime.Format(_T("%u:%02u"), dwSecs / 60, dwSecs - (dwSecs / 60) * 60);
	banMessage = m_pPrefs->IsBanMessageEnabled();
	banEnabled = m_pPrefs->BanEnabled();
	comString = m_pPrefs->CommunityString();
	comEnabled = m_pPrefs->CommunityEnabled();
	noBanEnabled = m_pPrefs->CommunityNoBanEnabled();
	slsMaxSources.Format(_T("%u"), m_pPrefs->SLSMaxSourcesPerFile());
	outdated.Format(_T("%u"), m_pPrefs->WhenSourcesOutdated());
	slsEnabled = m_pPrefs->SLSEnable();
	counterMeasures = m_pPrefs->IsCounterMeasures();
	newAuto = m_pPrefs->IsAutoCheckForNewVersion();
	fnCleanup = m_pPrefs->GetAutoFilenameCleanup();
	fnCleanUpTag = m_pPrefs->GetFilenameCleanupTags();
d135 7
a141 7
		dwTmp = static_cast<uint32>(_tstoi(banTimes));
		if (dwTmp < 3)
			dwTmp = 3;
		if (dwTmp > 10)
			dwTmp = 10;
		m_pPrefs->SetBadClientMinRequestNum(dwTmp);
		banTimes.Format(_T("%u"), dwTmp);
d143 7
a149 7
		dwTmp = static_cast<uint32>(_tstoi(banTimeInMins));
		if (dwTmp > 300)
			dwTmp = 300;
		if (dwTmp < 30)
			dwTmp = 30;
		m_pPrefs->SetBadClientBanTime(dwTmp * 60000);
		banTimeInMins.Format(_T("%u"), dwTmp);
d151 1
a151 1
		m_pPrefs->SetBanMessageEnabled(banMessage);
d153 1
a153 1
		uint32	dwSec, dwMin = static_cast<uint32>(_tstoi(minRequestTime));
d155 1
a155 1
		CString strBuffer(minRequestTime);
d172 1
a172 1
		minRequestTime.Format(_T("%u:%02u"), dwMin, dwSec);
d174 10
a183 10
		m_pPrefs->SetBanEnable(banEnabled);
		m_pPrefs->SetCommunityString(comString);
		m_pPrefs->SetCommunityEnabled(comEnabled);
		m_pPrefs->SetCommunityNoBanEnabled(noBanEnabled);

		dwTmp = static_cast<uint32>(_tstoi(slsMaxSources));
		if (dwTmp > 20)
			dwTmp = 20;
		if (dwTmp < 5)
			dwTmp = 5;
d185 1
a185 1
		slsMaxSources.Format(_T("%u"), dwTmp);
d187 5
a191 5
		dwTmp = static_cast<uint32>(_tstoi(outdated));
		if (dwTmp > 2)
			dwTmp = 2;
		if (dwTmp < 1)
			dwTmp = 1;
d193 1
a193 1
		outdated.Format(_T("%u"), dwTmp);
d195 5
a199 5
		m_pPrefs->SetSLSEnable(slsEnabled);
		m_pPrefs->SetCounterMeasures(counterMeasures);
		m_pPrefs->SetAutoCheckForNewVersion(newAuto);
		m_pPrefs->SetAutoFilenameCleanup(fnCleanup);
		m_pPrefs->SetFilenameCleanupTags(fnCleanUpTag);
d209 27
d238 1
a238 1
		CString	strEnabled = GetResString(IDS_ENABLED);
d240 5
a244 25
		SetWindowText(GetResString(IDS_PW_ADVANCED));
		GetResString(&banDesc, IDS_BAN);
		banEnabledCheck.SetWindowText(strEnabled);
		GetResString(&clientRequestDesc, IDS_CLIENTREQUESTLBL);
		GetResString(&banForDesc, IDS_BANFORLABEL);
		GetResString(&timesInDesc, IDS_TIMESINLBL);
		GetResString(&minutesBan1Desc, IDS_MINS);
		GetResString(&minutesBan2Desc, IDS_MINS);
		GetResString(&comDesc, IDS_COM);
		comEnabledCheck.SetWindowText(strEnabled);
		noBanEnabledCheck.SetWindowText(GetResString(IDS_NOBANENABLED));
		banMessageCheck.SetWindowText(GetResString(IDS_BANMESSAGE));
		GetResString(&saveLoadSourcesDesc, IDS_SAVELOADSOURCESGROUPBOX);
		GetResString(&slsMaxSourcesDesc, IDS_PW_MAXSOURCES);
		GetResString(&slsOutdatedDesc, IDS_SLS_OUTDATED);
		GetResString(&slsSourcesDesc, IDS_SOURCES_PF_FILES);
		GetResString(&slsDaysDesc, IDS_LONGDAYS);
		slsEnabledCheck.SetWindowText(strEnabled);
		counterMeasuresCheck.SetWindowText(GetResString(IDS_COUNTERMEASURES));
		newAutoCheck.SetWindowText(GetResString(IDS_AUTO_CHECK_NEW));
		GetResString(&fnCleanUpDesc, IDS_FNCLEANUPGROUPBOX);
		fncButton.SetWindowText(GetResString(IDS_FNCEDIT));
		fnCleanUpCheck.SetWindowText(GetResString(IDS_AUTOCLEANUPFN));
		fnCleanUpTagCheck.SetWindowText(GetResString(IDS_CLEANUPTAGS));
		UpdateData(FALSE);
d251 3
a253 2
	comStringEdit.EnableWindow(comEnabled);
	noBanEnabledCheck.EnableWindow(comEnabled);
d261 3
a263 2
	slsMaxSourcesEdit.EnableWindow(slsEnabled);	
	outdatedEdit.EnableWindow(slsEnabled);	
d268 2
a269 2
void CPPgAdvanced::OnSetCleanupFilter() {
	
d283 5
a287 4
	banTimesEdit.EnableWindow(banEnabled);
	minRequestTimeEdit.EnableWindow(banEnabled);
	banTimeInMinsEdit.EnableWindow(banEnabled);
	banMessageCheck.EnableWindow(banEnabled);
@


1.43
log
@Improved string processing.
@
text
@a18 3
	, banTimes(_T(""))
	, minRequestTime(_T(""))
	, banTimeInMins(_T(""))
a20 1
	, comString(_T(""))
a22 2
	, slsMaxSources(_T(""))
	, outdated(_T(""))
a27 13
	, banDesc(_T(""))
	, clientRequestDesc(_T(""))
	, banForDesc(_T(""))
	, timesInDesc(_T(""))
	, minutesBan1Desc(_T(""))
	, minutesBan2Desc(_T(""))
	, comDesc(_T(""))
	, saveLoadSourcesDesc(_T(""))
	, slsMaxSourcesDesc(_T(""))
	, slsOutdatedDesc(_T(""))
	, slsSourcesDesc(_T(""))
	, slsDaysDesc(_T(""))
	, fnCleanUpDesc(_T(""))
@


1.42
log
@renamed g_pPrefs->m_pPrefs (f... paste & copy :( )
@
text
@d297 1
a297 1
	InputBox inputbox;
a298 1
	inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), g_App.m_pPrefs->GetFilenameCleanups());
@


1.41
log
@renamed 3 variables
@
text
@d299 1
a299 1
	inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), g_App.g_pPrefs->GetFilenameCleanups());
d303 1
a303 1
		g_App.g_pPrefs->SetFilenameCleanups(inputbox.GetInput());
@


1.40
log
@Improved preferences localization.
@
text
@d299 1
a299 1
	inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), g_eMuleApp.m_pGlobPrefs->GetFilenameCleanups());
d303 1
a303 1
		g_eMuleApp.m_pGlobPrefs->SetFilenameCleanups(inputbox.GetInput());
@


1.39
log
@minor changes (function renamings, unused typedef removal)
@
text
@d245 4
a248 1
	if(::IsWindow(m_hWnd)){
d250 9
a258 9
		banDesc = GetResString(IDS_BAN);
		banEnabledCheck.SetWindowText(GetResString(IDS_ENABLED));
		clientRequestDesc = GetResString(IDS_CLIENTREQUESTLBL);
		banForDesc = GetResString(IDS_BANFORLABEL);
		timesInDesc = GetResString(IDS_TIMESINLBL);
		minutesBan1Desc = GetResString(IDS_MINS);
		minutesBan2Desc = GetResString(IDS_MINS);
		comDesc = GetResString(IDS_COM);
		comEnabledCheck.SetWindowText(GetResString(IDS_ENABLED));
d261 6
a266 6
		saveLoadSourcesDesc = GetResString(IDS_SAVELOADSOURCESGROUPBOX);
		slsMaxSourcesDesc = GetResString(IDS_PW_MAXSOURCES);
		slsOutdatedDesc = GetResString(IDS_SLS_OUTDATED);
		slsSourcesDesc = GetResString(IDS_SOURCES_PF_FILES);
		slsDaysDesc = GetResString(IDS_LONGDAYS);
		slsEnabledCheck.SetWindowText(GetResString(IDS_ENABLED));
d269 1
a269 1
		fnCleanUpDesc = GetResString(IDS_FNCLEANUPGROUPBOX);
@


1.38
log
@Updated preferences (moved logs to a new page so we can add more options in the future)
@
text
@d32 1
a32 1
	, mlDonkeyCm(FALSE)
d70 1
a70 1
	DDX_Check(pDX, IDC_MLDONKEY_CM, mlDonkeyCm);
d95 1
a95 1
	DDX_Control(pDX, IDC_MLDONKEY_CM, mlDonkeyCmCheck);
d115 1
a115 1
	ON_BN_CLICKED(IDC_MLDONKEY_CM, OnSettingsChange)
d149 1
a149 1
	mlDonkeyCm = m_pPrefs->GetMlDonkeyCM();
d232 1
a232 1
		m_pPrefs->SetMlDonkeyCM(mlDonkeyCm);
d264 1
a264 1
		mlDonkeyCmCheck.SetWindowText(GetResString(IDS_MLDONKEY_CM));
@


1.37
log
@Optimization of input parameter checks and string processing.
@
text
@a32 1
	, cmNotLog(FALSE)
a70 1
	DDX_Check(pDX, IDC_CM_NOTLOG, cmNotLog);
a95 1
	DDX_Control(pDX, IDC_CM_NOTLOG, cmNotLogCheck);
d115 1
a115 2
	ON_BN_CLICKED(IDC_MLDONKEY_CM, OnBnClickedMLDonkeyCM)
	ON_BN_CLICKED(IDC_CM_NOTLOG, OnSettingsChange)
a116 1
	//SyruS: cleanup
a142 1

a145 1

a148 1

a149 2
	cmNotLog = m_pPrefs->GetCMNotLog();

a150 1

a158 1
	OnBnClickedMLDonkeyCM();
a210 1
		
a232 2
		m_pPrefs->SetCMNotLog(cmNotLog);

a233 2

		//SyruS: cleanup
a264 1
		cmNotLogCheck.SetWindowText(GetResString(IDS_CM_NOTLOG));	//netwolf
a265 1

a314 8

void CPPgAdvanced::OnBnClickedMLDonkeyCM()
{
	UpdateData(TRUE);
	cmNotLogCheck.EnableWindow(mlDonkeyCm);

	SetModified();
}
@


1.36
log
@Improved string processing
@
text
@d139 2
a140 2
	banTimes.Format(_T("%d"), m_pPrefs->BadClientMinRequestNum());
	banTimeInMins.Format(_T("%d"), m_pPrefs->BadClientBanTime()/60000);
d142 4
a145 3
	//SyruS don't add "mins" into textbox (don't use CastSecondsToHM)
	sint32 seconds = m_pPrefs->BadClientMinRequestTime()/1000;
	minRequestTime.Format(_T("%i:%02u"),seconds/60, seconds-(seconds/60)*60);
d153 2
a154 2
	slsMaxSources.Format(_T("%d"), m_pPrefs->SLSMaxSourcesPerFile());
	outdated.Format(_T("%d"), m_pPrefs->WhenSourcesOutdated());
d176 1
a176 1
{	
d181 9
a189 7
		m_pPrefs->SetBadClientMinRequestNum(_tstoi(banTimes));
		if(m_pPrefs->BadClientMinRequestNum() < 3)
			m_pPrefs->SetBadClientMinRequestNum(3);
		if(m_pPrefs->BadClientMinRequestNum() >10)
			m_pPrefs->SetBadClientMinRequestNum(10);

		banTimes.Format(_T("%u"),m_pPrefs->BadClientMinRequestNum());
d191 7
a197 5
		m_pPrefs->SetBadClientBanTime(_tstoi(banTimeInMins)*60000);
		if(m_pPrefs->BadClientBanTime() > 18000000)
			m_pPrefs->SetBadClientBanTime(18000000);
		if(m_pPrefs->BadClientBanTime() < 1800000)
			m_pPrefs->SetBadClientBanTime(1800000);
d199 1
a199 1
		banTimeInMins.Format(_T("%d"),m_pPrefs->BadClientBanTime()/60000);
d201 1
a201 1
		m_pPrefs->SetBanMessageEnabled(banMessage);
d206 15
a220 10
		int iTmp = (_tstof(strBuffer)-static_cast<double>(_tstoi(strBuffer)))*100.0+0.5;
		if (iTmp > 59) iTmp = 59;
		m_pPrefs->SetBadClientMinRequestTime(_tstoi(strBuffer)*60000 +iTmp *1000);
		if(m_pPrefs->BadClientMinRequestTime() > 590000)
			m_pPrefs->SetBadClientMinRequestTime(590000);
		if(m_pPrefs->BadClientMinRequestTime() < 120000)
			m_pPrefs->SetBadClientMinRequestTime(120000);		
		//SyruS dont add "mins" into textbox (dont use CastSecondsToHM)
		sint32 seconds = m_pPrefs->BadClientMinRequestTime()/1000;
		minRequestTime.Format(_T("%i:%02u"),seconds/60, seconds-(seconds/60)*60);
d228 15
a242 21
		m_pPrefs->SetSLSMaxSourcesPerFile(_tstoi(slsMaxSources));
		if(m_pPrefs->SLSMaxSourcesPerFile() > 20)
		{
			m_pPrefs->SetSLSMaxSourcesPerFile(20);
			slsMaxSources.Format(_T("%u"),m_pPrefs->SLSMaxSourcesPerFile());			
		}
		else if(m_pPrefs->SLSMaxSourcesPerFile() < 5)
		{
			m_pPrefs->SetSLSMaxSourcesPerFile(5);
			slsMaxSources.Format(_T("%u"),m_pPrefs->SLSMaxSourcesPerFile());			
		}

		m_pPrefs->SetWhenSourcesOutdated(_tstoi(outdated));
		if(m_pPrefs->WhenSourcesOutdated() > 2){
			m_pPrefs->SetWhenSourcesOutdated(2);
			outdated.Format(_T("%u"),m_pPrefs->WhenSourcesOutdated());			
		}
		else if(m_pPrefs->WhenSourcesOutdated() < 1){
			m_pPrefs->SetWhenSourcesOutdated(1);
			outdated.Format(_T("%u"),m_pPrefs->WhenSourcesOutdated());			
		}
@


1.35
log
@Improved string processing
@
text
@d186 1
a186 1
		banTimes.Format(_T("%d"),m_pPrefs->BadClientMinRequestNum());
d222 1
a222 1
			slsMaxSources.Format(_T("%d"),m_pPrefs->SLSMaxSourcesPerFile());			
d227 1
a227 1
			slsMaxSources.Format(_T("%d"),m_pPrefs->SLSMaxSourcesPerFile());			
d233 1
a233 1
			outdated.Format(_T("%d"),m_pPrefs->WhenSourcesOutdated());			
d237 1
a237 1
			outdated.Format(_T("%d"),m_pPrefs->WhenSourcesOutdated());			
@


1.34
log
@Improved string processings; trailing whitespace removal
@
text
@d198 3
a200 3
		
		CString strBuffer(minRequestTime);		
		strBuffer.Replace(_T(":"),_T("."));
@


1.33
log
@get rid of "1 days...." (don't think we need to do it for ds, hrs etc., do 'we ?)
@
text
@d138 2
a139 2
{	
	banTimes.Format(_T("%d"), m_pPrefs->BadClientMinRequestNum());	
d142 1
a142 1
	//SyruS dont add "mins" into textbox (dont use CastSecondsToHM)
d144 4
a147 4
	minRequestTime.Format(_T("%i:%s"),seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));	
	banMessage = m_pPrefs->IsBanMessageEnabled();		
	banEnabled = m_pPrefs->BanEnabled();		
	
d149 6
a154 6
	comEnabled = m_pPrefs->CommunityEnabled();		
	noBanEnabled = m_pPrefs->CommunityNoBanEnabled();		
	
	slsMaxSources.Format(_T("%d"), m_pPrefs->SLSMaxSourcesPerFile());	
	outdated.Format(_T("%d"), m_pPrefs->WhenSourcesOutdated());	
	slsEnabled = m_pPrefs->SLSEnable();		
d210 1
a210 1
		minRequestTime.Format(_T("%i:%s"),seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));
@


1.32
log
@minor changes to DebugLog and remove some marks
@
text
@d275 1
a275 1
		slsDaysDesc = GetResString(IDS_DAYS);
@


1.31
log
@Ability to turn off auto-check for new version
@
text
@d107 1
a107 1
	ON_BN_CLICKED(IDC_BANENABLED, OnBnClickedBanEnabled) // DbT:BanEnDisable
a145 1
	// DbT:BanEnDisable
a147 1
	// DbT:End
a160 1
	//SyruS: cleanup
d212 1
a212 1
		m_pPrefs->SetBanEnable(banEnabled); // DbT:BanEnDisable
d242 1
a242 1
		m_pPrefs->SetCMNotLog(cmNotLog);	// netwolf
d261 1
a261 1
		banEnabledCheck.SetWindowText(GetResString(IDS_ENABLED)); // DbT:BanEnDisable
d280 1
a280 1
		//SyruS: cleanup
a306 1
//SyruS: cleanup
a319 1
// DbT:BanEnDisable
a329 1
// DbT:End
a330 1
// netwolf: Do not log countermeasures
@


1.30
log
@Fix for SLS outdate after 0 days
@
text
@d34 1
d73 1
d99 1
d120 1
d160 3
d247 2
d282 1
@


1.29
log
@Formatting, comments, and name changes.
float => double conversion
@
text
@d231 4
@


1.28
log
@Removed NNS feature and changed SLS
@
text
@d197 1
a197 1
		int iTmp = (_tstof(strBuffer)-(float)_tstoi(strBuffer))*100.0f+0.5;
@


1.27
log
@Formatting, comments, and name changes.
@
text
@a26 1
	, restoreSourcesTime(_T(""))
a41 1
	, slsLoadEveryDesc(_T(""))
a43 1
	, slsMinsDesc(_T(""))
a64 1
	DDX_Text(pDX, IDC_RESTORE_SOURCES_TIME, restoreSourcesTime);
a75 1
	DDX_Control(pDX, IDC_RESTORE_SOURCES_TIME, restoreSourcesTimeEdit);
a81 1

a89 1
	DDX_Text(pDX, IDC_SLS_LOAD_EVERY, slsLoadEveryDesc);
a91 1
	DDX_Text(pDX, IDC_SLS_MINS, slsMinsDesc);
a111 1
	ON_EN_CHANGE(IDC_RESTORE_SOURCES_TIME, OnSettingsChange)
a149 1
	restoreSourcesTime.Format(_T("%d"), m_pPrefs->RestoreSourcesTime()/60000);	
a212 1
	
a213 6
		m_pPrefs->SetRestoreSourcesTime(_tstoi(restoreSourcesTime)*60000);
		if(m_pPrefs->RestoreSourcesTime() < 3600000){
			m_pPrefs->SetRestoreSourcesTime( 3600000);
			restoreSourcesTime.Format(_T("%d"),m_pPrefs->RestoreSourcesTime()/60000);			
		}
		
d215 1
a215 1
		if(m_pPrefs->SLSMaxSourcesPerFile() > 40)
d217 1
a217 1
			m_pPrefs->SetSLSMaxSourcesPerFile(40);
d220 1
a220 1
		else if(m_pPrefs->SLSMaxSourcesPerFile() < 10)
d222 1
a222 1
			m_pPrefs->SetSLSMaxSourcesPerFile(10);
d227 2
a228 2
		if(m_pPrefs->WhenSourcesOutdated() > 10){
			m_pPrefs->SetWhenSourcesOutdated(10);
a262 1
		slsLoadEveryDesc = GetResString(IDS_SLS_LOAD_EVERY);
a263 1
		slsMinsDesc = GetResString(IDS_MINS);
a289 1
	restoreSourcesTimeEdit.EnableWindow(slsEnabled);	
d330 1
a330 1
}@


1.26
log
@More name changes, reinstated CMuleCtrlItem class, moved srcsarevisible from CPartFile to CMuleCtrlItem (where it belongs), added "Show Full Status Icons" and "Show Gray Paused" features with corresponding preferences, modified "SmartOpen" code to make it sticky and to make it work with sources with changing states.
@
text
@d144 2
a145 2
	banTimes.Format(_T("%d"), app_prefs->BadClientMinRequestNum());	
	banTimeInMins.Format(_T("%d"), app_prefs->BadClientBanTime()/60000);
d148 1
a148 1
	sint32 seconds = app_prefs->BadClientMinRequestTime()/1000;
d150 1
a150 1
	banMessage = app_prefs->IsBanMessageEnabled();		
d152 1
a152 1
	banEnabled = app_prefs->BanEnabled();		
d155 3
a157 3
	comString = app_prefs->CommunityString();
	comEnabled = app_prefs->CommunityEnabled();		
	noBanEnabled = app_prefs->CommunityNoBanEnabled();		
d159 4
a162 4
	restoreSourcesTime.Format(_T("%d"), app_prefs->RestoreSourcesTime()/60000);	
	slsMaxSources.Format(_T("%d"), app_prefs->SLSMaxSourcesPerFile());	
	outdated.Format(_T("%d"), app_prefs->WhenSourcesOutdated());	
	slsEnabled = app_prefs->SLSEnable();		
d164 2
a165 2
	mlDonkeyCm = app_prefs->GetMlDonkeyCM();
	cmNotLog = app_prefs->GetCMNotLog();
d167 2
a168 2
	fnCleanup = app_prefs->GetAutoFilenameCleanup();
	fnCleanUpTag = app_prefs->GetFilenameCleanupTags();
d186 5
a190 5
		app_prefs->SetBadClientMinRequestNum(_tstoi(banTimes));
		if(app_prefs->BadClientMinRequestNum() < 3)
			app_prefs->SetBadClientMinRequestNum(3);
		if(app_prefs->BadClientMinRequestNum() >10)
			app_prefs->SetBadClientMinRequestNum(10);
d192 1
a192 1
		banTimes.Format(_T("%d"),app_prefs->BadClientMinRequestNum());
d194 5
a198 5
		app_prefs->SetBadClientBanTime(_tstoi(banTimeInMins)*60000);
		if(app_prefs->BadClientBanTime() > 18000000)
			app_prefs->SetBadClientBanTime(18000000);
		if(app_prefs->BadClientBanTime() < 1800000)
			app_prefs->SetBadClientBanTime(1800000);
d200 1
a200 1
		banTimeInMins.Format(_T("%d"),app_prefs->BadClientBanTime()/60000);
d202 1
a202 1
		app_prefs->SetBanMessageEnabled(banMessage);
d209 5
a213 5
		app_prefs->SetBadClientMinRequestTime(_tstoi(strBuffer)*60000 +iTmp *1000);
		if(app_prefs->BadClientMinRequestTime() > 590000)
			app_prefs->SetBadClientMinRequestTime(590000);
		if(app_prefs->BadClientMinRequestTime() < 120000)
			app_prefs->SetBadClientMinRequestTime(120000);		
d215 1
a215 1
		sint32 seconds = app_prefs->BadClientMinRequestTime()/1000;
d218 1
a218 1
		app_prefs->SetBanEnable(banEnabled); // DbT:BanEnDisable
d220 3
a222 3
		app_prefs->SetCommunityString(comString);
		app_prefs->SetCommunityEnabled(comEnabled);
		app_prefs->SetCommunityNoBanEnabled(noBanEnabled);
d225 4
a228 4
		app_prefs->SetRestoreSourcesTime(_tstoi(restoreSourcesTime)*60000);
		if(app_prefs->RestoreSourcesTime() < 3600000){
			app_prefs->SetRestoreSourcesTime( 3600000);
			restoreSourcesTime.Format(_T("%d"),app_prefs->RestoreSourcesTime()/60000);			
d231 2
a232 2
		app_prefs->SetSLSMaxSourcesPerFile(_tstoi(slsMaxSources));
		if(app_prefs->SLSMaxSourcesPerFile() > 40)
d234 2
a235 2
			app_prefs->SetSLSMaxSourcesPerFile(40);
			slsMaxSources.Format(_T("%d"),app_prefs->SLSMaxSourcesPerFile());			
d237 1
a237 1
		else if(app_prefs->SLSMaxSourcesPerFile() < 10)
d239 2
a240 2
			app_prefs->SetSLSMaxSourcesPerFile(10);
			slsMaxSources.Format(_T("%d"),app_prefs->SLSMaxSourcesPerFile());			
d243 4
a246 4
		app_prefs->SetWhenSourcesOutdated(_tstoi(outdated));
		if(app_prefs->WhenSourcesOutdated() > 10){
			app_prefs->SetWhenSourcesOutdated(10);
			outdated.Format(_T("%d"),app_prefs->WhenSourcesOutdated());			
d249 3
a251 3
		app_prefs->SetSLSEnable(slsEnabled);
		app_prefs->SetMlDonkeyCM(mlDonkeyCm);
		app_prefs->SetCMNotLog(cmNotLog);	// netwolf
d254 2
a255 2
		app_prefs->SetAutoFilenameCleanup(fnCleanup);
		app_prefs->SetFilenameCleanupTags(fnCleanUpTag);
@


1.25
log
@FEATURE: logging countermeasures made optional [Netwolf]
plus cleanup of unused prefs (transfer full chunks, global load f/l chunks first...)
@
text
@d321 1
a321 1
	inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), theApp.glob_prefs->GetFilenameCleanups());
d325 1
a325 1
		theApp.glob_prefs->SetFilenameCleanups(inputbox.GetInput());
@


1.24
log
@now using Ottavio´s SLS system [netwolf]
@
text
@d34 1
d75 1
d104 1
d124 2
a125 1
	ON_BN_CLICKED(IDC_MLDONKEY_CM, OnSettingsChange)
d165 1
d175 1
d251 1
d287 1
d342 9
@


1.23
log
@converted to use DDX framework
@
text
@d28 1
a28 1
	, loadQuantities(_T(""))
d43 1
a43 1
	, slsLoadQuantityDesc(_T(""))
d68 1
a68 1
	DDX_Text(pDX, IDC_LOAD_QUANTITIES, loadQuantities);
d79 1
a79 1
	DDX_Control(pDX, IDC_LOAD_QUANTITIES, loadQuantitiesEdit);
d95 1
a95 1
	DDX_Text(pDX, IDC_SLS_LOAD_QUANTITY, slsLoadQuantityDesc);
d118 1
a118 1
	ON_EN_CHANGE(IDC_LOAD_QUANTITIES, OnSettingsChange)
d156 1
a156 1
	loadQuantities.Format(_T("%d"), app_prefs->LoadQuantities());	
d159 1
a159 1
	
d225 10
a234 4
		app_prefs->SetLoadQuantities(_tstoi(loadQuantities));
		if(app_prefs->LoadQuantities() > 100){
			app_prefs->SetLoadQuantities(100);
			loadQuantities.Format(_T("%d"),app_prefs->LoadQuantities());			
d272 1
a272 1
		slsLoadQuantityDesc = GetResString(IDS_SLS_LOAD_QUANTITY);
d302 1
a302 1
	loadQuantitiesEdit.EnableWindow(slsEnabled);	
@


1.22
log
@unicode cleanup
@
text
@d19 30
d59 47
d139 4
a142 7
{
	CString buffer;
	buffer.Format(_T("%d"), app_prefs->BadClientMinRequestNum());
	GetDlgItem(IDC_BANTIMES)->SetWindowText(buffer);
	buffer.Format(_T("%d"), app_prefs->BadClientBanTime()/60000);
	GetDlgItem(IDC_BANTIMEINMINS)->SetWindowText(buffer);

d145 2
a146 7
	buffer.Format(_T("%i:%s"),seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));
	GetDlgItem(IDC_MINREQUESTTIME)->SetWindowText(buffer);

	if (app_prefs->IsBanMessageEnabled()) 
		CheckDlgButton(IDC_BANMESSAGE,1);
	else
		CheckDlgButton(IDC_BANMESSAGE,0);
d148 2
a149 5
	if(app_prefs->BanEnabled())
		CheckDlgButton(IDC_BANENABLED,1);
	else
		CheckDlgButton(IDC_BANENABLED,0);
	OnBnClickedBanEnabled();
d151 13
d165 3
a167 9
	GetDlgItem(IDC_COMSTRING)->SetWindowText(app_prefs->CommunityString());
	if(app_prefs->CommunityEnabled())
		CheckDlgButton(IDC_COMENABLED,1);
	else
		CheckDlgButton(IDC_COMENABLED,0);
	if(app_prefs->CommunityNoBanEnabled())
		CheckDlgButton(IDC_NOBANENABLED,1);
	else
		CheckDlgButton(IDC_NOBANENABLED,0);
a168 11

	buffer.Format(_T("%d"), app_prefs->RestoreSourcesTime()/60000);
	GetDlgItem(IDC_RESTORE_SOURCES_TIME)->SetWindowText(buffer);
	buffer.Format(_T("%d"), app_prefs->LoadQuantities());
	GetDlgItem(IDC_LOAD_QUANTITIES)->SetWindowText(buffer);
	buffer.Format(_T("%d"), app_prefs->WhenSourcesOutdated());
	GetDlgItem(IDC_OUTDATED)->SetWindowText(buffer);
	if(app_prefs->SLSEnable())
		CheckDlgButton(IDC_SLSENABLED,1);
	else
		CheckDlgButton(IDC_SLSENABLED,0);
a170 9
	if(app_prefs->GetMlDonkeyCM())
		CheckDlgButton(IDC_MLDONKEY_CM,1);
	else
		CheckDlgButton(IDC_MLDONKEY_CM,0);

	//SyruS: cleanup
	CheckDlgButton(IDC_FNCLEANUP, (uint8)app_prefs->GetAutoFilenameCleanup());
	CheckDlgButton(IDC_FNCLEANUPTAG, (uint8)app_prefs->GetFilenameCleanupTags());

a175 2
//	CSingleLock PrefLock(&(app_prefs->m_Pref_Mutex),TRUE); 

d178 3
a180 5
		CString buffer;
		int iTmp;

		GetDlgItem(IDC_BANTIMES)->GetWindowText(buffer);
		app_prefs->SetBadClientMinRequestNum(_tstoi(buffer));
d186 3
a188 5
		buffer.Format(_T("%d"),app_prefs->BadClientMinRequestNum());
		GetDlgItem(IDC_BANTIMES)->SetWindowText(buffer);

		GetDlgItem(IDC_BANTIMEINMINS)->GetWindowText(buffer);
		app_prefs->SetBadClientBanTime(_tstoi(buffer)*60000);
d194 1
a194 2
		buffer.Format(_T("%d"),app_prefs->BadClientBanTime()/60000);
		GetDlgItem(IDC_BANTIMEINMINS)->SetWindowText(buffer);
d196 1
a196 1
		app_prefs->SetBanMessageEnabled(IsDlgButtonChecked(IDC_BANMESSAGE));
d198 2
a199 2
		GetDlgItem(IDC_MINREQUESTTIME)->GetWindowText(buffer);
		CString strBuffer(buffer);		
d201 2
a202 2
		iTmp=(_tstof(strBuffer)-(float)_tstoi(strBuffer))*100.0f+0.5;
		if (iTmp>59) iTmp=59;
d210 7
a216 8
		buffer.Format(_T("%i:%s"),seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));
		GetDlgItem(IDC_MINREQUESTTIME)->SetWindowText(buffer);
		app_prefs->SetBanEnable((int8)IsDlgButtonChecked(IDC_BANENABLED)); // DbT:BanEnDisable

		GetDlgItem(IDC_COMSTRING)->GetWindowText(buffer);
		app_prefs->SetCommunityString(buffer);
		app_prefs->SetCommunityEnabled((int8)IsDlgButtonChecked(IDC_COMENABLED));
		app_prefs->SetCommunityNoBanEnabled((int8)IsDlgButtonChecked(IDC_NOBANENABLED));
d218 2
a219 2
		GetDlgItem(IDC_RESTORE_SOURCES_TIME)->GetWindowText(buffer);
		app_prefs->SetRestoreSourcesTime(_tstoi(buffer)*60000);
d222 1
a222 2
			buffer.Format(_T("%d"),app_prefs->RestoreSourcesTime()/60000);
			GetDlgItem(IDC_RESTORE_SOURCES_TIME)->SetWindowText(buffer);
d224 2
a225 2
		GetDlgItem(IDC_LOAD_QUANTITIES)->GetWindowText(buffer);
		app_prefs->SetLoadQuantities(_tstoi(buffer));
d228 1
a228 2
			buffer.Format(_T("%d"),app_prefs->LoadQuantities());
			GetDlgItem(IDC_LOAD_QUANTITIES)->SetWindowText(buffer);
d230 2
a231 2
		GetDlgItem(IDC_OUTDATED)->GetWindowText(buffer);
		app_prefs->SetWhenSourcesOutdated(_tstoi(buffer));
d234 1
a234 2
			buffer.Format(_T("%d"),app_prefs->WhenSourcesOutdated());
			GetDlgItem(IDC_OUTDATED)->SetWindowText(buffer);
a235 1
		app_prefs->SetSLSEnable((int8)IsDlgButtonChecked(IDC_SLSENABLED));
d237 2
a238 1
		app_prefs->SetMlDonkeyCM((int8)IsDlgButtonChecked(IDC_MLDONKEY_CM));
d241 2
a242 2
		app_prefs->SetAutoFilenameCleanup((int8)IsDlgButtonChecked(IDC_FNCLEANUP));
		app_prefs->SetFilenameCleanupTags((int8)IsDlgButtonChecked(IDC_FNCLEANUPTAG));
d244 1
d252 1
a252 1
	if(m_hWnd){
d254 20
a273 20
		GetDlgItem(IDC_BAN)->SetWindowText(GetResString(IDS_BAN));
		GetDlgItem(IDC_BANENABLED)->SetWindowText(GetResString(IDS_ENABLED)); // DbT:BanEnDisable
		GetDlgItem(IDC_CLIENTREQUESTLBL)->SetWindowText(GetResString(IDS_CLIENTREQUESTLBL));
		GetDlgItem(IDC_BANFORLABEL)->SetWindowText(GetResString(IDS_BANFORLABEL));
		GetDlgItem(IDC_TIMESINLBL)->SetWindowText(GetResString(IDS_TIMESINLBL));
		GetDlgItem(IDC_MINUTES_BAN1)->SetWindowText(GetResString(IDS_MINS));
		GetDlgItem(IDC_MINUTES_BAN2)->SetWindowText(GetResString(IDS_MINS));
		GetDlgItem(IDC_COM)->SetWindowText(GetResString(IDS_COM));
		GetDlgItem(IDC_COMENABLED)->SetWindowText(GetResString(IDS_ENABLED));
		GetDlgItem(IDC_NOBANENABLED)->SetWindowText(GetResString(IDS_NOBANENABLED));
		GetDlgItem(IDC_BANMESSAGE)->SetWindowText(GetResString(IDS_BANMESSAGE));
		GetDlgItem(IDC_SAVELOADSOURCESGROUPBOX)->SetWindowText(GetResString(IDS_SAVELOADSOURCESGROUPBOX));
		GetDlgItem(IDC_SLS_LOAD_QUANTITY)->SetWindowText(GetResString(IDS_SLS_LOAD_QUANTITY));
		GetDlgItem(IDC_SLS_LOAD_EVERY)->SetWindowText(GetResString(IDS_SLS_LOAD_EVERY));
		GetDlgItem(IDC_SLS_OUTDATED)->SetWindowText(GetResString(IDS_SLS_OUTDATED));
		GetDlgItem(IDC_SLS_MINS)->SetWindowText(GetResString(IDS_MINS));
		GetDlgItem(IDC_SLS_SOURCES)->SetWindowText(GetResString(IDS_SOURCES_PF_FILES));
		GetDlgItem(IDC_SLS_DAYS)->SetWindowText(GetResString(IDS_DAYS));
		GetDlgItem(IDC_SLSENABLED)->SetWindowText(GetResString(IDS_ENABLED));
		GetDlgItem(IDC_MLDONKEY_CM)->SetWindowText(GetResString(IDS_MLDONKEY_CM));
d275 5
a279 4
		GetDlgItem(IDC_FNCLEANUPGROUPBOX)->SetWindowText(GetResString(IDS_FNCLEANUPGROUPBOX));
		GetDlgItem(IDC_FNC)->SetWindowText(GetResString(IDS_FNCEDIT));
		GetDlgItem(IDC_FNCLEANUP)->SetWindowText(GetResString(IDS_AUTOCLEANUPFN));
		GetDlgItem(IDC_FNCLEANUPTAG)->SetWindowText(GetResString(IDS_CLEANUPTAGS));
d285 3
a287 2
	GetDlgItem(IDC_COMSTRING)->EnableWindow(IsDlgButtonChecked(IDC_COMENABLED));
	GetDlgItem(IDC_NOBANENABLED)->EnableWindow(IsDlgButtonChecked(IDC_COMENABLED));
d294 4
a297 3
	GetDlgItem(IDC_RESTORE_SOURCES_TIME)->EnableWindow(IsDlgButtonChecked(IDC_SLSENABLED));	
	GetDlgItem(IDC_LOAD_QUANTITIES)->EnableWindow(IsDlgButtonChecked(IDC_SLSENABLED));	
	GetDlgItem(IDC_OUTDATED)->EnableWindow(IsDlgButtonChecked(IDC_SLSENABLED));	
d304 2
a305 9
				InputBox inputbox;

				inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), theApp.glob_prefs->GetFilenameCleanups());
				inputbox.DoModal();
				if (!inputbox.WasCancelled())
				{
					theApp.glob_prefs->SetFilenameCleanups(inputbox.GetInput());
					SetModified();
				}
d307 7
d319 5
a323 4
	GetDlgItem(IDC_BANTIMES)->EnableWindow(IsDlgButtonChecked(IDC_BANENABLED));
	GetDlgItem(IDC_MINREQUESTTIME)->EnableWindow(IsDlgButtonChecked(IDC_BANENABLED));
	GetDlgItem(IDC_BANTIMEINMINS)->EnableWindow(IsDlgButtonChecked(IDC_BANENABLED));
	GetDlgItem(IDC_BANMESSAGE)->EnableWindow(IsDlgButtonChecked(IDC_BANENABLED));
@


1.21
log
@BUGFIX: don't add "mins" into textbox (advanced / ban threshold) [SyruS]
@
text
@d64 1
a64 1
	buffer.Format("%d", app_prefs->BadClientMinRequestNum());
d66 1
a66 1
	buffer.Format("%d", app_prefs->BadClientBanTime()/60000);
d71 1
a71 1
	buffer.Format("%i:%s",seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));
d97 1
a97 1
	buffer.Format("%d", app_prefs->RestoreSourcesTime()/60000);
d99 1
a99 1
	buffer.Format("%d", app_prefs->LoadQuantities());
d101 1
a101 1
	buffer.Format("%d", app_prefs->WhenSourcesOutdated());
d131 1
a131 1
		app_prefs->SetBadClientMinRequestNum(atoi(buffer));
d137 1
a137 1
		buffer.Format("%d",app_prefs->BadClientMinRequestNum());
d141 1
a141 1
		app_prefs->SetBadClientBanTime(atoi(buffer)*60000);
d147 1
a147 1
		buffer.Format("%d",app_prefs->BadClientBanTime()/60000);
d154 2
a155 2
		strBuffer.Replace(":",".");
		iTmp=(atof(strBuffer)-(float)atoi(strBuffer))*100.0f+0.5;
d157 1
a157 1
		app_prefs->SetBadClientMinRequestTime(atoi(strBuffer)*60000 +iTmp *1000);
d164 1
a164 1
		buffer.Format("%i:%s",seconds/60,LeadingZero(seconds-(seconds/60)*60).GetBuffer(0));
d174 1
a174 1
		app_prefs->SetRestoreSourcesTime(atoi(buffer)*60000);
d177 1
a177 1
			buffer.Format("%d",app_prefs->RestoreSourcesTime()/60000);
d181 1
a181 1
		app_prefs->SetLoadQuantities(atoi(buffer));
d184 1
a184 1
			buffer.Format("%d",app_prefs->LoadQuantities());
d188 1
a188 1
		app_prefs->SetWhenSourcesOutdated(atoi(buffer));
d191 1
a191 1
			buffer.Format("%d",app_prefs->WhenSourcesOutdated());
@


1.20
log
@FEATURE: en/disable banning optional [DoubleT]
@
text
@d69 3
a71 1
	buffer = CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000);
d162 3
a164 1
		buffer = CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000);		//Cax2 terminate the string after the seconds...
@


1.19
log
@code cleanup
@
text
@d32 1
d76 7
d162 1
d208 1
d265 12
@


1.18
log
@SyruS: moved cleanup-visuals to advanced tab
@
text
@d62 2
a63 2
	char buffer[200];
	sprintf(buffer,"%d", app_prefs->BadClientMinRequestNum());
d65 1
a65 1
	sprintf(buffer,"%d", app_prefs->BadClientBanTime()/60000);
d68 1
a68 1
	CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000,buffer,5);
d87 1
a87 1
	sprintf(buffer,"%d", app_prefs->RestoreSourcesTime()/60000);
d89 1
a89 1
	sprintf(buffer,"%d", app_prefs->LoadQuantities());
d91 1
a91 1
	sprintf(buffer,"%d", app_prefs->WhenSourcesOutdated());
d117 1
a117 1
		char buffer[200];
d120 1
a120 1
		GetDlgItem(IDC_BANTIMES)->GetWindowText(buffer,3);
d127 1
a127 1
		sprintf(buffer, "%d",app_prefs->BadClientMinRequestNum());
d130 1
a130 1
		GetDlgItem(IDC_BANTIMEINMINS)->GetWindowText(buffer,6);
d137 1
a137 1
		sprintf(buffer, "%d",app_prefs->BadClientBanTime()/60000);
d142 2
a143 3
		GetDlgItem(IDC_MINREQUESTTIME)->GetWindowText(buffer,6);
		CString strBuffer;
		strBuffer=buffer;
d152 1
a152 1
		CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000,buffer,5);		//Cax2 terminate the string after the seconds...
d155 1
a155 1
		GetDlgItem(IDC_COMSTRING)->GetWindowText(buffer,100);
d160 1
a160 1
		GetDlgItem(IDC_RESTORE_SOURCES_TIME)->GetWindowText(buffer,8);
d164 1
a164 1
			sprintf(buffer, "%d",app_prefs->RestoreSourcesTime()/60000);
d167 1
a167 1
		GetDlgItem(IDC_LOAD_QUANTITIES)->GetWindowText(buffer,8);
d171 1
a171 1
			sprintf(buffer, "%d",app_prefs->LoadQuantities());
d174 1
a174 1
		GetDlgItem(IDC_OUTDATED)->GetWindowText(buffer,3);
d178 1
a178 1
			sprintf(buffer, "%d",app_prefs->WhenSourcesOutdated());
@


1.17
log
@Updated Night Shift to Scheduller (needs more testing and a new icon from DrSiRiUs... coming!)
@
text
@d6 1
d44 4
d104 4
d186 4
d218 5
d241 14
@


1.16
log
@Enabled Night Shift Enabled translations.
@
text
@a27 2
	DDX_Control(pDX, IDC_NS_DAY_TIME, m_nsdtime); // DonGato
	DDX_Control(pDX, IDC_NS_NIGHT_TIME, m_nsntime); // DonGato
a42 10
	ON_BN_CLICKED(IDC_NS_ENABLED, OnBnClickedNSEnabled)
	ON_CBN_SELCHANGE(IDC_NS_DAY_TIME, OnCbnSelchangeDayTime)
	ON_CBN_SELCHANGE(IDC_NS_NIGHT_TIME, OnCbnSelchangeNightTime)
	ON_EN_CHANGE(IDC_NS_DAY_UP, OnSettingsChange)
	ON_EN_CHANGE(IDC_NS_DAY_DOWN, OnSettingsChange)
	ON_EN_CHANGE(IDC_NS_NIGHT_UP, OnSettingsChange)
	ON_EN_CHANGE(IDC_NS_NIGHT_DOWN, OnSettingsChange)
	ON_BN_CLICKED(IDC_NS_EXCEPT, OnSettingsChange)
	ON_BN_CLICKED(IDC_NS_EXCEPT_SAT, OnSettingsChange)
	ON_BN_CLICKED(IDC_NS_EXCEPT_SUN, OnSettingsChange)
a48 30
	m_nsdtime.SetItemData(m_nsdtime.AddString("6:00"),21600);
	m_nsdtime.SetItemData(m_nsdtime.AddString("6:30"),23400);
	m_nsdtime.SetItemData(m_nsdtime.AddString("7:00"),25200);
	m_nsdtime.SetItemData(m_nsdtime.AddString("7:30"),27000);
	m_nsdtime.SetItemData(m_nsdtime.AddString("8:00"),28800);
	m_nsdtime.SetItemData(m_nsdtime.AddString("8:30"),30600);
	m_nsdtime.SetItemData(m_nsdtime.AddString("9:00"),32400);
	m_nsdtime.SetItemData(m_nsdtime.AddString("9:30"),34200);
	m_nsdtime.SetItemData(m_nsdtime.AddString("10:00"),36000);
	m_nsdtime.SetItemData(m_nsdtime.AddString("10:30"),37800);
	m_nsdtime.SetItemData(m_nsdtime.AddString("11:00"),39600);
	m_nsdtime.SetItemData(m_nsdtime.AddString("11:30"),41400);
	m_nsdtime.SetItemData(m_nsdtime.AddString("12:00"),43200);
	m_nsdtime.SetItemData(m_nsdtime.AddString("12:30"),45000);

	m_nsntime.SetItemData(m_nsntime.AddString("17:00"),61200);
	m_nsntime.SetItemData(m_nsntime.AddString("17:30"),63000);
	m_nsntime.SetItemData(m_nsntime.AddString("18:00"),64800);
	m_nsntime.SetItemData(m_nsntime.AddString("18:30"),66600);
	m_nsntime.SetItemData(m_nsntime.AddString("19:00"),68400);
	m_nsntime.SetItemData(m_nsntime.AddString("19:30"),70200);
	m_nsntime.SetItemData(m_nsntime.AddString("20:00"),72000);
	m_nsntime.SetItemData(m_nsntime.AddString("20:30"),73800);
	m_nsntime.SetItemData(m_nsntime.AddString("21:00"),75600);
	m_nsntime.SetItemData(m_nsntime.AddString("21:30"),77400);
	m_nsntime.SetItemData(m_nsntime.AddString("22:00"),79200);
	m_nsntime.SetItemData(m_nsntime.AddString("22:30"),81000);
	m_nsntime.SetItemData(m_nsntime.AddString("23:00"),82800);
	m_nsntime.SetItemData(m_nsntime.AddString("23:30"),84600);

a93 53
	for(int i = 0; i != m_nsdtime.GetCount(); i++)
		if(m_nsdtime.GetItemData(i) == app_prefs->GetNSEnd())
			m_nsdtime.SetCurSel(i);

	for(int i = 0; i != m_nsntime.GetCount(); i++)
		if(m_nsntime.GetItemData(i) == app_prefs->GetNSStart())
			m_nsntime.SetCurSel(i);

	if(app_prefs->GetNSDayUpload() == 0xFFFF)
		GetDlgItem(IDC_NS_DAY_UP)->SetWindowText("0");
	else
	{
		sprintf(buffer,"%d", app_prefs->GetNSDayUpload());
		GetDlgItem(IDC_NS_DAY_UP)->SetWindowText(buffer);
	}
	if(app_prefs->GetNSDayDownload() == 0xFFFF)
		GetDlgItem(IDC_NS_DAY_DOWN)->SetWindowText("0");
	else
	{
		sprintf(buffer,"%d", app_prefs->GetNSDayDownload());
		GetDlgItem(IDC_NS_DAY_DOWN)->SetWindowText(buffer);
	}

	if(app_prefs->GetNSNightUpload() == 0xFFFF)
		GetDlgItem(IDC_NS_NIGHT_UP)->SetWindowText("0");
	else
	{
		sprintf(buffer,"%d", app_prefs->GetNSNightUpload());
		GetDlgItem(IDC_NS_NIGHT_UP)->SetWindowText(buffer);
	}
	if(app_prefs->GetNSNightDownload() == 0xFFFF)
		GetDlgItem(IDC_NS_NIGHT_DOWN)->SetWindowText("0");
	else
	{
		sprintf(buffer,"%d", app_prefs->GetNSNightDownload());
		GetDlgItem(IDC_NS_NIGHT_DOWN)->SetWindowText(buffer);
	}

	if(app_prefs->IsNSExceptSat())
		CheckDlgButton(IDC_NS_EXCEPT_SAT,1);
	else
		CheckDlgButton(IDC_NS_EXCEPT_SAT,0);
	if(app_prefs->IsNSExceptSun())
		CheckDlgButton(IDC_NS_EXCEPT_SUN,1);
	else
		CheckDlgButton(IDC_NS_EXCEPT_SUN,0);

	if(app_prefs->IsNSEnabled())
		CheckDlgButton(IDC_NS_ENABLED,1);
	else
		CheckDlgButton(IDC_NS_ENABLED,0);
	OnBnClickedNSEnabled();

a174 35
		if(GetDlgItem(IDC_NS_DAY_UP)->GetWindowTextLength())
		{
			GetDlgItem(IDC_NS_DAY_UP)->GetWindowText(buffer,20);
			app_prefs->SetNSDayUpload((atoi(buffer)) ? atoi(buffer) : 0xFFFF);
		}
		if(GetDlgItem(IDC_NS_DAY_DOWN)->GetWindowTextLength())
		{
			GetDlgItem(IDC_NS_DAY_DOWN)->GetWindowText(buffer,20);
			app_prefs->SetNSDayDownload((atoi(buffer)) ? atoi(buffer) : 0xFFFF);
		}
		theApp.uploadqueue->NSDayUploadCheck();

		if(GetDlgItem(IDC_NS_NIGHT_UP)->GetWindowTextLength())
		{
			GetDlgItem(IDC_NS_NIGHT_UP)->GetWindowText(buffer,20);
			app_prefs->SetNSNightUpload((atoi(buffer)) ? atoi(buffer) : 0xFFFF);
		}
		if(GetDlgItem(IDC_NS_NIGHT_DOWN)->GetWindowTextLength())
		{
			GetDlgItem(IDC_NS_NIGHT_DOWN)->GetWindowText(buffer,20);
			app_prefs->SetNSNightDownload((atoi(buffer)) ? atoi(buffer) : 0xFFFF);
		}
		theApp.uploadqueue->NSNightUploadCheck();

		if (m_nsdtime.GetCurSel() != CB_ERR){
			app_prefs->SetNSEnd(m_nsdtime.GetItemData(m_nsdtime.GetCurSel()));
		}
		if (m_nsntime.GetCurSel() != CB_ERR){
			app_prefs->SetNSStart(m_nsntime.GetItemData(m_nsntime.GetCurSel()));
		}

		app_prefs->SetNSExceptSat((int8)IsDlgButtonChecked(IDC_NS_EXCEPT_SAT));
		app_prefs->SetNSExceptSun((int8)IsDlgButtonChecked(IDC_NS_EXCEPT_SUN));
		app_prefs->SetNSEnabled((int8)IsDlgButtonChecked(IDC_NS_ENABLED));

a204 14

		GetDlgItem(IDC_NS_FRM)->SetWindowText(GetResString(IDS_NS_FRM));
		GetDlgItem(IDC_NS_DAY)->SetWindowText(GetResString(IDS_NS_DAY));
		GetDlgItem(IDC_NS_NIGHT)->SetWindowText(GetResString(IDS_NS_NIGHT));
		GetDlgItem(IDC_NS_KB1)->SetWindowText(GetResString(IDS_KBYTESEC));
		GetDlgItem(IDC_NS_KB2)->SetWindowText(GetResString(IDS_KBYTESEC));
		GetDlgItem(IDC_NS_TIME)->SetWindowText(GetResString(IDS_TIME));
		GetDlgItem(IDC_NS_UP)->SetWindowText(GetResString(IDS_NS_UP));
		GetDlgItem(IDC_NS_DOWN)->SetWindowText(GetResString(IDS_NS_DOWN));
		GetDlgItem(IDC_NS_DOWN)->SetWindowText(GetResString(IDS_NS_DOWN));
		GetDlgItem(IDC_NS_EXCEPT)->SetWindowText(GetResString(IDS_NS_EXCEPT));
		GetDlgItem(IDC_NS_EXCEPT_SAT)->SetWindowText(GetResString(IDS_NS_EXCEPT_SAT));
		GetDlgItem(IDC_NS_EXCEPT_SUN)->SetWindowText(GetResString(IDS_NS_EXCEPT_SUN));
		GetDlgItem(IDC_NS_ENABLED)->SetWindowText(GetResString(IDS_ENABLED));
a220 15

	SetModified();
}

void CPPgAdvanced::OnBnClickedNSEnabled()
{
	GetDlgItem(IDC_NS_DAY_TIME)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_DAY_UP)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_DAY_DOWN)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_NIGHT_TIME)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_NIGHT_UP)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_NIGHT_DOWN)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_EXCEPT_SAT)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
	GetDlgItem(IDC_NS_EXCEPT_SUN)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));

@


1.15
log
@Added more times for Night Shift and corrected one.
@
text
@d348 1
@


1.14
log
@Updated times for Night Shift
@
text
@d69 6
a74 2
	m_nsdtime.SetItemData(m_nsdtime.AddString("10:00"),34200);
	m_nsdtime.SetItemData(m_nsdtime.AddString("10:30"),36000);
d86 4
@


1.13
log
@Changed weekend except to take in account sat/sun shifts exception. :-(
@
text
@d69 2
d72 2
@


1.12
log
@Weekend exclusion interface code.
@
text
@d53 2
d162 2
a163 2
	if(app_prefs->IsNSExceptWeekend())
		CheckDlgButton(IDC_NS_EXCEPT,1);
d165 5
a169 1
		CheckDlgButton(IDC_NS_EXCEPT,0);
d289 2
a290 1
		app_prefs->SetNSExceptWeekend((int8)IsDlgButtonChecked(IDC_NS_EXCEPT));
d334 2
d364 3
a366 1
	GetDlgItem(IDC_NS_EXCEPT)->EnableWindow(IsDlgButtonChecked(IDC_NS_ENABLED));
@


1.11
log
@Night Shift (in cooperation with obaldin :P)
@
text
@d52 1
d160 5
d282 2
d325 2
a326 1
		GetDlgItem(IDC_NS_ENABLED)->SetWindowText(GetResString(IDS_ENABLED));
d355 1
@


1.10
log
@Changed placement of banned users message.
@
text
@a1 1
//
a12 1

d28 2
d45 7
d58 18
d90 1
a90 1
	CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000,buffer,5);		//Cax2 terminate the string after 10th of seconds...
a97 1
	// DonGato (Community Sharing)
a108 1
	// reCDVst (Load/Save Sources Settings)
d121 44
a217 1
		// DonGato (Community Sharing)
a219 1
		//strcpy(app_prefs->prefs->CommunityString,buffer);
a222 1
		// reCDVst-DonGato (Load/Save Sources Settings)
d246 32
d308 10
d334 12
@


1.9
log
@Removed upload slots configuration.
@
text
@d36 1
d68 5
d102 2
d135 2
d202 1
@


1.9.2.1
log
@v1a upgrade
@
text
@a35 1
	ON_BN_CLICKED(IDC_BANMESSAGE, OnSettingsChange)
a66 5
	if (app_prefs->IsBanMessageEnabled()) 
		CheckDlgButton(IDC_BANMESSAGE,1);
	else
		CheckDlgButton(IDC_BANMESSAGE,0);

a95 2

	SetModified(FALSE);
a126 2
		app_prefs->SetBanMessageEnabled(IsDlgButtonChecked(IDC_BANMESSAGE));

a191 1
		GetDlgItem(IDC_BANMESSAGE)->SetWindowText(GetResString(IDS_BANMESSAGE));
@


1.8
log
@control panel limits, optimizations, bugfixes
@
text
@a32 3
	ON_EN_CHANGE(IDC_MIN_UP_CLIENTS_ALLOWED, OnSettingsChange)
	ON_EN_CHANGE(IDC_MAX_UP_CLIENTS_ALLOWED, OnSettingsChange)
	ON_EN_CHANGE(IDC_UPLOAD_CLIENT_DATARATE, OnSettingsChange)
a58 6
	sprintf(buffer,"%d", app_prefs->MinimumUploadClients());
	GetDlgItem(IDC_MIN_UP_CLIENTS_ALLOWED)->SetWindowText(buffer);
	sprintf(buffer,"%d", app_prefs->MaximumUploadClients());
	GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->SetWindowText(buffer);
	sprintf(buffer,"%d", app_prefs->UploadClientDatarate());
	GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE)->SetWindowText(buffer);
a140 51
		GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->GetWindowText(buffer,7);
		app_prefs->SetMaximumUploadClients(atoi(buffer));
		if(app_prefs->MaximumUploadClients() < 100)
		{
			app_prefs->SetMaximumUploadClients(100);
			sprintf(buffer, "%d",app_prefs->MaximumUploadClients());
			GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->SetWindowText(buffer);
		}

		GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE)->GetWindowText(buffer,7);
		iTmp = atoi(buffer);
        if(iTmp<2000) iTmp = 2000;
		GetDlgItem(IDC_MIN_UP_CLIENTS_ALLOWED)->GetWindowText(buffer,7);
		app_prefs->SetMinimumUploadClients(atoi(buffer));
		if(app_prefs->GetMaxGraphUploadRate() != UNLIMITED)
		{
			if (app_prefs->MinimumUploadClients() > (uint32)ROUND((app_prefs->GetMaxGraphUploadRate()*1024)/iTmp))
				app_prefs->SetMinimumUploadClients((uint32)ROUND((app_prefs->GetMaxGraphUploadRate()*1024)/iTmp)); 
		}

		if(app_prefs->MinimumUploadClients() < 2)
			app_prefs->SetMinimumUploadClients(2);
		if(app_prefs->MinimumUploadClients() > app_prefs->MaximumUploadClients())
			app_prefs->SetMinimumUploadClients(app_prefs->MaximumUploadClients());
		
		sprintf(buffer, "%d",app_prefs->MinimumUploadClients());
		GetDlgItem(IDC_MIN_UP_CLIENTS_ALLOWED)->SetWindowText(buffer);
	

		GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE)->GetWindowText(buffer,7);
		app_prefs->SetUploadClientDatarate(atoi(buffer));
		//SeeWen
		if(app_prefs->MinimumUploadClients() >= 6) {
			if(app_prefs->UploadClientDatarate() < 2000)
				app_prefs->SetUploadClientDatarate(2000);
		}
		else if ((app_prefs->MinimumUploadClients() < 6) && (app_prefs->MinimumUploadClients() > 3))
		{
			if(app_prefs->UploadClientDatarate() < 2500)
				app_prefs->SetUploadClientDatarate( 2500);
		}
		else
		{
			if(app_prefs->UploadClientDatarate() < 3000)
			{
				app_prefs->SetUploadClientDatarate(3000);
			}
		}
		sprintf(buffer, "%d",app_prefs->UploadClientDatarate());
		GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE)->SetWindowText(buffer);
	
a182 5
		GetDlgItem(IDC_UPLOAD_SLOTS_FRM)->SetWindowText(GetResString(IDS_UPLOAD_SLOTS_FRM));
		GetDlgItem(IDC_MIN_UP_CLIENTS_ALLOWED_LBL)->SetWindowText(GetResString(IDS_MIN_UP_CLIENTS_ALLOWED_LBL));
		GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED_LBL)->SetWindowText(GetResString(IDS_MAX_UP_CLIENTS_ALLOWED_LBL));
		GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE_LBL)->SetWindowText(GetResString(IDS_UPLOAD_CLIENT_DATARATE_LBL));
		GetDlgItem(IDC_BYTESPERSEC)->SetWindowText(GetResString(IDS_BYTESPERSEC));
@


1.7
log
@the famous zz upload system! :)
@
text
@d33 6
a38 6
	ON_EN_CHANGE(IDC_MIN_UP_CLIENTS_ALLOWED, OnEnChangeMinClients)
	ON_EN_CHANGE(IDC_MAX_UP_CLIENTS_ALLOWED, OnEnChangeMaxClients)
	ON_EN_CHANGE(IDC_UPLOAD_CLIENT_DATARATE, OnEnChangeDataRate)
	ON_EN_CHANGE(IDC_BANTIMES, OnEnChangeBanTimes)
	ON_EN_CHANGE(IDC_MINREQUESTTIME, OnEnChangeMinReqTime)
	ON_EN_CHANGE(IDC_BANTIMEINMINS, OnEnChangeBanTime)
d40 5
a44 5
	ON_EN_CHANGE(IDC_COMSTRING, OnEnChangeComString)
	ON_BN_CLICKED(IDC_NOBANENABLED, OnBnClickedNoBanEnabled)
	ON_EN_CHANGE(IDC_RESTORE_SOURCES_TIME, OnEnChangeRestoreTime)
	ON_EN_CHANGE(IDC_LOAD_QUANTITIES, OnEnChangeLoadQuantities)
	ON_EN_CHANGE(IDC_OUTDATED, OnEnChangeOutdated)
d46 1
a46 1
	ON_BN_CLICKED(IDC_MLDONKEY_CM, OnBnClickedmlDonkeyCM)
d73 1
a73 1
	CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000,buffer,4);		//Cax2 terminate the string after the seconds...
d147 1
a147 1
		CastSecondsToHM(app_prefs->BadClientMinRequestTime()/1000,buffer,4);		//Cax2 terminate the string after the seconds...
d149 10
d167 1
a167 1
				app_prefs->SetMinimumUploadClients( (uint32)ROUND((app_prefs->GetMaxGraphUploadRate()*1024)/iTmp)); 
d171 3
a173 1
			app_prefs->SetMinimumUploadClients( 2);
d178 1
a178 9
		GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->GetWindowText(buffer,7);
		app_prefs->SetMaximumUploadClients(atoi(buffer));
		if(app_prefs->MaximumUploadClients() < 100)
		{
			app_prefs->SetMaximumUploadClients( 100);
			sprintf(buffer, "%d",app_prefs->MaximumUploadClients());
			GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->SetWindowText(buffer);
		}
	
@


1.6
log
@Added instrumentation for debugging memory leaks :
#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

To all .cpp files (I hope I didn't miss any one)
@
text
@d160 2
a161 2
		if(app_prefs->MinimumUploadClients() < 3)
			app_prefs->SetMinimumUploadClients( 3);
@


1.5
log
@fix for min up slots
@
text
@d8 7
@


1.4
log
@control panel improvements...
@
text
@d144 1
@


1.3
log
@Removed SingleLock - no need there.
@
text
@d54 14
a67 13
	CString strBuffer;
	strBuffer.Format("%d", app_prefs->MinimumUploadClients());
	GetDlgItem(IDC_MIN_UP_CLIENTS_ALLOWED)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->MaximumUploadClients());
	GetDlgItem(IDC_MAX_UP_CLIENTS_ALLOWED)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->UploadClientDatarate());
	GetDlgItem(IDC_UPLOAD_CLIENT_DATARATE)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->BadClientMinRequestNum());
	GetDlgItem(IDC_BANTIMES)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->BadClientBanTime()/60000);
	GetDlgItem(IDC_BANTIMEINMINS)->SetWindowText(strBuffer);
	strBuffer.Format("%.2f", app_prefs->BadClientMinRequestTime()/60000.0f);
	GetDlgItem(IDC_MINREQUESTTIME)->SetWindowText(strBuffer);
d82 6
a87 6
	strBuffer.Format("%d", app_prefs->RestoreSourcesTime()/60000);
	GetDlgItem(IDC_RESTORE_SOURCES_TIME)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->LoadQuantities());
	GetDlgItem(IDC_LOAD_QUANTITIES)->SetWindowText(strBuffer);
	strBuffer.Format("%d", app_prefs->WhenSourcesOutdated());
	GetDlgItem(IDC_OUTDATED)->SetWindowText(strBuffer);
d107 1
a107 1
		int tmpdatarate;
a111 1
		{
d113 6
a118 3
			sprintf(buffer, "%d",app_prefs->BadClientMinRequestNum());
			GetDlgItem(IDC_BANTIMES)->SetWindowText(buffer);
		}
a121 1
		{
d123 6
a128 3
			sprintf(buffer, "%d",app_prefs->BadClientBanTime()/60000);
			GetDlgItem(IDC_BANTIMEINMINS)->SetWindowText(buffer);
		}
d130 12
a141 7
		app_prefs->SetBadClientMinRequestTime(atof(buffer)*60000.0f);
		if(app_prefs->BadClientMinRequestTime() > 590000.0f)
		{
			app_prefs->SetBadClientMinRequestTime(590000.0f);
			sprintf(buffer, "%.2f",app_prefs->BadClientMinRequestTime()/60000.0f);
			GetDlgItem(IDC_MINREQUESTTIME)->SetWindowText(buffer);
		}
d143 1
a143 1
		tmpdatarate = atoi(buffer);
d146 6
a152 1
		{
d154 1
a154 11
		} else {
			if(app_prefs->GetMaxGraphUploadRate() != UNLIMITED)
			{
				if (app_prefs->MinimumUploadClients() > (uint32)ROUND((app_prefs->GetMaxGraphUploadRate()*1024)/tmpdatarate) && app_prefs->MinimumUploadClients() > 3)
				{
					app_prefs->SetMinimumUploadClients( (uint32)ROUND((app_prefs->GetMaxGraphUploadRate()*1024)/tmpdatarate));
				} 
			} else {
				app_prefs->SetMinimumUploadClients( 3);
			}
		}
@


1.2
log
@Updates to Preferences (and enabling/disabling options in code because of that)
@
text
@d101 1
a101 1
	CSingleLock PrefLock(&(app_prefs->m_Pref_Mutex),TRUE); 
@


1.1
log
@*** empty log message ***
@
text
@d39 1
a39 3
	ON_BN_CLICKED(IDC_MLDONKEY_DONKEY, OnBnClickedMldonkeyDonkey)
	ON_BN_CLICKED(IDC_MLDONKEY_NORMAL, OnBnClickedMldonkeyNormal)
	ON_BN_CLICKED(IDC_MLDONKEY_ML, OnBnClickedMldonkeyMl)
d93 4
a96 4
	// Maverick
	SetMLDonkey(app_prefs->GetMlDonkeyBehviour());

	SetModified(FALSE);	// FoRcHa
d215 1
a215 2
		// Maverick
		app_prefs->SetMlDonkeyBehviour( m_MLDonkey);
d248 1
a248 6

		//Maverick
		GetDlgItem(IDC_MLDONKEY_BEHAVIOR)->SetWindowText(GetResString(IDS_MLDONKEY_BEHAVIOR));
		GetDlgItem(IDC_MLDONKEY_NORMAL)->SetWindowText(GetResString(IDS_MLDONKEY_NORMAL));
		GetDlgItem(IDC_MLDONKEY_DONKEY)->SetWindowText(GetResString(IDS_MLDONKEY_DONKEY));
		GetDlgItem(IDC_MLDONKEY_ML)->SetWindowText(GetResString(IDS_MLDONKEY_ML));
a266 22
}

// Maverick
void CPPgAdvanced::SetMLDonkey(TMlDonkeyBehavior MLDonkey)
{
	for(int i=0; i<2; i++)
	{
		switch (m_MLDonkey)
		{
			case eNormal:			
				((CButton*) GetDlgItem(IDC_MLDONKEY_NORMAL))->SetCheck(m_MLDonkey == MLDonkey);
				break;
			case eEmulateEDonkey:
				((CButton*) GetDlgItem(IDC_MLDONKEY_DONKEY))->SetCheck(m_MLDonkey == MLDonkey);
				break;
			case eEmulateMlDonkey:
				((CButton*) GetDlgItem(IDC_MLDONKEY_ML))->SetCheck(m_MLDonkey == MLDonkey);
				break;
		}
		m_MLDonkey = MLDonkey;
	}

@


1.1.4.1
log
@updating this branch...
@
text
@@


1.1.4.2
log
@updated control panes, and assorted bugfixes
@
text
@d39 3
a41 1
	ON_BN_CLICKED(IDC_MLDONKEY_CM, OnBnClickedmlDonkeyCM)
d95 4
a98 4
	if(app_prefs->GetMlDonkeyCM())
		CheckDlgButton(IDC_MLDONKEY_CM,1);
	else
		CheckDlgButton(IDC_MLDONKEY_CM,0);
d217 2
a218 1
		app_prefs->SetMlDonkeyCM((int8)IsDlgButtonChecked(IDC_MLDONKEY_CM));
d251 6
a256 1
		GetDlgItem(IDC_MLDONKEY_CM)->SetWindowText(GetResString(IDS_MLDONKEY_CM));
d275 22
@


