head	1.37;
access;
symbols
	PublicRelease_1_2e:1.37
	Interim_Release_1-2e_RC1:1.37
	PublicRelease_1_2d:1.37
	Interim_Release_1-2d_RC1:1.35
	Interim_Release_1-2d_beta1:1.34
	PublicRelease_1_2c:1.32
	Interim_Release_1-2c_RC1:1.32
	Interim_Release_1-2c_beta1:1.32
	PublicRelease_1_2b:1.32
	Interim_Release_1-2b_RC1:1.32
	PublicRelease_1_2a:1.32
	Interim_Release_1-2a_RC1:1.32
	Interim_Release_1-2a_beta2:1.31
	Interim_Release_1-2a_beta1:1.31
	PublicRelease_1_2:1.31
	Interim_Release_1-2_RC1:1.31
	Interim_Release_1-2_beta1:1.31
	PublicRelease_1_1g:1.31
	Interim_Release_1-1g_RC3:1.31
	Interim_Release_1-1g_RC2:1.31
	Interim_Release_1-1g_RC1:1.31
	Interim_Release_1-1g_beta2:1.30
	Interim_Release_1-1g_beta1:1.30
	PublicRelease_1_1f:1.30
	Interim_Release_1-1f_RC1:1.30
	PublicRelease_1_1e:1.30
	Interim_Release_1-1e_RC2:1.30
	Interim_Release_1-1e_RC1:1.30
	Interim_Release_1-1e_beta1:1.30
	PublicRelease_1_1d:1.30
	Interim_Release_1-1d_RC1:1.30
	PublicRelease_1_1c:1.30
	Interim_Release_1-1c_RC1:1.30
	Interim_Release_1-1c_beta2:1.30
	Interim_Release_1-1c_beta1:1.30
	PublicRelease_1_1b:1.30
	Interim_Release_1-1b_RC1:1.30
	PublicRelease_1_1a:1.30
	Interim_Release_1-1a_RC2:1.30
	Interim_Release_1-1a_RC1:1.30
	Interim_Release_1-1a_beta2:1.30
	Interim_Release_1-1a_beta1:1.30
	PublicRelease_1_1:1.30
	Interim_Release_1-1_beta1:1.30
	PublicRelease_1o:1.30
	Interim_Release_1o_RC1:1.30
	Interim_Release_1o_beta1:1.30
	PublicRelease_1n:1.30
	Interim_Release_1n_RC2:1.30
	Interim_Release_1n_RC1:1.30
	Interim_Release_1n_beta2:1.30
	Interim_Release_1n_beta1:1.30
	PublicRelease_1m:1.29
	Interim_Release_1m_beta1:1.29
	PublicRelease_1l:1.28
	Interim_Release_1l_RC3:1.28
	Interim_Release_1l_RC2:1.28
	Interim_Release_1l_RC1:1.28
	Interim_Release_1l_beta2:1.27
	Interim_Release_1l_beta1:1.24
	PublicRelease_1k:1.22
	Interim_Release_1k_RC4:1.22
	Interim_1k_RC3:1.22
	Interim_1k_RC2:1.22
	Interim_Release_1k_RC1:1.22
	Interim_Release_1k_beta5:1.22
	Intrerim_Release_1k_beta4:1.22
	Interim_Release_1k_beta1:1.21
	PublicRelease_1j:1.18
	Interim_Release_1J_RC3:1.18
	Interim_Release_1j_RC3:1.18
	Interim_Release_1j_RC2:1.18
	Interim_Release_1j_RC1:1.18
	Interim_Release_1j_beta2:1.18
	Interim_Release_1j_beta1:1.18
	PublicRelease_1i:1.18
	Interim_Release_1i_RC6:1.18
	Interim_Release_1i_RC3:1.18
	Interim_Release_1i_RC2:1.18
	Interim_Release_1i_RC1:1.18
	Interim_Release_1i_beta3:1.18
	Interim_Release_1i_beta2:1.18
	Interim_Release_1i_beta1:1.18
	PublicRelease_1h:1.16
	Interim_Release_1h_rc2:1.16
	Interim_Release_1h_RC1:1.16
	Interim_Release_1h_beta2:1.16
	Interim_Release_1h_beta1_now:1.16
	Interim_Release_1h_beta1:1.16
	PublicRelease_1g:1.16
	Interim_Release_1g_RC6_Final:1.16
	Interim_Release_1g_RC6:1.16
	Interim_Release_1g_RC5:1.16
	Interim_Release_1g_RC4:1.16
	Interim_Release_1g_RC3:1.14
	Interim_Release_1g_beta2:1.13
	Interim_Release_1g_beta1:1.13
	Interim_Release_1f_RC4:1.12
	Interim_Release_1f_RC3:1.12
	Interim_Release_1f_RC2:1.10
	Interim_Release_1f_RC:1.10
	Interim_Release_1f_beta2:1.10
	Interim_Release_1f_beta1:1.10
	PublicRelease_1e:1.9
	Interim_Release_1e_RC2:1.9
	Interim_Release_1e_RC:1.9
	Interim_Release_1e_beta3:1.9
	Interim_Release_1e_beta2:1.9
	Interim_Release_1e_beta2_before_kuchin:1.9
	Interim_Release_1e_beta1:1.9
	PublicRelease_1c:1.9
	featurestest:1.9.0.4
	Interim_Release_1c_RC:1.9
	Interim_Release_1c_beta2:1.9
	Interim_Release_1c_beta1:1.9
	threaded_downloadqueue:1.9.0.2
	PublicRelease_1b:1.8
	Interim_Release_1b_beta2:1.8
	Interim_Release_1b_beta1:1.8
	proxydeadlake:1.6.0.4
	PublicRelease_1a:1.6
	Interim_Release_1a_beta2:1.6
	BerkeleyDb:1.6.0.2
	Interim_Release_1a_beta1:1.6
	PublicRelease_1:1.6
	goldfish:1.6
	eMulePlus_1_RC2:1.6
	eMulePlus_26b_1RC1:1.6
	PreRelease_26b_i0e:1.6
	before_26d_merge:1.5
	Interim_Release_26b_i0d:1.4
	Interim_Release_26b_i0c:1.4
	Interim_Release_26b_i0b:1.4
	Interim_Release_26b_i0a:1.4
	systraydlg:1.3.0.4
	plus26based:1.3.0.2
	Interim_Release_25b_i0b:1.3
	Proxy_Dev:1.2
	Interim_Release_25b_i0a:1.1.4.1
	proxytest:1.1.4.1.0.2
	official_sockets:1.1.0.4
	eMulePlus_024b_5b:1.1.0.2;
locks; strict;
comment	@// @;


1.37
date	2008.05.01.04.09.38;	author aw3;	state Exp;
branches;
next	1.36;

1.36
date	2008.04.30.05.05.07;	author aw3;	state Exp;
branches;
next	1.35;

1.35
date	2008.04.16.04.27.22;	author aw3;	state Exp;
branches;
next	1.34;

1.34
date	2008.02.18.03.40.13;	author aw3;	state Exp;
branches;
next	1.33;

1.33
date	2007.12.28.04.06.16;	author aw3;	state Exp;
branches;
next	1.32;

1.32
date	2006.06.21.01.02.33;	author aw3;	state Exp;
branches;
next	1.31;

1.31
date	2005.11.27.20.31.05;	author eklmn;	state Exp;
branches;
next	1.30;

1.30
date	2004.07.05.23.23.42;	author dongato;	state Exp;
branches;
next	1.29;

1.29
date	2004.06.18.17.08.23;	author aw3;	state Exp;
branches;
next	1.28;

1.28
date	2004.05.24.11.37.29;	author netwolf1;	state Exp;
branches;
next	1.27;

1.27
date	2004.05.18.18.44.11;	author aw3;	state Exp;
branches;
next	1.26;

1.26
date	2004.05.17.14.57.46;	author aw3;	state Exp;
branches;
next	1.25;

1.25
date	2004.05.12.17.47.53;	author dongato;	state Exp;
branches;
next	1.24;

1.24
date	2004.04.18.15.19.26;	author dongato;	state Exp;
branches;
next	1.23;

1.23
date	2004.04.18.13.17.30;	author bavariansnail;	state Exp;
branches;
next	1.22;

1.22
date	2004.02.24.12.47.52;	author kush_eplus;	state Exp;
branches;
next	1.21;

1.21
date	2004.02.19.06.46.35;	author dongato;	state Exp;
branches;
next	1.20;

1.20
date	2004.02.19.00.29.34;	author netwolf1;	state Exp;
branches;
next	1.19;

1.19
date	2004.02.01.13.53.54;	author netwolf1;	state Exp;
branches;
next	1.18;

1.18
date	2003.09.22.16.40.49;	author morevit;	state Exp;
branches;
next	1.17;

1.17
date	2003.09.20.15.39.31;	author morevit;	state Exp;
branches;
next	1.16;

1.16
date	2003.07.07.19.17.50;	author partyckip;	state Exp;
branches;
next	1.15;

1.15
date	2003.07.05.11.53.08;	author dongato;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.15.09.10.05;	author partyckip;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.01.10.08.44;	author partyckip;	state Exp;
branches;
next	1.12;

1.12
date	2003.05.16.01.14.46;	author syrus77;	state Exp;
branches;
next	1.11;

1.11
date	2003.05.15.22.03.54;	author syrus77;	state Exp;
branches;
next	1.10;

1.10
date	2003.05.04.10.05.33;	author kuchin;	state Exp;
branches;
next	1.9;

1.9
date	2003.03.11.16.12.45;	author kuchin;	state Exp;
branches
	1.9.4.1;
next	1.8;

1.8
date	2003.03.01.12.48.29;	author dongato;	state Exp;
branches;
next	1.7;

1.7
date	2003.03.01.02.01.26;	author cax2;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.18.15.21.22;	author dongato;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2003.02.16.22.01.48;	author lord_kiron;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.10.13.15.39;	author kuchin;	state Exp;
branches;
next	1.3;

1.3
date	2003.02.02.13.27.42;	author kuchin;	state Exp;
branches;
next	1.2;

1.2
date	2003.02.01.14.45.39;	author dongato;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.21.18.21.21;	author cax2;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2003.01.28.16.54.20;	author cax2;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2003.02.02.02.36.27;	author cax2;	state Exp;
branches;
next	;

1.6.2.1
date	2003.03.01.20.59.36;	author obaldin;	state Exp;
branches;
next	;

1.9.4.1
date	2003.03.23.06.22.02;	author recdvst;	state Exp;
branches;
next	;


desc
@@


1.37
log
@Removed unused parameters warning suppression as they became in use.
@
text
@//	This file is part of eMule Plus
//
//	This program is free software; you can redistribute it and/or
//	modify it under the terms of the GNU General Public License
//	as published by the Free Software Foundation; either
//	version 2 of the License, or (at your option) any later version.
//
//	This program is distributed in the hope that it will be useful,
//	but WITHOUT ANY WARRANTY; without even the implied warranty of
//	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//	GNU General Public License for more details.
//
//	You should have received a copy of the GNU General Public License
//	along with this program; if not, write to the Free Software
//	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include "stdafx.h"
#include "emule.h"
#include "PPgFiles.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

// CPPgFiles dialog

IMPLEMENT_DYNAMIC(CPPgFiles, CPropertyPage)
CPPgFiles::CPPgFiles()
	: CPropertyPage(CPPgFiles::IDD)
	, m_bDLAutoPrio(FALSE)
	, m_bUpAutoPrio(FALSE)
	, m_bStartPaused(FALSE)
	, m_bStartPausedOnComplete(FALSE)
	, m_bResumeOtherCat(FALSE)
	, m_iSeeShare(0)
	, m_iFilePermission(0)
	, m_iHashPriority(0)
	, m_iFileBufferSize(0)
	, m_bAutoClearCompleted(FALSE)
{
}

CPPgFiles::~CPPgFiles()
{
}

void CPPgFiles::DoDataExchange(CDataExchange* pDX)
{
	CPropertyPage::DoDataExchange(pDX);
	DDX_Check(pDX, IDC_DAP_ENABLE, m_bDLAutoPrio);
	DDX_Check(pDX, IDC_UAP, m_bUpAutoPrio);
	DDX_Check(pDX, IDC_START_PAUSED, m_bStartPaused);
	DDX_Check(pDX, IDC_START_PAUSED_ON_COMPLETE, m_bStartPausedOnComplete);
	DDX_Check(pDX, IDC_RESUME_OTHER_CAT, m_bResumeOtherCat);
	DDX_Control(pDX, IDC_FILEBUFFERSIZE, m_FileBufferSizeSlider);
	DDX_Control(pDX, IDC_SLOWCOMPLETE_BLOCK, m_FileCopySizeSlider);
	DDX_Text(pDX, IDC_AP_HIGH, m_strPrioHigh);
	DDX_Text(pDX, IDC_AP_LOW, m_strPrioLow);
	DDX_Radio(pDX, IDC_SEESHARE1, m_iSeeShare);
	DDX_Radio(pDX, IDC_PERM_PUBLIC, m_iFilePermission);
	DDX_Radio(pDX, IDC_HASHPRIO_STANDARD, m_iHashPriority);
	DDX_Slider(pDX, IDC_FILEBUFFERSIZE, m_iFileBufferSize);
	DDX_Slider(pDX, IDC_SLOWCOMPLETE_BLOCK, m_iCopyBufferSz);
	DDX_Check(pDX, IDC_AUTO_CLEAR_COMPLETED, m_bAutoClearCompleted);
}

BEGIN_MESSAGE_MAP(CPPgFiles, CPropertyPage)
	ON_BN_CLICKED(IDC_SEESHARE1, OnSettingsChange)
	ON_BN_CLICKED(IDC_SEESHARE2, OnSettingsChange)
	ON_BN_CLICKED(IDC_SEESHARE3, OnSettingsChange)
	ON_BN_CLICKED(IDC_PERM_PUBLIC, OnSettingsChange)
	ON_BN_CLICKED(IDC_PERM_FRIENDS_ONLY, OnSettingsChange)
	ON_BN_CLICKED(IDC_PERM_HIDDEN, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_STANDARD, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_LOWER, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_IDLE, OnSettingsChange)
	ON_EN_CHANGE(IDC_AP_HIGH, OnSettingsChange)
	ON_EN_CHANGE(IDC_AP_LOW, OnSettingsChange)
	ON_BN_CLICKED(IDC_UAP, OnSettingsChange)
	ON_BN_CLICKED(IDC_DAP_ENABLE, OnBnClickedDAP)
	ON_BN_CLICKED(IDC_START_PAUSED, OnSettingsChange)
	ON_BN_CLICKED(IDC_START_PAUSED_ON_COMPLETE, OnBnClickedStartPaused)
	ON_BN_CLICKED(IDC_RESUME_OTHER_CAT, OnSettingsChange)
	ON_BN_CLICKED(IDC_AUTO_CLEAR_COMPLETED, OnSettingsChange)
	ON_WM_HSCROLL()
END_MESSAGE_MAP()

BOOL CPPgFiles::OnInitDialog()
{
	CPropertyPage::OnInitDialog();

	LoadSettings();
	Localize();

	return TRUE;
}

void CPPgFiles::LoadSettings(void)
{
	switch(m_pPrefs->CanSeeShares())
	{
		case SEE_SHARE_EVERYBODY:
			m_iSeeShare = 0;
			break;
		case SEE_SHARE_FRIENDS:
			m_iSeeShare = 1;
			break;
		case SEE_SHARE_NOONE:
		default:
			m_iSeeShare = 2;
			break;
	}

	switch(m_pPrefs->GetHashingPriority())
	{
		case HASH_PRIORITY_IDLE:
			m_iHashPriority = 2;
			break;
		case HASH_PRIORITY_LOWER:
			m_iHashPriority = 1;
			break;
		case HASH_PRIORITY_STANDARD:
		default:
			m_iHashPriority = 0;
			break;
	}

	m_iFilePermission = static_cast<int>(m_pPrefs->GetFilePermission());

	m_bUpAutoPrio = m_pPrefs->IsUAPEnabled();
	m_bDLAutoPrio = m_pPrefs->IsDAPEnabled();

	m_strPrioHigh.Format(_T("%u"), m_pPrefs->PriorityHigh());
	m_strPrioLow.Format(_T("%u"), m_pPrefs->PriorityLow());

	m_bStartPaused = m_pPrefs->StartDownloadPaused();
	m_bStartPausedOnComplete = m_pPrefs->DownloadPausedOnComplete();
	m_bResumeOtherCat = m_pPrefs->IsResumeOtherCat();
	m_bAutoClearCompleted = m_pPrefs->IsAutoClearCompleted();

	m_FileBufferSizeSlider.SetRange(1, PARTSZ32 / (32 * 1024) + 1, true);
	m_iFileBufferSize = m_pPrefs->GetFileBufferSize() / (32u * 1024u);

//	Scale step is 4 KB
	m_FileCopySizeSlider.SetRange(PREF_MIN_COMPLETEBLOCKSZ / 4, PREF_MAX_COMPLETEBLOCKSZ / 4, true);
	m_iCopyBufferSz = static_cast<unsigned>(m_pPrefs->SlowCompleteBlockSize() / 4);

	UpdateData(FALSE);

	OnBnClickedDAP();
	OnBnClickedStartPaused();

	SetModified(FALSE);
}

BOOL CPPgFiles::OnApply()
{
	if(m_bModified)
	{
		UpdateData(TRUE);

		uint32	dwVal, dwVal2;

		switch (m_iSeeShare)
		{
			case 0:
				m_pPrefs->SetCanSeeShares(SEE_SHARE_EVERYBODY);
				break;
			case 1:
				m_pPrefs->SetCanSeeShares(SEE_SHARE_FRIENDS);
				break;
			case 2:
			default:
				m_pPrefs->SetCanSeeShares(SEE_SHARE_NOONE);
				break;
		}

		switch (m_iHashPriority)
		{
			case 2:
				m_pPrefs->SetHashingPriority(HASH_PRIORITY_IDLE);
				g_App.m_fileHashControl.SetThreadPriority(THREAD_PRIORITY_IDLE);
				break;
			case 1:
				m_pPrefs->SetHashingPriority(HASH_PRIORITY_LOWER);
				g_App.m_fileHashControl.SetThreadPriority(THREAD_PRIORITY_LOWEST);
				break;
			case 0:
			default:
				m_pPrefs->SetHashingPriority(HASH_PRIORITY_STANDARD);
				g_App.m_fileHashControl.SetThreadPriority(THREAD_PRIORITY_BELOW_NORMAL);
				break;
		}
		
		m_pPrefs->SetFilePermission(static_cast<byte>(m_iFilePermission));
		m_pPrefs->SetUAPEnabled(B2b(m_bUpAutoPrio));
		m_pPrefs->SetDAPEnabled(B2b(m_bDLAutoPrio));
		m_pPrefs->SetStartDownloadPaused(B2b(m_bStartPaused));
		m_pPrefs->SetDownloadPausedOnComplete(B2b(m_bStartPausedOnComplete));
		m_pPrefs->SetResumeOtherCat(B2b(m_bResumeOtherCat));
		m_pPrefs->SetAutoClearCompleted(B2b(m_bAutoClearCompleted));

		dwVal = _tstoi(m_strPrioHigh);
		dwVal2 = _tstoi(m_strPrioLow);
		if (dwVal2 < dwVal)
		{
			dwVal2 = (dwVal * 2) & 0xFFFF;
			if (dwVal2 <= dwVal)	// high value is too big
				dwVal = 0;
		}
		if (dwVal == 0)
		{
			dwVal = PREF_DEF_DLSRC4HIGHPRIO;
			dwVal2 = PREF_DEF_DLSRC4LOWPRIO;
		}
		m_pPrefs->SetPriorityHigh(static_cast<uint16>(dwVal));
		m_pPrefs->SetPriorityLow(static_cast<uint16>(dwVal2));
		m_strPrioHigh.Format(_T("%u"), dwVal);
		m_strPrioLow.Format(_T("%u"), dwVal2);

		m_pPrefs->SetFileBufferSize(static_cast<unsigned>(m_iFileBufferSize) * 32u * 1024u);
		m_pPrefs->SetSlowCompleteBlockSize(static_cast<unsigned>(m_iCopyBufferSz) * 4u);

		UpdateData(FALSE);
		SetModified(FALSE);
	}
	return CPropertyPage::OnApply();
}

void CPPgFiles::Localize(void)
{
	static const uint16 s_auResTbl[][2] =
	{
		{ IDC_SEEMYSHARE_FRM, IDS_PW_SHARE },
		{ IDC_SEESHARE1, IDS_PW_EVER },
		{ IDC_SEESHARE2, IDS_PW_FRIENDS },
		{ IDC_SEESHARE3, IDS_PW_NOONE },
		{ IDC_PERMISSION_FRM, IDS_DEF_PERMISSION },
		{ IDC_PERM_HIDDEN, IDS_HIDDEN },
		{ IDC_PERM_FRIENDS_ONLY, IDS_FSTATUS_FRIENDSONLY },
		{ IDC_PERM_PUBLIC, IDS_FSTATUS_PUBLIC },
		{ IDC_AP_GRP, IDS_AP_GRP },
		{ IDC_AP_HIGH_LBL, IDS_AP_HIGH_LBL },
		{ IDC_AP_LOW_LBL, IDS_AP_LOW_LBL },
		{ IDC_DAP_ENABLE, IDS_ENABLED },
		{ IDC_UAP, IDS_UAP },
		{ IDC_START_PAUSED, IDS_START_PAUSED },
		{ IDC_START_PAUSED_ON_COMPLETE, IDS_START_PAUSED_ON_COMPLETE },
		{ IDC_RESUME_OTHER_CAT, IDS_RESUME_OTHER_CAT },
		{ IDC_AP_SOURCES1, IDS_SOURCES_PF_FILES },
		{ IDC_AP_SOURCES2, IDS_SOURCES_PF_FILES },
		{ IDC_HASHING_FRM, IDS_HASHING_FRM },
		{ IDC_HASHPRIO_STANDARD, IDS_HASHPRIO_STANDARD },
		{ IDC_HASHPRIO_LOWER, IDS_HASHPRIO_LOWER },
		{ IDC_HASHPRIO_IDLE, IDS_HASHPRIO_IDLE },
		{ IDC_AUTO_CLEAR_COMPLETED, IDS_AUTO_CLEAR_COMPLETED }
	};

	if (::IsWindow(m_hWnd))
	{
		CString	strRes;

		for (uint32 i = 0; i < ARRSIZE(s_auResTbl); i++)
		{
			::GetResString(&strRes, static_cast<UINT>(s_auResTbl[i][1]));
			SetDlgItemText(s_auResTbl[i][0], strRes);
		}
		strRes.Format(GetResString(IDS_FILEBUFFERSIZE), static_cast<unsigned>(m_iFileBufferSize) * 32u);
		SetDlgItemText(IDC_FILEBUFFERSIZE_LBL, strRes);
		strRes.Format(GetResString(IDS_SLOWCOMPLETE), static_cast<unsigned>(m_iCopyBufferSz) * 4u);
		SetDlgItemText(IDC_SLOWCOMPLETE, strRes);
	}
}

void CPPgFiles::OnBnClickedDAP()
{
	UpdateData(TRUE);
	GetDlgItem(IDC_AP_HIGH)->EnableWindow(m_bDLAutoPrio);
	GetDlgItem(IDC_AP_LOW)->EnableWindow(m_bDLAutoPrio);

	SetModified();
}

void CPPgFiles::OnHScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar)
{
	if (pScrollBar == (CScrollBar*)&m_FileBufferSizeSlider)
	{
		SetModified(TRUE);
		UpdateData(TRUE);

		CString	strRes;

		strRes.Format(GetResString(IDS_FILEBUFFERSIZE), static_cast<unsigned>(m_iFileBufferSize) * 32u);
		SetDlgItemText(IDC_FILEBUFFERSIZE_LBL, strRes);
	}
	else if (pScrollBar == (CScrollBar*)&m_FileCopySizeSlider)
	{
		SetModified(TRUE);
		UpdateData(TRUE);

		CString	strRes;

		strRes.Format(GetResString(IDS_SLOWCOMPLETE), static_cast<unsigned>(m_iCopyBufferSz) * 4u);
		SetDlgItemText(IDC_SLOWCOMPLETE, strRes);
	}
	CPropertyPage::OnHScroll(nSBCode, nPos, pScrollBar);
}

void CPPgFiles::OnBnClickedStartPaused()
{
	UpdateData(TRUE);

	GetDlgItem(IDC_RESUME_OTHER_CAT)->EnableWindow(m_bStartPausedOnComplete);

	SetModified();
}
@


1.36
log
@Call parent OnHScroll at the end of the processing.
@
text
@a287 1
	NOPRM(nSBCode); NOPRM(nPos);
@


1.35
log
@Simplified shared files hashing thread [KuSh].
@
text
@d309 1
@


1.34
log
@Optimized dialog regarding required memory and speed; Added more sanity checks for input;
Removed old not used localization; Suppressed compiler warnings; Formatting.
@
text
@d184 1
a184 1
				g_App.m_fileHashControl.SetProcessingPriority(ePIdle);
d188 1
a188 1
				g_App.m_fileHashControl.SetProcessingPriority(ePLower);
d193 1
a193 1
				g_App.m_fileHashControl.SetProcessingPriority(ePStandard);
@


1.33
log
@Suppressed compiler warnings;
Increased upper range for 'File Buffer Size', setting was made compatible with original (setting name was changed from "FileBufferSizePref" to "FileBufferSize", smooth migration is in place with slight deviation of values; Bigger File Buffer Size is recommended for higher speeds to stabilize and slightly improve downloading speed; New configuration is done with different granuality).
@
text
@a15 2
//
// PPgFiles.cpp : implementation file
d32 8
a39 8
	, dapEnable(FALSE)
	, uap(FALSE)
	, startPaused(FALSE)
	, startPausedOnComplete(FALSE)
	, resumeOtherCat(FALSE)
	, seeShare(0)
	, iFilePermission(0)
	, hashPriority(0)
d41 1
a41 1
	, autoClearCompleted(FALSE)
d52 12
a63 38
	DDX_Check(pDX, IDC_DAP_ENABLE, dapEnable);
	DDX_Check(pDX, IDC_UAP, uap);
	DDX_Check(pDX, IDC_START_PAUSED, startPaused);
	DDX_Check(pDX, IDC_START_PAUSED_ON_COMPLETE, startPausedOnComplete);
	DDX_Check(pDX, IDC_RESUME_OTHER_CAT, resumeOtherCat);
	DDX_Control(pDX, IDC_FILEBUFFERSIZE, fileBufferSizeSlider);
	DDX_Control(pDX, IDC_SLOWCOMPLETE_BLOCK, m_fileCopySizeSlider);
	DDX_Control(pDX, IDC_AP_HIGH, apHighEdit);
	DDX_Control(pDX, IDC_AP_LOW, apLowEdit);
	DDX_Control(pDX, IDC_SEESHARE1, seeEverybodyRadio);
	DDX_Control(pDX, IDC_SEESHARE2, seeFriendRadio);
	DDX_Control(pDX, IDC_SEESHARE3, seeNooneRadio);
	DDX_Control(pDX, IDC_PERM_PUBLIC, permPublicRadio);
	DDX_Control(pDX, IDC_PERM_FRIENDS_ONLY, permFriendsRadio);
	DDX_Control(pDX, IDC_PERM_HIDDEN, permHiddenRadio);
	DDX_Control(pDX, IDC_HASHPRIO_STANDARD, hashStandardRadio);
	DDX_Control(pDX, IDC_HASHPRIO_LOWER, hashLowerRadio);
	DDX_Control(pDX, IDC_HASHPRIO_IDLE, hashIdleRadio);
	DDX_Control(pDX, IDC_DAP_ENABLE, dapEnableCheck);
	DDX_Control(pDX, IDC_UAP, uapCheck);
	DDX_Control(pDX, IDC_START_PAUSED, startPausedCheck);
	DDX_Control(pDX, IDC_START_PAUSED_ON_COMPLETE, startPausedOnCompleteCheck);
	DDX_Control(pDX, IDC_RESUME_OTHER_CAT, resumeOtherCatCheck);
	DDX_Text(pDX, IDC_FILEBUFFERSIZE_LBL, fileBufferSizeDesc);
	DDX_Text(pDX, IDC_SEEMYSHARE_FRM, seeMyShareDesc);
	DDX_Text(pDX, IDC_PERMISSION_FRM, strPermFrmLbl);
	DDX_Text(pDX, IDC_AP_GRP, apGrpDesc);
	DDX_Text(pDX, IDC_AP_HIGH_LBL, apHighDesc);
	DDX_Text(pDX, IDC_AP_LOW_LBL, apLowDesc);
	DDX_Text(pDX, IDC_AP_SOURCES1, apSources1Desc);
	DDX_Text(pDX, IDC_AP_SOURCES2, apSources2Desc);
	DDX_Text(pDX, IDC_SLOWCOMPLETE, m_strCopyBufferDesc);
	DDX_Text(pDX, IDC_HASHING_FRM, hashingFrmDesc);
	DDX_Text(pDX, IDC_AP_HIGH, apHigh);
	DDX_Text(pDX, IDC_AP_LOW, apLow);
	DDX_Radio(pDX, IDC_SEESHARE1, seeShare);
	DDX_Radio(pDX, IDC_PERM_PUBLIC, iFilePermission);
	DDX_Radio(pDX, IDC_HASHPRIO_STANDARD, hashPriority);
d66 1
a66 2
	DDX_Check(pDX, IDC_AUTO_CLEAR_COMPLETED, autoClearCompleted);
	DDX_Control(pDX, IDC_AUTO_CLEAR_COMPLETED, autoClearCompletedCheck);
d105 1
a105 1
			seeShare = 0;
d108 1
a108 1
			seeShare = 1;
d112 1
a112 1
			seeShare = 2;
d119 1
a119 1
			hashPriority = 2;
d122 1
a122 1
			hashPriority = 1;
d126 1
a126 1
			hashPriority = 0;
d130 1
a130 1
	iFilePermission = static_cast<int>(m_pPrefs->GetFilePermission());
d132 2
a133 1
	uap = m_pPrefs->IsUAPEnabled();
d135 2
a136 1
	dapEnable = m_pPrefs->IsDAPEnabled();
d138 4
a141 2
	apHigh.Format(_T("%u"), m_pPrefs->PriorityHigh());
	apLow.Format(_T("%u"), m_pPrefs->PriorityLow());
d143 1
a143 6
	startPaused = m_pPrefs->StartDownloadPaused();
	startPausedOnComplete = m_pPrefs->DownloadPausedOnComplete();
	resumeOtherCat = m_pPrefs->IsResumeOtherCat();
	autoClearCompleted = m_pPrefs->IsAutoClearCompleted();

	fileBufferSizeSlider.SetRange(1, PARTSZ32 / (32 * 1024) + 1, true);
d147 1
a147 1
	m_fileCopySizeSlider.SetRange(8 / 4, 256 / 4, true);
d164 3
a166 1
		switch(seeShare)
d180 1
a180 1
		switch(hashPriority)
d197 17
a213 12
		m_pPrefs->SetFilePermission(static_cast<byte>(iFilePermission));

		m_pPrefs->SetUAPEnabled(uap);
		m_pPrefs->SetDAPEnabled(dapEnable);
		m_pPrefs->SetStartDownloadPaused(startPaused);
		m_pPrefs->SetDownloadPausedOnComplete(startPausedOnComplete);
		m_pPrefs->SetResumeOtherCat(B2b(resumeOtherCat));
		m_pPrefs->SetPriorityHigh(_tstoi(apHigh));
		m_pPrefs->SetPriorityLow(_tstoi(apLow));
		m_pPrefs->SetAutoClearCompleted(autoClearCompleted);

		if(m_pPrefs->PriorityLow() < m_pPrefs->PriorityHigh())
d215 2
a216 2
			m_pPrefs->SetPriorityLow(m_pPrefs->PriorityHigh() * 2);
			apLow.Format(_T("%u"), m_pPrefs->PriorityLow());
d218 4
d224 1
a224 1
		m_pPrefs->SetSlowCompleteBlockSize(static_cast<uint16>(static_cast<unsigned>(m_iCopyBufferSz) * 4u));
d234 28
a261 1
	if(::IsWindow(m_hWnd))
d263 11
a273 27
		SetWindowText(GetResString(IDS_PW_FILES));
		GetResString(&seeMyShareDesc, IDS_PW_SHARE);
		seeEverybodyRadio.SetWindowText(GetResString(IDS_PW_EVER));
		seeFriendRadio.SetWindowText(GetResString(IDS_PW_FRIENDS));
		seeNooneRadio.SetWindowText(GetResString(IDS_PW_NOONE));
		GetResString(&strPermFrmLbl, IDS_DEF_PERMISSION);
		permHiddenRadio.SetWindowText(GetResString(IDS_HIDDEN));
		permFriendsRadio.SetWindowText(GetResString(IDS_FSTATUS_FRIENDSONLY));
		permPublicRadio.SetWindowText(GetResString(IDS_FSTATUS_PUBLIC));
		GetResString(&apGrpDesc, IDS_AP_GRP);
		GetResString(&apHighDesc, IDS_AP_HIGH_LBL);
		GetResString(&apLowDesc, IDS_AP_LOW_LBL);
		dapEnableCheck.SetWindowText(GetResString(IDS_ENABLED));
		uapCheck.SetWindowText(GetResString(IDS_UAP));
		startPausedCheck.SetWindowText(GetResString(IDS_START_PAUSED));
		startPausedOnCompleteCheck.SetWindowText(GetResString(IDS_START_PAUSED_ON_COMPLETE));
		resumeOtherCatCheck.SetWindowText(GetResString(IDS_RESUME_OTHER_CAT));
		GetResString(&apSources1Desc, IDS_SOURCES_PF_FILES);
		GetResString(&apSources2Desc, IDS_SOURCES_PF_FILES);
		GetResString(&hashingFrmDesc, IDS_HASHING_FRM);
		hashStandardRadio.SetWindowText(GetResString(IDS_HASHPRIO_STANDARD));
		hashLowerRadio.SetWindowText(GetResString(IDS_HASHPRIO_LOWER));
		hashIdleRadio.SetWindowText(GetResString(IDS_HASHPRIO_IDLE));
		fileBufferSizeDesc.Format(GetResString(IDS_FILEBUFFERSIZE), static_cast<unsigned>(m_iFileBufferSize) * 32u);
		m_strCopyBufferDesc.Format(GetResString(IDS_SLOWCOMPLETE), static_cast<unsigned>(m_iCopyBufferSz) * 4u);
		autoClearCompletedCheck.SetWindowText(GetResString(IDS_AUTO_CLEAR_COMPLETED));
		UpdateData(FALSE);
d280 2
a281 2
	apHighEdit.EnableWindow(dapEnable);
	apLowEdit.EnableWindow(dapEnable);
d289 1
a289 1
	if (pScrollBar == (CScrollBar*) &fileBufferSizeSlider)
d293 5
a297 2
		fileBufferSizeDesc.Format(GetResString(IDS_FILEBUFFERSIZE), static_cast<unsigned>(m_iFileBufferSize) * 32u);
		UpdateData(FALSE);
d299 1
a299 1
	else if (pScrollBar == (CScrollBar*)&m_fileCopySizeSlider)
d303 5
a307 2
		m_strCopyBufferDesc.Format(GetResString(IDS_SLOWCOMPLETE), static_cast<unsigned>(m_iCopyBufferSz) * 4u);
		UpdateData(FALSE);
d315 1
a315 1
	resumeOtherCatCheck.EnableWindow(startPausedOnComplete);
@


1.32
log
@Configuration of default file permission [DarkSoul/Aw3]
(the feature isn't finished yet -- just GUI and value save/load are ready).
@
text
@d42 1
a42 1
	, fileBufferSize(0)
d92 1
a92 1
	DDX_Slider(pDX, IDC_FILEBUFFERSIZE, fileBufferSize);
d173 2
a174 2
	fileBufferSizeSlider.SetRange(1, 100, true);
	fileBufferSize = m_pPrefs->GetFileBufferSize();
d231 1
a231 1
		m_pPrefs->SetResumeOtherCat(resumeOtherCat);
d242 2
a243 2
		m_pPrefs->SetFileBufferSize(fileBufferSize);
		m_pPrefs->SetSlowCompleteBlockSize(static_cast<unsigned>(m_iCopyBufferSz) * 4u);
d278 1
a278 1
		fileBufferSizeDesc.Format(GetResString(IDS_FILEBUFFERSIZE), fileBufferSize*30000);
d296 1
d301 1
a301 1
		fileBufferSizeDesc.Format(GetResString(IDS_FILEBUFFERSIZE), fileBufferSize * 30000);
@


1.31
log
@renamed 3 variables
@
text
@d1 16
a17 1
//
d40 1
d66 3
d79 1
d90 1
d102 3
d159 2
d224 2
d260 4
@


1.30
log
@Some changes...
@
text
@d186 1
a186 1
				g_eMuleApp.m_fileHashControl.SetProcessingPriority(ePIdle);
d190 1
a190 1
				g_eMuleApp.m_fileHashControl.SetProcessingPriority(ePLower);
d195 1
a195 1
				g_eMuleApp.m_fileHashControl.SetProcessingPriority(ePStandard);
@


1.29
log
@Improved preferences localization.
@
text
@d27 1
d73 2
d91 1
d145 1
d206 1
d248 1
@


1.28
log
@Added option "Resume from other category when all done".
@
text
@d222 1
a222 1
		seeMyShareDesc = GetResString(IDS_PW_SHARE);
d226 3
a228 3
		apGrpDesc = GetResString(IDS_AP_GRP);
		apHighDesc = GetResString(IDS_AP_HIGH_LBL);
		apLowDesc = GetResString(IDS_AP_LOW_LBL);
d234 3
a236 3
		apSources1Desc = GetResString(IDS_SOURCES_PF_FILES);
		apSources2Desc = GetResString(IDS_SOURCES_PF_FILES);
		hashingFrmDesc = GetResString(IDS_HASHING_FRM);
@


1.27
log
@Reduced range of possible copy buffer sizes from 4-512 to 8-256
(due to large buffer only slows down copying).
@
text
@d23 1
d41 1
d56 1
d86 2
a87 1
	ON_BN_CLICKED(IDC_START_PAUSED_ON_COMPLETE, OnSettingsChange)
d140 1
d152 1
d198 1
d233 1
d272 9
@


1.26
log
@Removed Slow Completion setting; Copy buffer size is made as slidebar.
@
text
@d141 1
a141 1
	m_fileCopySizeSlider.SetRange(1, 512 / 4, true);
@


1.25
log
@Reorganized preferences
@
text
@a19 1
	, slowComplete(FALSE)
a22 3
	, slowCompleteBlock(_T(""))
	, apHigh(_T(""))
	, apLow(_T(""))
a25 9
	, fileBufferSizeDesc(_T(""))
	, seeMyShareDesc(_T(""))
	, apGrpDesc(_T(""))
	, apHighDesc(_T(""))
	, apLowDesc(_T(""))
	, apSources1Desc(_T(""))
	, apSources2Desc(_T(""))
	, slowCompleteKbDesc(_T(""))
	, hashingFrmDesc(_T(""))
a36 1
	DDX_Check(pDX, IDC_SLOWCOMPLETE, slowComplete);
d41 1
a41 1
	DDX_Control(pDX, IDC_SLOWCOMPLETE_BLOCK, slowCompleteBlockEdit);
a53 1
	DDX_Control(pDX, IDC_SLOWCOMPLETE, slowCompleteCheck);
d61 1
a61 1
	DDX_Text(pDX, IDC_SLOWCOMPLETE_KB, slowCompleteKbDesc);
a62 1
	DDX_Text(pDX, IDC_SLOWCOMPLETE_BLOCK, slowCompleteBlock);
d68 1
a83 2
	ON_BN_CLICKED(IDC_SLOWCOMPLETE, OnBnClickedSlowComplete)
	ON_EN_CHANGE(IDC_SLOWCOMPLETE_BLOCK, OnSettingsChange)
d131 2
a132 2
	apHigh.Format(_T("%d"), m_pPrefs->PriorityHigh());
	apLow.Format(_T("%d"), m_pPrefs->PriorityLow());
a135 1
	slowComplete = m_pPrefs->SlowComplete();
d137 1
a137 1
	fileBufferSizeSlider.SetRange(1,100,true);
d140 3
a142 1
	slowCompleteBlock.Format(_T("%d"), m_pPrefs->SlowCompleteBlockSize());
a146 1
	OnBnClickedSlowComplete();
d197 2
a198 2
			m_pPrefs->SetPriorityLow( m_pPrefs->PriorityHigh()*2);
			apLow.Format(_T("%d"),m_pPrefs->PriorityLow());
d202 1
a202 8
		m_pPrefs->SetSlowComplete(slowComplete);
		m_pPrefs->SetSlowCompleteBlockSize(_tstoi(slowCompleteBlock));

		if (m_pPrefs->SlowCompleteBlockSize() > 1024)
		{
			m_pPrefs->SetSlowCompleteBlockSize(1024);
			slowCompleteBlock.Format(_T("%d"),m_pPrefs->SlowCompleteBlockSize());
		}
a227 2
		slowCompleteCheck.SetWindowText(GetResString(IDS_SLOWCOMPLETE));
		slowCompleteKbDesc = GetResString(IDS_KBYTES);
d233 1
a246 8
void CPPgFiles::OnBnClickedSlowComplete()
{
	UpdateData(TRUE);
	slowCompleteBlockEdit.EnableWindow(slowComplete);

	SetModified();
}

d253 8
a260 1
		fileBufferSizeDesc.Format( GetResString(IDS_FILEBUFFERSIZE), fileBufferSize * 30000 );//netwolf: increased FileBufferSize
@


1.24
log
@Cosmetic changes
@
text
@a24 1
	, maxSourcePerFile(_T(""))
a38 11
	, maxSrcDesc(_T(""))
	, autoSourcesEnabled(FALSE)
	, minAutoSourcesPerFile(0)
	, maxAutoSourcesPerFile(0)
	, maxAutoSourcesTotal(0)
	, maxAutoExchangeSources(0)
	, autosrcLblGrp(_T(""))
	, autosrcLblFrom(_T(""))
	, autosrcLblTo(_T(""))
	, autosrcLblMaxtotal(_T(""))
	, autosrcLblSeUpto(_T(""))
a53 8
	DDX_Text(pDX, IDC_SLOWCOMPLETE_BLOCK, slowCompleteBlock);
	DDX_Text(pDX, IDC_MAXSOURCEPERFILE, maxSourcePerFile);
	DDX_Control(pDX, IDC_MAXSOURCEPERFILE, maxSourcePerFileEdit);
	DDX_Text(pDX, IDC_AP_HIGH, apHigh);
	DDX_Text(pDX, IDC_AP_LOW, apLow);
	DDX_Radio(pDX, IDC_SEESHARE1, seeShare);
	DDX_Radio(pDX, IDC_HASHPRIO_STANDARD, hashPriority);
	DDX_Slider(pDX, IDC_FILEBUFFERSIZE, fileBufferSize);
a54 1
	DDX_Text(pDX, IDC_FILEBUFFERSIZE_LBL, fileBufferSizeDesc);
a57 1
	DDX_Text(pDX, IDC_SEEMYSHARE_FRM, seeMyShareDesc);
a63 3
	DDX_Text(pDX, IDC_AP_GRP, apGrpDesc);
	DDX_Text(pDX, IDC_AP_HIGH_LBL, apHighDesc);
	DDX_Text(pDX, IDC_AP_LOW_LBL, apLowDesc);
d68 6
d78 6
a83 18
	DDX_Text(pDX, IDC_MAXSRC_LBL, maxSrcDesc);
	DDX_Control(pDX, IDC_SLOWCOMPLETE, slowCompleteCheck);

	DDX_Check(pDX, IDC_AUTOSRC_ENABLED, autoSourcesEnabled);
	DDX_Text(pDX, IDC_AUTOSRC_MIN_PER_FILE, minAutoSourcesPerFile);
	DDX_Text(pDX, IDC_AUTOSRC_MAX_PER_FILE, maxAutoSourcesPerFile);
	DDX_Text(pDX, IDC_AUTOSRC_MAXTOTAL, maxAutoSourcesTotal);
	DDX_Text(pDX, IDC_AUTOSRC_SE_UPTO, maxAutoExchangeSources);
	DDX_Text(pDX, IDC_AUTOSRC_GRP_LBL, autosrcLblGrp);
	DDX_Text(pDX, IDC_AUTOSRC_FROM_LBL, autosrcLblFrom);
	DDX_Text(pDX, IDC_AUTOSRC_TO_LBL, autosrcLblTo);
	DDX_Text(pDX, IDC_AUTOSRC_MAXTOTAL_LBL, autosrcLblMaxtotal);
	DDX_Text(pDX, IDC_AUTOSRC_SE_UPTO_LBL, autosrcLblSeUpto);
	DDX_Control(pDX, IDC_AUTOSRC_ENABLED, autoSourcesEnabledCheck);
	DDX_Control(pDX, IDC_AUTOSRC_MIN_PER_FILE, minAutoSourcesPerFileEdit);
	DDX_Control(pDX, IDC_AUTOSRC_MAX_PER_FILE, maxAutoSourcesPerFileEdit);
	DDX_Control(pDX, IDC_AUTOSRC_MAXTOTAL, maxAutoSourcesTotalEdit);
	DDX_Control(pDX, IDC_AUTOSRC_SE_UPTO, maxAutoExchangeSourcesEdit);
a98 2
	ON_EN_CHANGE(IDC_MAXSOURCEPERFILE, OnSettingsChange)
	ON_EN_KILLFOCUS(IDC_MAXSOURCEPERFILE, OnSourcesChange)
a101 5
	ON_BN_CLICKED(IDC_AUTOSRC_ENABLED, OnBnClickedAutoSources)
	ON_EN_CHANGE(IDC_AUTOSRC_MIN_PER_FILE, OnSettingsChange)
	ON_EN_CHANGE(IDC_AUTOSRC_MAX_PER_FILE, OnSettingsChange)
	ON_EN_CHANGE(IDC_AUTOSRC_MAXTOTAL, OnSettingsChange)
	ON_EN_CHANGE(IDC_AUTOSRC_SE_UPTO, OnSettingsChange)
a150 5
	if(m_pPrefs->GetMaxSourcePerFile() == 0xFFFF)
		maxSourcePerFile = _T("99999");
	else
		maxSourcePerFile.Format(_T("%d"), m_pPrefs->GetMaxSourcePerFile());

a159 6
	autoSourcesEnabled = m_pPrefs->IsAutoSourcesEnabled();
	minAutoSourcesPerFile = m_pPrefs->GetMinAutoSourcesPerFile();
	maxAutoSourcesPerFile = m_pPrefs->GetMaxAutoSourcesPerFile();
	maxAutoSourcesTotal = m_pPrefs->GetMaxAutoSourcesTotal();
	maxAutoExchangeSources = m_pPrefs->GetMaxAutoExchangeSources();

d164 1
a164 1
	OnBnClickedAutoSources();
a204 6
		if(!maxSourcePerFile.IsEmpty())
		{
			int mspf = _tstoi(maxSourcePerFile);
			m_pPrefs->SetMaxSourcePerFile( (mspf != 0) ? mspf : 10);
		}

a208 1

d211 1
a218 1

d221 1
a227 6
		m_pPrefs->SetAutoSourcesEnabled(autoSourcesEnabled);
		m_pPrefs->SetMinAutoSourcesPerFile(minAutoSourcesPerFile);
		m_pPrefs->SetMaxAutoSourcesPerFile(maxAutoSourcesPerFile);
		m_pPrefs->SetMaxAutoSourcesTotal(maxAutoSourcesTotal);
		m_pPrefs->SetMaxAutoExchangeSources(maxAutoExchangeSources);

a254 1
		maxSrcDesc = GetResString(IDS_PW_MAXSOURCES);
a258 26

		autoSourcesEnabledCheck.SetWindowText(GetResString(IDS_ENABLED));
		autosrcLblGrp		= GetResString(IDS_AUTOSRC_GRP_LBL);
		autosrcLblFrom		= GetResString(IDS_AUTOSRC_FROM_LBL);
		autosrcLblTo		= GetResString(IDS_AUTOSRC_TO_LBL);
		autosrcLblMaxtotal	= GetResString(IDS_AUTOSRC_MAXTOTAL_LBL);
		autosrcLblSeUpto	= GetResString(IDS_AUTOSRC_SE_UPTO_LBL);

		UpdateData(FALSE);
	}
}

void CPPgFiles::OnSourcesChange()
{
	UpdateData(TRUE);

	uint16 num = 10;
	if(!maxSourcePerFile.IsEmpty())
	{
		num = _tstoi(maxSourcePerFile);
		if (num < 10)
			num = 10;
	}
	if (num != m_pPrefs->GetMaxSourcePerFile())
	{
		maxSourcePerFile.Format(_T("%u"),num);
a279 13
void CPPgFiles::OnBnClickedAutoSources()
{
	UpdateData(TRUE);

	minAutoSourcesPerFileEdit.EnableWindow(autoSourcesEnabled);
	maxAutoSourcesPerFileEdit.EnableWindow(autoSourcesEnabled);
	maxAutoSourcesTotalEdit.EnableWindow(autoSourcesEnabled);
	maxAutoExchangeSourcesEdit.EnableWindow(autoSourcesEnabled);
	maxSourcePerFileEdit.EnableWindow(!autoSourcesEnabled);

	SetModified();
}

@


1.23
log
@auto max sources per file
@
text
@d322 1
a322 1
		autoSourcesEnabledCheck.SetWindowText(GetResString(IDS_AUTOSRC_ENABLED));
@


1.22
log
@formatting
@
text
@a23 1
	, autoClearCompleted(FALSE)
d41 10
a65 1
	DDX_Check(pDX, IDC_AUTO_CLEAR_COMPLETED, autoClearCompleted);
d68 1
a92 1
	DDX_Control(pDX, IDC_AUTO_CLEAR_COMPLETED, autoClearCompletedCheck);
d99 16
a129 1
	ON_BN_CLICKED(IDC_AUTO_CLEAR_COMPLETED, OnSettingsChange)
d135 5
a196 1
	autoClearCompleted = m_pPrefs->IsAutoClearCompleted();
d203 6
d213 1
a263 1
		m_pPrefs->SetAutoClearCompleted(autoClearCompleted);
d283 6
a310 1
		autoClearCompletedCheck.SetWindowText(GetResString(IDS_AUTO_CLEAR_COMPLETED));
d322 7
d368 13
@


1.21
log
@Minor change
@
text
@d125 1
a125 1
{	
d129 1
a129 1
			seeShare = 0;			
d132 1
a132 1
			seeShare = 1;			
d136 1
a136 1
			seeShare = 2;			
d155 1
a155 1
		
d157 2
a158 2
			
	apHigh.Format(_T("%d"), m_pPrefs->PriorityHigh());	
d161 2
a162 2
	if(m_pPrefs->GetMaxSourcePerFile() == 0xFFFF)	
		maxSourcePerFile = _T("99999");	
d164 1
a164 1
		maxSourcePerFile.Format(_T("%d"), m_pPrefs->GetMaxSourcePerFile());			
d166 2
a167 2
	startPaused = m_pPrefs->StartDownloadPaused();		
	startPausedOnComplete = m_pPrefs->DownloadPausedOnComplete();		
d170 1
a170 1
		
d192 2
a193 2
				m_pPrefs->SetCanSeeShares(SEE_SHARE_EVERYBODY);			
			break;
d196 1
a196 1
			break;
d200 3
a202 3
			break;
		}		
	
d208 1
a208 1
			break;
d212 1
a212 1
			break;
d217 1
a217 1
			break;
d219 1
a219 1
				
d222 1
a222 1
			int mspf = _tstoi(maxSourcePerFile);			
d232 1
a232 1
		m_pPrefs->SetPriorityHigh(_tstoi(apHigh));		
d237 1
a237 1
			apLow.Format(_T("%d"),m_pPrefs->PriorityLow());			
d239 1
a239 1
		
d242 1
a242 1
		m_pPrefs->SetSlowComplete(slowComplete);		
d247 2
a248 2
			slowCompleteBlock.Format(_T("%d"),m_pPrefs->SlowCompleteBlockSize());			
		} 
d281 1
a281 1
		hashIdleRadio.SetWindowText(GetResString(IDS_HASHPRIO_IDLE));		
d291 1
a291 1
		
d297 2
a298 2
			num = 10;		
	}	
d309 2
a310 2
	apHighEdit.EnableWindow(dapEnable);	
	apLowEdit.EnableWindow(dapEnable);	
d323 2
a324 2
void CPPgFiles::OnHScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar) 
{		
d328 1
a328 1
		UpdateData(TRUE);		
d330 1
a330 1
		UpdateData(FALSE);		
@


1.20
log
@added "Watch clipboard for ed2k links"
@
text
@a41 1
	, watchClipboard(FALSE)
a57 1
	DDX_Check(pDX, IDC_WATCH_CLIPBOARD, watchClipboard);
a90 1
	DDX_Control(pDX, IDC_WATCH_CLIPBOARD, watchClipboardCheck);
a110 2
	ON_BN_CLICKED(IDC_WATCH_CLIPBOARD, OnSettingsChange)

a174 1
	watchClipboard = m_pPrefs->IsWatchClipboard4ED2KLinks();
a230 1
		m_pPrefs->SetWatchClipboard4ED2KLinks(watchClipboard);
a282 1
		watchClipboardCheck.SetWindowText(GetResString(IDS_WATCH_CLIPBOARD));
@


1.19
log
@added 'auto-clear completed files' option
@
text
@d42 1
d59 1
d93 1
d114 1
d180 2
a181 1
	
d232 6
a237 5
		m_pPrefs->SetUAPEnabled( uap);
		m_pPrefs->SetDAPEnabled( dapEnable);
		m_pPrefs->SetStartDownloadPaused(startPaused) ;
		m_pPrefs->SetDownloadPausedOnComplete( startPausedOnComplete) ;
		m_pPrefs->SetAutoClearCompleted(autoClearCompleted) ;
d289 3
a291 1
		fileBufferSizeDesc.Format(GetResString(IDS_FILEBUFFERSIZE), fileBufferSize*30000); //netwolf: increased FileBufferSize		
@


1.18
log
@Formatting, comments, and name changes.
@
text
@d24 1
d57 1
d84 1
d100 7
a106 7
	ON_EN_CHANGE(IDC_AP_HIGH, OnSettingsChange) // DonGato
	ON_EN_CHANGE(IDC_AP_LOW, OnSettingsChange) // DonGato
	ON_BN_CLICKED(IDC_UAP, OnSettingsChange)	// Tarod
	ON_BN_CLICKED(IDC_DAP_ENABLE, OnBnClickedDAP) // DonGato
	ON_BN_CLICKED(IDC_START_PAUSED, OnSettingsChange) // Tarod
	ON_BN_CLICKED(IDC_START_PAUSED_ON_COMPLETE, OnSettingsChange) // Tarod
//	ON_BN_CLICKED(IDC_REMOVENNS, OnSettingsChange) // Tarod
d110 1
a110 1
	ON_EN_CHANGE(IDC_SLOWCOMPLETE_BLOCK, OnSettingsChange) // DonGato
a140 1
	// DonGato
a154 1
	// Tarod
a156 1
	// DonGato
a166 1
	// Tarod
d170 1
a171 1
	// Barry
d181 1
a181 1
	SetModified(FALSE);	// FoRcHa
a226 1
		// Added by Tarod
d231 1
a232 2

		// DonGato				
a240 1
		// Barry
d273 1
@


1.17
log
@More name changes, reinstated CMuleCtrlItem class, moved srcsarevisible from CPartFile to CMuleCtrlItem (where it belongs), added "Show Full Status Icons" and "Show Gray Paused" features with corresponding preferences, modified "SmartOpen" code to make it sticky and to make it work with sources with changing states.
@
text
@d124 1
a124 1
	switch(app_prefs->CanSeeShares())
d139 1
a139 1
	switch(app_prefs->GetHashingPriority())
d154 1
a154 1
	uap = app_prefs->IsUAPEnabled();
d157 1
a157 1
	dapEnable = app_prefs->IsDAPEnabled();
d159 2
a160 2
	apHigh.Format(_T("%d"), app_prefs->PriorityHigh());	
	apLow.Format(_T("%d"), app_prefs->PriorityLow());
d162 1
a162 1
	if(app_prefs->GetMaxSourcePerFile() == 0xFFFF)	
d165 1
a165 1
		maxSourcePerFile.Format(_T("%d"), app_prefs->GetMaxSourcePerFile());			
d168 3
a170 3
	startPaused = app_prefs->StartDownloadPaused();		
	startPausedOnComplete = app_prefs->DownloadPausedOnComplete();		
	slowComplete = app_prefs->SlowComplete();
d174 1
a174 1
	fileBufferSize = app_prefs->GetFileBufferSize();
d176 1
a176 1
	slowCompleteBlock.Format(_T("%d"), app_prefs->SlowCompleteBlockSize());
d194 1
a194 1
				app_prefs->SetCanSeeShares(SEE_SHARE_EVERYBODY);			
d197 1
a197 1
				app_prefs->SetCanSeeShares(SEE_SHARE_FRIENDS);
d201 1
a201 1
				app_prefs->SetCanSeeShares(SEE_SHARE_NOONE);
d208 1
a208 1
				app_prefs->SetHashingPriority(HASH_PRIORITY_IDLE);
d212 1
a212 1
				app_prefs->SetHashingPriority(HASH_PRIORITY_LOWER);
d217 1
a217 1
				app_prefs->SetHashingPriority(HASH_PRIORITY_STANDARD);
d225 1
a225 1
			app_prefs->SetMaxSourcePerFile( (mspf != 0) ? mspf : 10);
d229 4
a232 4
		app_prefs->SetUAPEnabled( uap);
		app_prefs->SetDAPEnabled( dapEnable);
		app_prefs->SetStartDownloadPaused(startPaused) ;
		app_prefs->SetDownloadPausedOnComplete( startPausedOnComplete) ;
d236 3
a238 3
		app_prefs->SetPriorityHigh(_tstoi(apHigh));		
		app_prefs->SetPriorityLow(_tstoi(apLow));
		if(app_prefs->PriorityLow() < app_prefs->PriorityHigh())
d240 2
a241 2
			app_prefs->SetPriorityLow( app_prefs->PriorityHigh()*2);
			apLow.Format(_T("%d"),app_prefs->PriorityLow());			
d245 1
a245 1
		app_prefs->SetFileBufferSize(fileBufferSize);
d247 3
a249 3
		app_prefs->SetSlowComplete(slowComplete);		
		app_prefs->SetSlowCompleteBlockSize(_tstoi(slowCompleteBlock));
		if (app_prefs->SlowCompleteBlockSize() > 1024)
d251 2
a252 2
			app_prefs->SetSlowCompleteBlockSize(1024);
			slowCompleteBlock.Format(_T("%d"),app_prefs->SlowCompleteBlockSize());			
d302 1
a302 1
	if (num != app_prefs->GetMaxSourcePerFile())
@


1.16
log
@converted to use DDX framework
@
text
@d209 1
a209 1
				theApp.m_FilesHashing.SetProcessingPriority(ePIdle);
d213 1
a213 1
				theApp.m_FilesHashing.SetProcessingPriority(ePLower);
d218 1
a218 1
				theApp.m_FilesHashing.SetProcessingPriority(ePStandard);
@


1.15
log
@now using Ottavio´s SLS system [netwolf]
@
text
@d19 22
d51 37
d127 1
a127 1
			CheckDlgButton(IDC_SEESHARE1,1);
d130 1
a130 1
			CheckDlgButton(IDC_SEESHARE2,1);
d134 1
a134 1
			CheckDlgButton(IDC_SEESHARE3,1);
d141 2
a142 2
		case 0:
			CheckDlgButton(IDC_HASHPRIO_IDLE,1);
d144 2
a145 2
		case 1:
			CheckDlgButton(IDC_HASHPRIO_LOWER,1);
d147 1
d149 1
a149 1
			CheckDlgButton(IDC_HASHPRIO_STANDARD,1);
d154 2
a155 5
	if(app_prefs->IsUAPEnabled())
		CheckDlgButton(IDC_UAP,1);
	else
		CheckDlgButton(IDC_UAP,0);

d157 4
a160 5
	if(app_prefs->IsDAPEnabled())
		CheckDlgButton(IDC_DAP_ENABLE,1);
	else
		CheckDlgButton(IDC_DAP_ENABLE,0);
	OnBnClickedDAP();
d162 2
a163 8
	CString strBuffer;
	strBuffer.Format(_T("%d"), app_prefs->PriorityHigh());
	GetDlgItem(IDC_AP_HIGH)->SetWindowText(strBuffer);
	strBuffer.Format(_T("%d"), app_prefs->PriorityLow());
	GetDlgItem(IDC_AP_LOW)->SetWindowText(strBuffer);

	if(app_prefs->GetMaxSourcePerFile() == 0xFFFF)
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText(_T("99999"));
d165 1
a165 4
	{
		strBuffer.Format(_T("%d"), app_prefs->GetMaxSourcePerFile());
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText(strBuffer);
	}
d168 4
a171 19
	if (app_prefs->StartDownloadPaused())
		CheckDlgButton(IDC_START_PAUSED, 1);
	else
		CheckDlgButton(IDC_START_PAUSED, 0);
	if (app_prefs->DownloadPausedOnComplete())
		CheckDlgButton(IDC_START_PAUSED_ON_COMPLETE, 1);
	else
		CheckDlgButton(IDC_START_PAUSED_ON_COMPLETE, 0);
/*	if (app_prefs->IsRemoveNNSEnabled())
		CheckDlgButton(IDC_REMOVENNS, 1);
	else
		CheckDlgButton(IDC_REMOVENNS, 0);
*/
	if (app_prefs->SlowComplete())
		CheckDlgButton(IDC_SLOWCOMPLETE, 1);
	else
		CheckDlgButton(IDC_SLOWCOMPLETE, 0);
	OnBnClickedSlowComplete();

d173 2
a174 3
	((CSliderCtrl*)GetDlgItem(IDC_FILEBUFFERSIZE))->SetRange(1,100,true);
	((CSliderCtrl*)GetDlgItem(IDC_FILEBUFFERSIZE))->SetPos(app_prefs->GetFileBufferSize());
	m_iFileBufferSize = app_prefs->GetFileBufferSize();
d176 3
a178 2
	strBuffer.Format(_T("%d"), app_prefs->SlowCompleteBlockSize());
	GetDlgItem(IDC_SLOWCOMPLETE_BLOCK)->SetWindowText(strBuffer);
d180 2
a186 2
//	CSingleLock PrefLock(&(app_prefs->m_Pref_Mutex),TRUE); 

d189 1
a189 6
		if(IsDlgButtonChecked(IDC_SEESHARE1))
			app_prefs->SetCanSeeShares(SEE_SHARE_EVERYBODY);
		else if(IsDlgButtonChecked(IDC_SEESHARE2))
			app_prefs->SetCanSeeShares(SEE_SHARE_FRIENDS);
		else
			app_prefs->SetCanSeeShares(SEE_SHARE_NOONE);
d191 1
a191 2
		// DonGato
		if(IsDlgButtonChecked(IDC_HASHPRIO_IDLE))
d193 13
a205 4
			app_prefs->SetHashingPriority(HASH_PRIORITY_IDLE);
			theApp.m_FilesHashing.SetProcessingPriority(ePIdle);
		}
		else if(IsDlgButtonChecked(IDC_HASHPRIO_LOWER))
d207 13
a219 2
			app_prefs->SetHashingPriority(HASH_PRIORITY_LOWER);
			theApp.m_FilesHashing.SetProcessingPriority(ePLower);
d221 2
a222 1
		else
d224 2
a225 8
			app_prefs->SetHashingPriority(HASH_PRIORITY_STANDARD);
			theApp.m_FilesHashing.SetProcessingPriority(ePStandard);
		}
		CString buffer;
		if(GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowTextLength())
		{
			GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowText(buffer);
			app_prefs->SetMaxSourcePerFile( (_tstoi(buffer)) ? _tstoi(buffer) : 10);
d229 4
a232 5
		app_prefs->SetUAPEnabled( (int8)IsDlgButtonChecked(IDC_UAP));
		app_prefs->SetDAPEnabled( (int8)IsDlgButtonChecked(IDC_DAP_ENABLE));
		app_prefs->SetStartDownloadPaused((int8)IsDlgButtonChecked(IDC_START_PAUSED)) ;
		app_prefs->SetDownloadPausedOnComplete( (int8)IsDlgButtonChecked(IDC_START_PAUSED_ON_COMPLETE)) ;
//		app_prefs->SetRemoveNNSEnabled( (int8)IsDlgButtonChecked(IDC_REMOVENNS));
d234 4
a237 6
		// DonGato
		
		GetDlgItem(IDC_AP_HIGH)->GetWindowText(buffer);
		app_prefs->SetPriorityHigh(_tstoi(buffer));
		GetDlgItem(IDC_AP_LOW)->GetWindowText(buffer);
		app_prefs->SetPriorityLow(_tstoi(buffer));
d241 1
a241 2
			buffer.Format(_T("%d"),app_prefs->PriorityLow());
			GetDlgItem(IDC_AP_LOW)->SetWindowText(buffer);
d245 1
a245 1
		app_prefs->SetFileBufferSize(m_iFileBufferSize);
d247 2
a248 3
		app_prefs->SetSlowComplete((int8)IsDlgButtonChecked(IDC_SLOWCOMPLETE));
		GetDlgItem(IDC_SLOWCOMPLETE_BLOCK)->GetWindowText(buffer);
		app_prefs->SetSlowCompleteBlockSize(_tstoi(buffer));
d252 1
a252 2
			buffer.Format(_T("%d"),app_prefs->SlowCompleteBlockSize());
			GetDlgItem(IDC_SLOWCOMPLETE_BLOCK)->SetWindowText(buffer);
d255 1
d263 1
a263 1
	if(GetSafeHwnd())
d266 22
a287 24
		GetDlgItem(IDC_SEEMYSHARE_FRM)->SetWindowText(GetResString(IDS_PW_SHARE));
		GetDlgItem(IDC_SEESHARE1)->SetWindowText(GetResString(IDS_PW_EVER));
		GetDlgItem(IDC_SEESHARE2)->SetWindowText(GetResString(IDS_PW_FRIENDS));
		GetDlgItem(IDC_SEESHARE3)->SetWindowText(GetResString(IDS_PW_NOONE));
		GetDlgItem(IDC_AP_GRP)->SetWindowText(GetResString(IDS_AP_GRP));
		GetDlgItem(IDC_AP_HIGH_LBL)->SetWindowText(GetResString(IDS_AP_HIGH_LBL));
		GetDlgItem(IDC_AP_LOW_LBL)->SetWindowText(GetResString(IDS_AP_LOW_LBL));
		GetDlgItem(IDC_DAP_ENABLE)->SetWindowText(GetResString(IDS_ENABLED));
		GetDlgItem(IDC_UAP)->SetWindowText(GetResString(IDS_UAP));
		GetDlgItem(IDC_START_PAUSED)->SetWindowText(GetResString(IDS_START_PAUSED));
		GetDlgItem(IDC_START_PAUSED_ON_COMPLETE)->SetWindowText(GetResString(IDS_START_PAUSED_ON_COMPLETE));
//		GetDlgItem(IDC_REMOVENNS)->SetWindowText(GetResString(IDS_REMOVENNS));
		GetDlgItem(IDC_AP_SOURCES1)->SetWindowText(GetResString(IDS_SOURCES_PF_FILES));
		GetDlgItem(IDC_AP_SOURCES2)->SetWindowText(GetResString(IDS_SOURCES_PF_FILES));
		GetDlgItem(IDC_SLOWCOMPLETE)->SetWindowText(GetResString(IDS_SLOWCOMPLETE));
		GetDlgItem(IDC_SLOWCOMPLETE_KB)->SetWindowText(GetResString(IDS_KBYTES));
		GetDlgItem(IDC_HASHING_FRM)->SetWindowText(GetResString(IDS_HASHING_FRM));
		GetDlgItem(IDC_MAXSRC_LBL)->SetWindowText(GetResString(IDS_PW_MAXSOURCES));
		GetDlgItem(IDC_HASHPRIO_STANDARD)->SetWindowText(GetResString(IDS_HASHPRIO_STANDARD));
		GetDlgItem(IDC_HASHPRIO_LOWER)->SetWindowText(GetResString(IDS_HASHPRIO_LOWER));
		GetDlgItem(IDC_HASHPRIO_IDLE)->SetWindowText(GetResString(IDS_HASHPRIO_IDLE));
		CString temp;
		temp.Format(GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*30000); //netwolf: increased FileBufferSize
		GetDlgItem(IDC_FILEBUFFERSIZE_LBL)->SetWindowText(temp);
d293 4
a296 4
	TCHAR buffer[30];
	CString sBuffer;
	uint16 num=0;
	if(GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowTextLength())
d298 4
a301 4
		GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowText(buffer,20);
		num=((_tstoi(buffer)) ? _tstoi(buffer) : 10);	
	}
	num=(num<10)?10:num;
d304 2
a305 2
		sBuffer.Format(_T("%u"),num);
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText(sBuffer);
d311 3
a313 2
	GetDlgItem(IDC_AP_HIGH)->EnableWindow(IsDlgButtonChecked(IDC_DAP_ENABLE));	
	GetDlgItem(IDC_AP_LOW)->EnableWindow(IsDlgButtonChecked(IDC_DAP_ENABLE));	
d320 2
a321 1
	GetDlgItem(IDC_SLOWCOMPLETE_BLOCK)->EnableWindow(IsDlgButtonChecked(IDC_SLOWCOMPLETE));
d327 2
a328 6
{
	SetModified(TRUE);
	
	CSliderCtrl* slider =(CSliderCtrl*)pScrollBar;
	CString temp;
	if (pScrollBar==GetDlgItem(IDC_FILEBUFFERSIZE))
d330 4
a333 3
		m_iFileBufferSize = slider->GetPos();
		temp.Format( GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*30000 );//netwolf: increased FileBufferSize
		GetDlgItem(IDC_FILEBUFFERSIZE_LBL)->SetWindowText(temp);
@


1.14
log
@unicode cleanup
@
text
@d44 1
a44 1
	ON_BN_CLICKED(IDC_REMOVENNS, OnSettingsChange) // Tarod
d129 1
a129 1
	if (app_prefs->IsRemoveNNSEnabled())
d133 1
a133 1

d192 1
a192 1
		app_prefs->SetRemoveNNSEnabled( (int8)IsDlgButtonChecked(IDC_REMOVENNS));
d241 1
a241 1
		GetDlgItem(IDC_REMOVENNS)->SetWindowText(GetResString(IDS_REMOVENNS));
@


1.13
log
@code cleanup
@
text
@d107 1
a107 1
	strBuffer.Format("%d", app_prefs->PriorityHigh());
d109 1
a109 1
	strBuffer.Format("%d", app_prefs->PriorityLow());
d113 1
a113 1
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText("99999");
d116 1
a116 1
		strBuffer.Format("%d", app_prefs->GetMaxSourcePerFile());
d145 1
a145 1
	strBuffer.Format("%d", app_prefs->SlowCompleteBlockSize());
d184 1
a184 1
			app_prefs->SetMaxSourcePerFile( (atoi(buffer)) ? atoi(buffer) : 10);
d197 1
a197 1
		app_prefs->SetPriorityHigh(atoi(buffer));
d199 1
a199 1
		app_prefs->SetPriorityLow(atoi(buffer));
d203 1
a203 1
			buffer.Format("%d",app_prefs->PriorityLow());
d212 1
a212 1
		app_prefs->SetSlowCompleteBlockSize(atoi(buffer));
d216 1
a216 1
			buffer.Format("%d",app_prefs->SlowCompleteBlockSize());
d259 1
a259 1
	char buffer[30];
d265 1
a265 1
		num=((atoi(buffer)) ? atoi(buffer) : 10);	
d270 1
a270 1
		sBuffer.Format("%u",num);
@


1.12
log
@SyruS: moved cleanup-visuals to advanced tab
@
text
@d180 1
a180 1
		char buffer[100];
d183 1
a183 1
			GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowText(buffer,20);
d196 1
a196 1
		GetDlgItem(IDC_AP_HIGH)->GetWindowText(buffer,7);
d198 1
a198 1
		GetDlgItem(IDC_AP_LOW)->GetWindowText(buffer,7);
d203 1
a203 1
			sprintf(buffer, "%d",app_prefs->PriorityLow());
d211 1
a211 1
		GetDlgItem(IDC_SLOWCOMPLETE_BLOCK)->GetWindowText(buffer, 20);
d216 1
a216 1
			sprintf(buffer, "%d",app_prefs->SlowCompleteBlockSize());
@


1.11
log
@SyruS: customizable cleanup of filenames
@
text
@a6 1
#include "Inputbox.h"
a48 4
	//SyruS: cleanup
	ON_BN_CLICKED(IDC_FNCLEANUP, OnSettingsChange)
	ON_BN_CLICKED(IDC_FNCLEANUPTAG, OnSettingsChange)
	ON_BN_CLICKED(IDC_FNC, OnSetCleanupFilter)
a147 4
	//SyruS: cleanup
	CheckDlgButton(IDC_FNCLEANUP, (uint8)app_prefs->GetAutoFilenameCleanup());
	CheckDlgButton(IDC_FNCLEANUPTAG, (uint8)app_prefs->GetFilenameCleanupTags());

a219 4
		//SyruS: cleanup
		app_prefs->SetAutoFilenameCleanup((int8)IsDlgButtonChecked(IDC_FNCLEANUP));
		app_prefs->SetFilenameCleanupTags((int8)IsDlgButtonChecked(IDC_FNCLEANUPTAG));

a253 4
		//SyruS: cleanup
		GetDlgItem(IDC_FNC)->SetWindowText(GetResString(IDS_EDIT));
		GetDlgItem(IDC_FNCLEANUP)->SetWindowText(GetResString(IDS_AUTOCLEANUPFN));
		GetDlgItem(IDC_FNCLEANUPTAG)->SetWindowText(GetResString(IDS_CLEANUPTAGS));
a301 9
}

//SyruS: cleanup
void CPPgFiles::OnSetCleanupFilter() {
				InputBox inputbox;

				inputbox.SetLabels(GetResString(IDS_FNFILTERTITLE), theApp.glob_prefs->GetFilenameCleanups());
				inputbox.DoModal();
				if (!inputbox.WasCancelled()) theApp.glob_prefs->SetFilenameCleanups(inputbox.GetInput());
@


1.10
log
@netwolf/SyruS/katsyonak changes - see changelog+
@
text
@d7 1
d50 5
d152 5
d229 4
d267 4
d319 9
@


1.9
log
@Continuing to convert variables to CSecuredVar template
@
text
@d250 1
a250 1
		temp.Format(GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*15000);
d297 1
a297 1
		temp.Format( GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*15000 );
@


1.9.4.1
log
@27a partial merge
@
text
@a44 1
	ON_BN_CLICKED(IDC_WATCHCB, OnSettingsChange)
a146 5

	if(app_prefs->WatchClipboard4ED2KLinks())
		CheckDlgButton(IDC_WATCHCB,1);
	else
		CheckDlgButton(IDC_WATCHCB,0);
a217 2
		app_prefs->SetWatchClipboard4ED2KLinks(IsDlgButtonChecked(IDC_WATCHCB));
	
a251 1
		GetDlgItem(IDC_WATCHCB)->SetWindowText(GetResString(IDS_PF_WATCHCB));
@


1.8
log
@file buffer size, autotake ed2k links and some preferences reorganization.
@
text
@d165 1
a165 1
			app_prefs->SetHashingPriority(0);
d170 1
a170 1
			app_prefs->SetHashingPriority(1);
d175 1
a175 1
			app_prefs->SetHashingPriority(2);
@


1.7
log
@simplified control panel,added remote queue limit as an otpion
@
text
@d49 1
d139 5
d205 3
d249 3
d286 14
@


1.6
log
@Removed FLMC as a preferences option.
@
text
@d32 9
a40 9
	ON_BN_CLICKED(IDC_SEESHARE1, OnBnClickedSeeshare1)
	ON_BN_CLICKED(IDC_SEESHARE2, OnBnClickedSeeshare2)
	ON_BN_CLICKED(IDC_SEESHARE3, OnBnClickedSeeshare3)
	ON_BN_CLICKED(IDC_HASHPRIO_STANDARD, OnBnClickedHashingStandard)
	ON_BN_CLICKED(IDC_HASHPRIO_LOWER, OnBnClickedHashingLower)
	ON_BN_CLICKED(IDC_HASHPRIO_IDLE, OnBnClickedHashingIdle)
	ON_EN_CHANGE(IDC_AP_HIGH, OnEnChangeHigh) // DonGato
	ON_EN_CHANGE(IDC_AP_LOW, OnEnChangeLow) // DonGato
	ON_BN_CLICKED(IDC_UAP, OnBnClickedUAP)	// Tarod
d42 5
a46 3
	ON_BN_CLICKED(IDC_START_PAUSED, OnBnClickedStartPaused) // Tarod
	ON_BN_CLICKED(IDC_START_PAUSED_ON_COMPLETE, OnBnClickedStartPausedOnComplete) // Tarod
	ON_BN_CLICKED(IDC_REMOVENNS, OnBnClickedRemoveNNS) // Tarod
d48 1
a48 1
	ON_EN_CHANGE(IDC_SLOWCOMPLETE_BLOCK, OnEnChangeSlowCompleteBlock) // DonGato
d110 8
a139 1

d172 6
d187 1
a187 1
		char buffer[100];
d236 1
d240 18
@


1.6.2.1
log
@keeping in sync with the main cvs line
@
text
@d32 9
a40 9
	ON_BN_CLICKED(IDC_SEESHARE1, OnSettingsChange)
	ON_BN_CLICKED(IDC_SEESHARE2, OnSettingsChange)
	ON_BN_CLICKED(IDC_SEESHARE3, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_STANDARD, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_LOWER, OnSettingsChange)
	ON_BN_CLICKED(IDC_HASHPRIO_IDLE, OnSettingsChange)
	ON_EN_CHANGE(IDC_AP_HIGH, OnSettingsChange) // DonGato
	ON_EN_CHANGE(IDC_AP_LOW, OnSettingsChange) // DonGato
	ON_BN_CLICKED(IDC_UAP, OnSettingsChange)	// Tarod
d42 3
a44 5
	ON_BN_CLICKED(IDC_START_PAUSED, OnSettingsChange) // Tarod
	ON_BN_CLICKED(IDC_START_PAUSED_ON_COMPLETE, OnSettingsChange) // Tarod
	ON_BN_CLICKED(IDC_REMOVENNS, OnSettingsChange) // Tarod
	ON_EN_CHANGE(IDC_MAXSOURCEPERFILE, OnSettingsChange)
	ON_EN_KILLFOCUS(IDC_MAXSOURCEPERFILE, OnSourcesChange)
d46 1
a46 2
	ON_EN_CHANGE(IDC_SLOWCOMPLETE_BLOCK, OnSettingsChange) // DonGato
	ON_WM_HSCROLL()
a107 8
	if(app_prefs->GetMaxSourcePerFile() == 0xFFFF)
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText("99999");
	else
	{
		strBuffer.Format("%d", app_prefs->GetMaxSourcePerFile());
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText(strBuffer);
	}

a127 5
	// Barry
	((CSliderCtrl*)GetDlgItem(IDC_FILEBUFFERSIZE))->SetRange(1,100,true);
	((CSliderCtrl*)GetDlgItem(IDC_FILEBUFFERSIZE))->SetPos(app_prefs->GetFileBufferSize());
	m_iFileBufferSize = app_prefs->GetFileBufferSize();

d130 1
a162 6
		char buffer[100];
		if(GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowTextLength())
		{
			GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowText(buffer,20);
			app_prefs->SetMaxSourcePerFile( (atoi(buffer)) ? atoi(buffer) : 10);
		}
d172 1
a172 1
		
a183 3
		// Barry
		app_prefs->SetFileBufferSize(m_iFileBufferSize);

a220 1
		GetDlgItem(IDC_MAXSRC_LBL)->SetWindowText(GetResString(IDS_PW_MAXSOURCES));
a223 21
		CString temp;
		temp.Format(GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*15000);
		GetDlgItem(IDC_FILEBUFFERSIZE_LBL)->SetWindowText(temp);
	}
}

void CPPgFiles::OnSourcesChange()
{
	char buffer[30];
	CString sBuffer;
	uint16 num=0;
	if(GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowTextLength())
	{
		GetDlgItem(IDC_MAXSOURCEPERFILE)->GetWindowText(buffer,20);
		num=((atoi(buffer)) ? atoi(buffer) : 10);	
	}
	num=(num<10)?10:num;
	if (num != app_prefs->GetMaxSourcePerFile())
	{
		sBuffer.Format("%u",num);
		GetDlgItem(IDC_MAXSOURCEPERFILE)->SetWindowText(sBuffer);
a239 14
}

void CPPgFiles::OnHScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar) 
{
	SetModified(TRUE);
	
	CSliderCtrl* slider =(CSliderCtrl*)pScrollBar;
	CString temp;
	if (pScrollBar==GetDlgItem(IDC_FILEBUFFERSIZE))
	{
		m_iFileBufferSize = slider->GetPos();
		temp.Format( GetResString(IDS_FILEBUFFERSIZE), m_iFileBufferSize*15000 );
		GetDlgItem(IDC_FILEBUFFERSIZE_LBL)->SetWindowText(temp);
	}
@


1.5
log
@Added instrumentation for debugging memory leaks :
#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

To all .cpp files (I hope I didn't miss any one)
@
text
@a41 1
	ON_BN_CLICKED(IDC_FLMC, OnBnClickedFLMC) // Tarod
a93 4
	if(app_prefs->IsFirstLastMovieChunksEnabled())
		CheckDlgButton(IDC_FLMC,1);
	else
		CheckDlgButton(IDC_FLMC,0);
a166 1
		app_prefs->SetFirstLastMovieChunksEnabled( (int8)IsDlgButtonChecked(IDC_FLMC));
a212 1
		GetDlgItem(IDC_FLMC)->SetWindowText(GetResString(IDS_FLMC));
@


1.4
log
@Small changes
@
text
@d8 5
@


1.3
log
@Removed SingleLock - no need there.
@
text
@d59 1
a59 1
		case 0:
d62 1
a62 1
		case 1:
d65 1
d141 1
a141 1
			app_prefs->SetCanSeeShares(0);
d143 1
a143 1
			app_prefs->SetCanSeeShares(1);
d145 1
a145 1
			app_prefs->SetCanSeeShares(2);
@


1.2
log
@Updates to Preferences (and enabling/disabling options in code because of that)
@
text
@d135 1
a135 1
	CSingleLock PrefLock(&(app_prefs->m_Pref_Mutex),TRUE); 
@


1.1
log
@*** empty log message ***
@
text
@a32 1
	ON_BN_CLICKED(IDC_ICH, OnBnClickedIch)
a83 5
	if(app_prefs->IsICHEnabled() )
		CheckDlgButton(IDC_ICH,1);
	else
		CheckDlgButton(IDC_ICH,0);

a162 2
		app_prefs->SetICHEnabled( (int8)IsDlgButtonChecked(IDC_ICH));

a203 2
		GetDlgItem(IDC_ICH_FRM)->SetWindowText(GetResString(IDS_PW_ICH));
		GetDlgItem(IDC_ICH)->SetWindowText(GetResString(IDS_PW_FILE_ICH));
@


1.1.4.1
log
@updating this branch...
@
text
@@


1.1.4.2
log
@updated control panes, and assorted bugfixes
@
text
@d33 1
d85 5
d169 2
d212 2
@


