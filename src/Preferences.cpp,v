head	1.432;
access;
symbols
	PublicRelease_1_2e:1.417
	Interim_Release_1-2e_RC1:1.415
	PublicRelease_1_2d:1.408
	Interim_Release_1-2d_RC1:1.407
	Interim_Release_1-2d_beta1:1.403
	PublicRelease_1_2c:1.370
	Interim_Release_1-2c_RC1:1.370
	Interim_Release_1-2c_beta1:1.358
	PublicRelease_1_2b:1.356
	Interim_Release_1-2b_RC1:1.355
	PublicRelease_1_2a:1.352
	Interim_Release_1-2a_RC1:1.349
	Interim_Release_1-2a_beta2:1.340
	Interim_Release_1-2a_beta1:1.338
	PublicRelease_1_2:1.331
	Interim_Release_1-2_RC1:1.331
	Interim_Release_1-2_beta1:1.329
	PublicRelease_1_1g:1.327
	Interim_Release_1-1g_RC3:1.326
	Interim_Release_1-1g_RC2:1.325
	Interim_Release_1-1g_RC1:1.325
	Interim_Release_1-1g_beta2:1.320
	Interim_Release_1-1g_beta1:1.316
	PublicRelease_1_1f:1.314
	Interim_Release_1-1f_RC1:1.314
	PublicRelease_1_1e:1.311
	Interim_Release_1-1e_RC2:1.310
	Interim_Release_1-1e_RC1:1.305
	Interim_Release_1-1e_beta1:1.302
	PublicRelease_1_1d:1.295
	Interim_Release_1-1d_RC1:1.295
	PublicRelease_1_1c:1.294
	Interim_Release_1-1c_RC1:1.294
	Interim_Release_1-1c_beta2:1.293
	Interim_Release_1-1c_beta1:1.286
	PublicRelease_1_1b:1.283
	Interim_Release_1-1b_RC1:1.283
	PublicRelease_1_1a:1.279
	Interim_Release_1-1a_RC2:1.279
	Interim_Release_1-1a_RC1:1.278
	Interim_Release_1-1a_beta2:1.277
	Interim_Release_1-1a_beta1:1.276
	PublicRelease_1_1:1.275
	Interim_Release_1-1_beta1:1.275
	PublicRelease_1o:1.263
	Interim_Release_1o_RC1:1.263
	Interim_Release_1o_beta1:1.261
	PublicRelease_1n:1.258
	Interim_Release_1n_RC2:1.257
	Interim_Release_1n_RC1:1.255
	Interim_Release_1n_beta2:1.250
	Interim_Release_1n_beta1:1.249
	PublicRelease_1m:1.244
	Interim_Release_1m_beta1:1.244
	PublicRelease_1l:1.243
	Interim_Release_1l_RC3:1.242
	Interim_Release_1l_RC2:1.241
	Interim_Release_1l_RC1:1.239
	Interim_Release_1l_beta2:1.238
	Interim_Release_1l_beta1:1.234
	PublicRelease_1k:1.221
	Interim_Release_1k_RC4:1.221
	Interim_1k_RC3:1.221
	Interim_1k_RC2:1.221
	Interim_Release_1k_RC1:1.219
	Interim_Release_1k_beta5:1.218
	Intrerim_Release_1k_beta4:1.218
	Interim_Release_1k_beta1:1.212
	PublicRelease_1j:1.198
	Interim_Release_1J_RC3:1.198
	Interim_Release_1j_RC3:1.198
	Interim_Release_1j_RC2:1.191
	Interim_Release_1j_RC1:1.190
	Interim_Release_1j_beta2:1.187
	Interim_Release_1j_beta1:1.186
	PublicRelease_1i:1.183
	Interim_Release_1i_RC6:1.182
	Interim_Release_1i_RC3:1.178
	Interim_Release_1i_RC2:1.178
	Interim_Release_1i_RC1:1.172
	Interim_Release_1i_beta3:1.169
	Interim_Release_1i_beta2:1.165
	Interim_Release_1i_beta1:1.153
	PublicRelease_1h:1.129
	Interim_Release_1h_rc2:1.129
	Interim_Release_1h_RC1:1.126
	Interim_Release_1h_beta2:1.118
	Interim_Release_1h_beta1_now:1.112
	Interim_Release_1h_beta1:1.112
	PublicRelease_1g:1.94
	Interim_Release_1g_RC6_Final:1.94
	Interim_Release_1g_RC6:1.94
	Interim_Release_1g_RC5:1.94
	Interim_Release_1g_RC4:1.93
	Interim_Release_1g_RC3:1.90
	Interim_Release_1g_beta2:1.75
	Interim_Release_1g_beta1:1.72
	Interim_Release_1f_RC4:1.70
	Interim_Release_1f_RC3:1.69
	Interim_Release_1f_RC2:1.67
	Interim_Release_1f_RC:1.67
	Interim_Release_1f_beta2:1.67
	Interim_Release_1f_beta1:1.63
	PublicRelease_1e:1.62
	Interim_Release_1e_RC2:1.62
	Interim_Release_1e_RC:1.62
	Interim_Release_1e_beta3:1.62
	Interim_Release_1e_beta2:1.62
	Interim_Release_1e_beta2_before_kuchin:1.62
	Interim_Release_1e_beta1:1.61
	PublicRelease_1c:1.58
	featurestest:1.58.0.2
	Interim_Release_1c_RC:1.58
	Interim_Release_1c_beta2:1.56
	Interim_Release_1c_beta1:1.53
	threaded_downloadqueue:1.53.0.2
	PublicRelease_1b:1.42
	Interim_Release_1b_beta2:1.42
	Interim_Release_1b_beta1:1.38
	proxydeadlake:1.26.0.2
	PublicRelease_1a:1.26
	Interim_Release_1a_beta2:1.26
	BerkeleyDb:1.24.0.2
	Interim_Release_1a_beta1:1.23
	PublicRelease_1:1.22
	goldfish:1.22
	eMulePlus_1_RC2:1.22
	eMulePlus_26b_1RC1:1.21
	PreRelease_26b_i0e:1.21
	before_26d_merge:1.19
	Interim_Release_26b_i0d:1.17
	Interim_Release_26b_i0c:1.15
	Interim_Release_26b_i0b:1.15
	Interim_Release_26b_i0a:1.15
	systraydlg:1.12.0.4
	plus26based:1.12.0.2
	Interim_Release_25b_i0b:1.12
	Proxy_Dev:1.11
	Interim_Release_25b_i0a:1.8.2.3
	official_sockets:1.8.0.2
	eMulePlus_024b_5b:1.1.0.2;
locks; strict;
comment	@// @;


1.432
date	2011.11.02.02.34.04;	author aw3;	state Exp;
branches;
next	1.431;

1.431
date	2010.05.04.04.03.38;	author aw3;	state Exp;
branches;
next	1.430;

1.430
date	2010.02.27.17.00.44;	author aw3;	state Exp;
branches;
next	1.429;

1.429
date	2010.02.08.04.05.49;	author aw3;	state Exp;
branches;
next	1.428;

1.428
date	2009.11.30.00.13.47;	author aw3;	state Exp;
branches;
next	1.427;

1.427
date	2009.10.30.01.35.29;	author aw3;	state Exp;
branches;
next	1.426;

1.426
date	2009.10.28.04.34.59;	author aw3;	state Exp;
branches;
next	1.425;

1.425
date	2009.09.25.15.54.23;	author aw3;	state Exp;
branches;
next	1.424;

1.424
date	2009.07.30.03.50.48;	author aw3;	state Exp;
branches;
next	1.423;

1.423
date	2009.07.14.03.54.08;	author aw3;	state Exp;
branches;
next	1.422;

1.422
date	2009.05.14.03.19.00;	author aw3;	state Exp;
branches;
next	1.421;

1.421
date	2009.05.01.04.23.46;	author aw3;	state Exp;
branches;
next	1.420;

1.420
date	2009.04.29.03.13.22;	author aw3;	state Exp;
branches;
next	1.419;

1.419
date	2009.04.26.03.50.35;	author aw3;	state Exp;
branches;
next	1.418;

1.418
date	2009.04.21.02.50.45;	author aw3;	state Exp;
branches;
next	1.417;

1.417
date	2009.04.08.04.05.38;	author aw3;	state Exp;
branches;
next	1.416;

1.416
date	2009.04.04.03.07.55;	author aw3;	state Exp;
branches;
next	1.415;

1.415
date	2009.01.02.02.08.47;	author aw3;	state Exp;
branches;
next	1.414;

1.414
date	2008.11.03.05.45.23;	author aw3;	state Exp;
branches;
next	1.413;

1.413
date	2008.10.26.16.15.14;	author aw3;	state Exp;
branches;
next	1.412;

1.412
date	2008.10.20.22.28.40;	author kush_eplus;	state Exp;
branches;
next	1.411;

1.411
date	2008.10.04.03.47.57;	author aw3;	state Exp;
branches;
next	1.410;

1.410
date	2008.08.14.01.43.50;	author kush_eplus;	state Exp;
branches;
next	1.409;

1.409
date	2008.07.01.04.43.51;	author aw3;	state Exp;
branches;
next	1.408;

1.408
date	2008.05.14.03.42.12;	author aw3;	state Exp;
branches;
next	1.407;

1.407
date	2008.04.07.03.35.48;	author aw3;	state Exp;
branches;
next	1.406;

1.406
date	2008.04.06.11.47.22;	author eklmn;	state Exp;
branches;
next	1.405;

1.405
date	2008.03.15.04.13.12;	author aw3;	state Exp;
branches;
next	1.404;

1.404
date	2008.02.25.19.46.42;	author eklmn;	state Exp;
branches;
next	1.403;

1.403
date	2008.02.18.03.43.15;	author aw3;	state Exp;
branches;
next	1.402;

1.402
date	2008.02.16.09.33.11;	author eklmn;	state Exp;
branches;
next	1.401;

1.401
date	2008.02.16.04.30.09;	author aw3;	state Exp;
branches;
next	1.400;

1.400
date	2008.02.09.20.16.36;	author eklmn;	state Exp;
branches;
next	1.399;

1.399
date	2008.02.07.05.18.00;	author aw3;	state Exp;
branches;
next	1.398;

1.398
date	2008.02.03.04.01.49;	author aw3;	state Exp;
branches;
next	1.397;

1.397
date	2008.02.01.03.17.32;	author aw3;	state Exp;
branches;
next	1.396;

1.396
date	2008.01.31.22.50.30;	author eklmn;	state Exp;
branches;
next	1.395;

1.395
date	2008.01.23.05.12.43;	author aw3;	state Exp;
branches;
next	1.394;

1.394
date	2008.01.19.04.12.14;	author aw3;	state Exp;
branches;
next	1.393;

1.393
date	2008.01.12.21.57.57;	author eklmn;	state Exp;
branches;
next	1.392;

1.392
date	2007.12.30.06.03.15;	author aw3;	state Exp;
branches;
next	1.391;

1.391
date	2007.12.28.10.27.34;	author eklmn;	state Exp;
branches;
next	1.390;

1.390
date	2007.12.28.04.05.55;	author aw3;	state Exp;
branches;
next	1.389;

1.389
date	2007.12.26.04.00.49;	author aw3;	state Exp;
branches;
next	1.388;

1.388
date	2007.12.23.17.49.42;	author aw3;	state Exp;
branches;
next	1.387;

1.387
date	2007.12.22.21.15.26;	author eklmn;	state Exp;
branches;
next	1.386;

1.386
date	2007.12.21.11.51.40;	author eklmn;	state Exp;
branches;
next	1.385;

1.385
date	2007.12.16.16.35.41;	author eklmn;	state Exp;
branches;
next	1.384;

1.384
date	2007.12.15.13.19.13;	author eklmn;	state Exp;
branches;
next	1.383;

1.383
date	2007.12.14.21.11.18;	author kush_eplus;	state Exp;
branches;
next	1.382;

1.382
date	2007.12.12.20.15.32;	author eklmn;	state Exp;
branches;
next	1.381;

1.381
date	2007.12.12.18.49.23;	author eklmn;	state Exp;
branches;
next	1.380;

1.380
date	2007.12.11.04.37.24;	author aw3;	state Exp;
branches;
next	1.379;

1.379
date	2007.12.02.00.06.17;	author aw3;	state Exp;
branches;
next	1.378;

1.378
date	2007.12.01.10.38.06;	author eklmn;	state Exp;
branches;
next	1.377;

1.377
date	2007.11.25.18.58.42;	author aw3;	state Exp;
branches;
next	1.376;

1.376
date	2007.11.12.23.48.41;	author fuxie-dk;	state Exp;
branches;
next	1.375;

1.375
date	2007.10.31.18.18.56;	author fuxie-dk;	state Exp;
branches;
next	1.374;

1.374
date	2007.10.24.19.07.11;	author fuxie-dk;	state Exp;
branches;
next	1.373;

1.373
date	2007.10.18.14.48.01;	author fuxie-dk;	state Exp;
branches;
next	1.372;

1.372
date	2007.10.11.18.08.17;	author fuxie-dk;	state Exp;
branches;
next	1.371;

1.371
date	2007.09.27.14.28.40;	author fuxie-dk;	state Exp;
branches;
next	1.370;

1.370
date	2007.08.22.04.09.08;	author aw3;	state Exp;
branches;
next	1.369;

1.369
date	2007.08.21.12.49.27;	author aw3;	state Exp;
branches;
next	1.368;

1.368
date	2007.08.09.04.31.15;	author aw3;	state Exp;
branches;
next	1.367;

1.367
date	2007.08.09.02.20.34;	author kush_eplus;	state Exp;
branches;
next	1.366;

1.366
date	2007.08.06.19.43.22;	author aw3;	state Exp;
branches;
next	1.365;

1.365
date	2007.07.13.03.55.13;	author aw3;	state Exp;
branches;
next	1.364;

1.364
date	2007.07.08.22.31.18;	author kush_eplus;	state Exp;
branches;
next	1.363;

1.363
date	2007.06.26.04.08.52;	author aw3;	state Exp;
branches;
next	1.362;

1.362
date	2007.06.04.00.54.49;	author aw3;	state Exp;
branches;
next	1.361;

1.361
date	2007.05.27.16.26.26;	author aw3;	state Exp;
branches;
next	1.360;

1.360
date	2007.05.18.03.00.17;	author aw3;	state Exp;
branches;
next	1.359;

1.359
date	2007.04.08.03.25.00;	author aw3;	state Exp;
branches;
next	1.358;

1.358
date	2007.02.18.16.00.49;	author eklmn;	state Exp;
branches;
next	1.357;

1.357
date	2007.02.08.03.56.54;	author aw3;	state Exp;
branches;
next	1.356;

1.356
date	2007.02.01.03.58.27;	author aw3;	state Exp;
branches;
next	1.355;

1.355
date	2006.12.06.14.02.54;	author aw3;	state Exp;
branches;
next	1.354;

1.354
date	2006.10.21.15.06.19;	author aw3;	state Exp;
branches;
next	1.353;

1.353
date	2006.10.14.03.16.23;	author aw3;	state Exp;
branches;
next	1.352;

1.352
date	2006.10.13.04.10.12;	author aw3;	state Exp;
branches;
next	1.351;

1.351
date	2006.10.05.04.47.16;	author aw3;	state Exp;
branches;
next	1.350;

1.350
date	2006.10.02.01.15.06;	author aw3;	state Exp;
branches;
next	1.349;

1.349
date	2006.09.18.13.23.12;	author aw3;	state Exp;
branches;
next	1.348;

1.348
date	2006.09.17.13.47.23;	author aw3;	state Exp;
branches;
next	1.347;

1.347
date	2006.09.09.01.10.24;	author aw3;	state Exp;
branches;
next	1.346;

1.346
date	2006.09.07.03.24.07;	author aw3;	state Exp;
branches;
next	1.345;

1.345
date	2006.08.26.21.36.39;	author aw3;	state Exp;
branches;
next	1.344;

1.344
date	2006.07.14.04.49.06;	author aw3;	state Exp;
branches;
next	1.343;

1.343
date	2006.06.27.04.31.41;	author aw3;	state Exp;
branches;
next	1.342;

1.342
date	2006.06.24.01.04.54;	author aw3;	state Exp;
branches;
next	1.341;

1.341
date	2006.06.21.01.02.33;	author aw3;	state Exp;
branches;
next	1.340;

1.340
date	2006.05.26.03.43.41;	author aw3;	state Exp;
branches;
next	1.339;

1.339
date	2006.05.22.03.45.00;	author aw3;	state Exp;
branches;
next	1.338;

1.338
date	2006.04.22.23.23.45;	author aw3;	state Exp;
branches;
next	1.337;

1.337
date	2006.04.16.00.52.22;	author aw3;	state Exp;
branches;
next	1.336;

1.336
date	2006.04.14.14.58.36;	author aw3;	state Exp;
branches;
next	1.335;

1.335
date	2006.04.04.22.28.40;	author kush_eplus;	state Exp;
branches;
next	1.334;

1.334
date	2006.03.26.23.35.08;	author aw3;	state Exp;
branches;
next	1.333;

1.333
date	2006.03.19.23.41.51;	author aw3;	state Exp;
branches;
next	1.332;

1.332
date	2006.03.18.04.44.41;	author aw3;	state Exp;
branches;
next	1.331;

1.331
date	2006.02.19.16.22.30;	author aw3;	state Exp;
branches;
next	1.330;

1.330
date	2006.02.12.04.02.58;	author aw3;	state Exp;
branches;
next	1.329;

1.329
date	2006.01.06.20.06.46;	author kush_eplus;	state Exp;
branches;
next	1.328;

1.328
date	2005.12.31.06.08.26;	author aw3;	state Exp;
branches;
next	1.327;

1.327
date	2005.12.21.04.21.19;	author aw3;	state Exp;
branches;
next	1.326;

1.326
date	2005.12.17.14.28.25;	author aw3;	state Exp;
branches;
next	1.325;

1.325
date	2005.11.30.02.04.05;	author aw3;	state Exp;
branches;
next	1.324;

1.324
date	2005.11.28.05.27.38;	author aw3;	state Exp;
branches;
next	1.323;

1.323
date	2005.11.28.03.11.13;	author aw3;	state Exp;
branches;
next	1.322;

1.322
date	2005.11.27.22.11.49;	author eklmn;	state Exp;
branches;
next	1.321;

1.321
date	2005.11.27.20.31.05;	author eklmn;	state Exp;
branches;
next	1.320;

1.320
date	2005.11.27.17.58.55;	author aw3;	state Exp;
branches;
next	1.319;

1.319
date	2005.11.07.02.52.03;	author aw3;	state Exp;
branches;
next	1.318;

1.318
date	2005.08.29.03.05.27;	author aw3;	state Exp;
branches;
next	1.317;

1.317
date	2005.08.24.05.26.45;	author aw3;	state Exp;
branches;
next	1.316;

1.316
date	2005.08.11.21.03.52;	author eklmn;	state Exp;
branches;
next	1.315;

1.315
date	2005.08.11.03.46.43;	author aw3;	state Exp;
branches;
next	1.314;

1.314
date	2005.07.25.03.40.19;	author aw3;	state Exp;
branches;
next	1.313;

1.313
date	2005.07.19.04.15.55;	author aw3;	state Exp;
branches;
next	1.312;

1.312
date	2005.07.17.20.47.44;	author aw3;	state Exp;
branches;
next	1.311;

1.311
date	2005.07.09.18.29.52;	author katsyonak;	state Exp;
branches;
next	1.310;

1.310
date	2005.07.09.03.39.18;	author aw3;	state Exp;
branches;
next	1.309;

1.309
date	2005.07.04.23.07.16;	author katsyonak;	state Exp;
branches;
next	1.308;

1.308
date	2005.07.01.16.09.24;	author aw3;	state Exp;
branches;
next	1.307;

1.307
date	2005.06.28.03.54.21;	author aw3;	state Exp;
branches;
next	1.306;

1.306
date	2005.06.25.20.56.58;	author syrus77;	state Exp;
branches;
next	1.305;

1.305
date	2005.06.12.13.53.37;	author eklmn;	state Exp;
branches;
next	1.304;

1.304
date	2005.06.11.14.38.37;	author aw3;	state Exp;
branches;
next	1.303;

1.303
date	2005.06.11.00.40.35;	author katsyonak;	state Exp;
branches;
next	1.302;

1.302
date	2005.05.01.22.01.30;	author katsyonak;	state Exp;
branches;
next	1.301;

1.301
date	2005.04.23.05.17.39;	author aw3;	state Exp;
branches;
next	1.300;

1.300
date	2005.04.21.03.36.58;	author katsyonak;	state Exp;
branches;
next	1.299;

1.299
date	2005.04.09.02.35.29;	author aw3;	state Exp;
branches;
next	1.298;

1.298
date	2005.04.07.04.28.01;	author aw3;	state Exp;
branches;
next	1.297;

1.297
date	2005.04.03.20.50.35;	author aw3;	state Exp;
branches;
next	1.296;

1.296
date	2005.04.03.04.51.41;	author kuchin;	state Exp;
branches;
next	1.295;

1.295
date	2005.03.06.22.00.41;	author aw3;	state Exp;
branches;
next	1.294;

1.294
date	2005.02.23.20.59.49;	author aw3;	state Exp;
branches;
next	1.293;

1.293
date	2005.02.14.22.45.08;	author aw3;	state Exp;
branches;
next	1.292;

1.292
date	2005.02.13.22.56.27;	author aw3;	state Exp;
branches;
next	1.291;

1.291
date	2005.02.07.18.49.15;	author aw3;	state Exp;
branches;
next	1.290;

1.290
date	2005.02.06.17.58.10;	author kuchin;	state Exp;
branches;
next	1.289;

1.289
date	2005.02.05.13.57.12;	author kuchin;	state Exp;
branches;
next	1.288;

1.288
date	2005.02.02.07.15.51;	author aw3;	state Exp;
branches;
next	1.287;

1.287
date	2005.01.31.13.18.12;	author aw3;	state Exp;
branches;
next	1.286;

1.286
date	2005.01.24.03.38.35;	author aw3;	state Exp;
branches;
next	1.285;

1.285
date	2005.01.16.00.34.59;	author netwolf1;	state Exp;
branches;
next	1.284;

1.284
date	2005.01.06.19.06.23;	author netwolf1;	state Exp;
branches;
next	1.283;

1.283
date	2004.12.16.19.35.01;	author aw3;	state Exp;
branches;
next	1.282;

1.282
date	2004.12.16.00.27.16;	author aw3;	state Exp;
branches;
next	1.281;

1.281
date	2004.12.15.14.53.08;	author katsyonak;	state Exp;
branches;
next	1.280;

1.280
date	2004.12.15.03.26.18;	author aw3;	state Exp;
branches;
next	1.279;

1.279
date	2004.11.28.19.02.22;	author aw3;	state Exp;
branches;
next	1.278;

1.278
date	2004.11.26.18.59.51;	author aw3;	state Exp;
branches;
next	1.277;

1.277
date	2004.11.10.17.28.41;	author aw3;	state Exp;
branches;
next	1.276;

1.276
date	2004.11.01.17.34.38;	author aw3;	state Exp;
branches;
next	1.275;

1.275
date	2004.10.16.16.58.22;	author aw3;	state Exp;
branches;
next	1.274;

1.274
date	2004.10.16.04.33.11;	author aw3;	state Exp;
branches;
next	1.273;

1.273
date	2004.10.14.05.22.15;	author aw3;	state Exp;
branches;
next	1.272;

1.272
date	2004.10.10.05.15.46;	author dongato;	state Exp;
branches;
next	1.271;

1.271
date	2004.10.08.22.51.23;	author aw3;	state Exp;
branches;
next	1.270;

1.270
date	2004.10.08.15.46.47;	author dongato;	state Exp;
branches;
next	1.269;

1.269
date	2004.10.08.04.41.03;	author aw3;	state Exp;
branches;
next	1.268;

1.268
date	2004.10.08.04.17.33;	author dongato;	state Exp;
branches;
next	1.267;

1.267
date	2004.10.08.03.28.31;	author dongato;	state Exp;
branches;
next	1.266;

1.266
date	2004.10.06.19.18.30;	author aw3;	state Exp;
branches;
next	1.265;

1.265
date	2004.09.30.20.23.56;	author aw3;	state Exp;
branches;
next	1.264;

1.264
date	2004.09.30.19.09.31;	author aw3;	state Exp;
branches;
next	1.263;

1.263
date	2004.09.26.04.06.43;	author aw3;	state Exp;
branches;
next	1.262;

1.262
date	2004.09.25.07.30.06;	author aw3;	state Exp;
branches;
next	1.261;

1.261
date	2004.09.21.20.18.59;	author aw3;	state Exp;
branches;
next	1.260;

1.260
date	2004.09.20.07.22.02;	author aw3;	state Exp;
branches;
next	1.259;

1.259
date	2004.09.17.04.23.17;	author aw3;	state Exp;
branches;
next	1.258;

1.258
date	2004.09.08.22.18.16;	author syrus77;	state Exp;
branches;
next	1.257;

1.257
date	2004.09.07.19.56.00;	author aw3;	state Exp;
branches;
next	1.256;

1.256
date	2004.09.04.05.31.35;	author aw3;	state Exp;
branches;
next	1.255;

1.255
date	2004.08.24.12.06.39;	author syrus77;	state Exp;
branches;
next	1.254;

1.254
date	2004.08.23.22.44.02;	author syrus77;	state Exp;
branches;
next	1.253;

1.253
date	2004.08.17.14.06.16;	author aw3;	state Exp;
branches;
next	1.252;

1.252
date	2004.08.11.06.51.46;	author aw3;	state Exp;
branches;
next	1.251;

1.251
date	2004.08.10.12.43.39;	author eklmn;	state Exp;
branches;
next	1.250;

1.250
date	2004.08.05.01.25.33;	author aw3;	state Exp;
branches;
next	1.249;

1.249
date	2004.07.18.12.20.31;	author eklmn;	state Exp;
branches;
next	1.248;

1.248
date	2004.07.05.23.23.42;	author dongato;	state Exp;
branches;
next	1.247;

1.247
date	2004.06.30.13.38.41;	author dongato;	state Exp;
branches;
next	1.246;

1.246
date	2004.06.28.22.58.27;	author dongato;	state Exp;
branches;
next	1.245;

1.245
date	2004.06.28.17.35.31;	author dongato;	state Exp;
branches;
next	1.244;

1.244
date	2004.06.16.16.29.46;	author dongato;	state Exp;
branches;
next	1.243;

1.243
date	2004.06.13.10.23.26;	author dropf;	state Exp;
branches;
next	1.242;

1.242
date	2004.06.06.20.48.09;	author aw3;	state Exp;
branches;
next	1.241;

1.241
date	2004.06.01.22.31.03;	author aw3;	state Exp;
branches;
next	1.240;

1.240
date	2004.05.31.20.02.34;	author aw3;	state Exp;
branches;
next	1.239;

1.239
date	2004.05.24.11.37.29;	author netwolf1;	state Exp;
branches;
next	1.238;

1.238
date	2004.05.18.18.44.11;	author aw3;	state Exp;
branches;
next	1.237;

1.237
date	2004.05.17.14.56.13;	author aw3;	state Exp;
branches;
next	1.236;

1.236
date	2004.05.12.18.31.26;	author katsyonak;	state Exp;
branches;
next	1.235;

1.235
date	2004.05.12.08.30.31;	author netwolf1;	state Exp;
branches;
next	1.234;

1.234
date	2004.05.05.21.10.50;	author aw3;	state Exp;
branches;
next	1.233;

1.233
date	2004.05.04.14.45.24;	author dropf;	state Exp;
branches;
next	1.232;

1.232
date	2004.05.04.11.28.00;	author netwolf1;	state Exp;
branches;
next	1.231;

1.231
date	2004.05.03.23.21.40;	author dropf;	state Exp;
branches;
next	1.230;

1.230
date	2004.05.03.19.55.52;	author dongato;	state Exp;
branches;
next	1.229;

1.229
date	2004.05.03.10.57.14;	author netwolf1;	state Exp;
branches;
next	1.228;

1.228
date	2004.05.03.09.59.44;	author netwolf1;	state Exp;
branches;
next	1.227;

1.227
date	2004.04.29.11.59.45;	author netwolf1;	state Exp;
branches;
next	1.226;

1.226
date	2004.04.23.22.13.51;	author katsyonak;	state Exp;
branches;
next	1.225;

1.225
date	2004.04.20.23.49.37;	author dropf;	state Exp;
branches;
next	1.224;

1.224
date	2004.04.18.15.47.13;	author syrus77;	state Exp;
branches;
next	1.223;

1.223
date	2004.04.18.13.17.30;	author bavariansnail;	state Exp;
branches;
next	1.222;

1.222
date	2004.04.15.17.07.57;	author aw3;	state Exp;
branches;
next	1.221;

1.221
date	2004.03.31.22.26.56;	author dropf;	state Exp;
branches;
next	1.220;

1.220
date	2004.03.31.08.05.09;	author eklmn;	state Exp;
branches;
next	1.219;

1.219
date	2004.03.27.19.39.45;	author dongato;	state Exp;
branches;
next	1.218;

1.218
date	2004.03.17.21.14.11;	author eklmn;	state Exp;
branches;
next	1.217;

1.217
date	2004.03.14.11.52.51;	author bavariansnail;	state Exp;
branches;
next	1.216;

1.216
date	2004.03.11.05.07.43;	author aw3;	state Exp;
branches;
next	1.215;

1.215
date	2004.03.09.02.17.37;	author katsyonak;	state Exp;
branches;
next	1.214;

1.214
date	2004.03.03.21.45.23;	author dropf;	state Exp;
branches;
next	1.213;

1.213
date	2004.02.23.13.33.24;	author kush_eplus;	state Exp;
branches;
next	1.212;

1.212
date	2004.02.19.00.29.35;	author netwolf1;	state Exp;
branches;
next	1.211;

1.211
date	2004.02.18.16.25.11;	author kush_eplus;	state Exp;
branches;
next	1.210;

1.210
date	2004.02.17.13.36.06;	author dongato;	state Exp;
branches;
next	1.209;

1.209
date	2004.02.16.23.30.30;	author aw3;	state Exp;
branches;
next	1.208;

1.208
date	2004.02.15.11.55.57;	author morevit;	state Exp;
branches;
next	1.207;

1.207
date	2004.02.13.16.13.35;	author netwolf1;	state Exp;
branches;
next	1.206;

1.206
date	2004.02.13.02.03.48;	author aw3;	state Exp;
branches;
next	1.205;

1.205
date	2004.02.11.04.13.00;	author katsyonak;	state Exp;
branches;
next	1.204;

1.204
date	2004.02.04.13.40.58;	author kush_eplus;	state Exp;
branches;
next	1.203;

1.203
date	2004.02.03.21.43.00;	author syrus77;	state Exp;
branches;
next	1.202;

1.202
date	2004.02.03.01.20.31;	author double_t;	state Exp;
branches;
next	1.201;

1.201
date	2004.02.03.01.07.48;	author netwolf1;	state Exp;
branches;
next	1.200;

1.200
date	2004.02.01.16.33.45;	author netwolf1;	state Exp;
branches;
next	1.199;

1.199
date	2004.02.01.13.53.55;	author netwolf1;	state Exp;
branches;
next	1.198;

1.198
date	2004.01.22.19.48.25;	author dongato;	state Exp;
branches;
next	1.197;

1.197
date	2004.01.21.23.20.46;	author dongato;	state Exp;
branches;
next	1.196;

1.196
date	2004.01.20.09.16.36;	author dongato;	state Exp;
branches;
next	1.195;

1.195
date	2004.01.18.13.58.12;	author dongato;	state Exp;
branches;
next	1.194;

1.194
date	2004.01.15.15.30.11;	author dongato;	state Exp;
branches;
next	1.193;

1.193
date	2004.01.14.17.47.53;	author netwolf1;	state Exp;
branches;
next	1.192;

1.192
date	2004.01.14.14.39.39;	author dongato;	state Exp;
branches;
next	1.191;

1.191
date	2004.01.11.14.13.09;	author dongato;	state Exp;
branches;
next	1.190;

1.190
date	2004.01.10.13.11.26;	author dongato;	state Exp;
branches;
next	1.189;

1.189
date	2004.01.09.12.52.09;	author dongato;	state Exp;
branches;
next	1.188;

1.188
date	2004.01.08.23.01.08;	author dongato;	state Exp;
branches;
next	1.187;

1.187
date	2003.12.31.14.01.53;	author dongato;	state Exp;
branches;
next	1.186;

1.186
date	2003.12.20.02.46.13;	author katsyonak;	state Exp;
branches;
next	1.185;

1.185
date	2003.12.18.22.58.32;	author dongato;	state Exp;
branches;
next	1.184;

1.184
date	2003.12.18.21.52.47;	author dongato;	state Exp;
branches;
next	1.183;

1.183
date	2003.12.09.09.20.04;	author katsyonak;	state Exp;
branches;
next	1.182;

1.182
date	2003.12.06.17.29.31;	author dongato;	state Exp;
branches;
next	1.181;

1.181
date	2003.12.06.17.09.54;	author dongato;	state Exp;
branches;
next	1.180;

1.180
date	2003.12.02.11.55.58;	author dongato;	state Exp;
branches;
next	1.179;

1.179
date	2003.11.22.01.30.27;	author syrus77;	state Exp;
branches;
next	1.178;

1.178
date	2003.11.16.15.21.15;	author katsyonak;	state Exp;
branches;
next	1.177;

1.177
date	2003.11.15.00.21.46;	author syrus77;	state Exp;
branches;
next	1.176;

1.176
date	2003.11.11.21.36.56;	author dropf;	state Exp;
branches;
next	1.175;

1.175
date	2003.11.07.15.47.44;	author andrerib;	state Exp;
branches;
next	1.174;

1.174
date	2003.11.05.21.12.01;	author dongato;	state Exp;
branches;
next	1.173;

1.173
date	2003.11.05.18.25.49;	author dongato;	state Exp;
branches;
next	1.172;

1.172
date	2003.11.04.14.13.19;	author kuchin;	state Exp;
branches;
next	1.171;

1.171
date	2003.11.04.09.20.49;	author kuchin;	state Exp;
branches;
next	1.170;

1.170
date	2003.10.31.22.36.52;	author dongato;	state Exp;
branches;
next	1.169;

1.169
date	2003.10.30.02.44.37;	author morevit;	state Exp;
branches;
next	1.168;

1.168
date	2003.10.29.22.13.32;	author dropf;	state Exp;
branches;
next	1.167;

1.167
date	2003.10.29.14.14.18;	author morevit;	state Exp;
branches;
next	1.166;

1.166
date	2003.10.26.13.50.16;	author morevit;	state Exp;
branches;
next	1.165;

1.165
date	2003.10.21.14.33.59;	author dongato;	state Exp;
branches;
next	1.164;

1.164
date	2003.10.21.02.16.52;	author morevit;	state Exp;
branches;
next	1.163;

1.163
date	2003.10.20.13.20.01;	author morevit;	state Exp;
branches;
next	1.162;

1.162
date	2003.10.20.00.55.48;	author katsyonak;	state Exp;
branches;
next	1.161;

1.161
date	2003.10.17.10.29.06;	author morevit;	state Exp;
branches;
next	1.160;

1.160
date	2003.10.15.03.51.45;	author morevit;	state Exp;
branches;
next	1.159;

1.159
date	2003.10.14.18.40.58;	author syrus77;	state Exp;
branches;
next	1.158;

1.158
date	2003.10.08.12.56.33;	author morevit;	state Exp;
branches;
next	1.157;

1.157
date	2003.10.07.11.36.32;	author dongato;	state Exp;
branches;
next	1.156;

1.156
date	2003.10.06.21.57.05;	author puritynn666;	state Exp;
branches;
next	1.155;

1.155
date	2003.10.06.13.24.12;	author dongato;	state Exp;
branches;
next	1.154;

1.154
date	2003.10.05.17.53.56;	author morevit;	state Exp;
branches;
next	1.153;

1.153
date	2003.10.04.22.19.17;	author morevit;	state Exp;
branches;
next	1.152;

1.152
date	2003.10.04.14.07.32;	author dongato;	state Exp;
branches;
next	1.151;

1.151
date	2003.10.04.13.56.41;	author dongato;	state Exp;
branches;
next	1.150;

1.150
date	2003.10.04.10.23.05;	author dongato;	state Exp;
branches;
next	1.149;

1.149
date	2003.10.03.09.52.00;	author eklmn;	state Exp;
branches;
next	1.148;

1.148
date	2003.10.02.11.08.27;	author dongato;	state Exp;
branches;
next	1.147;

1.147
date	2003.09.30.06.58.45;	author dongato;	state Exp;
branches;
next	1.146;

1.146
date	2003.09.29.14.57.43;	author morevit;	state Exp;
branches;
next	1.145;

1.145
date	2003.09.27.21.23.14;	author dongato;	state Exp;
branches;
next	1.144;

1.144
date	2003.09.27.19.59.42;	author dongato;	state Exp;
branches;
next	1.143;

1.143
date	2003.09.27.07.51.31;	author emoulari;	state Exp;
branches;
next	1.142;

1.142
date	2003.09.25.11.22.55;	author morevit;	state Exp;
branches;
next	1.141;

1.141
date	2003.09.24.20.37.29;	author dongato;	state Exp;
branches;
next	1.140;

1.140
date	2003.09.24.16.50.56;	author morevit;	state Exp;
branches;
next	1.139;

1.139
date	2003.09.23.19.05.42;	author dongato;	state Exp;
branches;
next	1.138;

1.138
date	2003.09.23.16.52.49;	author morevit;	state Exp;
branches;
next	1.137;

1.137
date	2003.09.23.13.50.35;	author dongato;	state Exp;
branches;
next	1.136;

1.136
date	2003.09.22.00.31.24;	author morevit;	state Exp;
branches;
next	1.135;

1.135
date	2003.09.22.00.24.48;	author morevit;	state Exp;
branches;
next	1.134;

1.134
date	2003.09.22.00.17.22;	author morevit;	state Exp;
branches;
next	1.133;

1.133
date	2003.09.21.22.07.17;	author morevit;	state Exp;
branches;
next	1.132;

1.132
date	2003.09.20.20.47.40;	author bavariansnail;	state Exp;
branches;
next	1.131;

1.131
date	2003.09.20.15.39.31;	author morevit;	state Exp;
branches;
next	1.130;

1.130
date	2003.09.19.00.13.38;	author morevit;	state Exp;
branches;
next	1.129;

1.129
date	2003.09.15.15.49.55;	author bavariansnail;	state Exp;
branches;
next	1.128;

1.128
date	2003.09.12.20.34.31;	author bavariansnail;	state Exp;
branches;
next	1.127;

1.127
date	2003.09.12.14.57.46;	author bavariansnail;	state Exp;
branches;
next	1.126;

1.126
date	2003.09.11.02.36.43;	author dongato;	state Exp;
branches;
next	1.125;

1.125
date	2003.09.10.20.39.22;	author dongato;	state Exp;
branches;
next	1.124;

1.124
date	2003.09.09.16.21.59;	author dongato;	state Exp;
branches;
next	1.123;

1.123
date	2003.09.07.05.20.38;	author dongato;	state Exp;
branches;
next	1.122;

1.122
date	2003.09.06.13.27.57;	author dongato;	state Exp;
branches;
next	1.121;

1.121
date	2003.09.06.05.31.36;	author dongato;	state Exp;
branches;
next	1.120;

1.120
date	2003.09.06.02.19.23;	author dongato;	state Exp;
branches;
next	1.119;

1.119
date	2003.09.06.00.04.21;	author dongato;	state Exp;
branches;
next	1.118;

1.118
date	2003.08.31.16.49.55;	author dongato;	state Exp;
branches;
next	1.117;

1.117
date	2003.08.30.11.23.26;	author emoulari;	state Exp;
branches;
next	1.116;

1.116
date	2003.08.23.00.20.50;	author forcha;	state Exp;
branches;
next	1.115;

1.115
date	2003.08.20.20.57.28;	author dongato;	state Exp;
branches;
next	1.114;

1.114
date	2003.08.19.17.32.46;	author dongato;	state Exp;
branches;
next	1.113;

1.113
date	2003.08.19.17.12.12;	author andrerib;	state Exp;
branches;
next	1.112;

1.112
date	2003.08.15.15.07.12;	author forcha;	state Exp;
branches;
next	1.111;

1.111
date	2003.08.15.10.08.17;	author kuchin;	state Exp;
branches;
next	1.110;

1.110
date	2003.08.13.15.52.37;	author eklmn;	state Exp;
branches;
next	1.109;

1.109
date	2003.08.10.16.42.02;	author kuchin;	state Exp;
branches;
next	1.108;

1.108
date	2003.08.10.04.42.50;	author eklmn;	state Exp;
branches;
next	1.107;

1.107
date	2003.08.03.20.55.40;	author forcha;	state Exp;
branches;
next	1.106;

1.106
date	2003.08.03.20.42.05;	author forcha;	state Exp;
branches;
next	1.105;

1.105
date	2003.08.02.11.51.11;	author dongato;	state Exp;
branches;
next	1.104;

1.104
date	2003.07.31.15.02.19;	author puritynn666;	state Exp;
branches;
next	1.103;

1.103
date	2003.07.30.12.29.31;	author kuchin;	state Exp;
branches;
next	1.102;

1.102
date	2003.07.29.19.21.12;	author dongato;	state Exp;
branches;
next	1.101;

1.101
date	2003.07.29.13.16.52;	author bond006;	state Exp;
branches;
next	1.100;

1.100
date	2003.07.29.09.09.04;	author dongato;	state Exp;
branches;
next	1.99;

1.99
date	2003.07.28.22.54.58;	author dongato;	state Exp;
branches;
next	1.98;

1.98
date	2003.07.28.14.57.52;	author dongato;	state Exp;
branches;
next	1.97;

1.97
date	2003.07.28.02.33.12;	author dongato;	state Exp;
branches;
next	1.96;

1.96
date	2003.07.27.19.56.57;	author dongato;	state Exp;
branches;
next	1.95;

1.95
date	2003.07.27.17.32.20;	author dongato;	state Exp;
branches;
next	1.94;

1.94
date	2003.07.09.15.08.21;	author netwolf1;	state Exp;
branches;
next	1.93;

1.93
date	2003.07.08.00.04.59;	author netwolf1;	state Exp;
branches;
next	1.92;

1.92
date	2003.07.05.16.24.59;	author dongato;	state Exp;
branches;
next	1.91;

1.91
date	2003.07.05.11.53.08;	author dongato;	state Exp;
branches;
next	1.90;

1.90
date	2003.07.01.22.10.45;	author netwolf1;	state Exp;
branches;
next	1.89;

1.89
date	2003.06.30.17.44.36;	author eklmn;	state Exp;
branches;
next	1.88;

1.88
date	2003.06.29.21.31.35;	author syrus77;	state Exp;
branches;
next	1.87;

1.87
date	2003.06.28.08.11.06;	author partyckip;	state Exp;
branches;
next	1.86;

1.86
date	2003.06.28.01.23.44;	author dongato;	state Exp;
branches;
next	1.85;

1.85
date	2003.06.22.13.18.17;	author kuchin;	state Exp;
branches;
next	1.84;

1.84
date	2003.06.21.21.54.00;	author netwolf1;	state Exp;
branches;
next	1.83;

1.83
date	2003.06.20.00.01.10;	author netwolf1;	state Exp;
branches;
next	1.82;

1.82
date	2003.06.16.15.37.42;	author netwolf1;	state Exp;
branches;
next	1.81;

1.81
date	2003.06.15.09.09.28;	author partyckip;	state Exp;
branches;
next	1.80;

1.80
date	2003.06.14.00.48.56;	author netwolf1;	state Exp;
branches;
next	1.79;

1.79
date	2003.06.11.18.27.10;	author eklmn;	state Exp;
branches;
next	1.78;

1.78
date	2003.06.09.20.31.19;	author partyckip;	state Exp;
branches;
next	1.77;

1.77
date	2003.06.09.20.11.28;	author partyckip;	state Exp;
branches;
next	1.76;

1.76
date	2003.06.09.20.07.39;	author partyckip;	state Exp;
branches;
next	1.75;

1.75
date	2003.06.08.23.58.37;	author syrus77;	state Exp;
branches;
next	1.74;

1.74
date	2003.06.08.15.59.49;	author kuchin;	state Exp;
branches;
next	1.73;

1.73
date	2003.06.04.16.47.08;	author partyckip;	state Exp;
branches;
next	1.72;

1.72
date	2003.05.31.16.45.18;	author partyckip;	state Exp;
branches;
next	1.71;

1.71
date	2003.05.31.08.50.54;	author partyckip;	state Exp;
branches;
next	1.70;

1.70
date	2003.05.25.01.12.05;	author syrus77;	state Exp;
branches;
next	1.69;

1.69
date	2003.05.20.09.06.49;	author netwolf1;	state Exp;
branches;
next	1.68;

1.68
date	2003.05.15.22.03.54;	author syrus77;	state Exp;
branches;
next	1.67;

1.67
date	2003.05.08.17.08.25;	author netwolf1;	state Exp;
branches;
next	1.66;

1.66
date	2003.05.08.16.06.33;	author kuchin;	state Exp;
branches;
next	1.65;

1.65
date	2003.05.06.21.17.15;	author partyckip;	state Exp;
branches;
next	1.64;

1.64
date	2003.05.05.16.22.52;	author emoulari;	state Exp;
branches;
next	1.63;

1.63
date	2003.05.04.10.30.27;	author kuchin;	state Exp;
branches;
next	1.62;

1.62
date	2003.04.20.14.35.29;	author kuchin;	state Exp;
branches;
next	1.61;

1.61
date	2003.04.03.10.12.17;	author kuchin;	state Exp;
branches;
next	1.60;

1.60
date	2003.03.30.09.03.52;	author emoulari;	state Exp;
branches;
next	1.59;

1.59
date	2003.03.27.09.40.25;	author recdvst;	state Exp;
branches;
next	1.58;

1.58
date	2003.03.22.09.32.21;	author dongato;	state Exp;
branches
	1.58.2.1;
next	1.57;

1.57
date	2003.03.21.18.55.16;	author dongato;	state Exp;
branches;
next	1.56;

1.56
date	2003.03.19.06.50.28;	author partyckip;	state Exp;
branches;
next	1.55;

1.55
date	2003.03.19.01.02.28;	author cax2;	state Exp;
branches;
next	1.54;

1.54
date	2003.03.15.20.53.47;	author lord_kiron;	state Exp;
branches;
next	1.53;

1.53
date	2003.03.14.15.05.23;	author lord_kiron;	state Exp;
branches;
next	1.52;

1.52
date	2003.03.14.14.35.19;	author lord_kiron;	state Exp;
branches;
next	1.51;

1.51
date	2003.03.14.14.31.45;	author lord_kiron;	state Exp;
branches;
next	1.50;

1.50
date	2003.03.14.14.19.30;	author lord_kiron;	state Exp;
branches;
next	1.49;

1.49
date	2003.03.14.12.03.06;	author lord_kiron;	state Exp;
branches;
next	1.48;

1.48
date	2003.03.12.16.53.03;	author cax2;	state Exp;
branches;
next	1.47;

1.47
date	2003.03.11.21.33.25;	author emoulari;	state Exp;
branches;
next	1.46;

1.46
date	2003.03.11.16.12.45;	author kuchin;	state Exp;
branches;
next	1.45;

1.45
date	2003.03.11.10.52.48;	author kuchin;	state Exp;
branches;
next	1.44;

1.44
date	2003.03.10.18.49.56;	author kuchin;	state Exp;
branches;
next	1.43;

1.43
date	2003.03.10.16.15.39;	author kuchin;	state Exp;
branches;
next	1.42;

1.42
date	2003.03.09.01.24.43;	author dongato;	state Exp;
branches;
next	1.41;

1.41
date	2003.03.08.22.28.55;	author emoulari;	state Exp;
branches;
next	1.40;

1.40
date	2003.03.08.12.09.42;	author recdvst;	state Exp;
branches;
next	1.39;

1.39
date	2003.03.05.23.22.37;	author dongato;	state Exp;
branches;
next	1.38;

1.38
date	2003.03.03.22.09.49;	author moosetea;	state Exp;
branches;
next	1.37;

1.37
date	2003.03.03.14.15.56;	author dongato;	state Exp;
branches;
next	1.36;

1.36
date	2003.03.03.13.01.38;	author dongato;	state Exp;
branches;
next	1.35;

1.35
date	2003.03.03.03.23.51;	author dongato;	state Exp;
branches;
next	1.34;

1.34
date	2003.03.02.18.29.41;	author lord_kiron;	state Exp;
branches;
next	1.33;

1.33
date	2003.03.02.12.39.14;	author dongato;	state Exp;
branches;
next	1.32;

1.32
date	2003.03.02.05.13.12;	author recdvst;	state Exp;
branches;
next	1.31;

1.31
date	2003.03.02.04.41.22;	author recdvst;	state Exp;
branches;
next	1.30;

1.30
date	2003.03.01.12.48.30;	author dongato;	state Exp;
branches;
next	1.29;

1.29
date	2003.03.01.04.11.35;	author dongato;	state Exp;
branches;
next	1.28;

1.28
date	2003.03.01.02.01.26;	author cax2;	state Exp;
branches;
next	1.27;

1.27
date	2003.02.28.21.00.31;	author dongato;	state Exp;
branches;
next	1.26;

1.26
date	2003.02.26.21.12.32;	author cax2;	state Exp;
branches;
next	1.25;

1.25
date	2003.02.25.15.36.09;	author dongato;	state Exp;
branches;
next	1.24;

1.24
date	2003.02.24.20.09.48;	author dongato;	state Exp;
branches
	1.24.2.1;
next	1.23;

1.23
date	2003.02.23.19.16.13;	author cax2;	state Exp;
branches;
next	1.22;

1.22
date	2003.02.20.07.25.21;	author cax2;	state Exp;
branches;
next	1.21;

1.21
date	2003.02.18.15.21.24;	author dongato;	state Exp;
branches;
next	1.20;

1.20
date	2003.02.17.19.17.12;	author dongato;	state Exp;
branches;
next	1.19;

1.19
date	2003.02.16.22.01.48;	author lord_kiron;	state Exp;
branches;
next	1.18;

1.18
date	2003.02.14.22.46.35;	author cax2;	state Exp;
branches;
next	1.17;

1.17
date	2003.02.13.19.08.32;	author cax2;	state Exp;
branches;
next	1.16;

1.16
date	2003.02.12.00.19.49;	author cax2;	state Exp;
branches;
next	1.15;

1.15
date	2003.02.10.19.26.16;	author kuchin;	state Exp;
branches;
next	1.14;

1.14
date	2003.02.10.13.17.55;	author kuchin;	state Exp;
branches;
next	1.13;

1.13
date	2003.02.06.16.27.34;	author kuchin;	state Exp;
branches;
next	1.12;

1.12
date	2003.02.02.13.32.56;	author kuchin;	state Exp;
branches;
next	1.11;

1.11
date	2003.02.02.03.39.55;	author cax2;	state Exp;
branches;
next	1.10;

1.10
date	2003.02.01.14.45.39;	author dongato;	state Exp;
branches;
next	1.9;

1.9
date	2003.01.30.22.40.33;	author cax2;	state Exp;
branches;
next	1.8;

1.8
date	2003.01.29.00.25.45;	author cax2;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	2003.01.27.13.34.27;	author dongato;	state Exp;
branches;
next	1.6;

1.6
date	2003.01.26.13.23.35;	author pooz;	state Exp;
branches;
next	1.5;

1.5
date	2003.01.24.22.07.48;	author maverick65;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.24.10.36.01;	author kuchin;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.23.17.00.44;	author cax2;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.22.17.27.25;	author kuchin;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.21.18.21.21;	author cax2;	state Exp;
branches;
next	;

1.8.2.1
date	2003.01.29.00.45.00;	author cax2;	state Exp;
branches;
next	1.8.2.2;

1.8.2.2
date	2003.01.29.13.38.26;	author cax2;	state Exp;
branches;
next	1.8.2.3;

1.8.2.3
date	2003.01.30.22.36.57;	author cax2;	state Exp;
branches;
next	1.8.2.4;

1.8.2.4
date	2003.02.02.02.36.27;	author cax2;	state Exp;
branches;
next	;

1.24.2.1
date	2003.02.28.22.44.55;	author obaldin;	state Exp;
branches;
next	1.24.2.2;

1.24.2.2
date	2003.03.01.20.59.36;	author obaldin;	state Exp;
branches;
next	;

1.58.2.1
date	2003.03.23.06.22.02;	author recdvst;	state Exp;
branches;
next	1.58.2.2;

1.58.2.2
date	2003.03.23.12.51.43;	author recdvst;	state Exp;
branches;
next	1.58.2.3;

1.58.2.3
date	2003.03.24.09.39.43;	author recdvst;	state Exp;
branches;
next	;


desc
@@


1.432
log
@Updated default ipfilter link (with migration); Removed enforcing of old broken fakes link.
@
text
@//this file is part of eMule
//Copyright (C)2002-2005 Merkur ( devs@@emule-project.net / http://www.emule-project.net )
//
//This program is free software; you can redistribute it and/or
//modify it under the terms of the GNU General Public License
//as published by the Free Software Foundation; either
//version 2 of the License, or (at your option) any later version.
//
//This program is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//GNU General Public License for more details.
//
//You should have received a copy of the GNU General Public License
//along with this program; if not, write to the Free Software
//Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include "stdafx.h"
#include <locale.h>
#include <share.h>
#include <io.h>
#include "Preferences.h"
#include "opcodes.h"
#include "otherfunctions.h"
#include "ini2.h"
#include "resource.h"
#ifndef NEW_SOCKETS_ENGINE
	#include "emule.h"
#else
	#include "MuleListCtrl.h"
#endif //NEW_SOCKETS_ENGINE
#include "SharedFileList.h"
#include "ServerList.h"
#include "UploadQueue.h"
#include "MD5Sum.h"
#include "Category.h"
#include "AsyncProxySocketLayer.h"
#include "ListenSocket.h"
#include "packets.h"
#ifdef OLD_SOCKETS_ENABLED
#include "sockets.h"
#endif

// For SecuredVars
const DWORD CCriticalSection_INL2::s_dwSafeValue = 0x159D37BF;


#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

bool CPreferences::bWinVerAlreadyDetected = false;

static const TCHAR *s_apcShortcutNames[] =
{
	_T("GeneralMinimizeWindowToTrayShortcut"),		//SCUT_WIN_MINIMIZE
	_T("GeneralSwitchWindowShortcut"),				//SCUT_WIN_SWITCH
	_T("GeneralShowServerWndShortcut"),				//SCUT_WIN_SRV
	_T("GeneralShowTransferWndShortcut"),			//SCUT_WIN_TRANSFER
	_T("GeneralShowSearchWndShortcut"),				//SCUT_WIN_SEARCH
	_T("GeneralShowSharedFilesWndShortcut"),		//SCUT_WIN_SHAREDFILES
	_T("GeneralShowChatWndShortcut"),				//SCUT_WIN_CHAT
	_T("GeneralShowIRCWndShortcut"),				//SCUT_WIN_IRC
	_T("GeneralShowStatisticsWndShortcut"),			//SCUT_WIN_STATS
	_T("GeneralShowPreferencesWndShortcut"),		//SCUT_WIN_PREFS
	_T("DownloadCancelShortcut"),					//SCUT_DL_CANCEL
	_T("DownloadStopShortcut"),						//SCUT_DL_STOP
	_T("DownloadPauseShortcut"),					//SCUT_DL_PAUSE
	_T("DownloadResumeShortcut"),					//SCUT_DL_RESUME
	_T("DownloadOpenShortcut"),						//SCUT_FILE_OPEN
	_T("DownloadOpenFolderShortcut"),				//SCUT_FILE_OPENDIR
	_T("DownloadPreviewShortcut"),					//SCUT_DL_PREVIEW
	_T("DownloadRenameShortcut"),					//SCUT_FILE_RENAME
	_T("DownloadViewFileCommentsShortcut"),			//SCUT_FILE_COMMENTS
	_T("DownloadViewFileDetailsShortcut"),			//SCUT_FILE_DETAILS
	_T("DownloadViewFileDetailsSourcesShortcut"),	//SCUT_DL_FD_SOURCES
	_T("DownloadClearCompletedFilesShortcut"),		//SCUT_DL_CLEAR
	_T("DownloadClearAllCompletedFilesShortcut"),	//SCUT_DL_CLEARALL
	_T("DownloadShowAllUploadsShortcut"),			//SCUT_DL_SHOWALL
	_T("DownloadUseDefaultSortShortcut"),			//SCUT_DL_DEFSORT
	_T("DownloadPreallocateShortcut"),				//SCUT_DL_PREALLOC
	_T("DownloadA4AFShortcut"),						//SCUT_DL_A4AF
	_T("DownloadA4AFAutoShortcut"),					//SCUT_DL_A4AFAUTO
	_T("DownloadA4AFOtherShortcut"),				//SCUT_DL_A4AFOTHER
	_T("DownloadA4AFSameCatShortcut"),				//SCUT_DL_A4AFSAMECAT
	_T("DownloadED2KLinkShortcut"),					//SCUT_LINK
	_T("DownloadED2kLinkHtmlShortcut"),				//SCUT_LINK_HTML
	_T("DownloadED2kLinkSourceShortcut"),			//SCUT_LINK_SOURCE
	_T("UploadViewClientDetailsShortcut"),			//SCUT_SRC_DETAILS
	_T("UploadAddClientToFriendsShortcut"),			//SCUT_SRC_FRIEND
	_T("UploadSendMessageClientShortcut"),			//SCUT_SRC_MSG
	_T("UploadViewClientFilesShortcut"),			//SCUT_SRC_SHAREDFILES
	_T("ShareEditFileCommentsShortcut"),			//SCUT_FILE_EDITCOMMENTS
	_T("CopyHashShortcut"),							//SCUT_LINK_HASH
	_T("FilenameCleanupShortcut")					//SCUT_FILE_NAMECLEANUP
};

const StructLanguage g_aLangs[] =
{
	{MAKELANGID(LANG_BASQUE, SUBLANG_DEFAULT), 1252},					// Basque
	{MAKELANGID(LANG_BELARUSIAN, SUBLANG_DEFAULT), 1251},				// Belarusian
	{MAKELANGID(LANG_CATALAN, SUBLANG_DEFAULT), 1252},					// Catalan
	{MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED), 936},		// Chinese (simplified)
	{MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL), 950},		// Chinese (traditional)
	{MAKELANGID(LANG_CROATIAN, SUBLANG_DEFAULT), 1250},					// Croatian
	{MAKELANGID(LANG_CZECH, SUBLANG_DEFAULT), 1250},					// Czech
	{MAKELANGID(LANG_DANISH, SUBLANG_DEFAULT), 1252},					// Danish
	{MAKELANGID(LANG_DUTCH, SUBLANG_DEFAULT), 1252},					// Dutch
	{MAKELANGID(LANG_ENGLISH, SUBLANG_DEFAULT), 1252},					// English
	{MAKELANGID(LANG_SPECIAL, SUBLNG_EXTREMADURAN), 1252},				// Extremaduran
	{MAKELANGID(LANG_FINNISH, SUBLANG_DEFAULT), 1252},					// Finnish
	{MAKELANGID(LANG_FRENCH, SUBLANG_DEFAULT), 1252},					// French
	{MAKELANGID(LANG_GERMAN, SUBLANG_DEFAULT), 1252},					// German
	{MAKELANGID(LANG_GREEK, SUBLANG_DEFAULT), 1253},					// Greek
	{MAKELANGID(LANG_HEBREW, SUBLANG_DEFAULT), 1255},					// Hebrew
//	{MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT), 1250},				// Hungarian
	{MAKELANGID(LANG_ITALIAN, SUBLANG_DEFAULT), 1252},					// Italian
	{MAKELANGID(LANG_KOREAN, SUBLANG_DEFAULT), 949},					// Korean
	{MAKELANGID(LANG_LITHUANIAN, SUBLANG_DEFAULT), 1257},				// Lithuanian
	{MAKELANGID(LANG_MALAY, SUBLANG_MALAY_MALAYSIA), 1252},				// Malay
	{MAKELANGID(LANG_NORWEGIAN, SUBLANG_NORWEGIAN_BOKMAL), 1252},		// Norwegian (Bokmal)
	{MAKELANGID(LANG_POLISH, SUBLANG_DEFAULT), 1250},					// Polish
	{MAKELANGID(LANG_PORTUGUESE, SUBLANG_PORTUGUESE), 1252},			// Portuguese (Portugal)
	{MAKELANGID(LANG_PORTUGUESE, SUBLANG_PORTUGUESE_BRAZILIAN), 1252},	// Portuguese (Brazilian)
	{MAKELANGID(LANG_ROMANIAN, SUBLANG_DEFAULT), 1250},					// Romanian
	{MAKELANGID(LANG_RUSSIAN, SUBLANG_DEFAULT), 1251},					// Russian
	{MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_LATIN), 1250},			// Serbian
	{MAKELANGID(LANG_SLOVENIAN, SUBLANG_DEFAULT), 1250},				// Slovenian
	{MAKELANGID(LANG_SPANISH, SUBLANG_SPANISH), 1252},					// Spanish
	{MAKELANGID(LANG_TURKISH, SUBLANG_DEFAULT), 1254},					// Turkish
	{MAKELANGID(LANG_UKRAINIAN, SUBLANG_DEFAULT), 1251},				// Ukrainian
	{0, 0}
};

static const struct {
	TCHAR		*pcIniName;
	unsigned	uiDef;
	unsigned	uiMax;
} s_aSortItems[CPreferences::TABLE_COUNT] = {
	{ _T("SortItemDownload"), DLCOL_STATUS, DLCOL_NUMCOLUMNS },			//TABLE_DOWNLOAD
	{ _T("SortItemDownload2"), DLCOL_PRIORITY, DLCOL_NUMCOLUMNS},		//TABLE_DOWNLOAD2
	{ _T("SortItemUpload"), ULCOL_UPLOADTIME, ULCOL_NUMCOLUMNS },		//TABLE_UPLOAD
	{ _T("SortItemQueue"), QLCOL_QLRATING, QLCOL_NUMCOLUMNS },			//TABLE_QUEUE
	{ _T("SortItemSearch"), SEARCHCOL_SOURCES, SEARCHCOL_NUMCOLUMNS },	//TABLE_SEARCH
	{ _T("SortItemShared"), SFLCOL_FILENAME, SFLCOL_NUMCOLUMNS },		//TABLE_SHARED
	{ _T("SortItemServer"), SRVCOL_SERVERNAME, SRVCOL_NUMCOLUMNS },		//TABLE_SERVER
	{ _T("SortItemIRCNicks"), IRC1COL_STATUS, IRC1COL_NUMCOLUMNS },		//TABLE_IRCNICK
	{ _T("SortItemIRCChannel"), IRC2COL_NAME, IRC2COL_NUMCOLUMNS },		//TABLE_IRC
	{ _T("SortItemClients"), CLCOL_USERNAME, CLCOL_NUMCOLUMNS },		//TABLE_CLIENTLIST
	{ _T("SortItemPartStatus"), FDPARTSCOL_NUMBER, FDPARTSCOL_NUMCOLUMNS },	//TABLE_PARTSTATUS
	{ _T("SortItemFriend"), FRIENDCOL_USERNAME, FRIENDCOL_NUMCOLUMNS },	//TABLE_FRIENDLIST
	{ _T("SortItemSrcFileName"), FDSRCCOL_SOURCES, FDSRCCOL_NUMCOLUMNS }	//TABLE_SRCFILENAME
};

// Current extras for user lists
#define EP_PREFUPD_COMMENT_FILTER		_T("emule pro version")
#define EP_PREFUPD_FILENAME_CLEANUP		_T("sharelita|emule-island.com")

//	UpdateUserStrList updates current user string lists with new value
//	This method is used to propagate new values to current installations
//	Update value should be kept for 1-2 releases (better one), than replaced with
//	empty string or new update
//	Update value is preserved in the configuration file to identify
//	that update took place, as we allow users to modify their settings
//	if they want to change a list in different way
static void UpdateUserStrList(CString *pstrVal, CString *pstrCurUpdVal, const TCHAR *pcUpdVal)
{
//	Check that update value from ini is different with current update value
	if (pstrCurUpdVal->Compare(pcUpdVal) != 0)
	{
		*pstrCurUpdVal = pcUpdVal;
		if (pstrCurUpdVal->IsEmpty())
			return;

		CString	strToken, strTokUpd;
		int		iPos, iPosUpd;

		for (iPosUpd = 0;;)
		{
			strTokUpd = pstrCurUpdVal->Tokenize(_T("|"), iPosUpd);
			if (strTokUpd.IsEmpty())
				break;
			for (iPos = 0;;)
			{
				strToken = pstrVal->Tokenize(_T("|"), iPos);
				if (strToken.IsEmpty())
				{
				//	Not present, extend the current list with new one
					if (!pstrVal->IsEmpty())
						*pstrVal += _T('|');
					*pstrVal += strTokUpd;
					break;
				}
				if (strToken.CompareNoCase(strTokUpd) == 0)
					break;	// string is present, no need to update
			}
		}
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CPreferences::CPreferences()
{
	srand((unsigned)time(NULL));	//	Seed the random number generator
	m_bIsNTBased = false;

//	Get application start directory
	TCHAR path[MAX_PATH];

	::GetModuleFileName(NULL, path, MAX_PATH);

	TCHAR drive[_MAX_DRIVE];
	TCHAR dir[_MAX_DIR];

	_tsplitpath(path, drive, dir, NULL, NULL);

	m_strAppDir = CString(drive) + dir;
	m_strConfigDir = m_strAppDir + _T("Config\\");

	::CreateDirectory(GetConfigDir(), 0);

	m_strDownloadLogFilePath.Format(_T("%sdownload.log"), m_strAppDir);
#if 1 //code left for smooth migration, delete in v1.3
	if (GetTextFileFormat(m_strDownloadLogFilePath) == tffANSI)
	{
		CString strBackupFile(m_strDownloadLogFilePath);

		strBackupFile += _T(".ansi");

		_tremove(strBackupFile);
		_trename(m_strDownloadLogFilePath, strBackupFile);
	}
#endif

//	Load preferences from "preferences.ini" file
	LoadIniPreferences();

	m_nSmartIdState = 0;
	LoadDatPreferences();

//	Load filter words from the file
	LoadFilterFile();

//	Mark as emule client
	m_userHash[5] = 14;
	m_userHash[14] = 111;

	LoadSharedDirs();
	LoadTempDirs();

	LoadServerlistAddresses();

	m_bUseProxyListenPort = false;
	m_nListenPort = 0;

//	Make sure the Incoming and primary Temp dirs exist
	CString	strTemp;

	CreateAllDirectories(m_sIncomingDir.Get(&strTemp));
	CreateAllDirectories(m_sTempDir.Get(&strTemp));

	m_pNameTag = NULL;
	SetUserNickTag();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CPreferences::~CPreferences()
{
#ifndef NEW_SOCKETS_ENGINE
	CCat::Finalize();

#endif //NEW_SOCKETS_ENGINE
	free(m_pNameTag);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	LoadServerlistAddresses() loads the server addresses from "config/addresses.dat" into 'm_addressesList'.
void CPreferences::LoadServerlistAddresses()
{
//	First we must free list
	m_addressesList.RemoveAll();

	CString		strTmp = m_strConfigDir;
	CStdioFile	addressesFile;

	strTmp += _T("addresses.dat");
	if (addressesFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | CFile::typeText))
	{
		while (addressesFile.ReadString(strTmp))
		{
		//	Allow commented-out entries in the addresses.dat file.
			strTmp.TrimLeft();
			if (!strTmp.IsEmpty() && strTmp[0] != '#')
				m_addressesList.AddHead(strTmp);
		}
		addressesFile.Close();
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetStandardValues() sets default values for the legacy preference info.
void CPreferences::SetStandardValues()
{
//	Read the user hash from "config/userhash.dat".
	CString		strFullPath = m_strConfigDir;

	strFullPath += _T("userhash.dat");

	FILE	*pHashFile = _tfsopen(strFullPath, _T("rb"), _SH_DENYWR);

	if (pHashFile != NULL)
	{
		if (!fread(m_userHash, sizeof(m_userHash), 1, pHashFile))
			CreateUserHash();
		fclose(pHashFile);
	}
	else
		CreateUserHash();

	WINDOWPLACEMENT		defaultWPM;

	defaultWPM.length = sizeof(WINDOWPLACEMENT);
	defaultWPM.rcNormalPosition.left = 10;
	defaultWPM.rcNormalPosition.top = 10;
	defaultWPM.rcNormalPosition.right = 700;
	defaultWPM.rcNormalPosition.bottom = 500;
	defaultWPM.showCmd = 0;
	m_WindowPlacement = defaultWPM;

	Save();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetMaxDownloadWithCheck() sets max download limit checking the possible limits.
uint32 CPreferences::SetMaxDownloadWithCheck(uint32 dwMaxDownload)
{
	if (dwMaxDownload < 10)
		dwMaxDownload = 10;
	if(dwMaxDownload > m_dwMaxGraphDownloadRate)
		dwMaxDownload = m_dwMaxGraphDownloadRate;

	m_dwMaxDownload = dwMaxDownload;
	return dwMaxDownload;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetMaxUploadWithCheck() sets max upload limit checking the possible limits.
uint32 CPreferences::SetMaxUploadWithCheck(uint32 dwMaxUpload)
{
	if (dwMaxUpload < 10)
		dwMaxUpload = 10;
	if (dwMaxUpload > m_dwMaxGraphUploadRate)
		dwMaxUpload = m_dwMaxGraphUploadRate;

	m_dwMaxUpload = dwMaxUpload;
	return dwMaxUpload;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	GetMaxDownload() handles download rate limiting based on the max upload rate setting.
uint16 CPreferences::GetMaxDownload()
{
//	Don't be a Lam3r :)
	uint32		dwMaxUp = GetMaxUpload();
	uint32		dwMaxDown;

//	max-up...
//	0..4:	if max-up < 1/3 max-down, max-down = 3 * max-up. Otherwise unchanged
//	4..9:	if max-up < 1/4 max-down, max-down = 4 * max-up. Otherwise unchanged
//	10..:	Unchanged (or unlimited if the "limitless download" preference is set)
	if (LimitlessDownload())
	{
		if (dwMaxUp >= 100)
			return UNLIMITED;
		else
			dwMaxDown = m_dwMaxGraphDownloadRate;
	}
	else
		dwMaxDown = m_dwMaxDownload;
	return static_cast<uint16>(TieUploadDownload(dwMaxUp, dwMaxDown));
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Save() writes all the various preferences out to their appropriate files
bool CPreferences::Save()
{
	Preferences_Ext_Struct	prefsExt;
	bool	bError = false;
	CString	strFullPath = m_strConfigDir;

	strFullPath += _T("preferences.dat");

	FILE	*pPrefFile = _tfsopen(strFullPath, _T("wb"), _SH_DENYWR);

	if (pPrefFile != NULL)
	{
		prefsExt.version = PREFFILE_VERSION;
		prefsExt.EmuleWindowPlacement = m_WindowPlacement;
		md4cpy(prefsExt.abyteUserHash, m_userHash);

		bError = (fwrite(&prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefFile) == 0);
		fclose(pPrefFile);
	}
	else
		bError = true;

//	Saving HashID to "config/userhash.dat"
	strFullPath.Format(_T("%suserhash.dat"), m_strConfigDir);

	FILE	*pHashFile = _tfsopen(strFullPath, _T("wb"), _SH_DENYWR);

	if (pHashFile != NULL)
	{
		bError = (fwrite(m_userHash, sizeof(m_userHash), 1, pHashFile) == 0);
		fclose(pHashFile);
	}
	else
		bError = true;

	SaveIniPreferences();

	strFullPath.Format(_T("%sshareddir.dat"), m_strConfigDir);

	CStdioFile	sharedDirsFile;

	if (sharedDirsFile.Open(strFullPath, CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite|CFile::typeBinary))
	{
#ifdef _UNICODE
		uint16	uBOM = 0xFEFF;

		sharedDirsFile.Write(&uBOM, sizeof(uBOM));
#endif
		CSingleLock	sLock(&m_csDirList, true);

		for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != NULL;)
		{
			sharedDirsFile.WriteString(m_sharedDirList.GetNext(pos));
			sharedDirsFile.Write(_T("\r\n"), 2 * sizeof(TCHAR));
		}
		sLock.Unlock();
		sharedDirsFile.Close();
	}
	else
		bError = true;

	strFullPath.Format(_T("%stempdir.dat"),m_strConfigDir);

	CStdioFile	tempDirsFile;

	if (tempDirsFile.Open(strFullPath, CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite|CFile::typeBinary))
	{
#ifdef _UNICODE
		uint16	uBOM = 0xFEFF;

		tempDirsFile.Write(&uBOM, sizeof(uBOM));
#endif
		CSingleLock	sLock(&m_csDirList, true);

		for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != NULL;)
		{
			tempDirsFile.WriteString(m_tempDirList.GetNext(pos).GetBuffer());
			tempDirsFile.Write(_T("\r\n"), 2 * sizeof(TCHAR));
		}
		sLock.Unlock();
		tempDirsFile.Close();
	}
	else
		bError = true;

	CreateAllDirectories(m_sIncomingDir.Get(&strFullPath));
	CreateAllDirectories(m_sTempDir.Get(&strFullPath));

	return bError;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	CreateUserHash() generates a random 16 byte ID in 'm_userHash'.
void CPreferences::CreateUserHash()
{
	uint16 *pnHash = reinterpret_cast<uint16*>(m_userHash);

	for (int i = 0; i < 8; i++)
		pnHash[i] = static_cast<uint16>(rand() | ((rand() > (RAND_MAX / 2)) ? 0x8000 : 0));

//	Mark as emule client
	m_userHash[5] = 14;
	m_userHash[14] = 111;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int CPreferences::GetColumnWidth(int iTbl, int index) const
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			return m_auDownloadColumnWidths[index];
		case TABLE_UPLOAD:
			return m_auUploadColumnWidths[index];
		case TABLE_QUEUE:
			return m_auQueueColumnWidths[index];
		case TABLE_SEARCH:
			return m_auSearchColumnWidths[index];
		case TABLE_SHARED:
			return m_auSharedColumnWidths[index];
		case TABLE_SERVER:
			return m_auServerColumnWidths[index];
		case TABLE_IRCNICK:
			return m_auIrcNickColumnWidths[index];
		case TABLE_IRC:
			return m_auIrcColumnWidths[index];
		case TABLE_CLIENTLIST:
			return m_auClientListColumnWidths[index];
		case TABLE_PARTSTATUS:
			return m_auPartStatusColumnWidths[index];
		case TABLE_FRIENDLIST:
			return m_auFriendColumnWidths[index];
		case TABLE_SRCFILENAME:
			return m_auSrcFileNameColumnWidths[index];
	}
	return 0;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetColumnWidth(int iTbl, int index, int width)
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			m_auDownloadColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_UPLOAD:
			m_auUploadColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_QUEUE:
			m_auQueueColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_SEARCH:
			m_auSearchColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_SHARED:
			m_auSharedColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_SERVER:
			m_auServerColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_IRCNICK:
			m_auIrcNickColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_IRC:
			m_auIrcColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_CLIENTLIST:
			m_auClientListColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_PARTSTATUS:
			m_auPartStatusColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_FRIENDLIST:
			m_auFriendColumnWidths[index] = static_cast<uint16>(width);
			break;
		case TABLE_SRCFILENAME:
			m_auSrcFileNameColumnWidths[index] = static_cast<uint16>(width);
			break;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool CPreferences::GetColumnHidden(int iTbl, int index) const
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			return m_abDownloadColumnHidden[index];
		case TABLE_UPLOAD:
			return m_abUploadColumnHidden[index];
		case TABLE_QUEUE:
			return m_abQueueColumnHidden[index];
		case TABLE_SEARCH:
			return m_abSearchColumnHidden[index];
		case TABLE_SHARED:
			return m_abSharedColumnHidden[index];
		case TABLE_SERVER:
			return m_abServerColumnHidden[index];
		case TABLE_IRCNICK:
			return m_abIrcNickColumnHidden[index];
		case TABLE_IRC:
			return m_abIrcColumnHidden[index];
		case TABLE_CLIENTLIST:
			return m_abClientListColumnHidden[index];
		case TABLE_PARTSTATUS:
			return m_abPartStatusColumnHidden[index];
		case TABLE_FRIENDLIST:
			return m_abFriendColumnHidden[index];
		case TABLE_SRCFILENAME:
			return m_abSrcFileNameColumnHidden[index];
	}
	return false;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetColumnHidden(int iTbl, int index, bool bHidden)
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			m_abDownloadColumnHidden[index] = bHidden;
			break;
		case TABLE_UPLOAD:
			m_abUploadColumnHidden[index] = bHidden;
			break;
		case TABLE_QUEUE:
			m_abQueueColumnHidden[index] = bHidden;
			break;
		case TABLE_SEARCH:
			m_abSearchColumnHidden[index] = bHidden;
			break;
		case TABLE_SHARED:
			m_abSharedColumnHidden[index] = bHidden;
			break;
		case TABLE_SERVER:
			m_abServerColumnHidden[index] = bHidden;
			break;
		case TABLE_IRCNICK:
			m_abIrcNickColumnHidden[index] = bHidden;
			break;
		case TABLE_IRC:
			m_abIrcColumnHidden[index] = bHidden;
			break;
		case TABLE_CLIENTLIST:
			m_abClientListColumnHidden[index] = bHidden;
			break;
		case TABLE_PARTSTATUS:
			m_abPartStatusColumnHidden[index] = bHidden;
			break;
		case TABLE_FRIENDLIST:
			m_abFriendColumnHidden[index] = bHidden;
			break;
		case TABLE_SRCFILENAME:
			m_abSrcFileNameColumnHidden[index] = bHidden;
			break;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int CPreferences::GetColumnOrder(int iTbl, int index) const
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			return m_aiDownloadColumnOrder[index];
		case TABLE_UPLOAD:
			return m_aiUploadColumnOrder[index];
		case TABLE_QUEUE:
			return m_aiQueueColumnOrder[index];
		case TABLE_SEARCH:
			return m_aiSearchColumnOrder[index];
		case TABLE_SHARED:
			return m_aiSharedColumnOrder[index];
		case TABLE_SERVER:
			return m_aiServerColumnOrder[index];
		case TABLE_IRCNICK:
			return m_aiIrcNickColumnOrder[index];
		case TABLE_IRC:
			return m_aiIrcColumnOrder[index];
		case TABLE_CLIENTLIST:
			return m_aiClientListColumnOrder[index];
		case TABLE_PARTSTATUS:
			return m_aiPartStatusColumnOrder[index];
		case TABLE_FRIENDLIST:
			return m_aiFriendColumnOrder[index];
		case TABLE_SRCFILENAME:
			return m_aiSrcFileNameColumnOrder[index];
	}
	return 0;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetColumnOrder(int iTbl, int *piOrder)
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			memcpy2(m_aiDownloadColumnOrder, piOrder, sizeof(m_aiDownloadColumnOrder));
			break;
		case TABLE_UPLOAD:
			memcpy2(m_aiUploadColumnOrder, piOrder, sizeof(m_aiUploadColumnOrder));
			break;
		case TABLE_QUEUE:
			memcpy2(m_aiQueueColumnOrder, piOrder, sizeof(m_aiQueueColumnOrder));
			break;
		case TABLE_SEARCH:
			memcpy2(m_aiSearchColumnOrder, piOrder, sizeof(m_aiSearchColumnOrder));
			break;
		case TABLE_SHARED:
			memcpy2(m_aiSharedColumnOrder, piOrder, sizeof(m_aiSharedColumnOrder));
			break;
		case TABLE_SERVER:
			memcpy2(m_aiServerColumnOrder, piOrder, sizeof(m_aiServerColumnOrder));
			break;
		case TABLE_IRCNICK:
			memcpy2(m_aiIrcNickColumnOrder, piOrder, sizeof(m_aiIrcNickColumnOrder));
			break;
		case TABLE_IRC:
			memcpy2(m_aiIrcColumnOrder, piOrder, sizeof(m_aiIrcColumnOrder));
			break;
		case TABLE_CLIENTLIST:
			memcpy2(m_aiClientListColumnOrder, piOrder, sizeof(m_aiClientListColumnOrder));
			break;
		case TABLE_PARTSTATUS:
			memcpy2(m_aiPartStatusColumnOrder, piOrder, sizeof(m_aiPartStatusColumnOrder));
			break;
		case TABLE_FRIENDLIST:
			memcpy2(m_aiFriendColumnOrder, piOrder, sizeof(m_aiFriendColumnOrder));
			break;
		case TABLE_SRCFILENAME:
			memcpy2(m_aiSrcFileNameColumnOrder, piOrder, sizeof(m_aiSrcFileNameColumnOrder));
			break;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	GetRecommendedMaxConnections() calculates a recommended connection limit based on the maximum
//		supported by the OS.
int CPreferences::GetRecommendedMaxConnections()
{
//	Get an estimate of the maximum number of connections the OS will support
	int iRealMax = ::GetMaxConnections();

//	If limit is out of range, recommend 500
	if(iRealMax == -1 || iRealMax > 520)
		return 500;

//	If limit is between 0 and 19, recommend it
	if(iRealMax < 20)
		return iRealMax;

//	If limit is between 20 and 256, recommend it be reduced by 10
	if(iRealMax <= 256)
		return iRealMax - 10;

//	If limit is between 257 and 520, recommend it be reduced by 20
	return iRealMax - 20;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SaveIniPreferences()
{
	EMULE_TRY

	CString		strBuf;

	strBuf.Format(_T("%spreferences.ini"), m_strConfigDir);

	CIni		ini(strBuf);

	ini.SetDefaultCategory(_T("eMule"));

	ini.SetString(_T("AppVersion"), CURRENT_VERSION_LONG);
	ini.SetString(_T("Nick"), *m_sNick.Get(&strBuf));
	ini.SetString(_T("IncomingDir"), *m_sIncomingDir.Get(&strBuf));
	ini.SetString(_T("TempDir"), *m_sTempDir.Get(&strBuf));
	ini.SetString(_T("VideoPlayer"), m_strVideoPlayer);
	ini.SetString(_T("VideoPlayerArgs"), m_strVideoPlayerArgs);

	FractionalRate2String(&strBuf, m_dwMaxUpload);
	ini.SetString(_T("MaxUpload"), strBuf);
	FractionalRate2String(&strBuf, m_dwMaxDownload);
	ini.SetString(_T("MaxDownload"), strBuf);
	ini.SetInt(_T("MaxConnections"), m_nMaxConnections);
	ini.SetBool(_T("DeadServerAction"), m_bRemoveDeadServers);
	ini.SetString(_T("BindAddr"), m_strBindAddr);
	ini.SetInt(_T("Port"), m_uPort);
	ini.SetInt(_T("UDPPort"), m_uUDPPort);
	ini.SetBool(_T("OpenXPFirewallPorts"),m_bOpenPorts);
	ini.SetBool(_T("UseServerAuxPort"), m_bUseServerAuxPort);
	ini.SetInt(_T("MaxSourcesPerFile"), m_dwMaxSourcePerFile);
	ini.SetWORD(_T("Language"), m_nLanguageID);
	ini.SetInt(_T("SeeShare"), m_nSeeShares);
	ini.SetInt(_T("FilePermission"), m_byteFilePermission);

	ini.SetBool(_T("PartTrafficEnabled"), m_bUsePartTraffic);
	ini.SetInt(_T("UploadbarStyle"), m_byteUpbarPartTraffic);
	ini.SetInt(_T("UploadbarColor"), m_byteUpbarColorPartTraffic);

	ini.SetInt(_T("ToolTipDelay"), m_dwTooltipDelay);
	ini.SetInt(_T("QueueSize"), m_dwQueueSize);
	ini.SetInt(_T("StatGraphsInterval"), m_nTrafficOMeterInterval);
	ini.SetInt(_T("StatsInterval"), m_nStatsInterval);
	ini.SetInt(_T("DetailColumnWidth"), m_iDetailColumnWidth);
	ini.SetInt(_T("DownloadCapacity"), m_dwMaxGraphDownloadRate / 10);
	ini.SetInt(_T("UploadCapacity"), m_dwMaxGraphUploadRate / 10);
	ini.SetInt(_T("DeadServerRetry"), m_dwDeadServerRetries);
	ini.SetInt(_T("VariousStatisticsMaxValue"), m_nStatsMax);
	ini.SetInt(_T("StatsAverageMinutes"), m_nStatsAverageMinutes);
	ini.SetInt(_T("MaxConnectionsPerFiveSeconds"), m_nMaxConPerFive);

	ini.SetInt(_T("BadClientBanTime"), m_dwBadClientBanTime);
	ini.SetInt(_T("BadClientMinRequestTime"), m_dwMinRequestTime);
	ini.SetInt(_T("BadClientMinRequestNum"), m_byteBadClientBan);
	ini.SetBool(_T("BanMessageEnabled"), m_bBanMessageEnabled);
	ini.SetBool(_T("BanEnabled"), m_bBanEnabled);

	ini.SetInt(_T("SLS_WhenSourcesOutdated"), m_dwSLSOutdated);
	ini.SetInt(_T("SLS_MaxSourcesPerFile"), m_dwSLSMaxSrcPerFile);
	ini.SetBool(_T("SLS_Enable"), m_bSLSEnable);

	ini.SetBool(_T("Reconnect"), m_bReconnect);
	ini.SetBool(_T("Scoresystem"), m_bUseServerPriorities);

	ini.SetBool(_T("UAP"), m_bUAP);
	ini.SetBool(_T("DAP"), m_bDAP);
	ini.SetBool(_T("DisableXS"), m_bDisableXS);
	ini.SetBool(_T("StartDownloadPaused"), m_bStartDownloadPaused);
	ini.SetBool(_T("DownloadPausedOnComplete"), m_bDownloadPausedOnComplete);
	ini.SetBool(_T("ResumeOtherCat"), m_bResumeOtherCat);
	ini.SetBool(_T("AutoClearCompleted"), m_bAutoClearCompleted);
	ini.SetBool(_T("AutoSourcesEnabled"), m_bAutoSourcesEnabled);
	ini.SetInt(_T("MinAutoSourcesPerFile"), m_nMinAutoSourcesPerFile);
	ini.SetInt(_T("MaxAutoSourcesPerFile"), m_nMaxAutoSourcesPerFile);
	ini.SetInt(_T("MaxAutoSourcesTotal"), m_nMaxAutoSourcesTotal);
	ini.SetInt(_T("MaxAutoExchangeSources"), m_nMaxAutoExchangeSources);
	ini.SetBool(_T("AutoSourcesLogEnabled"), m_bAutoSourcesLogEnabled);
	ini.SetBool(_T("ClientTransferLogEnabled"), m_bClientTransferLogEnabled);

	ini.SetString(_T("ToolbarSettings"), *m_sToolbarSettings.Get(&strBuf));
	ini.SetString(_T("ToolbarBitmap"), *m_sToolbarBitmap.Get(&strBuf));
	ini.SetString(_T("ToolbarBitmapFolder"), *m_sToolbarBitmapFolder.Get(&strBuf));
	ini.SetInt(_T("ToolbarLabels"), m_iToolbarLabels);
	ini.SetBool(_T("Serverlist"), m_bAutoServerList);
	ini.SetBool(_T("UpdateNotify"), m_bUpdateNotify);
	ini.SetBool(_T("MinimizeToTray"), m_bMinToTray);
	ini.SetBool(_T("AddServersFromServer"), m_bAddServersFromServer);
	ini.SetBool(_T("AddServersFromClient"), m_bAddServersFromClients);
	ini.SetBool(_T("Splashscreen"), m_bSplashScreen);
	ini.SetBool(_T("BringToFront"), m_bBringToForeground);
	ini.SetBool(_T("BeepOnError"), m_bBeepOnError);
	ini.SetBool(_T("ConfirmExit"), m_bConfirmExit);
	ini.SetBool(_T("ConfirmDisconnect"), m_bConfirmDisconnect);
	ini.SetBool(_T("ConfirmFriendDel"), m_bConfirmFriendDel);
	ini.SetBool(_T("FilterBadIPs"), m_bFilterBadIP);
	ini.SetBool(_T("FilterServersByIP"), m_bFilterServersByIP);
	ini.SetBool(_T("Autoconnect"), m_bAutoConnect);
	ini.SetBool(_T("OnlineSignature"), m_bOnlineSig);
	ini.SetBool(_T("StartupMinimized"), m_bStartMinimized);
	ini.SetBool(_T("ToolbarSpeedMeter"), m_bShowToolbarSpeedMeter);
	ini.SetBool(_T("CountryFlag"), m_bShowCountryFlag);
	ini.SetBool(_T("CloseToTray"), m_bCloseToTray);
	ini.SetBool(_T("DetailsOnClick"), m_bDetailsOnClick);
	ini.SetInt(_T("SrvConTimeout"), m_nSrvConTimeout);
	ini.SetInt(_T("SlowCompleteBlockSize"), m_dwSlowCompleteBlockSize);
	ini.SetBool(_T("ShowRatesOnTitle"), m_bShowRatesInTitle);

	ini.SetBool(_T("AutoConnectStaticOnly"), m_bAutoConnectStaticOnly);
	ini.SetInt(_T("3DDepth"), m_byteDepth3D);

	ini.SetBool(_T("NotifyOnDownload"), m_bUseDownloadNotifier);
	ini.SetBool(_T("NotifyOnDownloadAdd"), m_bUseDownloadAddNotifier);
	ini.SetBool(_T("NotifyOnChat"), m_bUseChatNotifier);
	ini.SetBool(_T("NotifyOnLog"), m_bUseLogNotifier);
	ini.SetBool(_T("NotifierUseSound"), m_bUseSoundInNotifier);
	ini.SetBool(_T("NotifierUseScheduler"), m_bUseSchedulerNotifier);
	ini.SetBool(_T("NotifierPopEveryChatMessage"), m_bNotifierPopsEveryChatMsg);
	ini.SetBool(_T("NotifyOnImportantError"), m_bNotifierImportantError);
	ini.SetBool(_T("NotifyOnWebServerError"), m_bNotifierWebServerError);
	ini.SetBool(_T("NotifyOnServerError"), m_bNotifierServerError);
	ini.SetString(_T("NotifierSoundPath"), *m_sNotifierSoundFilePath.Get(&strBuf));

	ini.SetString(_T("MessageFilter"), m_strMessageFilter);
	ini.SetString(_T("CommentFilter"), *m_sCommentFilter.Get(&strBuf));
	ini.SetString(_T("CommentFilterUpd"), m_strCommentFilterUpd);
	ini.SetString(_T("TxtEditor"), m_strTxtEditor);
	ini.SetBool(_T("ShowRatingIcons"), m_bShowRatingIcons);
	ini.SetBool(_T("SmartIdCheck"), m_bSmartIdCheck);

	ini.SetString(_T("IRCServer"), *m_sIRCServer.Get(&strBuf));
	ini.SetString(_T("IRCNick"), *m_sIRCNick.Get(&strBuf));
	ini.SetBool(_T("IRCAddTimestamp"), m_bIRCAddTimestamp);
	ini.SetString(_T("IRCFilterName"), *m_sIRCChanNameFilter.Get(&strBuf));
	ini.SetInt(_T("IRCFilterUser"), m_nIRCChannelUserFilter);
	ini.SetBool(_T("IRCUseFilter"), m_bIRCUseChanFilter);
	ini.SetString(_T("IRCPerformString"), *m_sIRCPerformString.Get(&strBuf));
	ini.SetBool(_T("IRCUsePerform"), m_bIRCUsePerform);
	ini.SetBool(_T("IRCListOnConnect"), m_bIRCListOnConnect);
	ini.SetBool(_T("IRCIgnoreInfoMessage"), m_bIRCIgnoreInfoMessage);
	ini.SetBool(_T("IRCMessageEncodingUTF8"), m_bIRCMessageEncodingUTF8);
	ini.SetBool(_T("IRCStripColor"), m_bIRCStripColor);

	ini.SetBool(_T("UseSortingDefaults"), m_bUseSort);
	ini.SetBool(_T("Use2ndSortSources"), m_bUseSrcSortCol2);
	ini.SetBool(_T("PausedStoppedLast"), m_bPausedStoppedLast);
	ini.SetUInt32(_T("SortServersCode"), m_uiServerSortCol);
	ini.SetUInt32(_T("SortUploadsCode"), m_uiUploadSortCol);
	ini.SetUInt32(_T("SortQueueCode"), m_uiQueueSortCol);
	ini.SetUInt32(_T("SortSearchCode"), m_uiSearchSortCol);
	ini.SetUInt32(_T("SortIrcCode"), m_uiIRCSortCol);
	ini.SetUInt32(_T("SortFilesCode"), m_uiFileSortCol);
	ini.SetUInt32(_T("SortDownloadsCode"), m_uiDownloadSortCol);
	ini.SetUInt32(_T("SortClientListCode"), m_uiClientListSortCol);
	ini.SetUInt32(_T("1stSortSourcesCode"), m_uiSrcSortCol1);
	ini.SetUInt32(_T("2ndSortSourcesCode"), m_uiSrcSortCol2);

	ini.SetBool(_T("CommunityEnabled"), m_bCommunityEnabled);
	ini.SetString(_T("CommunityString"), *m_sCommunityString.Get(&strBuf));
	ini.SetBool(_T("CommunityNoBan"), m_bCommunityNoBan);
	ini.SetInt(_T("NotificationDisplayTime"), m_nNotificationDisplayTime);
	ini.SetInt(_T("NotificationFontSize"), m_nNotificationFontSize);
	ini.SetInt(_T("Profile"), m_uiProfile);
	ini.SetInt(_T("PriorityHigh"), m_nPriorityHigh);
	ini.SetInt(_T("PriorityLow"), m_nPriorityLow);
	ini.SetBool(_T("RestartWaiting"), m_bRestartWaiting);
	ini.SetBool(_T("LogToFile"), m_bLogToFile);
	ini.SetBool(_T("LogUploadToFile"), m_bLogUploadToFile);
	ini.SetBool(_T("LogDownloadToFile"), m_bLogDownloadToFile);
	ini.SetBool(_T("BugReport"), m_bBugReport);
	ini.SetBool(_T("AllowLocalHostIP"), m_bAllowLocalHostIP);
	ini.SetBool(_T("DisableXSUpTo"), m_bDisableXSUpTo);
	ini.SetInt(_T("XSUpTo"), m_nXSUpTo);
	ini.SetString(_T("UsedFont"), *m_sUsedFont.Get(&strBuf));
	ini.SetInt(_T("FontSize"), m_nFontSize);
	ini.SetInt(_T("HashingPriority"), m_HashingPriority);
	ini.SetBool(_T("UploadParts"), m_bUploadParts);
	ini.SetBool(_T("A4AFStringEnabled"), m_bA4AFStringEnabled);
	ini.SetBool(_T("A4AFCountEnabled"), m_bA4AFCountEnabled);
	ini.SetInt(_T("SearchMethod"), m_dwSearchMethod);
	ini.SetBool(_T("KeepSearchHistory"), m_bKeepSearchHistory);
	ini.SetBool(_T("AutoTakeED2KLinks"), m_bAutoTakeLinks);
	ini.SetInt(_T("FileBufferSize"), m_dwFileBufferSize);
	ini.SetInt(_T("MainProcessPriority"), m_nMainProcessPriority);
	ini.SetBool(_T("ShowAverageDataRate"),m_bShowAverageDataRate);
	ini.SetBool(_T("LimitlessDownload"),m_bLimitlessDownload);
	ini.SetBool(_T("SCHEnabled"), m_bSCHEnabled);
	ini.SetBool(_T("SCHExceptMon"), m_bSCHExceptMon);
	ini.SetBool(_T("SCHExceptTue"), m_bSCHExceptTue);
	ini.SetBool(_T("SCHExceptWed"), m_bSCHExceptWed);
	ini.SetBool(_T("SCHExceptThu"), m_bSCHExceptThu);
	ini.SetBool(_T("SCHExceptFri"), m_bSCHExceptFri);
	ini.SetBool(_T("SCHExceptSat"), m_bSCHExceptSat);
	ini.SetBool(_T("SCHExceptSun"), m_bSCHExceptSun);
	ini.SetInt(_T("SCHShift1"),m_nSCHShift1);
	ini.SetInt(_T("SCHShift2"),m_nSCHShift2);
	FractionalRate2String(&strBuf, m_uSCHShift1Upload);
	ini.SetString(_T("SCHShift1Up"), strBuf);
	FractionalRate2String(&strBuf, m_uSCHShift1Download);
	ini.SetString(_T("SCHShift1Down"), strBuf);
	ini.SetInt(_T("SCHShift1Conn"),m_nSCHShift1conn);
	ini.SetInt(_T("SCHShift15sec"),m_nSCHShift15sec);
	FractionalRate2String(&strBuf, m_uSCHShift2Upload);
	ini.SetString(_T("SCHShift2Up"), strBuf);
	FractionalRate2String(&strBuf, m_uSCHShift2Download);
	ini.SetString(_T("SCHShift2Down"), strBuf);
	ini.SetInt(_T("SCHShift2Conn"),m_nSCHShift2conn);
	ini.SetInt(_T("SCHShift25sec"),m_nSCHShift25sec);
	ini.SetBool(_T("ShowFileTypeIcon"), m_bShowFileTypeIcon);

	ini.SetBool(_T("MultipleInstances"), m_bMultiple);

	ini.SetBool(_T("Verbose"), m_bVerbose);
	ini.SetBool(_T("ManualHighPrio"), m_bManuallyAddedServerHighPrio);
	ini.SetBool(_T("ShowOverhead"), m_bShowOverhead);
	ini.SetBool(_T("VideoPreviewBackupped"), m_bBackupPreview);	//Cax2 string kept for compatibility with off client

	ini.SetInt(_T("AllCatType"), CCat::GetAllCatType());

	ini.SetArray(m_auDownloadColumnWidths, ARRSIZE(m_auDownloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SetArray(m_abDownloadColumnHidden, ARRSIZE(m_abDownloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SetArray(m_aiDownloadColumnOrder, ARRSIZE(m_aiDownloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SetArray(m_auUploadColumnWidths, ARRSIZE(m_auUploadColumnWidths), _T("UploadColumnWidths"));
	ini.SetArray(m_abUploadColumnHidden, ARRSIZE(m_abUploadColumnHidden), _T("UploadColumnHidden"));
	ini.SetArray(m_aiUploadColumnOrder, ARRSIZE(m_aiUploadColumnOrder), _T("UploadColumnOrder"));
	ini.SetArray(m_auQueueColumnWidths, ARRSIZE(m_auQueueColumnWidths), _T("QueueColumnWidths"));
	ini.SetArray(m_abQueueColumnHidden, ARRSIZE(m_abQueueColumnHidden), _T("QueueColumnHidden"));
	ini.SetArray(m_aiQueueColumnOrder, ARRSIZE(m_aiQueueColumnOrder), _T("QueueColumnOrder"));
	ini.SetArray(m_auSearchColumnWidths, ARRSIZE(m_auSearchColumnWidths), _T("SearchColumnWidths"));
	ini.SetArray(m_abSearchColumnHidden, ARRSIZE(m_abSearchColumnHidden), _T("SearchColumnHidden"));
	ini.SetArray(m_aiSearchColumnOrder, ARRSIZE(m_aiSearchColumnOrder), _T("SearchColumnOrder"));
	ini.SetArray(m_auSharedColumnWidths, ARRSIZE(m_auSharedColumnWidths), _T("SharedColumnWidths"));
	ini.SetArray(m_abSharedColumnHidden, ARRSIZE(m_abSharedColumnHidden), _T("SharedColumnHidden"));
	ini.SetArray(m_aiSharedColumnOrder, ARRSIZE(m_aiSharedColumnOrder), _T("SharedColumnOrder"));
	ini.SetArray(m_auServerColumnWidths, ARRSIZE(m_auServerColumnWidths), _T("ServerColumnWidths"));
	ini.SetArray(m_abServerColumnHidden, ARRSIZE(m_abServerColumnHidden), _T("ServerColumnHidden"));
	ini.SetArray(m_aiServerColumnOrder, ARRSIZE(m_aiServerColumnOrder), _T("ServerColumnOrder"));
	ini.SetArray(m_auIrcNickColumnWidths, ARRSIZE(m_auIrcNickColumnWidths), _T("IrcNickColumnWidths"));
	ini.SetArray(m_abIrcNickColumnHidden, ARRSIZE(m_abIrcNickColumnHidden), _T("IrcNickColumnHidden"));
	ini.SetArray(m_aiIrcNickColumnOrder, ARRSIZE(m_aiIrcNickColumnOrder), _T("IrcNickColumnOrder"));
	ini.SetArray(m_auIrcColumnWidths, ARRSIZE(m_auIrcColumnWidths), _T("IrcColumnWidths"));
	ini.SetArray(m_abIrcColumnHidden, ARRSIZE(m_abIrcColumnHidden), _T("IrcColumnHidden"));
	ini.SetArray(m_aiIrcColumnOrder, ARRSIZE(m_aiIrcColumnOrder), _T("IrcColumnOrder"));
	ini.SetArray(m_auClientListColumnWidths, ARRSIZE(m_auClientListColumnWidths), _T("ClientListColumnWidths"));
	ini.SetArray(m_abClientListColumnHidden, ARRSIZE(m_abClientListColumnHidden), _T("ClientListColumnHidden"));
	ini.SetArray(m_aiClientListColumnOrder, ARRSIZE(m_aiClientListColumnOrder), _T("ClientListColumnOrder"));
	ini.SetArray(m_auPartStatusColumnWidths, ARRSIZE(m_auPartStatusColumnWidths), _T("PartStatusColumnWidths"));
	ini.SetArray(m_abPartStatusColumnHidden, ARRSIZE(m_abPartStatusColumnHidden), _T("PartStatusColumnHidden"));
	ini.SetArray(m_aiPartStatusColumnOrder, ARRSIZE(m_aiPartStatusColumnOrder), _T("PartStatusColumnOrder"));
	ini.SetArray(m_auFriendColumnWidths, ARRSIZE(m_auFriendColumnWidths), _T("FriendColumnWidths"));
	ini.SetArray(m_abFriendColumnHidden, ARRSIZE(m_abFriendColumnHidden), _T("FriendColumnHidden"));
	ini.SetArray(m_aiFriendColumnOrder, ARRSIZE(m_aiFriendColumnOrder), _T("FriendColumnOrder"));
	ini.SetArray(m_auSrcFileNameColumnWidths, ARRSIZE(m_auSrcFileNameColumnWidths), _T("SrcFileNameColumnWidths"));
	ini.SetArray(m_abSrcFileNameColumnHidden, ARRSIZE(m_abSrcFileNameColumnHidden), _T("SrcFileNameColumnHidden"));
	ini.SetArray(m_aiSrcFileNameColumnOrder, ARRSIZE(m_aiSrcFileNameColumnOrder), _T("SrcFileNameColumnOrder"));

//	Provide a mechanism for all tables to store/retrieve sort order
	for (unsigned ui = 0; ui < TABLE_COUNT; ui++)
		ini.SetInt(s_aSortItems[ui].pcIniName, m_auiSortItem[ui]);
	ini.SetArray(m_abyteSortAscendingDownload, ARRSIZE(m_abyteSortAscendingDownload), _T("SortAscendingDownload"));
	ini.SetArray(m_abyteSortAscendingDownload2, ARRSIZE(m_abyteSortAscendingDownload2), _T("SortAscendingDownload2"));
	ini.SetArray(m_abyteSortAscendingUpload, ARRSIZE(m_abyteSortAscendingUpload), _T("SortAscendingUpload"));
	ini.SetArray(m_abyteSortAscendingQueue, ARRSIZE(m_abyteSortAscendingQueue), _T("SortAscendingQueue"));
	ini.SetArray(m_abyteSortAscendingSearch, ARRSIZE(m_abyteSortAscendingSearch), _T("SortAscendingSearch"));
	ini.SetArray(m_abyteSortAscendingShared, ARRSIZE(m_abyteSortAscendingShared), _T("SortAscendingShared"));
	ini.SetArray(m_abyteSortAscendingServer, ARRSIZE(m_abyteSortAscendingServer), _T("SortAscendingServer"));
	ini.SetArray(m_abyteSortAscendingIRCNick, ARRSIZE(m_abyteSortAscendingIRCNick), _T("SortAscendingIRCNick"));
	ini.SetArray(m_abyteSortAscendingIRCChannel, ARRSIZE(m_abyteSortAscendingIRCChannel), _T("SortAscendingIRCChannel"));
	ini.SetArray(m_abyteSortAscendingClients, ARRSIZE(m_abyteSortAscendingClients), _T("SortAscendingClients"));
	ini.SetArray(m_abyteSortAscendingPartStatus, ARRSIZE(m_abyteSortAscendingPartStatus), _T("SortAscendingPartStatus"));
	ini.SetArray(m_abyteSortAscendingFriend, ARRSIZE(m_abyteSortAscendingFriend), _T("SortAscendingFriend"));
	ini.SetArray(m_abyteSortAscendingSrcFileName, ARRSIZE(m_abyteSortAscendingSrcFileName), _T("SortAscendingSrcFileName"));
#if 1 //code left for smooth migration, delete in v1.3
	int	iTmpIdx;

	ini.SetInt(_T("TableSortItemDownload"), m_auiSortItem[TABLE_DOWNLOAD]);
	ini.SetInt(_T("TableSortItemDownload2"), m_auiSortItem[TABLE_DOWNLOAD2]);
	ini.SetInt(_T("TableSortItemUpload"), m_auiSortItem[TABLE_UPLOAD]);
	ini.SetInt(_T("TableSortItemQueue"), m_auiSortItem[TABLE_QUEUE]);
	iTmpIdx = m_auiSortItem[TABLE_SEARCH];
	ini.SetInt(_T("TableSortItemSearch"), iTmpIdx | ((m_abyteSortAscendingSearch[iTmpIdx] & 2) ? MLC_SORTALT : 0));
	iTmpIdx = m_auiSortItem[TABLE_SHARED];
	ini.SetInt(_T("TableSortItemShared"), iTmpIdx | ((m_abyteSortAscendingShared[iTmpIdx] & 2) ? MLC_SORTALT : 0));
	iTmpIdx = m_auiSortItem[TABLE_SERVER];
	ini.SetInt(_T("TableSortItemServer"), iTmpIdx | ((m_abyteSortAscendingServer[iTmpIdx] & 2) ? MLC_SORTALT : 0));
	ini.SetInt(_T("TableSortItemIRCNick"), m_auiSortItem[TABLE_IRCNICK]);
	ini.SetInt(_T("TableSortItemIRCChannel"), m_auiSortItem[TABLE_IRC]);
	ini.SetInt(_T("TableSortItemClientList"), m_auiSortItem[TABLE_CLIENTLIST]);
	iTmpIdx = m_auiSortItem[TABLE_PARTSTATUS];
	ini.SetInt(_T("TableSortItemPartStatus"), iTmpIdx | ((m_abyteSortAscendingPartStatus[iTmpIdx] & 2) ? MLC_SORTALT : 0));
	ini.SetInt(_T("TableSortItemFriend"), m_auiSortItem[TABLE_FRIENDLIST]);
	ini.SetBool(_T("TableSortAscendingDownload"), (m_abyteSortAscendingDownload[m_auiSortItem[TABLE_DOWNLOAD]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingDownload2"), (m_abyteSortAscendingDownload2[m_auiSortItem[TABLE_DOWNLOAD2]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingUpload"), (m_abyteSortAscendingUpload[m_auiSortItem[TABLE_UPLOAD]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingQueue"), (m_abyteSortAscendingQueue[m_auiSortItem[TABLE_QUEUE]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingSearch"), (m_abyteSortAscendingSearch[m_auiSortItem[TABLE_SEARCH]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingShared"), (m_abyteSortAscendingShared[m_auiSortItem[TABLE_SHARED]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingServer"), (m_abyteSortAscendingServer[m_auiSortItem[TABLE_SERVER]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingIRCNick"), (m_abyteSortAscendingIRCNick[m_auiSortItem[TABLE_IRCNICK]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingIRCChannel"), (m_abyteSortAscendingIRCChannel[m_auiSortItem[TABLE_IRC]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingClientList"), (m_abyteSortAscendingClients[m_auiSortItem[TABLE_CLIENTLIST]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingPartStatus"), (m_abyteSortAscendingPartStatus[m_auiSortItem[TABLE_PARTSTATUS]] & 1) ? true : false);
	ini.SetBool(_T("TableSortAscendingFriend"), (m_abyteSortAscendingFriend[m_auiSortItem[TABLE_FRIENDLIST]] & 1) ? true : false);
#endif

	for (unsigned i = 0; i < ARRSIZE(m_dwStatColors); i++)
	{
		strBuf.Format(_T("StatColor%u"), i);
		ini.SetUInt32(strBuf, GetStatsColor(i));
	}
	ini.SetInt(_T("ConnectionsGraphRatio"), m_byteGraphRatio);

	ini.SetBool(_T("MlDonkeyCM"), m_bCounterMeasures);
	ini.SetBool(_T("CMNotLog"), m_bCMNotLog);

	ini.SetInt(_T("ServerKeepAliveTimeout"), m_dwServerKeepAliveTimeout);
	ini.SetBool(_T("WatchClipboard4ED2kFilelinks"), m_bWatchClipboard);
	ini.SetBool(_T("ExportLocalizedLinks"), m_bExportLocalizedLinks);

//	AutoCheck for new version
	ini.SetBool(_T("AutoCheckForNewVersion"), m_bAutoCheckForNewVersion);
	ini.SetInt(_T("AutoCheckLastTime"), m_iAutoCheckLastTime);

	ini.SetString(_T("A4AFAutoFileHash"), HashToString(m_A4AF_FileHash));

//	Messaging
	ini.SetInt(_T("AcceptMessageFrom"), m_uiAcceptMessagesFrom);
	ini.SetString(_T("AwayStateMessage"), *m_sAwayStateMessage.Get(&strBuf));

	ini.SetBool(_T("ScanFilter"), m_bScanFilter);
	ini.SetBool(_T("FakeRxDataFilter"), m_bFakeRxDataFilter);
	ini.SetBool(_T("PreviewSmallBlocks"), m_bPreviewSmallBlocks);
	ini.SetBool(_T("ShowFullFileStatusIcons"), m_bShowFullFileStatusIcons);
	ini.SetBool(_T("ShowPausedGray"), m_bShowPausedGray);
	ini.SetBool(_T("RoundSizes"), m_bRoundSizes);
	ini.SetBool(_T("TransferredOnCompleted"), m_bTransferredOnCompleted);
	ini.SetBool(_T("UseDwlPercentage"), m_bUseDwlPercentage);
	ini.SetString(_T("URLsForICC"), *m_sURLsForICC.Get(&strBuf));
	ini.SetInt(_T("DetailedPartsFilter"), m_byteDetailedPartsFilter);

	ini.SetInt(_T("SmartFilterMaxQueueRank"), m_nSmartFilterMaxQR);
	ini.SetBool(_T("SmartFilterShowOnQueue"), m_bSmartFilterShowOQ);

	ini.SetInt(_T("FilterLevel"), static_cast<int>(m_byteIPFilterLevel));
	ini.SetString(_T("UpdateURLIPFilter"), m_strIPFilterURL);	// Value name same as eMule Morph for maximum compatibility
	ini.SetBool(_T("AutoUPdateIPFilter"), m_bIPFilterUpdateOnStart);	// Value name same as eMule Morph for maximum compatibility

	ini.SetInt(_T("LastIPFilterUpdate"), m_dwLastIPFilterUpdate);
	ini.SetInt(_T("IPFilterUpdateFrequency"), m_dwIPFilterUpdateFrequency);

//	Antivirus
	ini.SetBool(_T("AVEnabled"), m_bAVEnabled);
	ini.SetString(_T("AVPath"), m_strAVPath);
	ini.SetString(_T("AVParams"), m_strAVParams);
	ini.SetBool(_T("AVScanCompleted"), m_bAVScanCompleted);

//	Splitter settings
	ini.SetInt(_T("SplitterbarPositionFriend"), m_uSplitterPosFriend);

	ini.SetArray(&m_adRollupPos[0][0], sizeof(m_adRollupPos) / sizeof(m_adRollupPos[0][0]), _T("RollupPos"));
	ini.SetArray(m_abRollupState, ARRSIZE(m_abRollupState), _T("RollupState"));

	ini.SetBool(_T("CryptLayerRequested"), m_bCryptLayerRequested);
	ini.SetBool(_T("CryptLayerRequired"), m_bCryptLayerRequired);
	ini.SetBool(_T("CryptLayerSupported"), m_bCryptLayerSupported);
	ini.SetInt(_T("CryptTCPPaddingLength"), m_dwCryptTCPPaddingLenMod - 1);

//	Proxy
	ini.SetDefaultCategory(_T("Proxy"));
	ini.SetBool(_T("EnablePassword"), m_proxy.m_bEnablePassword);
	ini.SetBool(_T("EnableProxy"), m_proxy.m_bUseProxy);
	ini.SetString(_T("Name"), CString(m_proxy.m_strName));
	ini.SetString(_T("Password"), Crypt(CString(m_proxy.m_strPassword)));
	ini.SetString(_T("User"), CString(m_proxy.m_strUser));
	ini.SetInt(_T("Port"), m_proxy.m_uPort);
	ini.SetInt(_T("Type"), m_proxy.m_nType);

//	WebServer
	ini.SetDefaultCategory(_T("WebServer"));

	ini.SetString(_T("Password"), HashToString(m_abyteWebPassword));
	ini.SetString(_T("PasswordLow"), HashToString(m_abyteLowWebPassword));
	ini.SetInt(_T("Port"), m_uWSPort);
	ini.SetBool(_T("Enabled"), m_bWebEnabled);
	ini.SetBool(_T("EnabledLow"), m_bWebLowEnabled);
	ini.SetInt(_T("PageRefreshTime"), m_nWebPageRefresh);
	ini.SetBool(_T("IntruderDetection"), m_bWebIntruderDetection);
	ini.SetInt(_T("TempDisableLogin"), m_dwWebTempDisableLogin);
	ini.SetInt(_T("LoginAttemptsAllowed"), m_dwWSLoginAttemptsAllowed);
	ini.SetString(_T("WebTemplateFile"), m_strTemplateFile);
	ini.SetBool(_T("MenuLocked"), m_WSPrefs.bMenuLocked);
	ini.SetBool(_T("ShowUploadQueue"), m_WSPrefs.bShowUploadQueue);
	ini.SetBool(_T("ShowUploadQueueBanned"), m_WSPrefs.bShowUploadQueueBanned);
	ini.SetBool(_T("ShowUploadQueueFriend"), m_WSPrefs.bShowUploadQueueFriend);
	ini.SetBool(_T("ShowUploadQueueCredit"), m_WSPrefs.bShowUploadQueueCredit);
	ini.SetArray(m_WSPrefs.abDownloadColHidden, ARRSIZE(m_WSPrefs.abDownloadColHidden), _T("downloadColumnHidden"));
	ini.SetArray(m_WSPrefs.abUploadColHidden, ARRSIZE(m_WSPrefs.abUploadColHidden), _T("uploadColumnHidden"));
	ini.SetArray(m_WSPrefs.abQueueColHidden, ARRSIZE(m_WSPrefs.abQueueColHidden), _T("queueColumnHidden"));
	ini.SetArray(m_WSPrefs.abSharedColHidden, ARRSIZE(m_WSPrefs.abSharedColHidden), _T("sharedColumnHidden"));
	ini.SetArray(m_WSPrefs.abServerColHidden, ARRSIZE(m_WSPrefs.abServerColHidden), _T("serverColumnHidden"));
	ini.SetArray(m_WSPrefs.abSearchColHidden, ARRSIZE(m_WSPrefs.abSearchColHidden), _T("searchColumnHidden"));
	ini.SetUInt32(_T("DownloadSort"), m_WSPrefs.dwDownloadSort);
	ini.SetUInt32(_T("UploadSort"), m_WSPrefs.dwUploadSort);
	ini.SetUInt32(_T("QueueSort"), m_WSPrefs.dwQueueSort);
	ini.SetUInt32(_T("SharedSort"), m_WSPrefs.dwSharedSort);
	ini.SetUInt32(_T("ServerSort"), m_WSPrefs.dwServerSort);
	ini.SetUInt32(_T("SearchSort"), m_WSPrefs.dwSearchSort);
	ini.SetArray(m_WSPrefs.abDownloadSortAsc, ARRSIZE(m_WSPrefs.abDownloadSortAsc), _T("DownloadSortDir"));
	ini.SetArray(m_WSPrefs.abUploadSortAsc, ARRSIZE(m_WSPrefs.abUploadSortAsc), _T("UploadSortDir"));
	ini.SetArray(m_WSPrefs.abQueueSortAsc, ARRSIZE(m_WSPrefs.abQueueSortAsc), _T("QueueSortDir"));
	ini.SetArray(m_WSPrefs.aiSharedSortAsc, ARRSIZE(m_WSPrefs.aiSharedSortAsc), _T("SharedSortDir"));
	ini.SetArray(m_WSPrefs.abServerSortAsc, ARRSIZE(m_WSPrefs.abServerSortAsc), _T("ServerSortDir"));
	ini.SetArray(m_WSPrefs.abSearchSortAsc, ARRSIZE(m_WSPrefs.abSearchSortAsc), _T("SearchSortDir"));

//	MobileMule
	ini.SetDefaultCategory(_T("MobileMule"));
	ini.SetString(_T("Password"), HashToString(m_abyteMMPassword));
	ini.SetBool(_T("Enabled"), m_bMMEnabled);
	ini.SetInt(_T("Port"), m_uMMPort);

//	LANCAST
	ini.SetDefaultCategory(_T("Lancast"));
	ini.SetBool(_T("Enabled"), m_bLancastEnabled);
	ini.SetBool(_T("UseDefaultIP"), m_bUseDefaultIP);
	strBuf.Format(_T("%i.%i.%i.%i"),(byte)m_dwLancastIP,(byte)(m_dwLancastIP>>8),(byte)(m_dwLancastIP>>16),(byte)(m_dwLancastIP>>24));
	ini.SetString(_T("IPAddress"), strBuf);
	strBuf.Format(_T("%i.%i.%i.%i"),(byte)m_dwLancastSubnet,(byte)(m_dwLancastSubnet>>8),(byte)(m_dwLancastSubnet>>16),(byte)(m_dwLancastSubnet>>24));
	ini.SetString(_T("Subnet"), strBuf);
	ini.SetInt(_T("Port"), m_uLancastPort);

	ini.SetDefaultCategory(_T("Cleanup"));
	ini.SetBool(_T("AutoFilenameCleanup"), m_bAutoFilenameCleanup);
	ini.SetBool(_T("CleanupTags"), m_bFilenameCleanupTags);
	ini.SetString(_T("FilenameCleanups"), *m_sFilenameCleanups.Get(&strBuf));
	ini.SetString(_T("FilenameCleanupsUpd"), m_strFilenameCleanupsUpd);

//	SMTP Notifier
	ini.SetDefaultCategory(_T("SMTP"));
	ini.SetString(_T("Server"), *m_sSMTPServer.Get(&strBuf));
	ini.SetString(_T("Name"), *m_sSMTPName.Get(&strBuf));
	ini.SetString(_T("From"), *m_sSMTPFrom.Get(&strBuf));
	ini.SetString(_T("To"), *m_sSMTPTo.Get(&strBuf));
	ini.SetString(_T("UserName"), *m_sSMTPUserName.Get(&strBuf));
	ini.SetString(_T("Password"), Crypt(*m_sSMTPPassword.Get(&strBuf)));
	ini.SetBool(_T("Authenticated"), m_bSMTPAuthenticated);
	ini.SetBool(_T("Info"), m_bSMTPInfo);
	ini.SetBool(_T("Warning"), m_bSMTPWarning);
	ini.SetBool(_T("MsgInSubject"), m_bSMTPMsgInSubj);

//	Backup feature
	ini.SetDefaultCategory(_T("Backup"));
	ini.SetBool(_T("DatFiles"), m_bDatFiles);
	ini.SetBool(_T("MetFiles"), m_bMetFiles);
	ini.SetBool(_T("IniFiles"), m_bIniFiles);
	ini.SetBool(_T("PartFiles"), m_bPartFiles);
	ini.SetBool(_T("PartMetFiles"), m_bPartMetFiles);
	ini.SetBool(_T("PartTxtsrcFiles"), m_bPartTxtsrcFiles);
	ini.SetBool(_T("AutoBackup"), m_bAutoBackup);
	ini.SetBool(_T("BackupOverwrite"), m_bBackupOverwrite);
	ini.SetString(_T("BackupDir"), *m_sBackupDir.Get(&strBuf));
	ini.SetBool(_T("ScheduledBackup"), m_bScheduledBackup);
	ini.SetInt(_T("ScheduledBackupInterval"), m_nScheduledBackupInterval);

//	FakeCheck
	ini.SetDefaultCategory(_T("FakeCheck"));
	ini.SetInt(_T("FakesDatVersion"),m_nFakesDatVersion);
	ini.SetBool(_T("UpdateFakeStartup"),m_bUpdateFakeStartup);
	ini.SetString(_T("FakeListURL"), m_sFakeListURL);
	ini.SetInt(_T("DownloadingFakeListVersion"), m_dwDLingFakeListVersion);
	ini.SetString(_T("DownloadingFakeListLink"), m_strDLingFakeListLink);
	ini.SetUInt32(_T("FakeListDownloadColor"), m_clrFakeListDownloadColor);

//	Shortcut management
	ini.SetDefaultCategory(_T("Shortcuts"));
	for (int i = 0; i < SCUT_COUNT; i++)
		ini.SetInt(s_apcShortcutNames[i], m_anShortcutCode[i]);

//	Update stats value and save inside altogether
	SaveStats(0, &ini);

	EMULE_CATCH
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SaveCats()
{
	CString		strTemp;

	strTemp.Format(_T("%scategory.ini"), m_strConfigDir);
	_tremove(strTemp);

	if (CCat::GetNumCats() > 1)
	{
		CIni		catini(strTemp);

		catini.SetDefaultCategory(_T("General"));
		catini.SetInt(_T("Count"), CCat::GetNumCats() - CCat::GetNumPredefinedCats());

		for (int i = 1; i < CCat::GetNumPredefinedCats(); i++)
		{
			CCat	*pCat = CCat::GetCatByIndex(i);

			strTemp.Format(_T("PredefinedCat%#i"), i);
			catini.SetInt(strTemp, pCat->m_eCatID);
		}

	//	If there are user-defined categories...
		if (CCat::GetNumCats() > CCat::GetNumPredefinedCats())
		{
			for (int ix = CCat::GetNumPredefinedCats(); ix < CCat::GetNumCats(); ix++)
			{
				CCat	*pCat = CCat::GetCatByIndex(ix);

				strTemp.Format(_T("Cat#%u"), ix - CCat::GetNumPredefinedCats() + 1);
				catini.SetDefaultCategory(strTemp);
				catini.SetString(_T("Title"), pCat->m_strTitle);
				catini.SetString(_T("Incoming"), pCat->m_strSavePath);

				if (TempDirListCheckAndAdd(pCat->m_strTempPath, true) < 0)
				{
				//	There's no such directory in the list and its creation failed
					pCat->m_strTempPath = GetTempDir();
				}
				catini.SetString(_T("Temp"), pCat->m_strTempPath);
				catini.SetString(_T("Comment"), pCat->m_strComment);
				catini.SetUInt32(_T("Color"), pCat->m_crColor);
				catini.SetInt(_T("Priority"), pCat->m_iPriority);
				catini.SetString(_T("AutoCat"), pCat->m_strAutoCatExt);
				catini.SetInt(_T("CategoryID"), pCat->m_eCatID);
			}
		}
		catini.SaveAndClose();
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	GetDefaultStatsColor()
COLORREF CPreferences::GetDefaultStatsColor(unsigned uiIdx)
{
	static const COLORREF acrDefColors[12] =
	{
		RGB(  0,   0,  64), RGB(192, 192, 255), RGB(128, 255, 128), RGB(  0, 210,   0),
		RGB(  0, 128,   0), RGB(255, 128, 128), RGB(200,   0,   0), RGB(140,   0,   0),
		RGB(150, 150, 255), RGB(192,   0, 192), RGB(255, 192, 255), RGB(255, 255, 128)
	};
	if (uiIdx >= ARRSIZE(acrDefColors))
		uiIdx = 0;
	return acrDefColors[uiIdx];
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	LoadIniPreferences() loads preferences stored in the "preferences.ini" file.
void CPreferences::LoadIniPreferences()
{
	static const byte	s_abyteDownloadListDefSortAscending[DLCOL_NUMCOLUMNS] = { 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1 };
	static const byte	s_abyteUploadListDefSortAscending[ULCOL_NUMCOLUMNS] = { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 };
	static const byte	s_abyteQueueListDefSortAscending[QLCOL_NUMCOLUMNS] = { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 };
	static const byte	s_abyteSearchListDefSortAscending[SEARCHCOL_NUMCOLUMNS] = { 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1 };
	static const byte	s_abyteSharedListDefSortAscending[SFLCOL_NUMCOLUMNS] = { 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1 };
	static const byte	s_abyteSrvListDefSortAscending[SRVCOL_NUMCOLUMNS] = { 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1 };
	static const byte	s_abyteIRCNickListDefSortAscending[IRC1COL_NUMCOLUMNS] = { 1, 1 };
	static const byte	s_abyteIRCChannelListDefSortAscending[IRC2COL_NUMCOLUMNS] = { 1, 0, 1 };
	static const byte	s_abyteClientsListDefSortAscending[CLCOL_NUMCOLUMNS] = { 1, 1, 1, 1, 1, 1, 1, 1, 1 };
	static const byte	s_abyteFDPartsListDefSortAscending[FDPARTSCOL_NUMCOLUMNS] = { 1, 0, 1, 1 };
	static const byte	s_abyteFriendListDefSortAscending[FRIENDCOL_NUMCOLUMNS] = { 1, 1 };
	static const byte	s_abyteFDSrcFNameListDefSortAscending[FDSRCCOL_NUMCOLUMNS] = { 1, 0 };
	CString strFileName;

	strFileName.Format(_T("%spreferences.ini"), m_strConfigDir);

//	Load using read-only to get AppVersion to detect if version was changed
	CIni ini(strFileName, INI_MODE_READONLY);
	ini.SetDefaultCategory(_T("eMule"));

	CString strPrefsVersion(ini.GetString(_T("AppVersion"), _T("")));

//	All file data is cached, close the file to allow renaming if required
	ini.CloseWithoutSave();

	CFileFind	findFileName;
	bool		bChangedVersion = false;

	if ((strPrefsVersion.Compare(CURRENT_VERSION_LONG) != 0) && findFileName.FindFile(strFileName) && !strPrefsVersion.IsEmpty())
	{
		CString strNewName;

	//	Cax2 we can add the code to find our version's setting, if the ini file is from a different version...
	//	Rename the old .ini file
		strNewName.Format(_T("%spreferences[%s].ini"), m_strConfigDir, strPrefsVersion);
		::DeleteFile(strNewName);
	//	NB! rename will fail if AppVersion contained restricted characters
		if (::MoveFile(strFileName, strNewName))
			bChangedVersion = true;	// save loaded configuration to the new preferences.ini on successful renaming
	}

//	Set language as early as possible to specify correct locale
	GetWindowsVersion();	//required to set m_bIsNTBased

	m_nLanguageID = ini.GetWORD(_T("Language"), 0);
	SetLanguage();

	uint32	dwVal;
	uint16	uVal;
	TCHAR	cCh;
	static TCHAR	acNick[] = _T("       [ePlus]");

//	Generate a random six character default nickname
#define EP_CHCMP(c)	(1 << ((c) - _T('a')))
	for (unsigned ui = 0; ui < 6; ui++)
	{
		dwVal = rand();
		cCh = static_cast<TCHAR>(dwVal % (_T('z') - _T('a')) + _T('a'));
	//	Replace few vowels with digits to avoid generation of bad words
		if ((EP_CHCMP(cCh) & (EP_CHCMP(_T('a')) | EP_CHCMP(_T('e')) | EP_CHCMP(_T('i')) | EP_CHCMP(_T('o')) | EP_CHCMP(_T('u')))) != 0)
			cCh = static_cast<TCHAR>(dwVal & 7) + _T('0');
		acNick[ui] = cCh;
	}
#undef EP_CHCMP

	ini.GetString(m_sNick.GetRaw(), _T("Nick"), acNick);

	CString	strBuf;

//	Get the incoming directory (default appdir\Incoming)
	strBuf.Format(_T("%sIncoming"), m_strAppDir);
	ini.GetString(m_sIncomingDir.GetRaw(), _T("IncomingDir"), strBuf);

//	Get the temp directory (default appdir\Temp)
	strBuf.Format(_T("%sTemp"), m_strAppDir);
	ini.GetString(m_sTempDir.GetRaw(), _T("TempDir"), strBuf);

//	Get the Video Player path and settings
	ini.GetString(&m_strVideoPlayer, _T("VideoPlayer"), _T(""));
	ini.GetString(&m_strVideoPlayerArgs, _T("VideoPlayerArgs"), _T(""));
	m_bBackupPreview = ini.GetBool(_T("VideoPreviewBackupped"), false);	//Cax2 string kept for compatibility with off client
	m_bPreviewSmallBlocks = ini.GetBool(_T("PreviewSmallBlocks"), false);

	// If Video Player path is invalid, try to find Media Player Classic or VLC path in the registry
	if (_taccess(m_strVideoPlayer.Trim(), 0) != 0)
	{
		HKEY	hKey;
		TCHAR	szBuf[255];
		DWORD	dwBufLen = sizeof(szBuf);
		LONG	lResult = RegOpenKeyEx(HKEY_LOCAL_MACHINE, _T("SOFTWARE\\Gabest\\Media Player Classic"), 0, KEY_QUERY_VALUE, &hKey);

		if (lResult == ERROR_SUCCESS)
		{
			lResult = RegQueryValueEx(hKey, _T("ExePath"), NULL, NULL, (LPBYTE) szBuf, &dwBufLen);
			RegCloseKey(hKey);
			if ((lResult == ERROR_SUCCESS) && (dwBufLen <= sizeof(szBuf)))
			{
				m_strVideoPlayer = szBuf;
				m_bPreviewSmallBlocks = true;
			}
		}

		if (lResult != ERROR_SUCCESS)
		{
			lResult = RegOpenKeyEx(HKEY_LOCAL_MACHINE, _T("SOFTWARE\\VideoLAN\\VLC"), 0, KEY_QUERY_VALUE, &hKey);
			if (lResult == ERROR_SUCCESS)
			{
				lResult = RegQueryValueEx(hKey, _T("InstallDir"), NULL, NULL, (LPBYTE) szBuf, &dwBufLen);
				RegCloseKey(hKey);
				if ((lResult == ERROR_SUCCESS) && (dwBufLen <= sizeof(szBuf)))
				{
					strBuf = szBuf;
					strBuf += _T("\\vlc.exe");
					m_strVideoPlayer = strBuf;
				}
			}
		}
	}

//	Get the Upload Capacity
	m_dwMaxGraphUploadRate = ValidateUpCapability(10 * ini.GetInt(_T("UploadCapacity"), PREF_DEF_UPCAP / 10));
//	Get the Download Capacity
	m_dwMaxGraphDownloadRate = ValidateDownCapability(10 * ini.GetInt(_T("DownloadCapacity"), PREF_DEF_DOWNCAP / 10));
//	Get the Upload Limit (default - pinned to Upload Capacity)
	m_dwMaxUpload = static_cast<uint32>((ini.GetDouble(_T("MaxUpload"), m_dwMaxGraphUploadRate) * 10) + 0.5);
	SetMaxUploadWithCheck(m_dwMaxUpload);
//	Get the Download limit (default - pinned to Download Capacity)
	m_dwMaxDownload = static_cast<uint32>((ini.GetDouble(_T("MaxDownload"), m_dwMaxGraphDownloadRate) * 10) + 0.5);
	SetMaxDownloadWithCheck(m_dwMaxDownload);
//	Get the Connection Limit (default - a bit less than the max the OS will support)
	m_nMaxConnections = ini.GetUInt16(_T("MaxConnections"), GetRecommendedMaxConnections());
//	Get the Dead Server Action (default 2? - non-zero indicates "remove")
	m_bRemoveDeadServers = ini.GetBool(_T("DeadServerAction"), true);

	ini.GetString(&m_strBindAddr, _T("BindAddr"), _T(""));
	m_strBindAddr.Trim();
	m_strBindAddrA = m_strBindAddr;
	m_pcBindAddr = m_strBindAddrA.IsEmpty() ? NULL : m_strBindAddr.GetString();	//if ASCII string is empty the other one is empty or bogus
	m_pcBindAddrA = m_strBindAddrA.IsEmpty() ? NULL : m_strBindAddrA.GetString();

//	Get the TCP port
	dwVal = ini.GetInt(_T("Port"), 0);
	if (dwVal == 0)
	{
	//	Value is incorrect or doesn't exist -> select random port
		do
		{
		//	Range: PREF_MIN_NEWUSER_RNDPORT + (0 .. 32767)
			dwVal = rand() + PREF_MIN_NEWUSER_RNDPORT;
		//	Exclude other default ports to avoid conflicts
		} while ((dwVal == PREF_DEF_WS_PORT) || (dwVal == PREF_DEF_MM_PORT));
	}
	m_uPort = static_cast<uint16>(dwVal);

//	Get the UDP port
	dwVal = ini.GetInt(_T("UDPPort"), ~0);
	if (dwVal == ~0)
		dwVal = m_uPort + (m_uPort & 0x1E) + 1;	//value doesn't exist -> select based on TCP port
	m_uUDPPort = static_cast<uint16>(dwVal);

//	Get Windows XP firewall ports opener
	m_bOpenPorts = ini.GetBool(_T("OpenXPFirewallPorts"), true);

	m_bUseServerAuxPort = ini.GetBool(_T("UseServerAuxPort"), false);
//	Get the Sources Per File Limit (default 400)
	m_dwMaxSourcePerFile = ini.GetInt(_T("MaxSourcesPerFile"), 400);
	if (m_dwMaxSourcePerFile < PREF_MIN_MAXFILESRC)
		m_dwMaxSourcePerFile = PREF_MIN_MAXFILESRC;
	if (m_dwMaxSourcePerFile > PREF_MAX_MAXFILESRC)
		m_dwMaxSourcePerFile = PREF_MAX_MAXFILESRC;
//	Get the Queue Size Limit (default 3 x Min Queue Size - pinned between Min Queue Size and Max Queue Size)
	m_dwQueueSize = ini.GetInt(_T("QueueSize"), 3 * MIN_QUEUE);
	if (m_dwQueueSize > MAX_QUEUE)
		m_dwQueueSize = MAX_QUEUE;
	if (m_dwQueueSize < MIN_QUEUE)
		m_dwQueueSize = MIN_QUEUE;
//	Get the See Shares setting (default Everybody)
	m_nSeeShares = (enSeeShare)ini.GetInt(_T("SeeShare"), SEE_SHARE_NOONE);
//	Default shared file permission
	dwVal = ini.GetInt(_T("FilePermission"), PERM_ALL);
	if (dwVal > PERM_NOONE)
		dwVal = PERM_ALL;
	m_byteFilePermission = static_cast<byte>(dwVal);
	m_bUsePartTraffic = ini.GetBool(_T("PartTrafficEnabled"), false);
	m_byteUpbarPartTraffic = static_cast<byte>(ini.GetInt(_T("UploadbarStyle"), 2));
	if (m_byteUpbarPartTraffic > 3)
		m_byteUpbarPartTraffic = 2;
	dwVal = ini.GetInt(_T("UploadbarColor"), 0);
	if (dwVal > 3)
		dwVal = 0;
	m_byteUpbarColorPartTraffic = static_cast<byte>(dwVal);
	m_dwTooltipDelay = ini.GetInt(_T("ToolTipDelay"), 2);
	if (m_dwTooltipDelay > 60)
		m_dwTooltipDelay = 60;
	m_nTrafficOMeterInterval = ini.GetUInt16(_T("StatGraphsInterval"), 3);
	m_nStatsInterval = ini.GetUInt16(_T("StatsInterval"), 5);
	m_iDetailColumnWidth = ini.GetInt(_T("DetailColumnWidth"), 150);
#if 1	//code left for smooth migration, delete in v1.3
	m_dwDeadServerRetries = ini.GetInt(_T("DeadServerRetries"), 1);
	m_dwDeadServerRetries = ini.GetInt(_T("DeadServerRetry"), m_dwDeadServerRetries);
#else
	m_dwDeadServerRetries = ini.GetInt(_T("DeadServerRetry"), 1);
#endif
	if (m_dwDeadServerRetries == 0)
		m_dwDeadServerRetries = 1;
	if (m_dwDeadServerRetries > PREF_MAX_DEADSRVRETRY)
		m_dwDeadServerRetries = PREF_MAX_DEADSRVRETRY;
	m_nStatsMax = ini.GetUInt16(_T("VariousStatisticsMaxValue"), 100);
	m_nStatsAverageMinutes = static_cast<byte>(ini.GetInt(_T("StatsAverageMinutes"), 5));
	if (m_nStatsAverageMinutes < 1)
		m_nStatsAverageMinutes = 5;
	m_nMaxConPerFive = ini.GetUInt16(_T("MaxConnectionsPerFiveSeconds"), GetDefaultMaxConPerFiveSecs());
	m_bShowRatesInTitle = ini.GetBool(_T("ShowRatesOnTitle"), false);

	dwVal = (IsNTBased()) ? 200 : 100;
	if (m_nMaxConPerFive > dwVal)
		m_nMaxConPerFive = static_cast<uint16>(dwVal);
	if (m_nMaxConPerFive < 5)
		m_nMaxConPerFive = 5;

	m_dwBadClientBanTime = ini.GetInt(_T("BadClientBanTime"), MIN2MS(60));
	if (m_dwBadClientBanTime > MIN2MS(PREF_MAX_MINS2BAN))
		m_dwBadClientBanTime = MIN2MS(PREF_MAX_MINS2BAN);
	if (m_dwBadClientBanTime < MIN2MS(PREF_MIN_MINS2BAN))
		m_dwBadClientBanTime = MIN2MS(PREF_MIN_MINS2BAN);

	m_dwMinRequestTime = ini.GetInt(_T("BadClientMinRequestTime"), 590000);
	if (m_dwMinRequestTime > 590000)
		m_dwMinRequestTime = 590000;
	if (m_dwMinRequestTime < 120000)
		m_dwMinRequestTime = 120000;

	dwVal = ini.GetInt(_T("BadClientMinRequestNum"), 3);
	if (dwVal < PREF_MIN_BANTIMES)
		dwVal = PREF_MIN_BANTIMES;
	if (dwVal > PREF_MAX_BANTIMES)
		dwVal = PREF_MAX_BANTIMES;
	m_byteBadClientBan = static_cast<byte>(dwVal);
	m_bBanMessageEnabled = ini.GetBool(_T("BanMessageEnabled"), false);
	m_bBanEnabled = ini.GetBool(_T("BanEnabled"), true);

	m_dwSLSOutdated = ini.GetInt(_T("SLS_WhenSourcesOutdated"), 1);
	if (m_dwSLSOutdated > PREF_MAX_FILESLSDAYS)
		m_dwSLSOutdated = PREF_MAX_FILESLSDAYS;
	if (m_dwSLSOutdated < PREF_MIN_FILESLSDAYS)
		m_dwSLSOutdated = PREF_MIN_FILESLSDAYS;

	m_dwSLSMaxSrcPerFile = ini.GetInt(_T("SLS_MaxSourcesPerFile"), 10);
	if (m_dwSLSMaxSrcPerFile > PREF_MAX_MAXFILESLS)
		m_dwSLSMaxSrcPerFile = PREF_MAX_MAXFILESLS;
	if (m_dwSLSMaxSrcPerFile < PREF_MIN_MAXFILESLS)
		m_dwSLSMaxSrcPerFile = PREF_MIN_MAXFILESLS;

	m_bSLSEnable = ini.GetBool(_T("SLS_Enable"), true);

	m_bReconnect = ini.GetBool(_T("Reconnect"), true);
	m_bUseServerPriorities = ini.GetBool(_T("Scoresystem"), true);

	m_bUAP = ini.GetBool(_T("UAP"), true);
	m_bDAP = ini.GetBool(_T("DAP"), true);
	m_bDisableXS = ini.GetBool(_T("DisableXS"), false);
	m_bStartDownloadPaused = ini.GetBool(_T("StartDownloadPaused"), false);
	m_bDownloadPausedOnComplete = ini.GetBool(_T("DownloadPausedOnComplete"), false);
	m_bResumeOtherCat = ini.GetBool(_T("ResumeOtherCat"), true);
	m_bAutoClearCompleted = ini.GetBool(_T("AutoClearCompleted"), false);
	m_nMinAutoSourcesPerFile = ini.GetInt(_T("MinAutoSourcesPerFile"), 150);
	m_nMaxAutoSourcesPerFile = ini.GetInt(_T("MaxAutoSourcesPerFile"), 800);
	m_bAutoSourcesEnabled = ini.GetBool(_T("AutoSourcesEnabled"), false);
	if (m_bAutoSourcesEnabled)
	{
		m_dwMaxSourcePerFile = m_nMinAutoSourcesPerFile;
		m_nXSUpTo = 100;
	}
	m_nMaxAutoSourcesTotal = ini.GetInt(_T("MaxAutoSourcesTotal"), 2500);
	m_nMaxAutoExchangeSources = ini.GetInt(_T("MaxAutoExchangeSources"), 400);
	m_bAutoSourcesLogEnabled = ini.GetBool(_T("AutoSourcesLogEnabled"), false);
	m_bClientTransferLogEnabled = ini.GetBool(_T("ClientTransferLogEnabled"), true);

	ini.GetString(m_sToolbarSettings.GetRaw(), _T("ToolbarSettings"), GetDefaultToolbarSettings());
	ini.GetString(m_sToolbarBitmap.GetRaw(), _T("ToolbarBitmap"), _T(""));
	ini.GetString(m_sToolbarBitmapFolder.GetRaw(), _T("ToolbarBitmapFolder"), _T(""));
	m_iToolbarLabels = ini.GetInt(_T("ToolbarLabels"), 1);
	if (static_cast<unsigned>(m_iToolbarLabels) > 2u)
		m_iToolbarLabels = 1;
	m_bAutoServerList = ini.GetBool(_T("Serverlist"), false);
	m_bUpdateNotify = ini.GetBool(_T("UpdateNotify"), true);
	m_bMinToTray = ini.GetBool(_T("MinimizeToTray"), true);
	m_bAddServersFromServer = ini.GetBool(_T("AddServersFromServer"), true);
	m_bAddServersFromClients = ini.GetBool(_T("AddServersFromClient"), false);
	m_bSplashScreen = ini.GetBool(_T("Splashscreen"), true);
	m_bBringToForeground = ini.GetBool(_T("BringToFront"), true);
	m_bBeepOnError = ini.GetBool(_T("BeepOnError"), true);
	m_bConfirmExit = ini.GetBool(_T("ConfirmExit"), true);
	m_bConfirmDisconnect = ini.GetBool(_T("ConfirmDisconnect"), false);
	m_bConfirmFriendDel = ini.GetBool(_T("ConfirmFriendDel"), true);
	m_bFilterBadIP = ini.GetBool(_T("FilterBadIPs"), true);
	m_bFilterServersByIP = ini.GetBool(_T("FilterServersByIP"), true);
	m_bAutoConnect = ini.GetBool(_T("Autoconnect"), false);
	m_bOnlineSig = ini.GetBool(_T("OnlineSignature"), false);
	m_bStartMinimized = ini.GetBool(_T("StartupMinimized"), false);
	m_bShowToolbarSpeedMeter = ini.GetBool(_T("ToolbarSpeedMeter"), false);
	m_bShowCountryFlag = ini.GetBool(_T("CountryFlag"), true);
	m_bCloseToTray = ini.GetBool(_T("CloseToTray"), false);
	m_bDetailsOnClick = ini.GetBool(_T("DetailsOnClick"), false);

	CCat::SetAllCatType(static_cast<_EnumCategories>(ini.GetInt(_T("AllCatType"), CAT_ALL)));

	m_nSrvConTimeout = ini.GetInt(_T("SrvConTimeout"), SEC2MS(20));
	if (m_nSrvConTimeout < SEC2MS(PREF_MIN_SRVCONNTIMEOUT))
		m_nSrvConTimeout = SEC2MS(PREF_MIN_SRVCONNTIMEOUT);
	if (m_nSrvConTimeout > SEC2MS(PREF_MAX_SRVCONNTIMEOUT))
		m_nSrvConTimeout = SEC2MS(PREF_MAX_SRVCONNTIMEOUT);

	m_dwSlowCompleteBlockSize = ini.GetInt(_T("SlowCompleteBlockSize"), 32);
	if (m_dwSlowCompleteBlockSize < PREF_MIN_COMPLETEBLOCKSZ)
		m_dwSlowCompleteBlockSize = PREF_MIN_COMPLETEBLOCKSZ;
	if (m_dwSlowCompleteBlockSize > PREF_MAX_COMPLETEBLOCKSZ)
		m_dwSlowCompleteBlockSize = PREF_MAX_COMPLETEBLOCKSZ;

	m_bAutoConnectStaticOnly = ini.GetBool(_T("AutoConnectStaticOnly"), false);
	m_byteDepth3D = static_cast<byte>(ini.GetInt(_T("3DDepth"), 0));
	if ((m_byteDepth3D > 5) && (m_byteDepth3D < 251))	//check for possible values
		m_byteDepth3D = 0;

	m_bUseDownloadAddNotifier = ini.GetBool(_T("NotifyOnDownloadAdd"), false);
	m_bUseDownloadNotifier = ini.GetBool(_T("NotifyOnDownload"), false);
	m_bUseChatNotifier = ini.GetBool(_T("NotifyOnChat"), false);
	m_bUseLogNotifier = ini.GetBool(_T("NotifyOnLog"), false);
	m_bUseSoundInNotifier = ini.GetBool(_T("NotifierUseSound"), false);
	m_bUseSchedulerNotifier = ini.GetBool(_T("NotifierUseScheduler"), false);
	m_bNotifierPopsEveryChatMsg = ini.GetBool(_T("NotifierPopEveryChatMessage"), false);
	m_bNotifierImportantError = ini.GetBool(_T("NotifyOnImportantError"), false);
	m_bNotifierWebServerError = ini.GetBool(_T("NotifyOnWebServerError"), false);
	m_bNotifierServerError = ini.GetBool(_T("NotifyOnServerError"), false);
	ini.GetString(m_sNotifierSoundFilePath.GetRaw(), _T("NotifierSoundPath"), _T(""));

	ini.GetString(m_sIRCServer.GetRaw(), _T("IRCServer"), _T("irc.emuleplus.info"));
	ini.GetString(m_sIRCNick.GetRaw(), _T("IRCNick"), m_sNick.Get());
	m_bIRCAddTimestamp = ini.GetBool(_T("IRCAddTimestamp"), true);
	ini.GetString(m_sIRCChanNameFilter.GetRaw(), _T("IRCFilterName"), _T(""));
	m_bIRCUseChanFilter = ini.GetBool(_T("IRCUseFilter"), false);
	m_nIRCChannelUserFilter = ini.GetUInt16(_T("IRCFilterUser"), 0);
	ini.GetString(m_sIRCPerformString.GetRaw(), _T("IRCPerformString"), _T("/join #emule+"));
	m_bIRCUsePerform = ini.GetBool(_T("IRCUsePerform"), true);
	m_bIRCListOnConnect = ini.GetBool(_T("IRCListOnConnect"), true);
	m_bIRCIgnoreInfoMessage = ini.GetBool(_T("IRCIgnoreInfoMessage"), false);
	m_bIRCMessageEncodingUTF8 = ini.GetBool(_T("IRCMessageEncodingUTF8"), false);
	m_bIRCStripColor = ini.GetBool(_T("IRCStripColor"), false);

	m_bSmartIdCheck = ini.GetBool(_T("SmartIdCheck"), true);
	m_bVerbose = ini.GetBool(_T("Verbose"), false);
	m_bManuallyAddedServerHighPrio = ini.GetBool(_T("ManualHighPrio"), false);
	m_bShowOverhead = ini.GetBool(_T("ShowOverhead"), true);

	ini.GetString(&m_strTxtEditor, _T("TxtEditor"), _T("notepad.exe"));
	ini.GetString(&m_strMessageFilter, _T("MessageFilter"), _T("Defcon|Your client has an infinite queue"));
	ini.GetString(m_sCommentFilter.GetRaw(), _T("CommentFilter"), _T("http://www.|emulespeedup|fastest eMule ever|emule pro version"));
//	Update current user value with new tokens
//	NB! update value shouldn't be used for more than 2 releases (one is the best)
	ini.GetString(&m_strCommentFilterUpd, _T("CommentFilterUpd"), _T(""));
	UpdateUserStrList(m_sCommentFilter.GetRaw(), &m_strCommentFilterUpd, EP_PREFUPD_COMMENT_FILTER);
	m_bShowRatingIcons = ini.GetBool(_T("ShowRatingIcons"), true);

	m_bUseSort = ini.GetBool(_T("UseSortingDefaults"), true);
	m_bUseSrcSortCol2 = ini.GetBool(_T("Use2ndSortSources"), false);
	m_bPausedStoppedLast = ini.GetBool(_T("PausedStoppedLast"), false);
	m_uiServerSortCol = ini.GetInt(_T("SortServersCode"), SRVCOL_SERVERNAME);
	if ((m_uiServerSortCol & MLC_COLUMNMASK) >= SRVCOL_NUMCOLUMNS)
		m_uiServerSortCol = SRVCOL_SERVERNAME;
	m_uiUploadSortCol = ini.GetInt(_T("SortUploadsCode"), MLC_SORTDESC | ULCOL_UPLOADTIME);
	if ((m_uiUploadSortCol & MLC_COLUMNMASK) >= ULCOL_NUMCOLUMNS)
		m_uiUploadSortCol = MLC_SORTDESC | ULCOL_UPLOADTIME;
	m_uiQueueSortCol = ini.GetInt(_T("SortQueueCode"), MLC_SORTDESC | QLCOL_QLRATING);
	if ((m_uiQueueSortCol & MLC_COLUMNMASK) >= QLCOL_NUMCOLUMNS)
		m_uiQueueSortCol = MLC_SORTDESC | QLCOL_QLRATING;
	m_uiSearchSortCol = ini.GetInt(_T("SortSearchCode"), MLC_SORTDESC | SEARCHCOL_SOURCES);
	if ((m_uiSearchSortCol & MLC_COLUMNMASK) >= SEARCHCOL_NUMCOLUMNS)
		m_uiSearchSortCol = MLC_SORTDESC | SEARCHCOL_SOURCES;
	m_uiIRCSortCol = ini.GetInt(_T("SortIrcCode"), IRC2COL_NAME);
	if ((m_uiIRCSortCol & MLC_COLUMNMASK) >= IRC2COL_NUMCOLUMNS)
		m_uiIRCSortCol = IRC2COL_NAME;
	m_uiFileSortCol = ini.GetInt(_T("SortFilesCode"), SFLCOL_FILENAME);
	if ((m_uiFileSortCol & MLC_COLUMNMASK) >= SFLCOL_NUMCOLUMNS)
		m_uiFileSortCol = SFLCOL_FILENAME;
	m_uiClientListSortCol = ini.GetInt(_T("SortClientListCode"), CLCOL_USERNAME);
	if ((m_uiClientListSortCol & MLC_COLUMNMASK) >= CLCOL_NUMCOLUMNS)
		m_uiClientListSortCol = CLCOL_USERNAME;
	m_uiDownloadSortCol = ini.GetInt(_T("SortDownloadsCode"), DLCOL_STATUS);
	if ((m_uiDownloadSortCol & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_uiDownloadSortCol = DLCOL_STATUS;
	m_uiSrcSortCol1 = ini.GetInt(_T("1stSortSourcesCode"), DLCOL_PRIORITY);
	if ((m_uiSrcSortCol1 & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_uiSrcSortCol1 = DLCOL_PRIORITY;
	m_uiSrcSortCol2 = ini.GetInt(_T("2ndSortSourcesCode"), DLCOL_FILENAME);
	if ((m_uiSrcSortCol2 & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_uiSrcSortCol2 = DLCOL_FILENAME;

	m_bCommunityEnabled = ini.GetBool(_T("CommunityEnabled"), false);
	ini.GetString(m_sCommunityString.GetRaw(), _T("CommunityString"), _T(""));
	m_bCommunityNoBan = ini.GetBool(_T("CommunityNoBan"), false);
	m_nNotificationDisplayTime = ini.GetInt(_T("NotificationDisplayTime"), 4000);
	m_nNotificationFontSize = ini.GetInt(_T("NotificationFontSize"), 70);
	m_uiProfile = ini.GetInt(_T("Profile"), 0);
	if (m_uiProfile > 11)
		m_uiProfile = 0;
	m_nPriorityHigh = static_cast<uint16>(ini.GetInt(_T("PriorityHigh"), PREF_DEF_DLSRC4HIGHPRIO));
	m_nPriorityLow = static_cast<uint16>(ini.GetInt(_T("PriorityLow"), PREF_DEF_DLSRC4LOWPRIO));
	if (m_nPriorityLow < m_nPriorityHigh)
	{
		m_nPriorityLow = m_nPriorityHigh * 2;
		if (m_nPriorityLow <= m_nPriorityHigh)	// high value is too big
			m_nPriorityHigh = 0;
	}
	if (m_nPriorityHigh == 0)
	{
		m_nPriorityLow = PREF_DEF_DLSRC4LOWPRIO;
		m_nPriorityHigh = PREF_DEF_DLSRC4HIGHPRIO;
	}
	m_bRestartWaiting = ini.GetBool(_T("RestartWaiting"), true);
	m_bLogToFile = ini.GetBool(_T("LogToFile"), false);
	m_bLogUploadToFile = ini.GetBool(_T("LogUploadToFile"), false);
	m_bLogDownloadToFile = ini.GetBool(_T("LogDownloadToFile"), false);
	m_bBugReport = ini.GetBool(_T("BugReport"), false);
	m_bAllowLocalHostIP = ini.GetBool(_T("AllowLocalHostIP"), false);
	m_bDisableXSUpTo = ini.GetBool(_T("DisableXSUpTo"), false);
	m_nXSUpTo = ini.GetUInt16(_T("XSUpTo"), uVal = GetMaxSourcePerFileSoft());
	if(m_nXSUpTo > uVal)
		m_nXSUpTo = uVal;
	ini.GetString(m_sUsedFont.GetRaw(), _T("UsedFont"), _T("MS Sans Serif"));
	m_nFontSize = static_cast<byte>(ini.GetInt(_T("FontSize"), 80));
	m_HashingPriority = (enHashPriority)ini.GetInt(_T("HashingPriority"), 2);
	m_bUploadParts = ini.GetBool(_T("UploadParts"), false);
	m_bA4AFStringEnabled = ini.GetBool(_T("A4AFStringEnabled"), false);
	m_bA4AFCountEnabled = ini.GetBool(_T("A4AFCountEnabled"), false);
	m_bBanMessageEnabled = ini.GetBool(_T("BanMessageEnabled"), false);
	m_dwSearchMethod = ini.GetInt(_T("SearchMethod"), EP_SEARCHMETHOD_SERV);
	if (m_dwSearchMethod >= EP_SEARCHMETHOD_COUNT)
		m_dwSearchMethod = EP_SEARCHMETHOD_SERV;
	m_bKeepSearchHistory = ini.GetBool(_T("KeepSearchHistory"), true);
	m_bAutoTakeLinks = ini.GetBool(_T("AutoTakeED2KLinks"), false);
#if 1	//code left for smooth migration, delete in v1.3
	m_dwFileBufferSize = ini.GetInt(_T("FileBufferSizePref"), 35);
	m_dwFileBufferSize *= 30000;	// old eMule Plus setting was in 30000 byte blocks
	m_dwFileBufferSize = ini.GetInt(_T("FileBufferSize"), m_dwFileBufferSize);
#else
	m_dwFileBufferSize = ini.GetInt(_T("FileBufferSize"), 1024 * 1024);	// 1MB
#endif
	m_dwFileBufferSize &= ~(32 * 1024 - 1);	// internally size is kept with 32KB granularity
//	Max size is a little bit bigger than chunk size to allow flushing of the whole chunk
	if ((m_dwFileBufferSize == 0) || (m_dwFileBufferSize > ((PARTSZ32 / (32u * 1024u) + 1u) * 32u * 1024u)))
		m_dwFileBufferSize = 1024 * 1024;
	m_nMainProcessPriority = ini.GetInt(_T("MainProcessPriority"), 0);
	m_bShowAverageDataRate = ini.GetBool(_T("ShowAverageDataRate"), false);
	m_bLimitlessDownload = ini.GetBool(_T("LimitlessDownload"), false);

	m_bSCHEnabled = ini.GetBool(_T("SCHEnabled"), false);
	m_bSCHExceptMon = ini.GetBool(_T("SCHExceptMon"), false);
	m_bSCHExceptTue = ini.GetBool(_T("SCHExceptTue"), false);
	m_bSCHExceptWed = ini.GetBool(_T("SCHExceptWed"), false);
	m_bSCHExceptThu = ini.GetBool(_T("SCHExceptThu"), false);
	m_bSCHExceptFri = ini.GetBool(_T("SCHExceptFri"), false);
	m_bSCHExceptSat = ini.GetBool(_T("SCHExceptSat"), true);
	m_bSCHExceptSun = ini.GetBool(_T("SCHExceptSun"), true);
	m_nSCHShift1 = ini.GetInt(_T("SCHShift1"),64800);
	m_nSCHShift2 = ini.GetInt(_T("SCHShift2"),21600);
	m_uSCHShift1Upload = static_cast<uint16>((ini.GetDouble(_T("SCHShift1Up"), m_dwMaxGraphUploadRate) * 10) + 0.5);
	if (m_uSCHShift1Upload < 10)
		m_uSCHShift1Upload = 10;
	if(m_uSCHShift1Upload > m_dwMaxGraphUploadRate)
		m_uSCHShift1Upload = static_cast<uint16>(m_dwMaxGraphUploadRate);
	m_uSCHShift1Download = static_cast<uint16>((ini.GetDouble(_T("SCHShift1Down"), m_dwMaxGraphDownloadRate) * 10) + 0.5);
	if (m_uSCHShift1Download < 10)
		m_uSCHShift1Download = 10;
	if(m_uSCHShift1Download > m_dwMaxGraphDownloadRate)
		m_uSCHShift1Download = static_cast<uint16>(m_dwMaxGraphDownloadRate);
	m_nSCHShift1conn = ini.GetUInt16(_T("SCHShift1Conn"), 512);
	m_nSCHShift15sec = ini.GetUInt16(_T("SCHShift15sec"), 40);
	m_uSCHShift2Upload = static_cast<uint16>((ini.GetDouble(_T("SCHShift2Up"), m_dwMaxGraphUploadRate) * 10) + 0.5);
	if (m_uSCHShift2Upload < 10)
		m_uSCHShift2Upload = 10;
	if(m_uSCHShift2Upload > m_dwMaxGraphUploadRate)
		m_uSCHShift2Upload = (uint16)m_dwMaxGraphUploadRate;
	m_uSCHShift2Download = static_cast<uint16>((ini.GetDouble(_T("SCHShift2Down"), m_dwMaxGraphDownloadRate) * 10) + 0.5);
	if (m_uSCHShift2Download < 10)
		m_uSCHShift2Download = 10;
	if(m_uSCHShift2Download > m_dwMaxGraphDownloadRate)
		m_uSCHShift2Download = (uint16)m_dwMaxGraphDownloadRate;

	m_nSCHShift2conn = ini.GetUInt16(_T("SCHShift2Conn"), 256);
	m_nSCHShift25sec = ini.GetUInt16(_T("SCHShift25sec"), 20);
	m_bShowFileTypeIcon = ini.GetBool(_T("ShowFileTypeIcon"), true);

	m_bMultiple = ini.GetBool(_T("MultipleInstances"), false);

	ini.GetArray(m_auDownloadColumnWidths, ARRSIZE(m_auDownloadColumnWidths), _T("DownloadColumnWidths"));
	ini.GetArray(m_abDownloadColumnHidden, ARRSIZE(m_abDownloadColumnHidden), _T("DownloadColumnHidden"));
	ini.GetArray(m_aiDownloadColumnOrder, ARRSIZE(m_aiDownloadColumnOrder), _T("DownloadColumnOrder"));
	ini.GetArray(m_auUploadColumnWidths, ARRSIZE(m_auUploadColumnWidths), _T("UploadColumnWidths"));
	ini.GetArray(m_abUploadColumnHidden, ARRSIZE(m_abUploadColumnHidden), _T("UploadColumnHidden"));
	ini.GetArray(m_aiUploadColumnOrder, ARRSIZE(m_aiUploadColumnOrder), _T("UploadColumnOrder"));
	ini.GetArray(m_auQueueColumnWidths, ARRSIZE(m_auQueueColumnWidths), _T("QueueColumnWidths"));
	ini.GetArray(m_abQueueColumnHidden, ARRSIZE(m_abQueueColumnHidden), _T("QueueColumnHidden"));
	ini.GetArray(m_aiQueueColumnOrder, ARRSIZE(m_aiQueueColumnOrder), _T("QueueColumnOrder"));
	ini.GetArray(m_auSearchColumnWidths, ARRSIZE(m_auSearchColumnWidths), _T("SearchColumnWidths"));
	ini.GetArray(m_abSearchColumnHidden, ARRSIZE(m_abSearchColumnHidden), _T("SearchColumnHidden"));
	ini.GetArray(m_aiSearchColumnOrder, ARRSIZE(m_aiSearchColumnOrder), _T("SearchColumnOrder"));
	ini.GetArray(m_auSharedColumnWidths, ARRSIZE(m_auSharedColumnWidths), _T("SharedColumnWidths"));
	ini.GetArray(m_abSharedColumnHidden, ARRSIZE(m_abSharedColumnHidden), _T("SharedColumnHidden"));
	ini.GetArray(m_aiSharedColumnOrder, ARRSIZE(m_aiSharedColumnOrder), _T("SharedColumnOrder"));
	ini.GetArray(m_auServerColumnWidths, ARRSIZE(m_auServerColumnWidths), _T("ServerColumnWidths"));
	ini.GetArray(m_abServerColumnHidden, ARRSIZE(m_abServerColumnHidden), _T("ServerColumnHidden"));
	ini.GetArray(m_aiServerColumnOrder, ARRSIZE(m_aiServerColumnOrder), _T("ServerColumnOrder"));
	ini.GetArray(m_auIrcNickColumnWidths, ARRSIZE(m_auIrcNickColumnWidths), _T("IrcNickColumnWidths"));
	ini.GetArray(m_abIrcNickColumnHidden, ARRSIZE(m_abIrcNickColumnHidden), _T("IrcNickColumnHidden"));
	ini.GetArray(m_aiIrcNickColumnOrder, ARRSIZE(m_aiIrcNickColumnOrder), _T("IrcNickColumnOrder"));
	ini.GetArray(m_auIrcColumnWidths, ARRSIZE(m_auIrcColumnWidths), _T("IrcColumnWidths"));
	ini.GetArray(m_abIrcColumnHidden, ARRSIZE(m_abIrcColumnHidden), _T("IrcColumnHidden"));
	ini.GetArray(m_aiIrcColumnOrder, ARRSIZE(m_aiIrcColumnOrder), _T("IrcColumnOrder"));
	ini.GetArray(m_auClientListColumnWidths, ARRSIZE(m_auClientListColumnWidths), _T("ClientListColumnWidths"));
	ini.GetArray(m_abClientListColumnHidden, ARRSIZE(m_abClientListColumnHidden), _T("ClientListColumnHidden"));
	ini.GetArray(m_aiClientListColumnOrder, ARRSIZE(m_aiClientListColumnOrder), _T("ClientListColumnOrder"));
	ini.GetArray(m_auPartStatusColumnWidths, ARRSIZE(m_auPartStatusColumnWidths), _T("PartStatusColumnWidths"));
	ini.GetArray(m_abPartStatusColumnHidden, ARRSIZE(m_abPartStatusColumnHidden), _T("PartStatusColumnHidden"));
	ini.GetArray(m_aiPartStatusColumnOrder, ARRSIZE(m_aiPartStatusColumnOrder), _T("PartStatusColumnOrder"));
	ini.GetArray(m_auFriendColumnWidths, ARRSIZE(m_auFriendColumnWidths), _T("FriendColumnWidths"));
	ini.GetArray(m_abFriendColumnHidden, ARRSIZE(m_abFriendColumnHidden), _T("FriendColumnHidden"));
	ini.GetArray(m_aiFriendColumnOrder, ARRSIZE(m_aiFriendColumnOrder), _T("FriendColumnOrder"));
	ini.GetArray(m_auSrcFileNameColumnWidths, ARRSIZE(m_auSrcFileNameColumnWidths), _T("SrcFileNameColumnWidths"));
	ini.GetArray(m_abSrcFileNameColumnHidden, ARRSIZE(m_abSrcFileNameColumnHidden), _T("SrcFileNameColumnHidden"));
	ini.GetArray(m_aiSrcFileNameColumnOrder, ARRSIZE(m_aiSrcFileNameColumnOrder), _T("SrcFileNameColumnOrder"));

//	Provide a mechanism for all tables to store/retrieve sort order
#if 1 //code left for smooth migration, delete in v1.3a
	m_auiSortItem[TABLE_DOWNLOAD] = ini.GetInt(_T("TableSortItemDownload"), DLCOL_STATUS);
	if (m_auiSortItem[TABLE_DOWNLOAD] >= DLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_DOWNLOAD] = DLCOL_STATUS;
	m_auiSortItem[TABLE_DOWNLOAD2] = ini.GetInt(_T("TableSortItemDownload2"), DLCOL_PRIORITY);
	if (m_auiSortItem[TABLE_DOWNLOAD2] >= DLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_DOWNLOAD2] = DLCOL_PRIORITY;
	m_auiSortItem[TABLE_UPLOAD] = ini.GetInt(_T("TableSortItemUpload"), ULCOL_UPLOADTIME);
	if (m_auiSortItem[TABLE_UPLOAD] >= ULCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_UPLOAD] = ULCOL_UPLOADTIME;
	m_auiSortItem[TABLE_QUEUE] = ini.GetInt(_T("TableSortItemQueue"), QLCOL_QLRATING);
	if (m_auiSortItem[TABLE_QUEUE] >= QLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_QUEUE] = QLCOL_QLRATING;
	m_auiSortItem[TABLE_SEARCH] = ini.GetInt(_T("TableSortItemSearch"), SEARCHCOL_SOURCES);
	m_auiSortItem[TABLE_SEARCH] &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_auiSortItem[TABLE_SEARCH] & MLC_COLUMNMASK) >= SEARCHCOL_NUMCOLUMNS)	//allow to save alternate criterion
		m_auiSortItem[TABLE_SEARCH] = SEARCHCOL_SOURCES;
	m_auiSortItem[TABLE_SHARED] = ini.GetInt(_T("TableSortItemShared"), SFLCOL_FILENAME);
	m_auiSortItem[TABLE_SHARED] &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_auiSortItem[TABLE_SHARED] & MLC_COLUMNMASK) >= SFLCOL_NUMCOLUMNS)	//allow to save alternate criterion
		m_auiSortItem[TABLE_SHARED] = SFLCOL_FILENAME;
	m_auiSortItem[TABLE_SERVER] = ini.GetInt(_T("TableSortItemServer"), SRVCOL_SERVERNAME);
	m_auiSortItem[TABLE_SERVER] &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_auiSortItem[TABLE_SERVER] & MLC_COLUMNMASK) >= SRVCOL_NUMCOLUMNS)	//allow to save alternate criterion
		m_auiSortItem[TABLE_SERVER] = SRVCOL_SERVERNAME;
	m_auiSortItem[TABLE_IRCNICK] = ini.GetInt(_T("TableSortItemIRCNicks"), IRC1COL_STATUS);
	if (m_auiSortItem[TABLE_IRCNICK] >= IRC1COL_NUMCOLUMNS)
		m_auiSortItem[TABLE_IRCNICK] = IRC1COL_STATUS;
	m_auiSortItem[TABLE_IRC] = ini.GetInt(_T("TableSortItemIRCChannel"), IRC2COL_NAME);
	if (m_auiSortItem[TABLE_IRC] >= IRC2COL_NUMCOLUMNS)
		m_auiSortItem[TABLE_IRC] = IRC2COL_NAME;
	m_auiSortItem[TABLE_CLIENTLIST] = ini.GetInt(_T("TableSortItemClientList"), CLCOL_USERNAME);
	if (m_auiSortItem[TABLE_CLIENTLIST] >= CLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_CLIENTLIST] = CLCOL_USERNAME;
	m_auiSortItem[TABLE_PARTSTATUS] = ini.GetInt(_T("TableSortItemPartStatus"), FDPARTSCOL_NUMBER);
	m_auiSortItem[TABLE_PARTSTATUS] &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_auiSortItem[TABLE_PARTSTATUS] & MLC_COLUMNMASK) >= FDPARTSCOL_NUMCOLUMNS)	//allow to save alternate criterion
		m_auiSortItem[TABLE_PARTSTATUS] = FDPARTSCOL_NUMBER;
	m_auiSortItem[TABLE_FRIENDLIST] = ini.GetInt(_T("TableSortItemFriend"), FRIENDCOL_USERNAME);
	if (m_auiSortItem[TABLE_FRIENDLIST] >= FRIENDCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_FRIENDLIST] = FRIENDCOL_USERNAME;
#else
	for (unsigned ui = 0; ui < TABLE_COUNT; ui++)
	{
		m_auiSortItem[ui] = ini.GetInt(s_aSortItems[ui].pcIniName, s_aSortItems[ui].uiDef);
		if (m_auiSortItem[ui] >= s_aSortItems[ui].uiMax)
			m_auiSortItem[ui] = s_aSortItems[ui].uiDef;
	}
#endif
	ini.GetArray(m_abyteSortAscendingDownload, ARRSIZE(m_abyteSortAscendingDownload), _T("SortAscendingDownload"), s_abyteDownloadListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingDownload2, ARRSIZE(m_abyteSortAscendingDownload2), _T("SortAscendingDownload2"), s_abyteDownloadListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingUpload, ARRSIZE(m_abyteSortAscendingUpload), _T("SortAscendingUpload"), s_abyteUploadListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingQueue, ARRSIZE(m_abyteSortAscendingQueue), _T("SortAscendingQueue"), s_abyteQueueListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingSearch, ARRSIZE(m_abyteSortAscendingSearch), _T("SortAscendingSearch"), s_abyteSearchListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingShared, ARRSIZE(m_abyteSortAscendingShared), _T("SortAscendingShared"), s_abyteSharedListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingServer, ARRSIZE(m_abyteSortAscendingServer), _T("SortAscendingServer"), s_abyteSrvListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingIRCNick, ARRSIZE(m_abyteSortAscendingIRCNick), _T("SortAscendingIRCNick"), s_abyteIRCNickListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingIRCChannel, ARRSIZE(m_abyteSortAscendingIRCChannel), _T("SortAscendingIRCChannel"), s_abyteIRCChannelListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingClients, ARRSIZE(m_abyteSortAscendingClients), _T("SortAscendingClients"), s_abyteClientsListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingPartStatus, ARRSIZE(m_abyteSortAscendingPartStatus), _T("SortAscendingPartStatus"), s_abyteFDPartsListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingFriend, ARRSIZE(m_abyteSortAscendingFriend), _T("SortAscendingFriend"), s_abyteFriendListDefSortAscending);
	ini.GetArray(m_abyteSortAscendingSrcFileName, ARRSIZE(m_abyteSortAscendingSrcFileName), _T("SortAscendingSrcFileName"), s_abyteFDSrcFNameListDefSortAscending);
#if 1 //code left for smooth migration, delete in v1.3a
	if(m_auiSortItem[TABLE_SEARCH] & MLC_SORTALT) {
		m_abyteSortAscendingSearch[m_auiSortItem[TABLE_SEARCH] & MLC_COLUMNMASK] |= 2;
		m_auiSortItem[TABLE_SEARCH] &= ~MLC_SORTALT;
	}
	if(m_auiSortItem[TABLE_SHARED] & MLC_SORTALT) {
		m_abyteSortAscendingShared[m_auiSortItem[TABLE_SHARED] & MLC_COLUMNMASK] |= 2;
		m_auiSortItem[TABLE_SHARED] &= ~MLC_SORTALT;
	}
	if(m_auiSortItem[TABLE_SERVER] & MLC_SORTALT) {
		m_abyteSortAscendingServer[m_auiSortItem[TABLE_SERVER] & MLC_COLUMNMASK] |= 2;
		m_auiSortItem[TABLE_SERVER] &= ~MLC_SORTALT;
	}
	if(m_auiSortItem[TABLE_PARTSTATUS] & MLC_SORTALT) {
		m_abyteSortAscendingPartStatus[m_auiSortItem[TABLE_PARTSTATUS] & MLC_COLUMNMASK] |= 2;
		m_auiSortItem[TABLE_PARTSTATUS] &= ~MLC_SORTALT;
	}

	m_abyteSortAscendingDownload[m_auiSortItem[TABLE_DOWNLOAD]] |= (byte)ini.GetBool(_T("TableSortAscendingDownload"), true);
	m_abyteSortAscendingDownload2[m_auiSortItem[TABLE_DOWNLOAD2]] |= (byte)ini.GetBool(_T("TableSortAscendingDownload2"), true);
	m_abyteSortAscendingUpload[m_auiSortItem[TABLE_UPLOAD]] |= (byte)ini.GetBool(_T("TableSortAscendingUpload"), true);
	m_abyteSortAscendingQueue[m_auiSortItem[TABLE_QUEUE]] |= (byte)ini.GetBool(_T("TableSortAscendingQueue"), true);
	m_abyteSortAscendingSearch[m_auiSortItem[TABLE_SEARCH]] |= (byte)ini.GetBool(_T("TableSortAscendingSearch"), true);
	m_abyteSortAscendingShared[m_auiSortItem[TABLE_SHARED]] |= (byte)ini.GetBool(_T("TableSortAscendingShared"), true);
	m_abyteSortAscendingServer[m_auiSortItem[TABLE_SERVER]] |= (byte)ini.GetBool(_T("TableSortAscendingServer"), true);
	m_abyteSortAscendingIRCNick[m_auiSortItem[TABLE_IRCNICK]] |= (byte)ini.GetBool(_T("TableSortAscendingIRCNick"), true);
	m_abyteSortAscendingIRCChannel[m_auiSortItem[TABLE_IRC]] |= (byte)ini.GetBool(_T("TableSortAscendingIRCChannel"), true);
	m_abyteSortAscendingClients[m_auiSortItem[TABLE_CLIENTLIST]] |= (byte)ini.GetBool(_T("TableSortAscendingClientList"), true);
	m_abyteSortAscendingPartStatus[m_auiSortItem[TABLE_PARTSTATUS]] |= (byte)ini.GetBool(_T("TableSortAscendingPartStatus"), true);
	m_abyteSortAscendingFriend[m_auiSortItem[TABLE_FRIENDLIST]] |= (byte)ini.GetBool(_T("TableSortAscendingFriend"), true);

	m_auiSortItem[TABLE_DOWNLOAD] = ini.GetInt(_T("SortItemDownload"), m_auiSortItem[TABLE_DOWNLOAD]);
	if (m_auiSortItem[TABLE_DOWNLOAD] >= DLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_DOWNLOAD] = DLCOL_STATUS;
	m_auiSortItem[TABLE_DOWNLOAD2] = ini.GetInt(_T("SortItemDownload2"), m_auiSortItem[TABLE_DOWNLOAD2]);
	if (m_auiSortItem[TABLE_DOWNLOAD2] >= DLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_DOWNLOAD2] = DLCOL_PRIORITY;
	m_auiSortItem[TABLE_UPLOAD] = ini.GetInt(_T("SortItemUpload"), m_auiSortItem[TABLE_UPLOAD]);
	if (m_auiSortItem[TABLE_UPLOAD] >= ULCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_UPLOAD] = ULCOL_UPLOADTIME;
	m_auiSortItem[TABLE_QUEUE] = ini.GetInt(_T("SortItemQueue"), m_auiSortItem[TABLE_QUEUE]);
	if (m_auiSortItem[TABLE_QUEUE] >= QLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_QUEUE] = QLCOL_QLRATING;
	m_auiSortItem[TABLE_SEARCH] = ini.GetInt(_T("SortItemSearch"), m_auiSortItem[TABLE_SEARCH]);
	if (m_auiSortItem[TABLE_SEARCH] >= SEARCHCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_SEARCH] = SEARCHCOL_SOURCES;
	m_auiSortItem[TABLE_SHARED] = ini.GetInt(_T("SortItemShared"), m_auiSortItem[TABLE_SHARED]);
	if (m_auiSortItem[TABLE_SHARED] >= SFLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_SHARED] = SFLCOL_FILENAME;
	m_auiSortItem[TABLE_SERVER] = ini.GetInt(_T("SortItemServer"), m_auiSortItem[TABLE_SERVER]);
	if (m_auiSortItem[TABLE_SERVER] >= SRVCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_SERVER] = SRVCOL_SERVERNAME;
	m_auiSortItem[TABLE_IRCNICK] = ini.GetInt(_T("SortItemIRCNicks"), m_auiSortItem[TABLE_IRCNICK]);
	if (m_auiSortItem[TABLE_IRCNICK] >= IRC1COL_NUMCOLUMNS)
		m_auiSortItem[TABLE_IRCNICK] = IRC1COL_STATUS;
	m_auiSortItem[TABLE_IRC] = ini.GetInt(_T("SortItemIRCChannel"), m_auiSortItem[TABLE_IRC]);
	if (m_auiSortItem[TABLE_IRC] >= IRC2COL_NUMCOLUMNS)
		m_auiSortItem[TABLE_IRC] = IRC2COL_NAME;
	m_auiSortItem[TABLE_CLIENTLIST] = ini.GetInt(_T("SortItemClients"), m_auiSortItem[TABLE_CLIENTLIST]);
	if (m_auiSortItem[TABLE_CLIENTLIST] >= CLCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_CLIENTLIST] = CLCOL_USERNAME;
	m_auiSortItem[TABLE_PARTSTATUS] = ini.GetInt(_T("SortItemPartStatus"), m_auiSortItem[TABLE_PARTSTATUS]);
	if (m_auiSortItem[TABLE_PARTSTATUS] >= FDPARTSCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_PARTSTATUS] = FDPARTSCOL_NUMBER;
	m_auiSortItem[TABLE_FRIENDLIST] = ini.GetInt(_T("SortItemFriend"), m_auiSortItem[TABLE_FRIENDLIST]);
	if (m_auiSortItem[TABLE_FRIENDLIST] >= FRIENDCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_FRIENDLIST] = FRIENDCOL_USERNAME;
	m_auiSortItem[TABLE_SRCFILENAME] = ini.GetInt(_T("SortItemSrcFileName"), FDSRCCOL_SOURCES);
	if (m_auiSortItem[TABLE_SRCFILENAME] >= FDSRCCOL_NUMCOLUMNS)
		m_auiSortItem[TABLE_SRCFILENAME] = FDSRCCOL_SOURCES;
#endif

	for (unsigned ui = 0; ui < ARRSIZE(m_dwStatColors); ui++)
	{
		strBuf.Format(_T("StatColor%u"), ui);
		m_dwStatColors[ui] = ini.GetUInt32(strBuf, ~0ul);
		if (m_dwStatColors[ui] == ~0)
			m_dwStatColors[ui] = GetDefaultStatsColor(ui);
	}
	dwVal = ini.GetInt(_T("ConnectionsGraphRatio"), 1);
	if (((dwVal - 1u) >= 5) && (dwVal != 10) && (dwVal != 255))
		dwVal = 1;
	m_byteGraphRatio = static_cast<byte>(dwVal);
	m_bCounterMeasures = ini.GetBool(_T("MlDonkeyCM"), true);
	m_bCMNotLog = ini.GetBool(_T("CMNotLog"), false);

	m_dwServerKeepAliveTimeout = ini.GetInt(_T("ServerKeepAliveTimeout"),0);
	m_bWatchClipboard = ini.GetBool(_T("WatchClipboard4ED2kFilelinks"), false);
	m_bExportLocalizedLinks = ini.GetBool(_T("ExportLocalizedLinks"), false);

//	AutoCheck for new version
	m_bAutoCheckForNewVersion = ini.GetBool(_T("AutoCheckForNewVersion"), true);
	m_iAutoCheckLastTime = ini.GetInt(_T("AutoCheckLastTime"), 0);

//	Load hash of A4AF auto file
	ini.GetString(&strBuf, _T("A4AFAutoFileHash"), _T(""));
	StringToHash(strBuf, m_A4AF_FileHash);

//	Messaging
	m_uiAcceptMessagesFrom = ini.GetInt(_T("AcceptMessageFrom"), 1);
	if ((m_uiAcceptMessagesFrom - 1u) > 3u)
		m_uiAcceptMessagesFrom = 1;
	m_bAwayState = false;
	ini.GetString(m_sAwayStateMessage.GetRaw(), _T("AwayStateMessage"),_T(""));

	m_bScanFilter = ini.GetBool(_T("ScanFilter"), true);
	m_bFakeRxDataFilter = ini.GetBool(_T("FakeRxDataFilter"), false);
	m_bShowFullFileStatusIcons = ini.GetBool(_T("ShowFullFileStatusIcons"), true);
	m_bShowPausedGray = ini.GetBool(_T("ShowPausedGray"), false);
	m_bRoundSizes = ini.GetBool(_T("RoundSizes"), true);
	m_bTransferredOnCompleted = ini.GetBool(_T("TransferredOnCompleted"), false);
	m_bUseDwlPercentage = ini.GetBool(_T("UseDwlPercentage"), true);
	ini.GetString(m_sURLsForICC.GetRaw(), _T("URLsForICC"), _T("www.microsoft.com|www.google.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org"));
	m_byteDetailedPartsFilter = static_cast<byte>(ini.GetInt(_T("DetailedPartsFilter"), 0));

	m_nSmartFilterMaxQR = ini.GetUInt16(_T("SmartFilterMaxQueueRank"), 25);
	m_bSmartFilterShowOQ = ini.GetBool(_T("SmartFilterShowOnQueue"), false);

	m_byteIPFilterLevel = static_cast<byte>(ini.GetInt(_T("FilterLevel"), 127));
	ini.GetString(&m_strIPFilterURL, _T("UpdateURLIPFilter"), _T("http://emulepawcio.sourceforge.net/ipfilter.dat"));
#if 1	//code left for smooth migration, delete in v1.3a
	if (m_strIPFilterURL == _T("http://emulepawcio.sourceforge.net/nieuwe_site/eplus_fakes/ipfilter.dat"))
		m_strIPFilterURL = _T("http://emulepawcio.sourceforge.net/ipfilter.dat");
#endif
	m_bIPFilterUpdateOnStart	= ini.GetBool(_T("AutoUPdateIPFilter"), false);

	m_dwLastIPFilterUpdate		= ini.GetInt(_T("LastIPFilterUpdate"), 0);
	m_dwIPFilterUpdateFrequency = ini.GetInt(_T("IPFilterUpdateFrequency"), 6);
	if (m_dwIPFilterUpdateFrequency > 6)
		m_dwIPFilterUpdateFrequency = 6;

//	Antivirus
	m_bAVEnabled				= ini.GetBool(_T("AVEnabled"), false);
	ini.GetString(&m_strAVPath, _T("AVPath"), _T(""));
	ini.GetString(&m_strAVParams, _T("AVParams"), _T(""));
	m_bAVScanCompleted			= ini.GetBool(_T("AVScanCompleted"), false);

//	Splitter settings
	m_uSplitterPosFriend = ini.GetUInt16(_T("SplitterbarPositionFriend"), 240);

	ini.GetArray(&m_adRollupPos[0][0], sizeof(m_adRollupPos) / sizeof(m_adRollupPos[0][0]), _T("RollupPos"));
	ini.GetArray(m_abRollupState, ARRSIZE(m_abRollupState), _T("RollupState"));

	m_bCryptLayerRequested = ini.GetBool(_T("CryptLayerRequested"), false);
	m_bCryptLayerRequired = ini.GetBool(_T("CryptLayerRequired"), false);
#ifdef _CRYPT_READY
	m_bCryptLayerSupported = ini.GetBool(_T("CryptLayerSupported"), true);
#else
	m_bCryptLayerSupported = ini.GetBool(_T("CryptLayerSupported"), false);
#endif
	dwVal = ini.GetInt(_T("CryptTCPPaddingLength"), 128);
	m_dwCryptTCPPaddingLenMod = min(dwVal + 1, 254 + 1);

//	Proxy
	ini.SetDefaultCategory(_T("Proxy"));
	m_proxy.m_bEnablePassword = ini.GetBool(_T("EnablePassword"), false);
	m_proxy.m_bUseProxy = ini.GetBool(_T("EnableProxy"), false);
	m_proxy.m_strName = ini.GetString(_T("Name"), _T(""));
	m_proxy.m_strPassword = Decrypt(ini.GetString(_T("Password"), _T("")));
	m_proxy.m_strUser = ini.GetString(_T("User"), _T(""));
	dwVal = ini.GetInt(_T("Port"), PREF_DEF_PROXY_PORT);
	if ((dwVal - 1u) > 0xFFFEu)
		dwVal = PREF_DEF_PROXY_PORT;
	m_proxy.m_uPort = static_cast<uint16>(dwVal);

	dwVal = ini.GetInt(_T("Type"), PROXYTYPE_SOCKS4);
	if ((dwVal < PROXYTYPE_SOCKS4) || (dwVal > PROXYTYPE_HTTP11))
		dwVal = PROXYTYPE_SOCKS4;
	m_proxy.m_nType = static_cast<uint16>(dwVal);

//	WebServer
	ini.SetDefaultCategory(_T("WebServer"));
	ini.GetString(&strBuf, _T("Password"), _T(""));
	StringToHash(strBuf, m_abyteWebPassword);
	ini.GetString(&strBuf, _T("PasswordLow"), _T(""));
	StringToHash(strBuf, m_abyteLowWebPassword);
	dwVal = ini.GetInt(_T("Port"), PREF_DEF_WS_PORT);
	if ((dwVal - 1u) > 0xFFFEu)
		dwVal = PREF_DEF_WS_PORT;
	m_uWSPort = static_cast<uint16>(dwVal);
	m_bWebEnabled = ini.GetBool(_T("Enabled"), false);
	m_bWebLowEnabled = ini.GetBool(_T("EnabledLow"), false);
	m_nWebPageRefresh = ini.GetInt(_T("PageRefreshTime"), 120);
	m_bWebIntruderDetection = ini.GetBool(_T("IntruderDetection"), true);
	m_dwWebTempDisableLogin = ini.GetInt(_T("TempDisableLogin"), 30);
	if ((m_dwWebTempDisableLogin - 1u) <= (PREF_MIN_WSDISABLELOGIN - 1))	// < min & != 0
		m_dwWebTempDisableLogin = PREF_MIN_WSDISABLELOGIN;
	if (m_dwWebTempDisableLogin > PREF_MAX_WSDISABLELOGIN)
		m_dwWebTempDisableLogin = PREF_MAX_WSDISABLELOGIN;
	m_dwWSLoginAttemptsAllowed = ini.GetInt(_T("LoginAttemptsAllowed"), 3);
	if ((m_dwWSLoginAttemptsAllowed < PREF_MIN_WSBADLOGINTRIES) || (m_dwWSLoginAttemptsAllowed > PREF_MAX_WSBADLOGINTRIES))
		m_dwWSLoginAttemptsAllowed = 3;
	ini.GetString(&m_strTemplateFile, _T("WebTemplateFile"), _T("eMuleXP.tmpl"));
	m_WSPrefs.bMenuLocked = ini.GetBool(_T("MenuLocked"), false);
	m_WSPrefs.bShowUploadQueue = ini.GetBool(_T("ShowUploadQueue"), false);
	m_WSPrefs.bShowUploadQueueBanned = ini.GetBool(_T("ShowUploadQueueBanned"), false);
	m_WSPrefs.bShowUploadQueueFriend = ini.GetBool(_T("ShowUploadQueueFriend"), false);
	m_WSPrefs.bShowUploadQueueCredit = ini.GetBool(_T("ShowUploadQueueCredit"), false);
	ini.GetArray(m_WSPrefs.abDownloadColHidden, ARRSIZE(m_WSPrefs.abDownloadColHidden), _T("downloadColumnHidden"));
	ini.GetArray(m_WSPrefs.abUploadColHidden, ARRSIZE(m_WSPrefs.abUploadColHidden), _T("uploadColumnHidden"));
	ini.GetArray(m_WSPrefs.abQueueColHidden, ARRSIZE(m_WSPrefs.abQueueColHidden), _T("queueColumnHidden"));
	ini.GetArray(m_WSPrefs.abSharedColHidden, ARRSIZE(m_WSPrefs.abSharedColHidden), _T("sharedColumnHidden"));
	ini.GetArray(m_WSPrefs.abServerColHidden, ARRSIZE(m_WSPrefs.abServerColHidden), _T("serverColumnHidden"));
	ini.GetArray(m_WSPrefs.abSearchColHidden, ARRSIZE(m_WSPrefs.abSearchColHidden), _T("searchColumnHidden"));
	m_WSPrefs.dwDownloadSort = ini.GetUInt32(_T("DownloadSort"), WS_DLCOL_NAME);
	if (m_WSPrefs.dwDownloadSort >= WS_DLCOL_NUMCOLUMNS)
		m_WSPrefs.dwDownloadSort = WS_DLCOL_NAME;
	m_WSPrefs.dwUploadSort = ini.GetUInt32(_T("UploadSort"), WS_ULCOL_USER);
	if (m_WSPrefs.dwUploadSort >= WS_ULCOL_NUMCOLUMNS)
		m_WSPrefs.dwUploadSort = WS_ULCOL_USER;
	m_WSPrefs.dwQueueSort = ini.GetUInt32(_T("QueueSort"), WS_QUCOL_SCORE);
	if (m_WSPrefs.dwQueueSort >= WS_QUCOL_NUMCOLUMNS)
		m_WSPrefs.dwQueueSort = WS_QUCOL_SCORE;
	m_WSPrefs.dwSharedSort = ini.GetUInt32(_T("SharedSort"), WS_SFLCOL_NAME);
	if (m_WSPrefs.dwSharedSort >= WS_SFLCOL_NUMCOLUMNS)
		m_WSPrefs.dwSharedSort = WS_SFLCOL_NAME;
	m_WSPrefs.dwServerSort = ini.GetUInt32(_T("ServerSort"), WS_SRVCOL_NAME);
	if (m_WSPrefs.dwServerSort >= WS_SRVCOL_NUMCOLUMNS)
		m_WSPrefs.dwServerSort = WS_SRVCOL_NAME;
	m_WSPrefs.dwSearchSort = ini.GetUInt32(_T("SearchSort"), WS_SLCOL_SOURCES);
	if (m_WSPrefs.dwSearchSort >= WS_SLCOL_NUMCOLUMNS)
		m_WSPrefs.dwSearchSort = WS_SLCOL_SOURCES;
	ini.GetArray(m_WSPrefs.abDownloadSortAsc, ARRSIZE(m_WSPrefs.abDownloadSortAsc), _T("DownloadSortDir"));
	ini.GetArray(m_WSPrefs.abUploadSortAsc, ARRSIZE(m_WSPrefs.abUploadSortAsc), _T("UploadSortDir"));
	ini.GetArray(m_WSPrefs.abQueueSortAsc, ARRSIZE(m_WSPrefs.abQueueSortAsc), _T("QueueSortDir"));
	ini.GetArray(m_WSPrefs.aiSharedSortAsc, ARRSIZE(m_WSPrefs.aiSharedSortAsc), _T("SharedSortDir"));
	ini.GetArray(m_WSPrefs.abServerSortAsc, ARRSIZE(m_WSPrefs.abServerSortAsc), _T("ServerSortDir"));
	ini.GetArray(m_WSPrefs.abSearchSortAsc, ARRSIZE(m_WSPrefs.abSearchSortAsc), _T("SearchSortDir"));

//	MobileMule
	ini.SetDefaultCategory(_T("MobileMule"));
	ini.GetString(&strBuf, _T("Password"), _T(""));
	StringToHash(strBuf, m_abyteMMPassword);
	m_bMMEnabled = ini.GetBool(_T("Enabled"), false);
	dwVal = ini.GetInt(_T("Port"), PREF_DEF_MM_PORT);
	if ((dwVal - 1u) > 0xFFFEu)
		dwVal = PREF_DEF_MM_PORT;
	m_uMMPort = static_cast<uint16>(dwVal);

//	LANCAST
//	Get the Default Local IP address, using this clients hostname,
//	we will use this ip as the "default" Lancast ip, if no ip is found in the ini file.
	char	acLocalHost[255];

	gethostname(acLocalHost, 255);	// Get this clients hostname

	hostent	*pHost = gethostbyname(acLocalHost);	// Get the host info

	if (pHost != NULL)
		ipstr(&strBuf, *reinterpret_cast<in_addr*>(*pHost->h_addr_list));	// Get this clients default ip as a string
	else
		strBuf = _T("");
	ini.SetDefaultCategory(_T("Lancast"));
	m_bLancastEnabled = ini.GetBool(_T("Enabled"), false);
	m_bUseDefaultIP = ini.GetBool(_T("UseDefaultIP"), true);
	m_dwDefaultLancastIP = inet_addr(strBuf);
	m_dwLancastIP = inet_addr(ini.GetString(_T("IPAddress"), strBuf));
	ini.GetString(&strBuf, _T("Subnet"), _T("255.255.0.0"));
	m_dwLancastSubnet = inet_addr(strBuf);
	dwVal = ini.GetInt(_T("Port"), PREF_DEF_LANCAST_PORT);
	if ((dwVal - 1u) > 0xFFFEu)
		dwVal = PREF_DEF_LANCAST_PORT;
	m_uLancastPort = static_cast<uint16>(dwVal);

//	Cleanup
	ini.SetDefaultCategory(_T("Cleanup"));
	m_bAutoFilenameCleanup = ini.GetBool(_T("AutoFilenameCleanup"), false);
	m_bFilenameCleanupTags = ini.GetBool(_T("CleanupTags"), false);
	ini.GetString(m_sFilenameCleanups.GetRaw(), _T("FilenameCleanups"), _T("http|www.|sharereactor|shareconnector|sharelita|emule-island.com|sharelive|filedonkey|saugstube|eselfilme|eseldownloads|donkey-mania|emulemovies|spanishare|goldesel.6x.to|elitedivx|deviance|filenexus|ac3-guru"));
//	Update current user value with new tokens
//	NB! update value shouldn't be used for more than 2 releases (one is the best)
	ini.GetString(&m_strFilenameCleanupsUpd, _T("FilenameCleanupsUpd"), _T(""));
	UpdateUserStrList(m_sFilenameCleanups.GetRaw(), &m_strFilenameCleanupsUpd, EP_PREFUPD_FILENAME_CLEANUP);

//	SMTP
	ini.SetDefaultCategory(_T("SMTP"));
	ini.GetString(m_sSMTPServer.GetRaw(), _T("Server"), _T("smtp.server.com"));
	ini.GetString(m_sSMTPName.GetRaw(), _T("Name"), CLIENT_NAME _T(" Messenger"));
	ini.GetString(m_sSMTPFrom.GetRaw(), _T("From"), _T("messenger@@emuleplus.info"));
	ini.GetString(m_sSMTPTo.GetRaw(), _T("To"), _T("user@@domain.com"));
	ini.GetString(m_sSMTPUserName.GetRaw(), _T("UserName"), _T("username"));
	*m_sSMTPPassword.GetRaw() = Decrypt(ini.GetString(_T("Password"), Crypt(_T("password"))));
	m_bSMTPAuthenticated = ini.GetBool(_T("Authenticated"), false);
	m_bSMTPInfo = ini.GetBool(_T("Info"), false);
	m_bSMTPWarning = ini.GetBool(_T("Warning"), false);
	m_bSMTPMsgInSubj = ini.GetBool(_T("MsgInSubject"), false);

//	Backup feature
	ini.SetDefaultCategory(_T("Backup"));
	m_bDatFiles = ini.GetBool(_T("DatFiles"), false);
	m_bMetFiles = ini.GetBool(_T("MetFiles"), false);
	m_bIniFiles = ini.GetBool(_T("IniFiles"), false);
	m_bPartFiles = ini.GetBool(_T("PartFiles"), false);
	m_bPartMetFiles = ini.GetBool(_T("PartMetFiles"), false);
	m_bPartTxtsrcFiles = ini.GetBool(_T("PartTxtsrcFiles"), false);
	m_bAutoBackup = ini.GetBool(_T("AutoBackup"), true);
	m_bBackupOverwrite = ini.GetBool(_T("BackupOverwrite"), true);
	strBuf.Format(_T("%sBackup"), m_strAppDir);
	ini.GetString(m_sBackupDir.GetRaw(), _T("BackupDir"), strBuf);
	m_bScheduledBackup = ini.GetBool(_T("ScheduledBackup"),false);
	m_nScheduledBackupInterval = ini.GetUInt16(_T("ScheduledBackupInterval"),5);

//	FakeCheck
	ini.SetDefaultCategory(_T("FakeCheck"));
	m_nFakesDatVersion		= ini.GetInt(_T("FakesDatVersion"), 0);
	m_bUpdateFakeStartup	= ini.GetBool(_T("UpdateFakeStartup"), false);
	ini.GetString(&m_sFakeListURL, _T("FakeListURL"), _T("http://www.donkeyfakes.net/download/ed2kfakes.txt"));
	m_sFakeListURL.Trim();
	m_dwDLingFakeListVersion = ini.GetInt(_T("DownloadingFakeListVersion"), 0);
	ini.GetString(&m_strDLingFakeListLink, _T("DownloadingFakeListLink"), _T(""));
	m_clrFakeListDownloadColor = ini.GetUInt32(_T("FakeListDownloadColor"), 0);

//	Shortcut management
	ini.SetDefaultCategory(_T("Shortcuts"));
//	VK_RETURN is used as the default value because it is the first element
//	in the dropdown list of the shortcut dialog (in the settings)
	for (int i = 0; i < SCUT_COUNT; i++)
		m_anShortcutCode[i] = static_cast<short>(ini.GetInt(s_apcShortcutNames[i], VK_RETURN));

	if (strPrefsVersion.IsEmpty())
	{
	//	Application version is empty -> assume that it's the first start
		strBuf = GetResString(IDS_MULTIPLE, m_nLanguageID);

#ifndef NEW_SOCKETS_ENGINE
		m_bMultiple = (IDYES == ::MessageBox(0, strBuf, CLIENT_NAME, MB_YESNO | MB_ICONQUESTION | MB_DEFBUTTON2));	// Make "no" the default
#else
		m_bMultiple = FALSE;
#endif //NEW_SOCKETS_ENGINE
	//	Force saving user selection as we can't start if another instance is running
		if (!m_bMultiple)
			bChangedVersion = true;
	}

//	Load statistics from the main config file
	LoadStats(&ini);

//	Categories
	LoadCats();
	if (CCat::GetNumCats() == 1)
		CCat::SetAllCatType(CCat::GetCatByIndex(0)->m_eCatID);

	if(bChangedVersion)
		SaveIniPreferences();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	LoadDatPreferences() loads the legacy preference info (version, user hash, window position, etc) from
//		"config/preferences.dat"
void CPreferences::LoadDatPreferences()
{
	Preferences_Ext_Struct	prefsExt;
	CString		strFullPath(m_strConfigDir);

	strFullPath += _T("preferences.dat");

	FILE	*pPrefsFile = _tfsopen(strFullPath, _T("rb"), _SH_DENYWR);

	if (pPrefsFile == NULL)
	{
		SetStandardValues();
		return;
	}

	for (;;)
	{
		if (fread(&prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefsFile) != 0)
		{
			md4cpy(m_userHash, prefsExt.abyteUserHash);
			if (md4cmp0(m_userHash) != 0)	//regenerate user hash if file content is bogus
			{
				m_WindowPlacement = prefsExt.EmuleWindowPlacement;
				break;
			}
		}
		SetStandardValues();
		break;
	}
	fclose(pPrefsFile);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Load filter words from the file
// Returns true for success, false for failure
bool CPreferences::LoadFilterFile()
{
	CStdioFile	FilterFile;
	CString	strFullPath = m_strConfigDir;

	strFullPath += _T("filter.dat");

//	Open filter file
	if (!FilterFile.Open(strFullPath, CFile::modeRead | CFile::shareDenyWrite | CFile::typeBinary))
	{
		if (PathFileExists(strFullPath))
			return false;

	//	As it doesn't exist make a new one and write directions
#ifdef _UNICODE
		static const TCHAR	acHdr[] = _T("\xFEFF# filter search result using listed words\r\n")
#else
		static const TCHAR	acHdr[] = _T("# filter search result using listed words\r\n")
#endif
			_T("# min 2 characters\r\n")
			_T("# empty lines are ok, '#' for comment\r\n");

		if (!FilterFile.Open(strFullPath, CFile::modeCreate | CFile::modeWrite | CFile::typeBinary))
			return false;

		FilterFile.WriteString(acHdr);
	//	File is closed automatically in destructor
		return true;
	}

#ifdef _UNICODE
	uint16	uBOM;

	FilterFile.Read(&uBOM, sizeof(uBOM));
	if (uBOM != 0xFEFFu)
	{
	//	No Unicode header found, reopen in text mode to import plain text format
		FilterFile.Close();
		if (!FilterFile.Open(strFullPath, CFile::modeRead | CFile::shareDenyWrite | CFile::typeText))
			return false;
	}
#endif

	CString	strLine;

//	Parse each line
	while (FilterFile.ReadString(strLine))
	{
		strLine.Trim(_T(" \r\n"));

	//	Ignore '#' comment lines and single letters
		if ((*strLine.GetString() != _T('#')) && (strLine.GetLength() > 1))
		{
			m_strFilterWords += _T(' ');
			m_strFilterWords += strLine;
		}
	}
	return true;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	LoadSharedDirs() loads the shared file paths from "config/shareddir.dat".
void CPreferences::LoadSharedDirs()
{
	CString		strTmp;
	CStdioFile	sDirFile;

	strTmp.Format(_T("%sshareddir.dat"), m_strConfigDir);

	if (sDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | CFile::typeBinary))
	{
#ifdef _UNICODE
		uint16	uBOM;

		sDirFile.Read(&uBOM, sizeof(uBOM));
		if (uBOM != 0xFEFFu)
		{
		//	No Unicode header found, reopen in text mode to import plain text format
			sDirFile.Close();
			if (!sDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | CFile::typeText))
				return;
		}
#endif
		try
		{
			while (sDirFile.ReadString(strTmp))
				SharedDirListCheckAndAdd(strTmp, true, true);
		}
		catch (...)
		{}	// file system corruption can cause reading error, don't crash here just because of that

		sDirFile.Close();
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	LoadTempDirs() loads the supplemental temp directory paths from "config/tempdir.dat".
void CPreferences::LoadTempDirs()
{
	CString			strTmp;
	CStdioFile		tempDirFile;

	strTmp.Format(_T("%stempdir.dat"), m_strConfigDir);

	if (tempDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | CFile::typeBinary))
	{
#ifdef _UNICODE
		uint16	uBOM;

		tempDirFile.Read(&uBOM, sizeof(uBOM));
		if (uBOM != 0xFEFFu)
		{
		//	No Unicode header found, reopen in text mode to import plain text format
			tempDirFile.Close();
			if (!tempDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | CFile::typeText))
				return;
		}
#endif
		try
		{
			while (tempDirFile.ReadString(strTmp))
				TempDirListCheckAndAdd(strTmp, true);
		}
		catch (...)
		{}	// file system corruption can cause reading error, don't crash here just because of that

		tempDirFile.Close();
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::LoadCats()
{
#ifndef NEW_SOCKETS_ENGINE
	CCat::g_iNumPredefinedCats = 0;

	CString	strTmpBuf = m_strConfigDir;

	strTmpBuf += _T("Category.ini");

//	Default cat
	CCat	*pNewCat = new CCat();

	pNewCat->m_strTitle = CCat::GetPredefinedCatTitle(CAT_ALL, GetLanguageID());
	pNewCat->m_strSavePath = GetIncomingDir();
	pNewCat->m_strTempPath = GetTempDir();
	pNewCat->m_strComment = _T("");
	pNewCat->m_strAutoCatExt = _T("");
	pNewCat->m_eCatID = CAT_ALL;
	pNewCat->m_bIsPredefined = true;
	CCat::AddCat(pNewCat, false);
	CCat::g_iNumPredefinedCats++;

	if (!PathFileExists(strTmpBuf))
		return;

	CIni	iniCat(strTmpBuf);

	iniCat.SetDefaultCategory(_T("General"));

	EnumCategories	eCatID;

	for (unsigned ui = 1; ui <= CAT_MAXPREDEFINEDCATS; ui++)
	{
		strTmpBuf.Format(_T("PredefinedCat%u"), ui);
		eCatID = static_cast<_EnumCategories>(iniCat.GetInt(strTmpBuf, CAT_NONE));
		if (eCatID == CAT_NONE)
			break;
		else
		{
			pNewCat = new CCat();

			pNewCat->m_strTitle = CCat::GetPredefinedCatTitle(eCatID,GetLanguageID());
			pNewCat->m_strSavePath = GetIncomingDir();
			pNewCat->m_strTempPath = GetTempDir();
			pNewCat->m_strComment = _T("");
			pNewCat->m_strAutoCatExt = _T("");
			pNewCat->m_eCatID = eCatID;
			pNewCat->m_bIsPredefined = true;
			CCat::AddCat(pNewCat, false);
			CCat::g_iNumPredefinedCats++;
		}
	}

	unsigned	uiVal, uiMax = static_cast<unsigned>(iniCat.GetInt(_T("Count"), 0));

	for (unsigned ui = 1; ui <= uiMax; ui++)
	{
		strTmpBuf.Format(_T("Cat#%u"), ui);
		iniCat.SetDefaultCategory(strTmpBuf);
		pNewCat = new CCat();

		TCHAR	strSavePath[MAX_PATH], strTempPath[MAX_PATH];

		iniCat.GetString(&pNewCat->m_strTitle, _T("Title"), _T(""));
	//	Process Incoming directory, if not set get default
		_tcsncpy(strSavePath, iniCat.GetString(_T("Incoming"), _T("")), ARRSIZE(strSavePath));
		strSavePath[ARRSIZE(strSavePath) - 1] = _T('\0');
		MakeFolderName(strSavePath);
		if (!IsShareableDirectory(strSavePath))
		{
			_tcsncpy(strSavePath, GetIncomingDir(), ARRSIZE(strSavePath));
			strSavePath[ARRSIZE(strSavePath) - 1] = _T('\0');
			MakeFolderName(strSavePath);
		}
		pNewCat->m_strSavePath = strSavePath;
	//	Process Temporary directory, if not set get default
		_tcsncpy(strTempPath, iniCat.GetString(_T("Temp"), GetTempDir()), ARRSIZE(strTempPath));
		strTempPath[ARRSIZE(strTempPath) - 1] = _T('\0');
		MakeFolderName(strTempPath);
		pNewCat->m_strTempPath = strTempPath;

		if (TempDirListCheckAndAdd(pNewCat->m_strTempPath, true) < 0)
		//	There's no such directory in the list and its creation failed
			pNewCat->m_strTempPath = GetTempDir();
		iniCat.GetString(&pNewCat->m_strComment, _T("Comment"), _T(""));
	//	Try to import original eMule setting first
		uiVal = iniCat.GetInt(_T("a4afPriority"), -1) + 1;
		uiVal = iniCat.GetInt(_T("Priority"), uiVal);
		if (uiVal > 4u)
			uiVal = 0;
		pNewCat->m_iPriority = static_cast<byte>(uiVal);
		pNewCat->m_crColor = static_cast<COLORREF>(iniCat.GetUInt32(_T("Color"), RGB(0, 0, 0)));
		iniCat.GetString(&pNewCat->m_strAutoCatExt, _T("AutoCat"), _T(""));
		pNewCat->m_eCatID = static_cast<_EnumCategories>(iniCat.GetInt(_T("CategoryID"), ui));
		pNewCat->m_bIsPredefined = false;

		CCat::AddCat(pNewCat, false);	//	Add category
	}
#endif //NEW_SOCKETS_ENGINE
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// LANCAST (moosetea) - get the lancast ip address
uint32 CPreferences::GetLancastIP()
{
	return (GetLancastUseDefaultIP()) ? m_dwDefaultLancastIP : m_dwLancastIP;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
WORD CPreferences::GetWindowsVersion()
{
	if (!bWinVerAlreadyDetected)
	{
		bWinVerAlreadyDetected = true;

		bool	bIsNTNBased;

		m_wWinVer = DetectWinVersion(&bIsNTNBased);
		m_bIsNTBased = bIsNTNBased; // <== Hrm. May have misread the member name when I renamed it. MOREVIT
	}
	return m_wWinVer;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	GetDefaultMaxConPerFiveSecs() picks a safe value for the maximum number of connections in a 5 second
//		period based on the OS version.
uint16 CPreferences::GetDefaultMaxConPerFiveSecs()
{
	switch (GetWindowsVersion())
	{
		case _WINVER_98_: /*= _WINVER_NT4_*/
			return (m_bIsNTBased) ? 10 : 5;
		case _WINVER_95_:
			return 5;
		case _WINVER_ME_:
			return 10;
		case _WINVER_2K_:
		case _WINVER_XP_:
		case _WINVER_SE_:	//Win Server 2003
		case _WINVER_VISTA_:
		case _WINVER_WIN7_:
			return 20;
		default:
			return 10;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Provide a mechanism for all tables to store/retrieve sort direction
byte* CPreferences::GetColumnSortAscending(int iTbl)
{
	switch (iTbl)
	{
		case TABLE_DOWNLOAD:
			return m_abyteSortAscendingDownload;
		case TABLE_DOWNLOAD2:
			return m_abyteSortAscendingDownload2;
		case TABLE_UPLOAD:
			return m_abyteSortAscendingUpload;
		case TABLE_QUEUE:
			return m_abyteSortAscendingQueue;
		case TABLE_SEARCH:
			return m_abyteSortAscendingSearch;
		case TABLE_SHARED:
			return m_abyteSortAscendingShared;
		case TABLE_SERVER:
			return m_abyteSortAscendingServer;
		case TABLE_IRCNICK:
			return m_abyteSortAscendingIRCNick;
		case TABLE_IRC:
			return m_abyteSortAscendingIRCChannel;
		case TABLE_CLIENTLIST:
			return m_abyteSortAscendingClients;
		case TABLE_PARTSTATUS:
			return m_abyteSortAscendingPartStatus;
		case TABLE_FRIENDLIST:
			return m_abyteSortAscendingFriend;
		case TABLE_SRCFILENAME:
			return m_abyteSortAscendingSrcFileName;
	}
	return NULL;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Provide a mechanism for all tables to store/retrieve sort column
void CPreferences::SetColumnSortItem(unsigned uiTbl, int iSortItem)
{
	if (uiTbl < TABLE_COUNT)
		m_auiSortItem[uiTbl] = iSortItem;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int CPreferences::GetColumnSortCode(unsigned uiTbl) const
{
	const byte	*pbytePtr;
	byte	byteCode;
	int		iIdx = (uiTbl < TABLE_COUNT) ? m_auiSortItem[uiTbl] : 0;

	switch (uiTbl)
	{
		case TABLE_DOWNLOAD:
			pbytePtr = m_abyteSortAscendingDownload;
			break;
		case TABLE_DOWNLOAD2:
			pbytePtr = m_abyteSortAscendingDownload2;
			break;
		case TABLE_UPLOAD:
			pbytePtr = m_abyteSortAscendingUpload;
			break;
		case TABLE_QUEUE:
			pbytePtr = m_abyteSortAscendingQueue;
			break;
		case TABLE_SEARCH:
			pbytePtr = m_abyteSortAscendingSearch;
			break;
		case TABLE_SHARED:
			pbytePtr = m_abyteSortAscendingShared;
			break;
		case TABLE_SERVER:
			pbytePtr = m_abyteSortAscendingServer;
			break;
		case TABLE_IRCNICK:
			pbytePtr = m_abyteSortAscendingIRCNick;
			break;
		case TABLE_IRC:
			pbytePtr = m_abyteSortAscendingIRCChannel;
			break;
		case TABLE_CLIENTLIST:
			pbytePtr = m_abyteSortAscendingClients;
			break;
		case TABLE_PARTSTATUS:
			pbytePtr = m_abyteSortAscendingPartStatus;
			break;
		case TABLE_FRIENDLIST:
			pbytePtr = m_abyteSortAscendingFriend;
			break;
		case TABLE_SRCFILENAME:
			pbytePtr = m_abyteSortAscendingSrcFileName;
			break;
		default:
			goto Ex;
	}
	byteCode = pbytePtr[iIdx];
	iIdx |= (byteCode & 1) ? MLC_SORTASC : MLC_SORTDESC;
	iIdx |= (byteCode & 2) ? MLC_SORTALT : 0;
Ex:
	return iIdx;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetLanguage()
{
	switch (m_nLanguageID)
	{
		// read from ini and supported by the program?
		case MAKELANGID(LANG_ENGLISH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_BASQUE, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_BELARUSIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_CATALAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED):
		case MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL):
		case MAKELANGID(LANG_CROATIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_CZECH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_DANISH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_DUTCH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_SPECIAL, SUBLNG_EXTREMADURAN):
		case MAKELANGID(LANG_FINNISH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_FRENCH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_GERMAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_GREEK, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_HEBREW, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_ITALIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_KOREAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_LITHUANIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_MALAY, SUBLANG_MALAY_MALAYSIA):
		case MAKELANGID(LANG_NORWEGIAN, SUBLANG_NORWEGIAN_BOKMAL):
		case MAKELANGID(LANG_POLISH, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_PORTUGUESE, SUBLANG_PORTUGUESE):
		case MAKELANGID(LANG_PORTUGUESE, SUBLANG_PORTUGUESE_BRAZILIAN):
		case MAKELANGID(LANG_ROMANIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_RUSSIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_LATIN):
		case MAKELANGID(LANG_SLOVENIAN, SUBLANG_DEFAULT):
		case MAKELANGID(LANG_SPANISH,SUBLANG_SPANISH):
		case MAKELANGID(LANG_TURKISH,SUBLANG_DEFAULT):
		case MAKELANGID(LANG_UKRAINIAN, SUBLANG_DEFAULT):
			InitThreadLocale();
			break;
		default:
		{
			DWORD	dwPrimLang, dwLocalLang = ::GetThreadLocale();

			dwPrimLang = PRIMARYLANGID(dwLocalLang);
			switch (dwPrimLang)
			{
				case LANG_ENGLISH:
				case LANG_BASQUE:
				case LANG_BELARUSIAN:
				case LANG_CATALAN:
				case LANG_CHINESE:
				case LANG_CZECH:
				case LANG_DANISH:
				case LANG_DUTCH:
				case LANG_FINNISH:
				case LANG_FRENCH:
				case LANG_GERMAN:
				case LANG_GREEK:
				case LANG_HEBREW:
//				case LANG_HUNGARIAN:
				case LANG_ITALIAN:
				case LANG_KOREAN:
				case LANG_LITHUANIAN:
				case LANG_MALAY:
				case LANG_NORWEGIAN:
				case LANG_POLISH:
				case LANG_PORTUGUESE:
				case LANG_ROMANIAN:
				case LANG_RUSSIAN:
				case LANG_SLOVENIAN:
				case LANG_SPANISH:
				case LANG_TURKISH:
				case LANG_UKRAINIAN:
					m_nLanguageID = MAKELANGID(dwPrimLang, SUBLANG_DEFAULT);
					break;

#ifndef SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_CYRILLIC
#define SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_CYRILLIC	0x07
#endif
#ifndef SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_LATIN
#define SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_LATIN	0x06 
#endif
				default:
				//	Damn, M$ for this mess...
					if (dwPrimLang == LANG_SERBIAN)	//LANG_CROATIAN == LANG_SERBIAN
					{
						if ( (dwLocalLang == MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_LATIN)) ||
							(dwLocalLang == MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_CYRILLIC)) ||
							(dwLocalLang == MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_LATIN)) ||
							(dwLocalLang == MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_BOSNIA_HERZEGOVINA_CYRILLIC)) )
						{
							m_nLanguageID = MAKELANGID(LANG_SERBIAN, SUBLANG_SERBIAN_LATIN);
						}
						else
							m_nLanguageID = MAKELANGID(LANG_CROATIAN, SUBLANG_DEFAULT);
					}
					else
						m_nLanguageID = MAKELANGID(LANG_ENGLISH, SUBLANG_DEFAULT);
			}

			InitThreadLocale();

#ifndef NEW_SOCKETS_ENGINE
			::MessageBox( 0, GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID),
				GetResString(IDS_PW_LANG, m_nLanguageID), MB_ICONASTERISK );
#endif //NEW_SOCKETS_ENGINE
		}
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetMainProcessPriority(int Value)
{
	m_nMainProcessPriority = Value;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
BOOL CPreferences::IsNTBased(void)
{
	GetWindowsVersion();
	return m_bIsNTBased;
}

void CPreferences::ResetStatistics()
{
	// Save a backup so that we can undo this action
	SaveStats(1);

	// SET ALL CUMULATIVE STAT VALUES TO 0  :'-(

	m_nTotalDownloadedBytes = 0;
	m_nTotalUploadedBytes = 0;
	cumDownOverheadTotal = 0;
	cumDownOverheadFileReq = 0;
	cumDownOverheadSrcEx = 0;
	cumDownOverheadServer = 0;
	cumDownOverheadOther = 0;
	cumDownOverheadTotalPackets = 0;
	cumDownOverheadFileReqPackets = 0;
	cumDownOverheadSrcExPackets = 0;
	cumDownOverheadServerPackets = 0;
	cumDownOverheadOtherPackets = 0;
	cumUpOverheadTotal = 0;
	cumUpOverheadFileReq = 0;
	cumUpOverheadSrcEx = 0;
	cumUpOverheadServer = 0;
	cumUpOverheadOther = 0;
	cumUpOverheadTotalPackets = 0;
	cumUpOverheadFileReqPackets = 0;
	cumUpOverheadSrcExPackets = 0;
	cumUpOverheadServerPackets = 0;
	cumUpOverheadOtherPackets = 0;
	cumUpSuccessfulSessions = 0;
	cumUpFailedSessions = 0;
	cumDownCompletedFiles = 0;
	dwCumDownSuccessfulSessions = 0;
	dwCumDownFailedSessions = 0;
	m_qwCumLostFromCorruption = 0;
	m_qwSesLostFromCorruption = 0;
	m_qwCumSavedFromCompression = 0;
	m_qwSesSavedFromCompression = 0;
	m_dwCumPartsSavedByICH = 0;
	memzero(cumUpDataClients, sizeof(cumUpDataClients));
	memzero(cumDownDataClients, sizeof(cumDownDataClients));
	cumConnMaxAvgDownRate = 0;
	cumConnMaxDownRate = 0;
	dwCumConnRunTime = 0;
	cumConnNumReconnects = 0;
	cumConnAvgConnections = 0;
	cumConnMaxConnLimitReached = 0;
	cumConnPeakConnections = 0;
	cumConnDownloadTime = 0;
	cumConnUploadTime = 0;
	cumConnTransferTime = 0;
	cumConnServerDuration = 0;
	cumConnMaxAvgUpRate = 0;
	cumConnMaxUpRate = 0;
	cumSrvrsMostWorkingServers = 0;
	cumSrvrsMostUsersOnline = 0;
	cumSrvrsMostFilesAvail = 0;
	cumSharedMostFilesShared = 0;
	m_qwCumSharedLargestShareSize = 0;
	m_qwCumSharedLargestAvgFileSize = 0;
	m_qwCumSharedLargestFileSize = 0;
	cumUpData_File = 0;
	cumUpData_PartFile = 0;
	cumUpData_Community = 0;
	cumUpData_NoCommunity = 0;

	time(&stat_datetimeLastReset);	// Set the time of last reset...

	// Save the reset stats
	SaveStats(0);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Load Statistics
// This used to be integrated in LoadIniPreferences, but it has been altered
// so that it can be used to load the backup created when the stats are reset.
bool CPreferences::LoadStats(CIni *pCurIni)
{
	EMULE_TRY

	// pCurIni != NULL: Load the stats normally like we used to do in LoadIniPreferences
	// pCurIni == NULL: Load the stats from statbkup.ini and create a backup of the current stats. Also, don't initialize session variables.
	CString		strFullPath;
	CFileFind	findBackUp;
	CIni		*pIni;

	if (pCurIni != NULL)
		pIni = pCurIni;	// original file is opened in read-only mode
	else
	{
		strFullPath.Format(_T("%sstatbkup.ini"), m_strConfigDir);
		if (!findBackUp.FindFile(strFullPath))
			return false;
		SaveStats(2);	// Save our temp backup of current values to statbkuptmp.ini, we will be renaming it at the end of this function.
		pIni = new CIni(strFullPath);
	}

	pIni->SetDefaultCategory(_T("Statistics"));

	m_nTotalDownloadedBytes.Put(pIni->GetUInt64(_T("TotalDownloadedBytes"), 0));
	m_nTotalUploadedBytes.Put(pIni->GetUInt64(_T("TotalUploadedBytes"), 0));

	// Load stats for cumulative downline overhead
	cumDownOverheadTotal = pIni->GetUInt64(_T("DownOverheadTotal"), 0);
	cumDownOverheadFileReq = pIni->GetUInt64(_T("DownOverheadFileReq"), 0);
	cumDownOverheadSrcEx = pIni->GetUInt64(_T("DownOverheadSrcEx"), 0);
	cumDownOverheadServer = pIni->GetUInt64(_T("DownOverheadServer"), 0);
	cumDownOverheadOther = pIni->GetUInt64(_T("DownOverheadOther"), 0);
	cumDownOverheadTotalPackets = pIni->GetUInt64(_T("DownOverheadTotalPackets"), 0);
	cumDownOverheadFileReqPackets = pIni->GetUInt64(_T("DownOverheadFileReqPackets"), 0);
	cumDownOverheadSrcExPackets = pIni->GetUInt64(_T("DownOverheadSrcExPackets"), 0);
	cumDownOverheadServerPackets = pIni->GetUInt64(_T("DownOverheadServerPackets"), 0);
	cumDownOverheadOtherPackets = pIni->GetUInt64(_T("DownOverheadOtherPackets"), 0);

	// Load stats for cumulative upline overhead
	cumUpOverheadTotal = pIni->GetUInt64(_T("UpOverheadTotal"), 0);
	cumUpOverheadFileReq = pIni->GetUInt64(_T("UpOverheadFileReq"), 0);
	cumUpOverheadSrcEx = pIni->GetUInt64(_T("UpOverheadSrcEx"), 0);
	cumUpOverheadServer = pIni->GetUInt64(_T("UpOverheadServer"), 0);
	cumUpOverheadOther = pIni->GetUInt64(_T("UpOverheadOther"), 0);
	cumUpOverheadTotalPackets = pIni->GetUInt64(_T("UpOverheadTotalPackets"), 0);
	cumUpOverheadFileReqPackets = pIni->GetUInt64(_T("UpOverheadFileReqPackets"), 0);
	cumUpOverheadSrcExPackets = pIni->GetUInt64(_T("UpOverheadSrcExPackets"), 0);
	cumUpOverheadServerPackets = pIni->GetUInt64(_T("UpOverheadServerPackets"), 0);
	cumUpOverheadOtherPackets = pIni->GetUInt64(_T("UpOverheadOtherPackets"), 0);

	// Load stats for cumulative upline data
	cumUpSuccessfulSessions = pIni->GetUInt32(_T("UpSuccessfulSessions"), 0);
	cumUpFailedSessions = pIni->GetUInt32(_T("UpFailedSessions"), 0);

	// Load cumulative client breakdown stats for sent bytes
	cumUpDataClients[SO_EDONKEY] = pIni->GetUInt64(_T("UpData_EDONKEY"), 0);
	cumUpDataClients[SO_EDONKEYHYBRID] = pIni->GetUInt64(_T("UpData_EDONKEYHYBRID"), 0);
	cumUpDataClients[SO_EMULE] = pIni->GetUInt64(_T("UpData_EMULE"), 0);
	cumUpDataClients[SO_PLUS] = pIni->GetUInt64(_T("UpData_EMULEPLUS"), 0);
	cumUpDataClients[SO_MLDONKEY] = pIni->GetUInt64(_T("UpData_MLDONKEY"), 0);
	cumUpDataClients[SO_XMULE] = pIni->GetUInt64(_T("UpData_LMULE"), 0);
	cumUpDataClients[SO_AMULE] = pIni->GetUInt64(_T("UpData_AMULE"), 0);
	cumUpDataClients[SO_LPHANT] = pIni->GetUInt64(_T("UpData_LPHANT"), 0);
	cumUpDataClients[SO_OLDEMULE] = 0;	// initialize unused
	cumUpDataClients[SO_SHAREAZA] = pIni->GetUInt64(_T("UpData_SHAREAZA"),0);
	cumUpDataClients[SO_UNKNOWN] = 0;	// initialize unused

	// Load cumulative source breakdown stats for sent bytes
	cumUpData_File = pIni->GetUInt64(_T("UpData_File"), 0);
	cumUpData_PartFile = pIni->GetUInt64(_T("UpData_Partfile"), 0);

	// Load cumulative community breakdown stats for sent bytes
	cumUpData_Community = pIni->GetUInt64(_T("UpData_Community"), 0);
	cumUpData_NoCommunity = pIni->GetUInt64(_T("UpData_NoCommunity"), 0);

	// Load stats for cumulative downline data
	cumDownCompletedFiles = pIni->GetUInt32(_T("DownCompletedFiles"), 0);
	dwCumDownSuccessfulSessions = pIni->GetInt(_T("DownSuccessfulSessions"), 0);
	dwCumDownFailedSessions = pIni->GetInt(_T("DownFailedSessions"), 0);

	// Cumulative statistics for saved due to compression/lost due to corruption
	m_qwCumLostFromCorruption = pIni->GetUInt64(_T("LostFromCorruption"), 0);
	m_qwCumSavedFromCompression = pIni->GetUInt64(_T("SavedFromCompression"), 0);
	m_dwCumPartsSavedByICH = pIni->GetUInt32(_T("PartsSavedByICH"), 0);

	// Load cumulative client breakdown stats for received bytes
	cumDownDataClients[SO_EDONKEY] = pIni->GetUInt64(_T("DownData_EDONKEY"), 0);
	cumDownDataClients[SO_EDONKEYHYBRID] = pIni->GetUInt64(_T("DownData_EDONKEYHYBRID"), 0);
	cumDownDataClients[SO_EMULE] = pIni->GetUInt64(_T("DownData_EMULE"), 0);
	cumDownDataClients[SO_PLUS] = pIni->GetUInt64(_T("DownData_EMULEPLUS"), 0);
	cumDownDataClients[SO_MLDONKEY] = pIni->GetUInt64(_T("DownData_MLDONKEY"), 0);
	cumDownDataClients[SO_XMULE] = pIni->GetUInt64(_T("DownData_LMULE"), 0);
	cumDownDataClients[SO_AMULE] = pIni->GetUInt64(_T("DownData_AMULE"), 0);
	cumDownDataClients[SO_LPHANT] = pIni->GetUInt64(_T("DownData_LPHANT"), 0);
	cumDownDataClients[SO_OLDEMULE] = 0;	// eklmn: initialize unused
	cumDownDataClients[SO_SHAREAZA] = pIni->GetUInt64(_T("DownData_SHAREAZA"), 0);
	cumDownDataClients[SO_UNKNOWN] = 0;

	// Load stats for cumulative connection data
	cumConnMaxAvgDownRate = pIni->GetDouble(_T("ConnMaxAvgDownRate"), 0);
	cumConnMaxDownRate = pIni->GetDouble(_T("ConnMaxDownRate"), 0);
	cumConnMaxAvgUpRate = pIni->GetDouble(_T("ConnMaxAvgUpRate"), 0);
	cumConnMaxUpRate = pIni->GetDouble(_T("ConnMaxUpRate"), 0);

	dwCumConnRunTime = pIni->GetUInt32(_T("ConnRunTime"), 0);
	cumConnTransferTime = pIni->GetUInt32(_T("ConnTransferTime"), 0);
	cumConnDownloadTime = pIni->GetUInt32(_T("ConnDownloadTime"), 0);
	cumConnUploadTime = pIni->GetUInt32(_T("ConnUploadTime"), 0);
	cumConnServerDuration = pIni->GetUInt32(_T("ConnServerDuration"), 0);
	cumConnNumReconnects = pIni->GetUInt16(_T("ConnNumReconnects"), 0);
	cumConnAvgConnections = pIni->GetUInt16(_T("ConnAvgConnections"), 0);
	cumConnMaxConnLimitReached = pIni->GetUInt16(_T("ConnMaxConnLimitReached"), 0);
	cumConnPeakConnections = pIni->GetUInt16(_T("ConnPeakConnections"), 0);

	// Load date/time of last reset
	stat_datetimeLastReset = pIni->GetUInt32(_T("statsDateTimeLastReset"), 0);

	// Smart Load For Restores - Don't overwrite records that are greater than the backed up ones
	if (pCurIni == NULL)
	{
		uint64	qwVal;
		uint32	dwVal;

	//	Load records for servers / network
		if ((dwVal = pIni->GetUInt32(_T("SrvrsMostWorkingServers"), 0)) > cumSrvrsMostWorkingServers)
			cumSrvrsMostWorkingServers = static_cast<uint16>(dwVal);
		if ((dwVal = pIni->GetUInt32(_T("SrvrsMostUsersOnline"), 0)) > cumSrvrsMostUsersOnline)
			cumSrvrsMostUsersOnline =	dwVal;
		if ((dwVal = pIni->GetUInt32(_T("SrvrsMostFilesAvail"), 0)) > cumSrvrsMostFilesAvail)
			cumSrvrsMostFilesAvail = dwVal;

	//	Load records for shared files
		if ((dwVal = pIni->GetUInt32(_T("SharedMostFilesShared"), 0)) > cumSharedMostFilesShared)
			cumSharedMostFilesShared = static_cast<uint16>(dwVal);

		if ((qwVal = pIni->GetUInt64(_T("SharedLargestShareSize"), 0)) > m_qwCumSharedLargestShareSize)
			m_qwCumSharedLargestShareSize = qwVal;
		if ((qwVal = pIni->GetUInt64(_T("SharedLargestAvgFileSize"), 0)) > m_qwCumSharedLargestAvgFileSize)
			m_qwCumSharedLargestAvgFileSize = qwVal;
		if ((qwVal = pIni->GetUInt64(_T("SharedLargestFileSize"), 0)) > m_qwCumSharedLargestFileSize)
			m_qwCumSharedLargestFileSize = qwVal;

	//	Check to make sure the backup of the values we just overwrote exists. If so, rename it to the backup file.
	//	This allows us to undo a restore, so to speak, just in case we don't like the restored values...
		CString	sINIBackUp;

		sINIBackUp.Format(_T("%sstatbkuptmp.ini"), m_strConfigDir);
		if (findBackUp.FindFile(sINIBackUp))
		{
			pIni->SaveAndClose();
			CFile::Remove(strFullPath); // Remove the backup that we just restored from
			CFile::Rename(sINIBackUp, strFullPath); // Rename our temporary backup to the normal statbkup.ini filename.
		}

		// Since we know this is a restore, now we should call ShowStatistics to update the data items to the new ones we just loaded.
		// Otherwise user is left waiting around for the tick counter to reach the next automatic update (Depending on setting in prefs)
#ifndef NEW_SOCKETS_ENGINE
		g_App.m_pMDlg->m_dlgStatistics.ShowStatistics();
#endif //NEW_SOCKETS_ENGINE
		delete pIni;
		pIni = NULL;
	}
	// Stupid Load -> Just load the values.
	else
	{
		// Load records for servers / network
		cumSrvrsMostWorkingServers = pIni->GetUInt16(_T("SrvrsMostWorkingServers"), 0);
		cumSrvrsMostUsersOnline = pIni->GetUInt32(_T("SrvrsMostUsersOnline"), 0);
		cumSrvrsMostFilesAvail = pIni->GetUInt32(_T("SrvrsMostFilesAvail"), 0);

		// Load records for shared files
		cumSharedMostFilesShared = pIni->GetUInt16(_T("SharedMostFilesShared"), 0);

		m_qwCumSharedLargestShareSize = pIni->GetUInt64(_T("SharedLargestShareSize"), 0);
		m_qwCumSharedLargestAvgFileSize = pIni->GetUInt64(_T("SharedLargestAvgFileSize"), 0);
		m_qwCumSharedLargestFileSize = pIni->GetUInt64(_T("SharedLargestFileSize"), 0);

		pIni->GetString(&m_strStatsExpandedTreeItems, _T("statsExpandedTreeItems"), PREF_DEF_STATREE_MASK);

	//	Initialize new session statistic variables...
		sesDownAvgTime = 0;
		sesDownCompletedFiles = 0;
		memzero(sesDownDataClients, sizeof(sesDownDataClients));
		memzero(sesUpDataClients, sizeof(sesUpDataClients));
		memset(sesUpDataPriority, 0, sizeof(sesUpDataPriority));
		sesUpData_File = 0;
		sesUpData_PartFile = 0;
		sesUpData_Community = 0;
		sesUpData_NoCommunity = 0;
		sesDownSuccessfulSessions = 0;
		sesDownFailedSessions = 0;
		sesDownFailedSessionsNoRequiredData = 0;
		m_qwSesLostFromCorruption = 0;
		m_qwSesSavedFromCompression = 0;
		m_dwSesPartsSavedByICH = 0;
	}

	if (stat_datetimeLastReset == 0)
	{
		time_t timeNow;
		time(&timeNow);
		stat_datetimeLastReset = timeNow;
	}

	return true;

	EMULE_CATCH
	return false;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// This formats the UCT long value that is saved for stat_datetimeLastReset
// If this value is 0 (Never reset), then it returns Unknown.
CString CPreferences::GetStatsLastResetStr()
{
	CString	returnStr;

	if (GetStatsLastResetLng())
	{
		COleDateTime statsResetLocalized(GetStatsLastResetLng());
		returnStr = statsResetLocalized.Format(_T("%c"));
	}
	else
		GetResString(&returnStr, IDS_UNKNOWN);

	return returnStr;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SaveStats(int iBackUp, CIni *pCurIni/*=NULL*/)
{
	// This function saves all of the new statistics in my addon.  It is also used to
	// save backups for the Reset Stats function, and the Restore Stats function (Which is actually LoadStats)
	// iBackUp = 0: DEFAULT; save to preferences.ini
	// iBackUp = 1: Save to statbkup.ini, which is used to restore after a reset
	// iBackUp = 2: Save to statbkuptmp.ini, which is temporarily created during a restore and then renamed to statbkup.ini

	CIni	*pIni;
	double	dTmp;

	if (pCurIni == NULL)
	{
		CString	strFullPath(m_strConfigDir);

		switch (iBackUp)
		{
			default:
				strFullPath += _T("preferences.ini");
				break;
			case 1:
				strFullPath += _T("statbkup.ini");
				break;
			case 2:
				strFullPath += _T("statbkuptmp.ini");
				break;
		}
		pIni = new CIni(strFullPath);
	}
	else
		pIni = pCurIni;

	pIni->SetDefaultCategory(_T("Statistics"));

	// Save cumulative statistics to preferences.ini, going in order as they appear in CStatisticsDlg::ShowStatistics.
	// We do NOT SET the values in prefs struct here.

	// Save Cum Down Data
	pIni->SetUInt64(_T("TotalDownloadedBytes"), /* g_App.stat_sessionReceivedBytes + */GetTotalDownloaded());

	// Save Complete Downloads - This is saved and incremented in partfile.cpp.
	pIni->SetUInt32(_T("DownCompletedFiles"), cumDownCompletedFiles);

	// Save Successful Download Sessions
	pIni->SetUInt32(_T("DownSuccessfulSessions"), dwCumDownSuccessfulSessions);

	// Save Failed Download Sessions
	pIni->SetUInt32(_T("DownFailedSessions"), dwCumDownFailedSessions);

	// Cumulative statistics for saved due to compression/lost due to corruption
	pIni->SetUInt64(_T("LostFromCorruption"), m_qwCumLostFromCorruption + m_qwSesLostFromCorruption);
	pIni->SetUInt64(_T("SavedFromCompression"), m_qwSesSavedFromCompression + m_qwCumSavedFromCompression);
	pIni->SetInt(_T("PartsSavedByICH"), m_dwCumPartsSavedByICH + m_dwSesPartsSavedByICH);

	// Save cumulative client breakdown stats for received bytes...
	pIni->SetUInt64(_T("DownData_EDONKEY"), GetCumDownData(SO_EDONKEY));
	pIni->SetUInt64(_T("DownData_EDONKEYHYBRID"), GetCumDownData(SO_EDONKEYHYBRID));
	pIni->SetUInt64(_T("DownData_EMULE"), GetCumDownData(SO_EMULE));
	pIni->SetUInt64(_T("DownData_EMULEPLUS"), GetCumDownData(SO_PLUS));
	pIni->SetUInt64(_T("DownData_MLDONKEY"), GetCumDownData(SO_MLDONKEY));
	pIni->SetUInt64(_T("DownData_LMULE"), GetCumDownData(SO_XMULE));
	pIni->SetUInt64(_T("DownData_AMULE"), GetCumDownData(SO_AMULE));
	pIni->SetUInt64(_T("DownData_LPHANT"), GetCumDownData(SO_LPHANT));
	pIni->SetUInt64(_T("DownData_SHAREAZA"), GetCumDownData(SO_SHAREAZA));

	// Save Cumulative Downline Overhead Statistics
#ifndef NEW_SOCKETS_ENGINE
	if (g_App.m_pDownloadQueue)
	{
		pIni->SetUInt64(_T("DownOverheadTotal"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequest() + g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + g_App.m_pDownloadQueue->GetDownDataOverheadServer() + g_App.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadTotal() );
		pIni->SetUInt64(_T("DownOverheadFileReq"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		pIni->SetUInt64(_T("DownOverheadSrcEx"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
		pIni->SetUInt64(_T("DownOverheadServer"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadServer() + GetDownOverheadServer() );
		pIni->SetUInt64(_T("DownOverheadOther"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadOther() );
		// BavarianSnail - corrected saving of overhead values
		pIni->SetUInt64(_T("DownOverheadTotalPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + g_App.m_pDownloadQueue->GetDownDataOverheadServerPackets() + g_App.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		pIni->SetUInt64(_T("DownOverheadFileReqPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + GetDownOverheadFileReqPackets() );
		pIni->SetUInt64(_T("DownOverheadSrcExPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		pIni->SetUInt64(_T("DownOverheadServerPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
		pIni->SetUInt64(_T("DownOverheadOtherPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadOtherPackets() );
	}
#endif //NEW_SOCKETS_ENGINE

	// Save Cumulative Upline Statistics
	pIni->SetUInt64(_T("TotalUploadedBytes"), /* g_App.stat_sessionSentBytes + */GetTotalUploaded() );
#ifndef NEW_SOCKETS_ENGINE
	if (g_App.m_pUploadQueue)
	{
		pIni->SetInt(_T("UpSuccessfulSessions"), g_App.m_pUploadQueue->GetSuccessfulUpCount()+GetUpSuccessfulSessions());
		pIni->SetInt(_T("UpFailedSessions"), g_App.m_pUploadQueue->GetFailedUpCount()+GetUpFailedSessions());

		// Save Cumulative Upline Overhead Statistics
		pIni->SetUInt64(_T("UpOverheadTotal"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequest() + g_App.m_pUploadQueue->GetUpDataOverheadSourceExchange() + g_App.m_pUploadQueue->GetUpDataOverheadServer() + g_App.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadTotal() );
		pIni->SetUInt64(_T("UpOverheadFileReq"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		pIni->SetUInt64(_T("UpOverheadSrcEx"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		pIni->SetUInt64(_T("UpOverheadServer"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		pIni->SetUInt64(_T("UpOverheadOther"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadOther() );
		pIni->SetUInt64(_T("UpOverheadTotalPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + g_App.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + g_App.m_pUploadQueue->GetUpDataOverheadServerPackets() + g_App.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets() );
		pIni->SetUInt64(_T("UpOverheadFileReqPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets() );
		pIni->SetUInt64(_T("UpOverheadSrcExPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		pIni->SetUInt64(_T("UpOverheadServerPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
		pIni->SetUInt64(_T("UpOverheadOtherPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadOtherPackets() );
	}
#endif //NEW_SOCKETS_ENGINE

	// Save Cumulative Client Breakdown Stats For Sent Bytes
	pIni->SetUInt64(_T("UpData_EDONKEY"), GetCumUpData(SO_EDONKEY));
	pIni->SetUInt64(_T("UpData_EDONKEYHYBRID"), GetCumUpData(SO_EDONKEYHYBRID));
	pIni->SetUInt64(_T("UpData_EMULE"), GetCumUpData(SO_EMULE));
	pIni->SetUInt64(_T("UpData_EMULEPLUS"), GetCumUpData(SO_PLUS));
	pIni->SetUInt64(_T("UpData_MLDONKEY"), GetCumUpData(SO_MLDONKEY));
	pIni->SetUInt64(_T("UpData_LMULE"), GetCumUpData(SO_XMULE));
	pIni->SetUInt64(_T("UpData_AMULE"), GetCumUpData(SO_AMULE));
	pIni->SetUInt64(_T("UpData_LPHANT"), GetCumUpData(SO_LPHANT));
	pIni->SetUInt64(_T("UpData_SHAREAZA"), GetCumUpData(SO_SHAREAZA));

	// Save cumulative source breakdown stats for sent bytes
	pIni->SetUInt64(_T("UpData_File"), GetCumUpData_File());
	pIni->SetUInt64(_T("UpData_Partfile"), GetCumUpData_PartFile());

	// Save cumulative community breakdown stats for sent bytes
	pIni->SetUInt64(_T("UpData_Community"), GetCumUpData_Community() );
	pIni->SetUInt64(_T("UpData_NoCommunity"), GetCumUpData_NoCommunity() );

	// Save Cumulative Connection Statistics
#ifndef NEW_SOCKETS_ENGINE
	if(g_App.m_pMDlg != NULL)
	{
		// Download Rate Average
		dTmp = g_App.m_pMDlg->m_dlgStatistics.GetAvgDownloadRate(AVG_TOTAL);
		// Max Download Rate Average
		if (dTmp > GetConnMaxAvgDownRate())
			Add2ConnMaxAvgDownRate(dTmp);
		pIni->SetDouble(_T("ConnMaxAvgDownRate"), GetConnMaxAvgDownRate());
		// Upload Rate Average
		dTmp = g_App.m_pMDlg->m_dlgStatistics.GetAvgUploadRate(AVG_TOTAL);
		// Max Upload Rate Average
		if (dTmp > GetConnMaxAvgUpRate())
			Add2ConnMaxAvgUpRate(dTmp);
		pIni->SetDouble(_T("ConnMaxAvgUpRate"), GetConnMaxAvgUpRate());
	}
	if (g_App.m_pDownloadQueue)
	{
		// Max Download Rate
		dTmp = static_cast<double>(g_App.m_pDownloadQueue->GetDataRate()) / 1024.0;
		if (dTmp > GetConnMaxDownRate())
			Add2ConnMaxDownRate(dTmp);
		pIni->SetDouble(_T("ConnMaxDownRate"), GetConnMaxDownRate());
	}
	// Max Upload Rate
	if (g_App.m_pUploadQueue)
	{
		dTmp = static_cast<double>(g_App.m_pUploadQueue->GetDataRate()) / 1024.0;
		if (dTmp > GetConnMaxUpRate())
			Add2ConnMaxUpRate(dTmp);
		pIni->SetDouble(_T("ConnMaxUpRate"), GetConnMaxUpRate());
	}
#endif //NEW_SOCKETS_ENGINE

	// Overall Run Time
#ifndef NEW_SOCKETS_ENGINE
	pIni->SetUInt32(_T("ConnRunTime"), dwCumConnRunTime + (::GetTickCount() - g_App.stat_starttime) / 1000u);
	// Number of Reconnects
	if (g_App.stat_reconnects>0)
		pIni->SetWORD(_T("ConnNumReconnects"), g_App.stat_reconnects - 1 + GetConnNumReconnects());
	else
		pIni->SetWORD(_T("ConnNumReconnects"), GetConnNumReconnects());
#endif //NEW_SOCKETS_ENGINE

#ifdef OLD_SOCKETS_ENABLED
	if (g_App.m_pServerConnect)
	{
		// Average Connections
		if (g_App.m_pServerConnect->IsConnected())
			pIni->SetUInt32(_T("ConnAvgConnections"), (uint32)(g_App.m_pMDlg->m_dlgStatistics.GetAverageConnections()+cumConnAvgConnections)/2);
	}
	if (g_App.m_pListenSocket)
	{
		// Max Connection Limit Reached
		if (g_App.m_pListenSocket->GetMaxConnectionsReachedCount() > 0)
			pIni->SetUInt32(_T("ConnMaxConnLimitReached"), g_App.m_pListenSocket->GetMaxConnectionsReachedCount() + cumConnMaxConnLimitReached);
	}
#endif //OLD_SOCKETS_ENABLED

#ifndef NEW_SOCKETS_ENGINE
	if(g_App.m_pMDlg != NULL)
	{
		// Peak Connections
		if (g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections() > cumConnPeakConnections)
			cumConnPeakConnections = static_cast<uint16>(g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections());
		pIni->SetInt(_T("ConnPeakConnections"), cumConnPeakConnections);

		// Time Stuff...
		pIni->SetUInt32(_T("ConnTransferTime"), GetConnTransferTime() + g_App.m_pMDlg->m_dlgStatistics.GetTransferTime());
		pIni->SetUInt32(_T("ConnUploadTime"), GetConnUploadTime() + g_App.m_pMDlg->m_dlgStatistics.GetUploadTime());
		pIni->SetUInt32(_T("ConnDownloadTime"), GetConnDownloadTime() + g_App.m_pMDlg->m_dlgStatistics.GetDownloadTime());
		pIni->SetUInt32(_T("ConnServerDuration"), GetConnServerDuration() + g_App.m_pMDlg->m_dlgStatistics.GetServerDuration());
	}
	// Compare and Save Server Records
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile, dwSrvLowIdUsers;
	double servocc;
	if (g_App.m_pServerList)
	{
		g_App.m_pServerList->GetServersStatus( servtotal, servfail, servuser, servfile,
			dwSrvLowIdUsers, servtuser, servtfile, servocc );

		if ((servtotal - servfail) > cumSrvrsMostWorkingServers)
			cumSrvrsMostWorkingServers = static_cast<uint16>(servtotal - servfail);
		pIni->SetInt(_T("SrvrsMostWorkingServers"), cumSrvrsMostWorkingServers);
		if (servtuser > cumSrvrsMostUsersOnline)
			cumSrvrsMostUsersOnline = servtuser;
		pIni->SetInt(_T("SrvrsMostUsersOnline"), cumSrvrsMostUsersOnline);
		if (servtfile > cumSrvrsMostFilesAvail)
			cumSrvrsMostFilesAvail = servtfile;
		pIni->SetInt(_T("SrvrsMostFilesAvail"), cumSrvrsMostFilesAvail);
	}

	if (g_App.m_pSharedFilesList)
	{
		// Compare and Save Shared File Records
		if (g_App.m_pSharedFilesList->GetCount()>cumSharedMostFilesShared)
			cumSharedMostFilesShared = g_App.m_pSharedFilesList->GetCount();
		pIni->SetInt(_T("SharedMostFilesShared"), cumSharedMostFilesShared);

		uint64 qwLargestFile;
		uint64 qwTotalSz = g_App.m_pSharedFilesList->GetDatasize(&qwLargestFile);

		if (qwTotalSz > m_qwCumSharedLargestShareSize)
			m_qwCumSharedLargestShareSize = qwTotalSz;
		pIni->SetUInt64(_T("SharedLargestShareSize"), m_qwCumSharedLargestShareSize);
		if (qwLargestFile > m_qwCumSharedLargestFileSize)
			m_qwCumSharedLargestFileSize = qwLargestFile;
		pIni->SetUInt64(_T("SharedLargestFileSize"), m_qwCumSharedLargestFileSize);
		if (g_App.m_pSharedFilesList->GetCount() != 0)
		{
			uint64 qwTmp = qwTotalSz / static_cast<uint64>(g_App.m_pSharedFilesList->GetCount());

			if (qwTmp > m_qwCumSharedLargestAvgFileSize)
				m_qwCumSharedLargestAvgFileSize = qwTmp;
		}
		pIni->SetUInt64(_T("SharedLargestAvgFileSize"), m_qwCumSharedLargestAvgFileSize);
		pIni->SetUInt32(_T("statsDateTimeLastReset"), stat_datetimeLastReset);
	}
#endif //NEW_SOCKETS_ENGINE

	// These aren't really statistics, but they're a part of my add-on, so we'll save them here and load them in LoadStats
	pIni->SetString(_T("statsExpandedTreeItems"), m_strStatsExpandedTreeItems);

	pIni->SaveAndClose();
	if (pCurIni == NULL)	// destroy only when locally created
		delete pIni;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetRecordStructMembers()
{
	// The purpose of this function is to be called from CStatisticsDlg::ShowStatistics()
	// This was easier than making a bunch of functions to interface with the record
	// members of the prefs struct from ShowStatistics.

	// This function is going to compare current values with previously saved records, and if
	// the current values are greater, the corresponding member of m_prefs will be updated.
	// We will not write to INI here, because this code is going to be called a lot more often
	// than SaveStats()  - Khaos

#ifndef NEW_SOCKETS_ENGINE
	CString buffer;

	// Servers
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile, dwSrvLowIdUsers;
	double servocc;
	g_App.m_pServerList->GetServersStatus( servtotal, servfail, servuser, servfile,
		dwSrvLowIdUsers, servtuser, servtfile, servocc );
	if ((servtotal - servfail) > cumSrvrsMostWorkingServers)
		cumSrvrsMostWorkingServers = static_cast<uint16>(servtotal - servfail);
	if (servtuser > cumSrvrsMostUsersOnline)
		cumSrvrsMostUsersOnline = servtuser;
	if (servtfile > cumSrvrsMostFilesAvail)
		cumSrvrsMostFilesAvail = servtfile;

	// Shared Files
	if (g_App.m_pSharedFilesList->GetCount() > cumSharedMostFilesShared)
		cumSharedMostFilesShared = g_App.m_pSharedFilesList->GetCount();

	uint64 qwLargestFile;
	uint64 qwTotalSz = g_App.m_pSharedFilesList->GetDatasize(&qwLargestFile);

	if (qwTotalSz > m_qwCumSharedLargestShareSize)
		m_qwCumSharedLargestShareSize = qwTotalSz;
	if (qwLargestFile > m_qwCumSharedLargestFileSize)
		m_qwCumSharedLargestFileSize = qwLargestFile;
	if (g_App.m_pSharedFilesList->GetCount() != 0)
	{
		uint64 qwTmp = qwTotalSz / static_cast<uint64>(g_App.m_pSharedFilesList->GetCount());

		if (qwTmp > m_qwCumSharedLargestAvgFileSize)
			m_qwCumSharedLargestAvgFileSize = qwTmp;
	}
#endif //NEW_SOCKETS_ENGINE
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::Add2SessionUpTransferData(unsigned uiClientID, bool bFromPF, uint32 dwBytes, bool bCommunity, byte byteFilePrio)
{
	//	This function adds the transferred bytes to the appropriate variables,
	//	as well as to the totals for all clients.
	//	PARAMETERS:
	//	uiClientID - The identifier for which client software sent or received this data, eg SO_EMULE
	//	bFromPF - Applies only to uploads.  True is from partfile, False is from non-partfile.
	//	bytes - Number of bytes sent by the client.  Subtract header before calling.
	//	bCommunity - True is from Community remote user, False is from non-Community.

	sesUpDataClients[(uiClientID < SO_LAST) ? uiClientID : SO_UNKNOWN] += dwBytes;

	//	Add to our total for sent bytes...
#ifndef NEW_SOCKETS_ENGINE
	g_App.UpdateSentBytes(dwBytes);
#endif

	if (bFromPF)
		sesUpData_PartFile += dwBytes;
	else
		sesUpData_File += dwBytes;

	if (bCommunity)
		sesUpData_Community += dwBytes;
	else
		sesUpData_NoCommunity += dwBytes;

	if (byteFilePrio < ARRSIZE(sesUpDataPriority))
		sesUpDataPriority[byteFilePrio] += dwBytes;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::Add2SessionDownTransferData(unsigned uiClientID, uint32 dwBytes)
{
	sesDownDataClients[(uiClientID < SO_LAST) ? uiClientID : SO_UNKNOWN] += dwBytes;

	//	Add to our total for received bytes...
#ifndef NEW_SOCKETS_ENGINE
	g_App.UpdateReceivedBytes(dwBytes);
#endif
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool CPreferences::IsShareableDirectory(const CString& rstrDir) const
{
	if(IsInstallationDirectory(rstrDir))
		return false;

	CString strFullPath;

	if(PathCanonicalize(strFullPath.GetBuffer(MAX_PATH), rstrDir))
		strFullPath.ReleaseBuffer();
	else
		strFullPath = rstrDir;

	//	Skip sharing of several special eMule folders
	if(!CompareDirectories(strFullPath, GetTempDir()))			// ".\eMule\Temp"
		return false;

	return true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool CPreferences::IsInstallationDirectory(const CString& rstrDir) const
{
	CString strFullPath;
	if(PathCanonicalize(strFullPath.GetBuffer(MAX_PATH), rstrDir))
		strFullPath.ReleaseBuffer();
	else
		strFullPath = rstrDir;

	// skip sharing of several special eMule folders
	if (!CompareDirectories(strFullPath, GetAppDir()))					// ".\eMule"
		return true;
	if (!CompareDirectories(strFullPath, GetConfigDir()))				// ".\eMule\Config"
		return true;
	if (!CompareDirectories(strFullPath, GetBackupDir()))				// ".\eMule\Backup"
		return true;
	if (!CompareDirectories(strFullPath, (GetAppDir() + _T("WebServer"))))// ".\eMule\Webserver"
		return true;
	if (!CompareDirectories(strFullPath, (GetAppDir() + _T("Db"))))		// ".\eMule\Db"
		return true;

	return false;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SharedDirListCheckAndAdd() checks existence of a directory in the list.
//		Params:
//			strNewDir - new directory;
//			bAdd      - add or not a directory to the list if it wasn't found in it.
//			bVerifyExistence - verify the existence of the directory before addition to the list.
//		Return:
//			TRUE if a directory wasn't found in the list, else FALSE.
bool CPreferences::SharedDirListCheckAndAdd(const CString &strNewDir, bool bAdd, bool bVerifyExistence/*false*/)
{
	CString	strDir = strNewDir;

	strDir.TrimRight();	//trim " \t\r\n"
//	All list entries has trailing '\'
	if (strDir.Right(1) != _T('\\'))
		strDir += _T('\\');

	m_csDirList.Lock();

	for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != NULL; )
	{
		if (strDir.CompareNoCase(m_sharedDirList.GetNext(pos)) == 0)
		{
		//	Such directory already exists
			m_csDirList.Unlock();
			return false;
		}
	}
	if (bAdd)
	{
		if (bVerifyExistence)
		{
			DWORD dwFileAttributes = GetFileAttributes(strDir);

		//	If directory exists, add it to the list, otherwise report error
			if ((dwFileAttributes == INVALID_FILE_ATTRIBUTES) || !(dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
			{
				m_csDirList.Unlock();
				return false;
			}
		}
		m_sharedDirList.AddTail(strDir);
	}

	m_csDirList.Unlock();
	return true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SharedDirListRefill() fills the list with new values.
//		Params:
//			pNewList - a list with new values.
void CPreferences::SharedDirListRefill(CStringList *pNewList)
{
	m_csDirList.Lock();

	m_sharedDirList.RemoveAll();
	m_sharedDirList.AddTail(pNewList);

	m_csDirList.Unlock();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SharedDirListCopy() makes a copy of the current list.
//		Params:
//			pOutputList - output copy.
void CPreferences::SharedDirListCopy(CStringList *pOutputList)
{
	m_csDirList.Lock();

	pOutputList->AddTail(&m_sharedDirList);

	m_csDirList.Unlock();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SharedDirListCmp() compare two lists.
//		Params:
//			pNewList - a list to compare with the current.
//		Return:
//			TRUE if lists are different, else FALSE.
bool CPreferences::SharedDirListCmp(CStringList *pNewList)
{
	bool	bRc = true;

	m_csDirList.Lock();

	if (pNewList->GetCount() == m_sharedDirList.GetCount())
	{
		bRc = false;

		POSITION pos1 = pNewList->GetHeadPosition();

		for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != NULL; )
		{
			if (m_sharedDirList.GetNext(pos).CompareNoCase(pNewList->GetNext(pos1)) != 0)
			{
				bRc = true;
				break;
			}
		}
	}

	m_csDirList.Unlock();
	return bRc;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	TempDirListCheckAndAdd() checks existence of a directory in the list and create it if required.
//		Params:
//			strNewDir - new directory;
//			bAdd      - create and add a directory to the list if it wasn't found in it.
//		Return:
//			0 - a directory already exists or impossible to add;
//			< 0 - a directory wasn't found in the list (impossible to create if bAdd was true);
//			> 0 - a directory was successfully created and added to the list.
int CPreferences::TempDirListCheckAndAdd(const CString &strNewDir, bool bAdd)
{
	CString	strDir = strNewDir;

	strDir.TrimRight(_T(" \r\n"));
//	All list entries has trailing '\'
	if (strDir.Right(1) != _T('\\'))
		strDir += _T('\\');

//	Don't add the main temporary directory to the list
	if (strDir.CompareNoCase(GetTempDir() + _T('\\')) == 0)
		return 0;

	m_csDirList.Lock();

	for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != NULL; )
	{
		if (strDir.CompareNoCase(m_tempDirList.GetNext(pos)) == 0)
		{
		//	Such directory already exists
			m_csDirList.Unlock();
			return 0;
		}
	}

	int	iRc = -1;

	if (bAdd)
	{
		CreateAllDirectories(&strDir);	//	Create all required directories

	//	If directory was successfully created, add it to the list, otherwise report error
		DWORD dwFileAttributes = GetFileAttributes(strDir);

		if ((dwFileAttributes != INVALID_FILE_ATTRIBUTES) && (dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
		{
			m_tempDirList.AddTail(strDir);
			iRc = 1;
		}
	}

	m_csDirList.Unlock();
	return iRc;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	TempDirListRefill() fills the list with new values.
//		Params:
//			pNewList - a list with new values.
void CPreferences::TempDirListRefill(CStringList *pNewList)
{
	m_csDirList.Lock();

	m_tempDirList.RemoveAll();
	m_tempDirList.AddTail(pNewList);

	m_csDirList.Unlock();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	TempDirListCopy() makes a copy of the current list.
//		Params:
//			pOutputList - output copy.
void CPreferences::TempDirListCopy(CStringList *pOutputList)
{
	m_csDirList.Lock();

	pOutputList->AddTail(&m_tempDirList);

	m_csDirList.Unlock();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	TempDirListCmp() compare two lists.
//		Params:
//			pNewList - a list to compare with the current.
//		Return:
//			TRUE if lists are different, else FALSE.
bool CPreferences::TempDirListCmp(CStringList *pNewList)
{
	bool	bRc = true;

	m_csDirList.Lock();

	if (pNewList->GetCount() == m_tempDirList.GetCount())
	{
		bRc = false;

		POSITION pos1 = pNewList->GetHeadPosition();

		for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != NULL; )
		{
			if (m_tempDirList.GetNext(pos).CompareNoCase(pNewList->GetNext(pos1)) != 0)
			{
				bRc = true;
				break;
			}
		}
	}

	m_csDirList.Unlock();
	return bRc;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	SetUserNickTag() prepares User Nickname data to be used for packets.
void CPreferences::SetUserNickTag()
{
	CMemFile	NameBuff(16);
	CWrTag		tagWr;
	void		*pTmp;

	tagWr.WriteToFile(CT_NAME, m_sNick.Get(), NameBuff, cfUTF8);
	pTmp = m_pNameTag;
	m_dwNameTagSz = static_cast<uint32>(NameBuff.GetLength());
	m_pNameTag = NameBuff.Detach();
	free(pTmp);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetA4AFHash(const byte* pbyteFileHash)
{
	md4cpy(m_A4AF_FileHash, pbyteFileHash);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint16 CPreferences::GetMaxSourcePerFileSoft() const
{
	unsigned ui = static_cast<unsigned>(m_dwMaxSourcePerFile) * 9u / 10u;

	return static_cast<uint16>((ui > MAX_SOURCES_FILE_SOFT) ? MAX_SOURCES_FILE_SOFT : ui);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint16 CPreferences::GetMaxSourcePerFileUDP() const
{
	unsigned ui = (static_cast<unsigned>(m_dwMaxSourcePerFile) * 3u) >> 2u;

	return static_cast<uint16>((ui > MAX_SOURCES_FILE_UDP)? MAX_SOURCES_FILE_UDP : ui);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetWSPass(const CString &strNewPass)
{
	MD5Sum(strNewPass, m_abyteWebPassword);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetWSLowPass(const CString &strNewPass)
{
	MD5Sum(strNewPass, m_abyteLowWebPassword);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::SetMMPass(const CString &strNewPass)
{
	MD5Sum(strNewPass, m_abyteMMPassword);
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::InitThreadLocale()
{
//	Set thread locale, this is used for:
//	- MBCS->Unicode conversions (e.g. search results).
//	- Unicode->MBCS conversions (e.g. publishing local files (names) in network, or saving text files on local disk)...
//	Note: this function is not supported on Windows 95/98/Me
	if (m_bIsNTBased)
	{
		LCID lcidSystem = GetSystemDefaultLCID();
		LANGID lidSystem = LANGIDFROMLCID(lcidSystem);
		UINT uSortIdUser = SORT_DEFAULT;
		UINT uSortVerUser = 0;
		LCID lcid = MAKESORTLCID(lidSystem, uSortIdUser, uSortVerUser);

		SetThreadLocale(lcid);
	}

//	If we set the thread locale (see comments above) we also have to specify the proper
//	code page for the C-RTL, otherwise we may not be able to store some strings as MBCS
//	(Unicode->MBCS conversion may fail)
	_tsetlocale(LC_CTYPE, _T(".ACP"));
}
@


1.431
log
@Add network interface to bind (from original) {Zom}.
@
text
@d1995 5
a1999 1
	ini.GetString(&m_strIPFilterURL, _T("UpdateURLIPFilter"), _T("http://emulepawcio.sourceforge.net/nieuwe_site/eplus_fakes/ipfilter.dat"));
a2187 8
//	Change old invalid values to current default
	CString strFakeFileName = ::PathFindFileName(m_sFakeListURL);

	if (strFakeFileName.CompareNoCase(_T("ed2kfakes.txt")) != 0)
	{
		m_sFakeListURL = _T("http://www.donkeyfakes.net/download/ed2kfakes.txt");
	}

@


1.430
log
@Added Windows 7 OS detection in case it's required for future.
@
text
@d757 1
d1416 6
@


1.429
log
@Encryption preparations.
@
text
@d2521 1
@


1.428
log
@Encryption preparations.
@
text
@d1095 1
d2015 2
@


1.427
log
@Updated comment filter to filter out new spam.
@
text
@a1091 1
#if 0//Enable to proceed work on obfuscation
a1094 1
#endif
a2006 1
#if 0//Enable to proceed work on obfuscation
a2013 5
#else
	m_bCryptLayerRequested = false;
	m_bCryptLayerRequired = false;
	m_bCryptLayerSupported = false;
#endif
@


1.426
log
@Reduced H-file dependency.
@
text
@d158 1
a158 1
#define EP_PREFUPD_COMMENT_FILTER		_T("")
d1632 1
a1632 1
	ini.GetString(m_sCommentFilter.GetRaw(), _T("CommentFilter"), _T("http://www.|emulespeedup|fastest eMule ever"));
@


1.425
log
@Trim tab characters as well while loading shared directories.
@
text
@d40 3
@


1.424
log
@Reduced H-file dependency.
@
text
@d3445 1
a3445 1
	strDir.TrimRight(_T(" \r\n"));
@


1.423
log
@Reduced H-file dependency.
@
text
@d37 3
@


1.422
log
@Unified list column definitions; Save state of the source file name list; Save sorting directions for all GUI lists.
@
text
@d34 1
@


1.421
log
@Removed some old not used statistics values to preserve cumulative Average Up/Download Rate (currently used cumulative data is calculated based on session results);
Don't save DownCompletedFiles statistics value to the disk after every file completion (do it together with other preferences.ini values);
Removed meaningless Average Up/Download Time cumulative statistics (our code can't preserve and calculate it properly, so better to remove it than show some wrong stuff).
@
text
@d1 2
a2 1
//Copyright (C)2002 Merkur ( merkur-@@users.sourceforge.net / http://www.emule-project.net )
d130 20
d477 1
a477 1
int CPreferences::GetColumnWidth(EnumTable t, int index) const
d479 1
a479 1
	switch (t)
d503 2
d509 1
a509 1
void CPreferences::SetColumnWidth(EnumTable t, int index, int width)
d511 1
a511 1
	switch (t)
d546 3
d552 1
a552 1
BOOL CPreferences::GetColumnHidden(EnumTable t, int index) const
d554 1
a554 1
	switch (t)
d578 2
d581 1
a581 1
	return FALSE;
d584 1
a584 1
void CPreferences::SetColumnHidden(EnumTable t, int index, bool bHidden)
d586 1
a586 1
	switch (t)
d621 3
d627 1
a627 1
int CPreferences::GetColumnOrder(EnumTable t, int index) const
d629 1
a629 1
	switch (t)
d653 2
d659 1
a659 1
void CPreferences::SetColumnOrder(EnumTable t, int *piOrder)
d661 1
a661 1
	switch (t)
d696 3
d975 3
d980 47
a1026 24
	ini.SetInt(_T("TableSortItemDownload"), m_iTableSortItemDownload);
	ini.SetInt(_T("TableSortItemDownload2"), m_iTableSortItemDownload2);
	ini.SetInt(_T("TableSortItemUpload"), m_iTableSortItemUpload);
	ini.SetInt(_T("TableSortItemQueue"), m_iTableSortItemQueue);
	ini.SetInt(_T("TableSortItemSearch"), m_iTableSortItemSearch);
	ini.SetInt(_T("TableSortItemShared"), m_iTableSortItemShared);
	ini.SetInt(_T("TableSortItemServer"), m_iTableSortItemServer);
	ini.SetInt(_T("TableSortItemIRCNick"), m_iTableSortItemIRCNick);
	ini.SetInt(_T("TableSortItemIRCChannel"), m_iTableSortItemIRCChannel);
	ini.SetInt(_T("TableSortItemClientList"), m_iTableSortItemClientList);
	ini.SetInt(_T("TableSortItemPartStatus"), m_iTableSortItemPartStatus);
	ini.SetInt(_T("TableSortItemFriend"), m_iTableSortItemFriend);
	ini.SetBool(_T("TableSortAscendingDownload"), m_bTableSortAscendingDownload);
	ini.SetBool(_T("TableSortAscendingDownload2"), m_bTableSortAscendingDownload2);
	ini.SetBool(_T("TableSortAscendingUpload"), m_bTableSortAscendingUpload);
	ini.SetBool(_T("TableSortAscendingQueue"), m_bTableSortAscendingQueue);
	ini.SetBool(_T("TableSortAscendingSearch"), m_bTableSortAscendingSearch);
	ini.SetBool(_T("TableSortAscendingShared"), m_bTableSortAscendingShared);
	ini.SetBool(_T("TableSortAscendingServer"), m_bTableSortAscendingServer);
	ini.SetBool(_T("TableSortAscendingIRCNick"), m_bTableSortAscendingIRCNick);
	ini.SetBool(_T("TableSortAscendingIRCChannel"), m_bTableSortAscendingIRCChannel);
	ini.SetBool(_T("TableSortAscendingClientList"), m_bTableSortAscendingClientList);
	ini.SetBool(_T("TableSortAscendingPartStatus"), m_bTableSortAscendingPartStatus);
	ini.SetBool(_T("TableSortAscendingFriend"), m_bTableSortAscendingFriend);
d1275 12
d1478 2
d1635 3
a1637 3
	m_uiServerSortCol = ini.GetInt(_T("SortServersCode"), SL_COLUMN_SERVERNAME);
	if ((m_uiServerSortCol & MLC_COLUMNMASK) >= SL_COLUMN_NUMCOLUMNS)
		m_uiServerSortCol = SL_COLUMN_SERVERNAME;
d1644 3
a1646 3
	m_uiSearchSortCol = ini.GetInt(_T("SortSearchCode"), MLC_SORTDESC | SL_COLUMN_SOURCES);
	if ((m_uiSearchSortCol & MLC_COLUMNMASK) >= SL_NUMCOLUMNS)
		m_uiSearchSortCol = MLC_SORTDESC | SL_COLUMN_SOURCES;
d1650 3
a1652 3
	m_uiFileSortCol = ini.GetInt(_T("SortFilesCode"), SFL_COLUMN_FILENAME);
	if ((m_uiFileSortCol & MLC_COLUMNMASK) >= SFL_NUMCOLUMNS)
		m_uiFileSortCol = SFL_COLUMN_FILENAME;
d1796 3
d1801 133
a1933 55
	m_iTableSortItemDownload = ini.GetInt(_T("TableSortItemDownload"), DLCOL_STATUS);
	if (m_iTableSortItemDownload >= DLCOL_NUMCOLUMNS)
		m_iTableSortItemDownload = DLCOL_STATUS;
	m_iTableSortItemDownload2 = ini.GetInt(_T("TableSortItemDownload2"), DLCOL_PRIORITY);
	if (m_iTableSortItemDownload2 >= DLCOL_NUMCOLUMNS)
		m_iTableSortItemDownload2 = DLCOL_PRIORITY;
	m_iTableSortItemUpload = ini.GetInt(_T("TableSortItemUpload"), ULCOL_UPLOADTIME);
	if (m_iTableSortItemUpload >= ULCOL_NUMCOLUMNS)
		m_iTableSortItemUpload = ULCOL_UPLOADTIME;
	m_iTableSortItemQueue = ini.GetInt(_T("TableSortItemQueue"), QLCOL_QLRATING);
	if (m_iTableSortItemQueue >= QLCOL_NUMCOLUMNS)
		m_iTableSortItemQueue = QLCOL_QLRATING;
	m_iTableSortItemSearch = ini.GetInt(_T("TableSortItemSearch"), SL_COLUMN_SOURCES);
	m_iTableSortItemSearch &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_iTableSortItemSearch & MLC_COLUMNMASK) >= SL_NUMCOLUMNS)	//allow to save alternate criterion
		m_iTableSortItemSearch = SL_COLUMN_SOURCES;
	m_iTableSortItemShared = ini.GetInt(_T("TableSortItemShared"), SFL_COLUMN_FILENAME);
	m_iTableSortItemShared &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_iTableSortItemShared & MLC_COLUMNMASK) >= SFL_NUMCOLUMNS)	//allow to save alternate criterion
		m_iTableSortItemShared = SFL_COLUMN_FILENAME;
	m_iTableSortItemServer = ini.GetInt(_T("TableSortItemServer"), SL_COLUMN_SERVERNAME);
	m_iTableSortItemServer &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_iTableSortItemServer & MLC_COLUMNMASK) >= SL_COLUMN_NUMCOLUMNS)	//allow to save alternate criterion
		m_iTableSortItemServer = SL_COLUMN_SERVERNAME;
	m_iTableSortItemIRCNick = ini.GetInt(_T("TableSortItemIRCNicks"), IRC1COL_STATUS);
	if (m_iTableSortItemIRCNick >= IRC1COL_NUMCOLUMNS)
		m_iTableSortItemIRCNick = IRC1COL_STATUS;
	m_iTableSortItemIRCChannel = ini.GetInt(_T("TableSortItemIRCChannel"), IRC2COL_NAME);
	if (m_iTableSortItemIRCChannel >= IRC2COL_NUMCOLUMNS)
		m_iTableSortItemIRCChannel = IRC2COL_NAME;
	m_iTableSortItemClientList = ini.GetInt(_T("TableSortItemClientList"), CLCOL_USERNAME);
	if (m_iTableSortItemClientList >= CLCOL_NUMCOLUMNS)
		m_iTableSortItemClientList = CLCOL_USERNAME;
	m_iTableSortItemPartStatus = ini.GetInt(_T("TableSortItemPartStatus"), FDPARTSCOL_NUMBER);
	m_iTableSortItemPartStatus &= MLC_COLUMNMASK | MLC_SORTALT;
	if ((m_iTableSortItemPartStatus & MLC_COLUMNMASK) >= FDPARTSCOL_NUMCOLUMNS)	//allow to save alternate criterion
		m_iTableSortItemPartStatus = FDPARTSCOL_NUMBER;
	m_iTableSortItemFriend = ini.GetInt(_T("TableSortItemFriend"), FRIENDCOL_USERNAME);
	if (m_iTableSortItemFriend >= FRIENDCOL_NUMCOLUMNS)
		m_iTableSortItemFriend = FRIENDCOL_USERNAME;
	m_bTableSortAscendingDownload = ini.GetBool(_T("TableSortAscendingDownload"), true);
	m_bTableSortAscendingDownload2 = ini.GetBool(_T("TableSortAscendingDownload2"), true);
	m_bTableSortAscendingUpload = ini.GetBool(_T("TableSortAscendingUpload"), true);
	m_bTableSortAscendingQueue = ini.GetBool(_T("TableSortAscendingQueue"), true);
	m_bTableSortAscendingSearch = ini.GetBool(_T("TableSortAscendingSearch"), true);
	m_bTableSortAscendingShared = ini.GetBool(_T("TableSortAscendingShared"), true);
	m_bTableSortAscendingServer = ini.GetBool(_T("TableSortAscendingServer"), true);
	m_bTableSortAscendingIRCNick = ini.GetBool(_T("TableSortAscendingIRCNick"), true);
	m_bTableSortAscendingIRCChannel = ini.GetBool(_T("TableSortAscendingIRCChannel"), true);
	m_bTableSortAscendingClientList = ini.GetBool(_T("TableSortAscendingClientList"), true);
	m_bTableSortAscendingPartStatus = ini.GetBool(_T("TableSortAscendingPartStatus"), true);
	m_bTableSortAscendingFriend = ini.GetBool(_T("TableSortAscendingFriend"), true);

	if (m_nStatsAverageMinutes < 1)
		m_nStatsAverageMinutes = 5;
d2525 2
a2526 2
// Provide a mechanism for all tables to store/retrieve sort order
int CPreferences::GetColumnSortItem(EnumTable t) const
d2528 1
a2528 1
	switch (t)
d2531 1
a2531 1
			return m_iTableSortItemDownload;
d2533 1
a2533 1
			return m_iTableSortItemDownload2;
d2535 1
a2535 1
			return m_iTableSortItemUpload;
d2537 1
a2537 1
			return m_iTableSortItemQueue;
d2539 1
a2539 1
			return m_iTableSortItemSearch;
d2541 1
a2541 1
			return m_iTableSortItemShared;
d2543 1
a2543 1
			return m_iTableSortItemServer;
d2545 1
a2545 1
			return m_iTableSortItemIRCNick;
d2547 1
a2547 1
			return m_iTableSortItemIRCChannel;
d2549 1
a2549 1
			return m_iTableSortItemClientList;
d2551 1
a2551 1
			return m_iTableSortItemPartStatus;
d2553 3
a2555 1
			return m_iTableSortItemFriend;
d2557 1
a2557 1
	return 0;
d2560 2
a2561 2
// Provide a mechanism for all tables to store/retrieve sort order
bool CPreferences::GetColumnSortAscending(EnumTable t) const
d2563 2
a2564 28
	switch (t)
	{
		case TABLE_DOWNLOAD:
			return m_bTableSortAscendingDownload;
		case TABLE_DOWNLOAD2:
			return m_bTableSortAscendingDownload2;
		case TABLE_UPLOAD:
			return m_bTableSortAscendingUpload;
		case TABLE_QUEUE:
			return m_bTableSortAscendingQueue;
		case TABLE_SEARCH:
			return m_bTableSortAscendingSearch;
		case TABLE_SHARED:
			return m_bTableSortAscendingShared;
		case TABLE_SERVER:
			return m_bTableSortAscendingServer;
		case TABLE_IRCNICK:
			return m_bTableSortAscendingIRCNick;
		case TABLE_IRC:
			return m_bTableSortAscendingIRCChannel;
		case TABLE_CLIENTLIST:
			return m_bTableSortAscendingClientList;
		case TABLE_PARTSTATUS:
			return m_bTableSortAscendingPartStatus;
		case TABLE_FRIENDLIST:
			return m_bTableSortAscendingFriend;
	}
	return true;
d2567 1
a2567 2
// Provide a mechanism for all tables to store/retrieve sort order
void CPreferences::SetColumnSortItem(EnumTable t, int sortItem)
d2569 5
a2573 1
	switch (t)
d2576 1
a2576 1
			m_iTableSortItemDownload = sortItem;
d2579 1
a2579 1
			m_iTableSortItemDownload2 = sortItem;
d2582 1
a2582 1
			m_iTableSortItemUpload = sortItem;
d2585 1
a2585 1
			m_iTableSortItemQueue = sortItem;
d2588 1
a2588 1
			m_iTableSortItemSearch = sortItem;
d2591 1
a2591 1
			m_iTableSortItemShared = sortItem;
d2594 1
a2594 1
			m_iTableSortItemServer = sortItem;
d2597 1
a2597 1
			m_iTableSortItemIRCNick = sortItem;
d2600 1
a2600 1
			m_iTableSortItemIRCChannel = sortItem;
d2603 1
a2603 1
			m_iTableSortItemClientList = sortItem;
d2606 1
a2606 1
			m_iTableSortItemPartStatus = sortItem;
d2609 1
a2609 12
			m_iTableSortItemFriend = sortItem;
			break;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Provide a mechanism for all tables to store/retrieve sort order
void CPreferences::SetColumnSortAscending(EnumTable t, bool sortAscending)
{
	switch(t)
	{
		case TABLE_DOWNLOAD:
			m_bTableSortAscendingDownload = sortAscending;
d2611 2
a2612 32
		case TABLE_DOWNLOAD2:
			m_bTableSortAscendingDownload2 = sortAscending;
			break;
		case TABLE_UPLOAD:
			m_bTableSortAscendingUpload = sortAscending;
			break;
		case TABLE_QUEUE:
			m_bTableSortAscendingQueue = sortAscending;
			break;
		case TABLE_SEARCH:
			m_bTableSortAscendingSearch = sortAscending;
			break;
		case TABLE_SHARED:
			m_bTableSortAscendingShared = sortAscending;
			break;
		case TABLE_SERVER:
			m_bTableSortAscendingServer = sortAscending;
			break;
		case TABLE_IRCNICK:
			m_bTableSortAscendingIRCNick = sortAscending;
			break;
		case TABLE_IRC:
			m_bTableSortAscendingIRCChannel = sortAscending;
			break;
		case TABLE_CLIENTLIST:
			m_bTableSortAscendingClientList = sortAscending;
			break;
		case TABLE_PARTSTATUS:
			m_bTableSortAscendingPartStatus = sortAscending;
			break;
		case TABLE_FRIENDLIST:
			m_bTableSortAscendingFriend = sortAscending;
d2614 2
d2617 5
@


1.420
log
@Avoid generation of potentially bad words inside default user nicks {Paola};
Combine preferences.ini access to avoid multiple loadings and savings (on startup file was loads 3 times, plus twice saved on every saving);
Removed saving some unused preferences.ini value DownSessionCompletedFiles.
@
text
@a2673 1
	cumUpAvgTime = 0;
a2676 1
	cumDownAvgTime = 0;
a2683 1
	cumConnAvgDownRate = 0;
a2685 1
	cumConnAvgUpRate = 0;
a2770 1
	cumUpAvgTime = pIni->GetUInt32(_T("UpAvgTime"), 0);
a2796 1
	cumDownAvgTime = pIni->GetUInt32(_T("DownAvgTime"), 0);
a2816 1
	cumConnAvgDownRate = pIni->GetDouble(_T("ConnAvgDownRate"), 0);
a2818 1
	cumConnAvgUpRate = pIni->GetDouble(_T("ConnAvgUpRate"), 0);
d2986 1
a2986 1
	pIni->SetInt(_T("DownCompletedFiles"), cumDownCompletedFiles);
a2992 1
	pIni->SetInt(_T("DownAvgTime"), (GetDownC_AvgTime() + GetDownS_AvgTime()) / 2);
a3034 1
		pIni->SetInt(_T("UpAvgTime"), (g_App.m_pUploadQueue->GetAverageUpTime()+GetUpAvgTime())/2);
a3074 1
		pIni->SetDouble(_T("ConnAvgDownRate"), dTmp);
a3080 1
		pIni->SetDouble(_T("ConnAvgUpRate"), dTmp);
a3285 23
void CPreferences::SaveCompletedDownloadsStat()
{
	EMULE_TRY

	// This function saves the values for the completed
	// download members to INI.  It is called from
	// CPartfile::PerformFileComplete ...   - Khaos

	CString	strFullPath = m_strConfigDir;

	strFullPath += _T("preferences.ini");

	CIni ini(strFullPath);

	ini.SetDefaultCategory(_T("Statistics"));

	ini.SetUInt32(_T("DownCompletedFiles"), GetDownCompletedFiles());

	ini.SaveAndClose();

	EMULE_CATCH
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
@


1.419
log
@Removed disk buffers flush after preferences.dat writing (nothing but slowdown on shutdown);
Removed duplicated attempts to close ini file (directly by the call and indirectly by destructor);
Removed importing of the old shortcut options; Reduced disk activity while loading filter.dat.
@
text
@d191 1
a191 1
	m_strAppDir = CString(drive) + CString(dir);
d1139 2
a1140 4
	ini.SaveAndClose();

//	Now file is closed, so we can update stats over SaveStats()
	SaveStats();
d1218 2
a1219 1
	CIni* pIni = new CIni(strFileName, INI_MODE_READONLY);
d1221 1
a1221 1
	pIni->SetDefaultCategory(_T("eMule"));
d1223 2
a1224 3
	CString strPrefsVersion(pIni->GetString(_T("AppVersion"), _T("")));

	delete pIni;
d1226 2
a1227 4
	CFileFind findFileName;

	bool bChangedVersion = false;
	int loadstatsFromOld = 0;	// -khaos--+++> Fix to stats being lost when version changes!
a1236 1
	//	Process new file only after successful rename, otherwise process original file
d1239 1
a1239 6
		{
			strFileName = strNewName;

			bChangedVersion = true;
			loadstatsFromOld = 2; // -khaos--+++> Set this to 2 so that LoadStats will load 'em from ini.old
		}
a1241 3
	CIni ini(strFileName, INI_MODE_READONLY);
	ini.SetDefaultCategory(_T("eMule"));

d1250 1
d1254 1
d1256 9
a1264 1
		acNick[ui] = static_cast<TCHAR>(rand() % (_T('z') - _T('a')) + _T('a'));
a2032 2
	ini.CloseWithoutSave();

d2048 2
a2049 3
//	Now when file is closed, let's call LoadStats()
	// statsitic
	LoadStats(loadstatsFromOld, strFileName);
d2713 1
a2713 5
	// Set the time of last reset...
	time_t	timeNow;
	
	time(&timeNow);
	stat_datetimeLastReset = timeNow;
d2716 1
a2716 3
	SaveStats();

	// End Reset Statistics
d2722 1
a2722 1
bool CPreferences::LoadStats(int loadBackUp, CString sFileName)
d2726 2
a2727 4
	// loadBackUp is 0 by default
	// loadBackUp = 0: Load the stats normally like we used to do in LoadIniPreferences
	// loadBackUp = 1: Load the stats from statbkup.ini and create a backup of the current stats.  Also, do not initialize session variables.
	// loadBackUp = 2: Load the stats from preferences.ini.old because the version has changed.
d2730 1
d2732 3
a2734 1
	switch (loadBackUp)
d2736 5
a2740 16
		case 0:
			strFullPath.Format(_T("%spreferences.ini"), m_strConfigDir);
			break;
		case 1:
			strFullPath.Format(_T("%sstatbkup.ini"), m_strConfigDir);
			if (!findBackUp.FindFile(strFullPath))
				return false;
			SaveStats(2);	// Save our temp backup of current values to statbkuptmp.ini, we will be renaming it at the end of this function.
			break;
		case 2:
			if (sFileName.IsEmpty())
				return false;
			strFullPath = sFileName;
			if (!findBackUp.FindFile(strFullPath))
				return false;
			break;
d2743 1
a2743 1
	CIni	ini(strFullPath);
d2745 2
a2746 4
	ini.SetDefaultCategory(_T("Statistics"));

	m_nTotalDownloadedBytes.Put(ini.GetUInt64(_T("TotalDownloadedBytes"), 0));
	m_nTotalUploadedBytes.Put(ini.GetUInt64(_T("TotalUploadedBytes"), 0));
d2749 10
a2758 10
	cumDownOverheadTotal = ini.GetUInt64(_T("DownOverheadTotal"), 0);
	cumDownOverheadFileReq = ini.GetUInt64(_T("DownOverheadFileReq"), 0);
	cumDownOverheadSrcEx = ini.GetUInt64(_T("DownOverheadSrcEx"), 0);
	cumDownOverheadServer = ini.GetUInt64(_T("DownOverheadServer"), 0);
	cumDownOverheadOther = ini.GetUInt64(_T("DownOverheadOther"), 0);
	cumDownOverheadTotalPackets = ini.GetUInt64(_T("DownOverheadTotalPackets"), 0);
	cumDownOverheadFileReqPackets = ini.GetUInt64(_T("DownOverheadFileReqPackets"), 0);
	cumDownOverheadSrcExPackets = ini.GetUInt64(_T("DownOverheadSrcExPackets"), 0);
	cumDownOverheadServerPackets = ini.GetUInt64(_T("DownOverheadServerPackets"), 0);
	cumDownOverheadOtherPackets = ini.GetUInt64(_T("DownOverheadOtherPackets"), 0);
d2761 10
a2770 10
	cumUpOverheadTotal = ini.GetUInt64(_T("UpOverheadTotal"), 0);
	cumUpOverheadFileReq = ini.GetUInt64(_T("UpOverheadFileReq"), 0);
	cumUpOverheadSrcEx = ini.GetUInt64(_T("UpOverheadSrcEx"), 0);
	cumUpOverheadServer = ini.GetUInt64(_T("UpOverheadServer"), 0);
	cumUpOverheadOther = ini.GetUInt64(_T("UpOverheadOther"), 0);
	cumUpOverheadTotalPackets = ini.GetUInt64(_T("UpOverheadTotalPackets"), 0);
	cumUpOverheadFileReqPackets = ini.GetUInt64(_T("UpOverheadFileReqPackets"), 0);
	cumUpOverheadSrcExPackets = ini.GetUInt64(_T("UpOverheadSrcExPackets"), 0);
	cumUpOverheadServerPackets = ini.GetUInt64(_T("UpOverheadServerPackets"), 0);
	cumUpOverheadOtherPackets = ini.GetUInt64(_T("UpOverheadOtherPackets"), 0);
d2773 3
a2775 3
	cumUpSuccessfulSessions =	ini.GetUInt32(_T("UpSuccessfulSessions"), 0);
	cumUpFailedSessions =		ini.GetUInt32(_T("UpFailedSessions"), 0);
	cumUpAvgTime =			ini.GetUInt32(_T("UpAvgTime"), 0);
d2778 8
a2785 8
	cumUpDataClients[SO_EDONKEY] = ini.GetUInt64(_T("UpData_EDONKEY"), 0);
	cumUpDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64(_T("UpData_EDONKEYHYBRID"), 0);
	cumUpDataClients[SO_EMULE] = ini.GetUInt64(_T("UpData_EMULE"), 0);
	cumUpDataClients[SO_PLUS] = ini.GetUInt64(_T("UpData_EMULEPLUS"), 0);
	cumUpDataClients[SO_MLDONKEY] = ini.GetUInt64(_T("UpData_MLDONKEY"), 0);
	cumUpDataClients[SO_XMULE] = ini.GetUInt64(_T("UpData_LMULE"), 0);
	cumUpDataClients[SO_AMULE] = ini.GetUInt64(_T("UpData_AMULE"), 0);
	cumUpDataClients[SO_LPHANT] = ini.GetUInt64(_T("UpData_LPHANT"), 0);
d2787 1
a2787 1
	cumUpDataClients[SO_SHAREAZA] = ini.GetUInt64(_T("UpData_SHAREAZA"),0);
d2791 2
a2792 2
	cumUpData_File = ini.GetUInt64(_T("UpData_File"), 0);
	cumUpData_PartFile = ini.GetUInt64(_T("UpData_Partfile"), 0);
d2795 2
a2796 2
	cumUpData_Community = ini.GetUInt64(_T("UpData_Community"), 0);
	cumUpData_NoCommunity = ini.GetUInt64(_T("UpData_NoCommunity"), 0);
d2799 4
a2802 4
	cumDownCompletedFiles = ini.GetUInt32(_T("DownCompletedFiles"), 0);
	dwCumDownSuccessfulSessions = ini.GetInt(_T("DownSuccessfulSessions"), 0);
	dwCumDownFailedSessions = ini.GetInt(_T("DownFailedSessions"), 0);
	cumDownAvgTime = ini.GetUInt32(_T("DownAvgTime"), 0);
d2805 3
a2807 3
	m_qwCumLostFromCorruption = ini.GetUInt64(_T("LostFromCorruption"), 0);
	m_qwCumSavedFromCompression = ini.GetUInt64(_T("SavedFromCompression"), 0);
	m_dwCumPartsSavedByICH = ini.GetUInt32(_T("PartsSavedByICH"), 0);
d2810 8
a2817 8
	cumDownDataClients[SO_EDONKEY] = ini.GetUInt64(_T("DownData_EDONKEY"), 0);
	cumDownDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64(_T("DownData_EDONKEYHYBRID"), 0);
	cumDownDataClients[SO_EMULE] = ini.GetUInt64(_T("DownData_EMULE"), 0);
	cumDownDataClients[SO_PLUS] = ini.GetUInt64(_T("DownData_EMULEPLUS"), 0);
	cumDownDataClients[SO_MLDONKEY] = ini.GetUInt64(_T("DownData_MLDONKEY"), 0);
	cumDownDataClients[SO_XMULE] = ini.GetUInt64(_T("DownData_LMULE"), 0);
	cumDownDataClients[SO_AMULE] = ini.GetUInt64(_T("DownData_AMULE"), 0);
	cumDownDataClients[SO_LPHANT] = ini.GetUInt64(_T("DownData_LPHANT"), 0);
d2819 1
a2819 1
	cumDownDataClients[SO_SHAREAZA] = ini.GetUInt64(_T("DownData_SHAREAZA"), 0);
d2823 16
a2838 16
	cumConnAvgDownRate = ini.GetDouble(_T("ConnAvgDownRate"), 0);
	cumConnMaxAvgDownRate = ini.GetDouble(_T("ConnMaxAvgDownRate"), 0);
	cumConnMaxDownRate = ini.GetDouble(_T("ConnMaxDownRate"), 0);
	cumConnAvgUpRate = ini.GetDouble(_T("ConnAvgUpRate"), 0);
	cumConnMaxAvgUpRate = ini.GetDouble(_T("ConnMaxAvgUpRate"), 0);
	cumConnMaxUpRate = ini.GetDouble(_T("ConnMaxUpRate"), 0);

	dwCumConnRunTime = ini.GetUInt32(_T("ConnRunTime"), 0);
	cumConnTransferTime = ini.GetUInt32(_T("ConnTransferTime"), 0);
	cumConnDownloadTime = ini.GetUInt32(_T("ConnDownloadTime"), 0);
	cumConnUploadTime = ini.GetUInt32(_T("ConnUploadTime"), 0);
	cumConnServerDuration = ini.GetUInt32(_T("ConnServerDuration"), 0);
	cumConnNumReconnects = ini.GetUInt16(_T("ConnNumReconnects"), 0);
	cumConnAvgConnections = ini.GetUInt16(_T("ConnAvgConnections"), 0);
	cumConnMaxConnLimitReached = ini.GetUInt16(_T("ConnMaxConnLimitReached"), 0);
	cumConnPeakConnections = ini.GetUInt16(_T("ConnPeakConnections"), 0);
d2841 1
a2841 1
	stat_datetimeLastReset = ini.GetUInt32(_T("statsDateTimeLastReset"), 0);
d2844 1
a2844 1
	if (loadBackUp == 1)
d2850 1
a2850 1
		if ((dwVal = ini.GetUInt32(_T("SrvrsMostWorkingServers"), 0)) > cumSrvrsMostWorkingServers)
d2852 1
a2852 1
		if ((dwVal = ini.GetUInt32(_T("SrvrsMostUsersOnline"), 0)) > cumSrvrsMostUsersOnline)
d2854 1
a2854 1
		if ((dwVal = ini.GetUInt32(_T("SrvrsMostFilesAvail"), 0)) > cumSrvrsMostFilesAvail)
d2858 1
a2858 1
		if ((dwVal = ini.GetUInt32(_T("SharedMostFilesShared"), 0)) > cumSharedMostFilesShared)
d2861 1
a2861 1
		if ((qwVal = ini.GetUInt64(_T("SharedLargestShareSize"), 0)) > m_qwCumSharedLargestShareSize)
d2863 1
a2863 1
		if ((qwVal = ini.GetUInt64(_T("SharedLargestAvgFileSize"), 0)) > m_qwCumSharedLargestAvgFileSize)
d2865 1
a2865 1
		if ((qwVal = ini.GetUInt64(_T("SharedLargestFileSize"), 0)) > m_qwCumSharedLargestFileSize)
d2875 1
a2875 1
			ini.SaveAndClose();
d2885 2
d2892 3
a2894 3
		cumSrvrsMostWorkingServers = ini.GetUInt16(_T("SrvrsMostWorkingServers"), 0);
		cumSrvrsMostUsersOnline =	ini.GetUInt32(_T("SrvrsMostUsersOnline"), 0);
		cumSrvrsMostFilesAvail = ini.GetUInt32(_T("SrvrsMostFilesAvail"), 0);
d2897 1
a2897 1
		cumSharedMostFilesShared = ini.GetUInt16(_T("SharedMostFilesShared"), 0);
d2899 3
a2901 3
		m_qwCumSharedLargestShareSize = ini.GetUInt64(_T("SharedLargestShareSize"), 0);
		m_qwCumSharedLargestAvgFileSize = ini.GetUInt64(_T("SharedLargestAvgFileSize"), 0);
		m_qwCumSharedLargestFileSize = ini.GetUInt64(_T("SharedLargestFileSize"), 0);
d2903 1
a2903 1
		ini.GetString(&m_strStatsExpandedTreeItems, _T("statsExpandedTreeItems"), PREF_DEF_STATREE_MASK);
d2944 1
a2944 3
		// DonGato: fixed localization of Last reset
		time_t	lastResetDateTime = (time_t) GetStatsLastResetLng();
		COleDateTime statsResetLocalized(lastResetDateTime);
d2948 1
a2948 1
		returnStr = GetResString(IDS_UNKNOWN);
d2953 1
a2953 1
void CPreferences::SaveStats(int bBackUp/*=0*/)
d2957 3
a2959 3
	// bBackUp = 0: DEFAULT; save to preferences.ini
	// bBackUp = 1: Save to statbkup.ini, which is used to restore after a reset
	// bBackUp = 2: Save to statbkuptmp.ini, which is temporarily created during a restore and then renamed to statbkup.ini
d2961 1
a2961 1
	CString	strFullPath = m_strConfigDir;
d2964 1
a2964 1
	switch (bBackUp)
d2966 15
a2980 9
		case 0:
			strFullPath += _T("preferences.ini");
			break;
		case 1:
			strFullPath += _T("statbkup.ini");
			break;
		case 2:
			strFullPath += _T("statbkuptmp.ini");
			break;
d2982 2
d2985 1
a2985 2
	CIni ini(strFullPath);
	ini.SetDefaultCategory(_T("Statistics"));
d2991 1
a2991 1
	ini.SetUInt64(_T("TotalDownloadedBytes"), /* g_App.stat_sessionReceivedBytes + */GetTotalDownloaded());
d2994 1
a2994 1
	ini.SetInt(_T("DownCompletedFiles"), cumDownCompletedFiles);
d2997 1
a2997 1
	ini.SetUInt32(_T("DownSuccessfulSessions"), dwCumDownSuccessfulSessions);
d3000 2
a3001 2
	ini.SetUInt32(_T("DownFailedSessions"), dwCumDownFailedSessions);
	ini.SetInt(_T("DownAvgTime"), (GetDownC_AvgTime() + GetDownS_AvgTime()) / 2);
d3004 3
a3006 3
	ini.SetUInt64(_T("LostFromCorruption"), m_qwCumLostFromCorruption + m_qwSesLostFromCorruption);
	ini.SetUInt64(_T("SavedFromCompression"), m_qwSesSavedFromCompression + m_qwCumSavedFromCompression);
	ini.SetInt(_T("PartsSavedByICH"), m_dwCumPartsSavedByICH + m_dwSesPartsSavedByICH);
d3009 9
a3017 9
	ini.SetUInt64(_T("DownData_EDONKEY"), GetCumDownData(SO_EDONKEY));
	ini.SetUInt64(_T("DownData_EDONKEYHYBRID"), GetCumDownData(SO_EDONKEYHYBRID));
	ini.SetUInt64(_T("DownData_EMULE"), GetCumDownData(SO_EMULE));
	ini.SetUInt64(_T("DownData_EMULEPLUS"), GetCumDownData(SO_PLUS));
	ini.SetUInt64(_T("DownData_MLDONKEY"), GetCumDownData(SO_MLDONKEY));
	ini.SetUInt64(_T("DownData_LMULE"), GetCumDownData(SO_XMULE));
	ini.SetUInt64(_T("DownData_AMULE"), GetCumDownData(SO_AMULE));
	ini.SetUInt64(_T("DownData_LPHANT"), GetCumDownData(SO_LPHANT));
	ini.SetUInt64(_T("DownData_SHAREAZA"), GetCumDownData(SO_SHAREAZA));
d3023 5
a3027 5
		ini.SetUInt64(_T("DownOverheadTotal"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequest() + g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + g_App.m_pDownloadQueue->GetDownDataOverheadServer() + g_App.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadTotal() );
		ini.SetUInt64(_T("DownOverheadFileReq"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		ini.SetUInt64(_T("DownOverheadSrcEx"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
		ini.SetUInt64(_T("DownOverheadServer"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadServer() + GetDownOverheadServer() );
		ini.SetUInt64(_T("DownOverheadOther"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadOther() );
d3029 5
a3033 5
		ini.SetUInt64(_T("DownOverheadTotalPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + g_App.m_pDownloadQueue->GetDownDataOverheadServerPackets() + g_App.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		ini.SetUInt64(_T("DownOverheadFileReqPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + GetDownOverheadFileReqPackets() );
		ini.SetUInt64(_T("DownOverheadSrcExPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		ini.SetUInt64(_T("DownOverheadServerPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
		ini.SetUInt64(_T("DownOverheadOtherPackets"), (uint64)g_App.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadOtherPackets() );
d3038 1
a3038 1
	ini.SetUInt64(_T("TotalUploadedBytes"), /* g_App.stat_sessionSentBytes + */GetTotalUploaded() );
d3042 3
a3044 3
		ini.SetInt(_T("UpSuccessfulSessions"), g_App.m_pUploadQueue->GetSuccessfulUpCount()+GetUpSuccessfulSessions());
		ini.SetInt(_T("UpFailedSessions"), g_App.m_pUploadQueue->GetFailedUpCount()+GetUpFailedSessions());
		ini.SetInt(_T("UpAvgTime"), (g_App.m_pUploadQueue->GetAverageUpTime()+GetUpAvgTime())/2);
d3047 10
a3056 10
		ini.SetUInt64(_T("UpOverheadTotal"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequest() + g_App.m_pUploadQueue->GetUpDataOverheadSourceExchange() + g_App.m_pUploadQueue->GetUpDataOverheadServer() + g_App.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadTotal() );
		ini.SetUInt64(_T("UpOverheadFileReq"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		ini.SetUInt64(_T("UpOverheadSrcEx"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		ini.SetUInt64(_T("UpOverheadServer"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		ini.SetUInt64(_T("UpOverheadOther"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadOther() );
		ini.SetUInt64(_T("UpOverheadTotalPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + g_App.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + g_App.m_pUploadQueue->GetUpDataOverheadServerPackets() + g_App.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets() );
		ini.SetUInt64(_T("UpOverheadFileReqPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets() );
		ini.SetUInt64(_T("UpOverheadSrcExPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		ini.SetUInt64(_T("UpOverheadServerPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
		ini.SetUInt64(_T("UpOverheadOtherPackets"), (uint64)g_App.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadOtherPackets() );
d3061 9
a3069 9
	ini.SetUInt64(_T("UpData_EDONKEY"), GetCumUpData(SO_EDONKEY));
	ini.SetUInt64(_T("UpData_EDONKEYHYBRID"), GetCumUpData(SO_EDONKEYHYBRID));
	ini.SetUInt64(_T("UpData_EMULE"), GetCumUpData(SO_EMULE));
	ini.SetUInt64(_T("UpData_EMULEPLUS"), GetCumUpData(SO_PLUS));
	ini.SetUInt64(_T("UpData_MLDONKEY"), GetCumUpData(SO_MLDONKEY));
	ini.SetUInt64(_T("UpData_LMULE"), GetCumUpData(SO_XMULE));
	ini.SetUInt64(_T("UpData_AMULE"), GetCumUpData(SO_AMULE));
	ini.SetUInt64(_T("UpData_LPHANT"), GetCumUpData(SO_LPHANT));
	ini.SetUInt64(_T("UpData_SHAREAZA"), GetCumUpData(SO_SHAREAZA));
d3072 2
a3073 2
	ini.SetUInt64(_T("UpData_File"), GetCumUpData_File());
	ini.SetUInt64(_T("UpData_Partfile"), GetCumUpData_PartFile());
d3076 2
a3077 2
	ini.SetUInt64(_T("UpData_Community"), GetCumUpData_Community() );
	ini.SetUInt64(_T("UpData_NoCommunity"), GetCumUpData_NoCommunity() );
d3085 1
a3085 1
		ini.SetDouble(_T("ConnAvgDownRate"), dTmp);
d3089 1
a3089 1
		ini.SetDouble(_T("ConnMaxAvgDownRate"), GetConnMaxAvgDownRate());
d3092 1
a3092 1
		ini.SetDouble(_T("ConnAvgUpRate"), dTmp);
d3096 1
a3096 1
		ini.SetDouble(_T("ConnMaxAvgUpRate"), GetConnMaxAvgUpRate());
d3104 1
a3104 1
		ini.SetDouble(_T("ConnMaxDownRate"), GetConnMaxDownRate());
d3112 1
a3112 1
		ini.SetDouble(_T("ConnMaxUpRate"), GetConnMaxUpRate());
d3118 1
a3118 1
	ini.SetUInt32(_T("ConnRunTime"), dwCumConnRunTime + (::GetTickCount() - g_App.stat_starttime) / 1000u);
d3121 1
a3121 1
		ini.SetWORD(_T("ConnNumReconnects"), g_App.stat_reconnects - 1 + GetConnNumReconnects());
d3123 1
a3123 1
		ini.SetWORD(_T("ConnNumReconnects"), GetConnNumReconnects());
d3131 1
a3131 1
			ini.SetUInt32(_T("ConnAvgConnections"), (uint32)(g_App.m_pMDlg->m_dlgStatistics.GetAverageConnections()+cumConnAvgConnections)/2);
d3137 1
a3137 1
			ini.SetUInt32(_T("ConnMaxConnLimitReached"), g_App.m_pListenSocket->GetMaxConnectionsReachedCount() + cumConnMaxConnLimitReached);
d3147 1
a3147 1
		ini.SetInt(_T("ConnPeakConnections"), cumConnPeakConnections);
d3150 4
a3153 4
		ini.SetUInt32(_T("ConnTransferTime"), GetConnTransferTime() + g_App.m_pMDlg->m_dlgStatistics.GetTransferTime());
		ini.SetUInt32(_T("ConnUploadTime"), GetConnUploadTime() + g_App.m_pMDlg->m_dlgStatistics.GetUploadTime());
		ini.SetUInt32(_T("ConnDownloadTime"), GetConnDownloadTime() + g_App.m_pMDlg->m_dlgStatistics.GetDownloadTime());
		ini.SetUInt32(_T("ConnServerDuration"), GetConnServerDuration() + g_App.m_pMDlg->m_dlgStatistics.GetServerDuration());
d3165 1
a3165 1
		ini.SetInt(_T("SrvrsMostWorkingServers"), cumSrvrsMostWorkingServers);
d3168 1
a3168 1
		ini.SetInt(_T("SrvrsMostUsersOnline"), cumSrvrsMostUsersOnline);
d3171 1
a3171 1
		ini.SetInt(_T("SrvrsMostFilesAvail"), cumSrvrsMostFilesAvail);
d3179 1
a3179 1
		ini.SetInt(_T("SharedMostFilesShared"), cumSharedMostFilesShared);
d3186 1
a3186 1
		ini.SetUInt64(_T("SharedLargestShareSize"), m_qwCumSharedLargestShareSize);
d3189 1
a3189 1
		ini.SetUInt64(_T("SharedLargestFileSize"), m_qwCumSharedLargestFileSize);
d3197 2
a3198 2
		ini.SetUInt64(_T("SharedLargestAvgFileSize"), m_qwCumSharedLargestAvgFileSize);
		ini.SetUInt32(_T("statsDateTimeLastReset"), stat_datetimeLastReset);
d3203 1
a3203 1
	ini.SetString(_T("statsExpandedTreeItems"), m_strStatsExpandedTreeItems);
d3205 3
a3207 1
	ini.SaveAndClose();
a3314 1
	ini.SetUInt32(_T("DownSessionCompletedFiles"), GetDownSessionCompletedFiles());
@


1.418
log
@Removed smooth migration preferences.ini settings and onlinesig.dat location.
@
text
@a368 5
#ifndef NEW_SOCKETS_ENGINE
	//	Force OS to flush data direct to disk on shutdown
		if (!g_App.m_pMDlg->IsRunning())
			_commit(_fileno(pPrefFile));
#endif //NEW_SOCKETS_ENGINE
a2034 5
//	Import old shortcut parameters
	m_anShortcutCode[SCUT_FILE_OPENDIR] = static_cast<short>(ini.GetInt(_T("ShareOpenShortcut"), m_anShortcutCode[SCUT_FILE_OPENDIR]));
	m_anShortcutCode[SCUT_LINK] = static_cast<short>(ini.GetInt(_T("ShareED2KLinkShortcut"), m_anShortcutCode[SCUT_LINK]));
	m_anShortcutCode[SCUT_LINK_HTML] = static_cast<short>(ini.GetInt(_T("ShareED2kLinkHtmlShortcut"), m_anShortcutCode[SCUT_LINK_HTML]));
	m_anShortcutCode[SCUT_LINK_SOURCE] = static_cast<short>(ini.GetInt(_T("ShareED2kLinkSourceShortcut"), m_anShortcutCode[SCUT_LINK_SOURCE]));
a2098 1

d2109 2
a2110 2
//	If filters.txt doesn't exist make a new one and write directions
	if (!PathFileExists(strFullPath))
d2112 7
d2120 1
a2126 5
#ifdef _UNICODE
		const uint16	uBOM = 0xFEFFu;

		FilterFile.Write(&uBOM, sizeof(uBOM));
#endif
a2131 4
//	Open filter file
	if (!FilterFile.Open(strFullPath, CFile::modeRead | CFile::shareDenyWrite | CFile::typeBinary))
		return false;

d2153 1
a2153 1
		if ((strLine.GetLength() > 1) && (_T('#') != strLine[0]))
a2743 1
	bool		bAlreadySaved = false;
a2901 1
			bAlreadySaved = true;
a2951 4
	// End Load Stats
	if (!bAlreadySaved)
		ini.CloseWithoutSave();

d2977 1
a2977 1
void CPreferences::SaveStats(int bBackUp)
d3222 1
a3222 8
	// If we are saving a back-up or a temporary back-up, return now.
	// if (bBackUp != 0) return;

	// by default save chages & close the file
	// if (bBackUp == 0)
		ini.SaveAndClose();

	// End SaveStats
@


1.417
log
@Reduced H-file dependency.
@
text
@d130 1
a130 1
#define EP_PREFUPD_COMMENT_FILTER		_T("fastest eMule ever")
a195 5
#if 1	//code left for smooth migration, delete in v1.2f
	// This file was moved (in 1.2c) to the AppDir for compatibility reasons
	// Delete old for a while as some signature application searches first in config dir
	::DeleteFile(m_strConfigDir + _T("onlinesig.dat"));
#endif
a738 3
#if 1	//code left for smooth migration, delete in v1.2f
	ini.SetInt(_T("DeadServerRetries"), m_dwDeadServerRetries);
#endif
a1536 8
#if 1	//code left for smooth migration, delete in v1.2f
	ini.GetString(&strBuf, _T("IRCServer"), _T("irc.emuleplus.info"));
// Change old invalid values to current default
	strBuf.Trim().MakeLower();
	if (strBuf.Left(13) == _T("irc.freshirc."))
		strBuf = _T("irc.emuleplus.info");
	*m_sIRCServer.GetRaw() = strBuf;
#else
a1537 2
#endif

@


1.416
log
@Enabled Source Save/Load by default to ease source search on restart;
Updated file cleanup string list (removed few extremely rare old strings; added 2 new ones).
@
text
@d32 1
@


1.415
log
@Strip IRC user message colors {xalbux}.
@
text
@d130 1
a130 1
#define EP_PREFUPD_FILENAME_CLEANUP		_T("shareconnector")
d1461 1
a1461 1
	m_bSLSEnable = ini.GetBool(_T("SLS_Enable"), false);
d1999 1
a1999 1
	ini.GetString(m_sFilenameCleanups.GetRaw(), _T("FilenameCleanups"), _T("http|www.|sharereactor|shareconnector|sharelive|filedonkey|saugstube|eselfilme|eseldownloads|donkey-mania|emulemovies|spanishare|eselpsychos.de|saughilfe.de|goldesel.6x.to|goldesel.tk|freedivx.org|elitedivx|deviance|filenexus|ac3-guru"));
@


1.414
log
@Reduced H-file dependency.
@
text
@d840 1
d1565 1
@


1.413
log
@Temporary structure moved from class to local variables;
Protection against zero hash read from preferences.dat (if it happens data is read from userhash.dat or regenerated if this file doesn't exist).
@
text
@a19 1
#include <time.h>
d31 1
@


1.412
log
@Generate a userhash only when needed;
Removed useless checks around delete operator.
@
text
@a179 3
//	Legacy preferences structs
	memzero(&m_prefsExt, sizeof(Preferences_Ext_Struct));

d358 1
a365 2
	m_prefsExt.version = PREFFILE_VERSION;

d368 3
a370 3
		m_prefsExt.version = PREFFILE_VERSION;
		m_prefsExt.EmuleWindowPlacement = m_WindowPlacement;
		md4cpy(m_prefsExt.abyteUserHash, m_userHash);
d372 1
a372 1
		bError = (fwrite(&m_prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefFile) == 0);
d2095 1
d2108 1
a2108 1
	if (fread(&m_prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefsFile) != 0)
d2110 11
a2120 2
		md4cpy(m_userHash, m_prefsExt.abyteUserHash);
		m_WindowPlacement = m_prefsExt.EmuleWindowPlacement;
a2121 3
	else
		SetStandardValues();

@


1.411
log
@Fixed initialization of the average download time statistics; Faster reading for some ini strings; More efficient ways to initialize few arrays.
@
text
@a215 3
//	Generate a random user hash in 'm_userHash', mark it as eMule
	CreateUserHash();

d251 1
d253 1
a253 3

	if (m_pNameTag != NULL)
		free(m_pNameTag);
d295 2
d3639 1
a3639 2
	if (pTmp != NULL)
		free(pTmp);
@


1.410
log
@Fixed uninitialised session upload priority statistics;
Minor code cleanup.
@
text
@d1830 2
a1831 1
	StringToHash(ini.GetString(_T("A4AFAutoFileHash"), _T("")), m_A4AF_FileHash);
d1907 4
a1910 2
	StringToHash(ini.GetString(_T("Password"), _T("")), m_abyteWebPassword);
	StringToHash(ini.GetString(_T("PasswordLow"), _T("")), m_abyteLowWebPassword);
d1966 2
a1967 1
	StringToHash(ini.GetString(_T("Password"), _T("")), m_abyteMMPassword);
d1992 2
a1993 1
	m_dwLancastSubnet = inet_addr(ini.GetString(_T("Subnet"), _T("255.255.0.0")));
d2716 2
a2717 5
	for (unsigned ui = 0; ui < SO_LAST; ui++)
	{
		cumUpDataClients[static_cast<EnumClientTypes>(ui)] = 0;
		cumDownDataClients[static_cast<EnumClientTypes>(ui)] = 0;
	}
d2956 1
d2958 3
a2960 7
		for (unsigned ui = 0; ui < SO_LAST; ui++)
		{
			sesDownDataClients[static_cast<EnumClientTypes>(ui)] = 0;
			sesUpDataClients[static_cast<EnumClientTypes>(ui)] = 0;
		}
		for (unsigned ui = 0; ui < ARRSIZE(sesUpDataPriority); ui++)
			sesUpDataPriority[ui] = 0;
@


1.409
log
@IRC: save state of the user list.
@
text
@d2711 1
a2711 2

	for (int i = 0; i < SO_LAST; i++)
d2713 2
a2714 2
		cumUpDataClients[i] = 0;
		cumDownDataClients[i] = 0;
d2917 3
a2919 3
		// Check to make sure the backup of the values we just overwrote exists. If so, rename it to the backup file.
		// This allows us to undo a restore, so to speak, just in case we don't like the restored values...

a2920 1
		CString sINIBackUp;
d2953 1
a2953 1
		// Initialize new session statistic variables...
d2955 1
a2955 1
		for (int i = 0; i < SO_LAST; i++)
d2957 2
a2958 2
			sesDownDataClients[(EnumClientTypes)i] = 0;
			sesUpDataClients[(EnumClientTypes)i] = 0;
d2960 2
@


1.408
log
@Temporary disabled obfuscation configuration.
@
text
@d487 2
d523 3
d557 2
d593 3
d627 2
d663 3
d941 3
d965 1
d977 1
d1734 3
d1775 3
d1798 1
d2414 2
d2447 2
d2487 3
d2531 3
@


1.407
log
@Extended cumulative statistics successful and failed download sessions to keep bigger values (only 65535 before);
Suppressed compiler warnings; Additional sanity checks; Formatting.
@
text
@d1020 1
d1024 1
d1846 1
d1854 5
@


1.406
log
@added UTF8 encoding support for IRC (can be activated only over pref.ini)
@
text
@d504 1
a504 1
			m_auDownloadColumnWidths[index] = width;
d507 1
a507 1
			m_auUploadColumnWidths[index] = width;
d510 1
a510 1
			m_auQueueColumnWidths[index] = width;
d513 1
a513 1
			m_auSearchColumnWidths[index] = width;
d516 1
a516 1
			m_auSharedColumnWidths[index] = width;
d519 1
a519 1
			m_auServerColumnWidths[index] = width;
d522 1
a522 1
			m_auIrcColumnWidths[index] = width;
d525 1
a525 1
			m_auClientListColumnWidths[index] = width;
d528 1
a528 1
			m_auPartStatusColumnWidths[index] = width;
d531 1
a531 1
			m_auFriendColumnWidths[index] = width;
d773 1
a773 1
	ini.SetInt(_T("ToolbarLabels"), m_nToolbarLabels);
d818 2
a829 1
	ini.SetBool(_T("SmartIdCheck"), m_bSmartIdCheck);
d868 1
a868 1
	ini.SetInt(_T("SearchMethod"), m_byteSearchMethod);
d1329 1
a1329 1
	m_nMaxConnections = ini.GetInt(_T("MaxConnections"), GetRecommendedMaxConnections());
d1380 4
a1383 3
	m_byteUpbarColorPartTraffic = ini.GetInt(_T("UploadbarColor"), 0);
	if (m_byteUpbarColorPartTraffic > 3)
		m_byteUpbarColorPartTraffic = 0;
d1387 2
a1388 2
	m_nTrafficOMeterInterval = ini.GetInt(_T("StatGraphsInterval"), 3);
	m_nStatsInterval = ini.GetInt(_T("StatsInterval"), 5);
d1400 3
a1402 3
	m_nStatsMax = ini.GetInt(_T("VariousStatisticsMaxValue"), 100);
	m_nStatsAverageMinutes = ini.GetInt(_T("StatsAverageMinutes"), 5);
	m_nMaxConPerFive = ini.GetInt(_T("MaxConnectionsPerFiveSeconds"), GetDefaultMaxConPerFiveSecs());
d1407 1
a1407 1
		m_nMaxConPerFive = dwVal;
d1472 3
a1474 1
	m_nToolbarLabels = ini.GetInt(_T("ToolbarLabels"),1);
a1537 1
	m_bIRCMessageEncodingUTF8 = ini.GetBool(_T("IRCMessageEncodingUTF8"), false);
d1542 1
a1542 1
	m_nIRCChannelUserFilter = ini.GetInt(_T("IRCFilterUser"), 0);
d1547 2
d1625 1
a1625 1
	m_nXSUpTo = ini.GetInt(_T("XSUpTo"), uVal = GetMaxSourcePerFileSoft());
d1629 1
a1629 1
	m_nFontSize = ini.GetInt(_T("FontSize"), 80);
d1635 3
a1637 3
	m_byteSearchMethod = ini.GetInt(_T("SearchMethod"), EP_SEARCHMETHOD_SERV);
	if (m_byteSearchMethod >= EP_SEARCHMETHOD_COUNT)
		m_byteSearchMethod = EP_SEARCHMETHOD_SERV;
d1669 1
a1669 1
		m_uSCHShift1Upload = m_dwMaxGraphUploadRate;
d1674 3
a1676 3
		m_uSCHShift1Download = m_dwMaxGraphDownloadRate;
	m_nSCHShift1conn = ini.GetInt(_T("SCHShift1Conn"),512);
	m_nSCHShift15sec = ini.GetInt(_T("SCHShift15sec"),40);
d1688 2
a1689 2
	m_nSCHShift2conn = ini.GetInt(_T("SCHShift2Conn"),256);
	m_nSCHShift25sec = ini.GetInt(_T("SCHShift25sec"),20);
d1820 1
a1820 1
	m_nSmartFilterMaxQR = ini.GetInt(_T("SmartFilterMaxQueueRank"), 25);
d1839 1
a1839 1
	m_uSplitterPosFriend = ini.GetInt(_T("SplitterbarPositionFriend"), 240);
d1995 1
a1995 1
	m_nScheduledBackupInterval = ini.GetInt(_T("ScheduledBackupInterval"),5);
d2658 2
a2659 2
	cumDownSuccessfulSessions = 0;
	cumDownFailedSessions = 0;
d2805 2
a2806 2
	cumDownSuccessfulSessions = ini.GetInt(_T("DownSuccessfulSessions"), 0);
	cumDownFailedSessions = ini.GetInt(_T("DownFailedSessions"), 0);
d2840 4
a2843 4
	cumConnNumReconnects = ini.GetInt(_T("ConnNumReconnects"), 0);
	cumConnAvgConnections = ini.GetInt(_T("ConnAvgConnections"), 0);
	cumConnMaxConnLimitReached = ini.GetInt(_T("ConnMaxConnLimitReached"), 0);
	cumConnPeakConnections = ini.GetInt(_T("ConnPeakConnections"), 0);
d2897 1
a2897 1
		cumSrvrsMostWorkingServers = ini.GetInt(_T("SrvrsMostWorkingServers"), 0);
d2902 1
a2902 1
		cumSharedMostFilesShared = ini.GetInt(_T("SharedMostFilesShared"), 0);
d3002 1
a3002 1
	ini.SetInt(_T("DownSuccessfulSessions"), cumDownSuccessfulSessions);
d3005 1
a3005 1
	ini.SetInt(_T("DownFailedSessions"), cumDownFailedSessions);
d3150 2
a3151 2
		if (g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections()>cumConnPeakConnections)
			cumConnPeakConnections = g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections();
@


1.405
log
@Allow export localized ed2k links (skip utf8 conversion) {DoubleT} -- GUI part will be added later.
@
text
@d829 1
d1534 1
@


1.404
log
@set locale to the system default (thanks Aw3)
@
text
@d973 1
d1787 1
@


1.403
log
@Added more sanity checks for input; Defined some default values;
Fixed potential stack corruption on reading of extremely long category paths;
Suppressed compiler warnings; Formatting.
@
text
@d3634 2
d3638 1
a3638 1
		LCID lcid = MAKESORTLCID(m_nLanguageID, uSortIdUser, uSortVerUser);
d3646 1
a3646 10
	const StructLanguage *pLangs = g_aLangs;
	CString strCodepage(_T(".ACP"));

	do
	{
		if (pLangs->uLangs == m_nLanguageID)
			strCodepage.Format(_T(".%u"), pLangs->uCodepage);
		pLangs++;
	} while (pLangs->uLangs != 0);
	_tsetlocale(LC_CTYPE, strCodepage);
@


1.402
log
@Removed meaningless statistics class check
@
text
@d728 1
a728 1
	ini.SetInt(_T("QueueSize"), m_nQueueSize);
d795 1
a795 1
	ini.SetInt(_T("SlowCompleteBlockSize"), m_nSlowCompleteBlockSize);
d849 1
a849 1
	ini.SetInt(_T("Profile"), m_nProfile);
d1036 1
a1036 1
	ini.SetInt(_T("Port"), m_nWebPort);
d1042 1
a1042 1
	ini.SetInt(_T("LoginAttemptsAllowed"), m_nWebLoginAttemptsAllowed);
d1361 5
a1365 5
	m_nQueueSize = ini.GetInt(_T("QueueSize"), MIN_QUEUE*3);
	if(m_nQueueSize > MAX_QUEUE)
		m_nQueueSize = MAX_QUEUE;
	else if(m_nQueueSize < MIN_QUEUE)
		m_nQueueSize = MIN_QUEUE;
d1498 5
a1502 5
	m_nSlowCompleteBlockSize = ini.GetInt(_T("SlowCompleteBlockSize"), 32);
	if (m_nSlowCompleteBlockSize < 8)
		m_nSlowCompleteBlockSize = 8;
	if (m_nSlowCompleteBlockSize > 256)
		m_nSlowCompleteBlockSize = 256;
d1594 10
a1603 7
	m_nProfile = ini.GetInt(_T("Profile"),0);
	m_nPriorityHigh = ini.GetInt(_T("PriorityHigh"),100);
	m_nPriorityLow = ini.GetInt(_T("PriorityLow"),300);
	if(m_nPriorityLow != 0)
	{
		if(m_nPriorityLow < m_nPriorityHigh)
			m_nPriorityLow = m_nPriorityHigh * 2;
d1605 1
a1605 1
	else
d1607 2
a1608 2
		m_nPriorityLow = 300;
		m_nPriorityHigh = 100;
d1850 5
a1854 1
	m_proxy.m_uPort = ini.GetInt(_T("Port"), PREF_DEF_PROXY_PORT);
d1864 4
a1867 1
	m_nWebPort = ini.GetInt(_T("Port"), PREF_DEF_WS_PORT);
d1873 7
a1879 3
	if (m_dwWebTempDisableLogin > 60)
		m_dwWebTempDisableLogin = 60;
	m_nWebLoginAttemptsAllowed = ini.GetInt(_T("LoginAttemptsAllowed"), 3);
d1921 4
a1924 1
	m_uMMPort = ini.GetInt(_T("Port"), PREF_DEF_MM_PORT);
d1945 4
a1948 1
	m_uLancastPort = ini.GetInt(_T("Port"), 5000);
d2273 2
a2274 1
		_tcscpy(strSavePath, iniCat.GetString(_T("Incoming"), _T("")));
d2279 1
d2284 2
a2285 1
		_tcscpy(strTempPath, iniCat.GetString(_T("Temp"), GetTempDir()));
d3141 1
a3141 1
		if (g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections() > cumConnPeakConnections)
@


1.401
log
@Fixed ANSI logs backup on first Unicode startup;
Corrected read type of "DeadServerAction" value from preferences.ini (it was int instead of bool);
Removed meaningless statistics class check [eklmn].
@
text
@d3054 1
a3054 1
	if(g_App.m_pMDlg)
d3115 1
a3115 1
	if(g_App.m_pMDlg)
d3117 10
a3126 13
		if (g_App.m_pMDlg->m_dlgStatistics)
		{
			// Peak Connections
			if (g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections()>cumConnPeakConnections)
				cumConnPeakConnections = g_App.m_pMDlg->m_dlgStatistics.GetPeakConnections();
			ini.SetInt(_T("ConnPeakConnections"), cumConnPeakConnections);

			// Time Stuff...
			ini.SetUInt32(_T("ConnTransferTime"), GetConnTransferTime() + g_App.m_pMDlg->m_dlgStatistics.GetTransferTime());
			ini.SetUInt32(_T("ConnUploadTime"), GetConnUploadTime() + g_App.m_pMDlg->m_dlgStatistics.GetUploadTime());
			ini.SetUInt32(_T("ConnDownloadTime"), GetConnDownloadTime() + g_App.m_pMDlg->m_dlgStatistics.GetDownloadTime());
			ini.SetUInt32(_T("ConnServerDuration"), GetConnServerDuration() + g_App.m_pMDlg->m_dlgStatistics.GetServerDuration());
		}
@


1.400
log
@fixed crazy values in time statistic after new(clean) instalation
@
text
@d209 1
a209 1
		m_strDownloadLogFilePath += _T(".ansi");
d1326 1
a1326 1
	m_nMaxConnections = ini.GetInt(_T("MaxConnections"),GetRecommendedMaxConnections());
d1328 1
a1328 1
	m_bRemoveDeadServers = ini.GetInt(_T("DeadServerAction"), true);
d1592 2
a1593 2
	m_nNotificationDisplayTime = ini.GetInt(_T("NotificationDisplayTime"),4000);
	m_nNotificationFontSize = ini.GetInt(_T("NotificationFontSize"),70);
d2249 1
a2249 2
		TCHAR	strSavePath[MAX_PATH];
		TCHAR	strTempPath[MAX_PATH];
d3056 14
a3069 17
		if (g_App.m_pMDlg->m_dlgStatistics)
		{
			// Download Rate Average
			dTmp = g_App.m_pMDlg->m_dlgStatistics.GetAvgDownloadRate(AVG_TOTAL);
			ini.SetDouble(_T("ConnAvgDownRate"), dTmp);
			// Max Download Rate Average
			if (dTmp > GetConnMaxAvgDownRate())
				Add2ConnMaxAvgDownRate(dTmp);
			ini.SetDouble(_T("ConnMaxAvgDownRate"), GetConnMaxAvgDownRate());
			// Upload Rate Average
			dTmp = g_App.m_pMDlg->m_dlgStatistics.GetAvgUploadRate(AVG_TOTAL);
			ini.SetDouble(_T("ConnAvgUpRate"), dTmp);
			// Max Upload Rate Average
			if (dTmp > GetConnMaxAvgUpRate())
				Add2ConnMaxAvgUpRate(dTmp);
			ini.SetDouble(_T("ConnMaxAvgUpRate"), GetConnMaxAvgUpRate());
		}
@


1.399
log
@Remove Dead Server enable/disable should be bool value;
Introduced max dead server retries limit (20);
Corrected IP Filter Update Frequency default value (7) which was above the possible range (0-6);
Added sanity check for IP Filter Update Frequency value; Formatting.
@
text
@d2893 2
@


1.398
log
@Increased default tooltip delay from 1 to 2 what make probably more sense;
Added sanity checks for Max Sources per File, Tooltip delay, Ban Time, Min Request Time for Ban, Min Requests to ban, Connection Graph Ratio.
@
text
@d713 1
a713 1
	ini.SetInt(_T("DeadServerAction"), m_nDeadServer);
d735 1
a735 1
	ini.SetInt(_T("DeadServerRetries"), m_nDeadServerRetries);
d737 1
a737 1
	ini.SetInt(_T("DeadServerRetry"), m_nDeadServerRetries);
d1003 1
a1003 1
	ini.SetInt(_T("IPFilterUpdateFrequency"), 	m_iIPFilterUpdateFrequency);
d1328 1
a1328 1
	m_nDeadServer = ini.GetInt(_T("DeadServerAction"), 2);
d1387 2
a1388 2
	m_nDeadServerRetries = ini.GetInt(_T("DeadServerRetries"), 1);
	m_nDeadServerRetries = ini.GetInt(_T("DeadServerRetry"), m_nDeadServerRetries);
d1390 1
a1390 1
	m_nDeadServerRetries = ini.GetInt(_T("DeadServerRetry"), 1);
d1392 4
a1395 2
	if (m_nDeadServerRetries == 0)
		m_nDeadServerRetries = 1;
d1492 5
a1496 5
	m_nSrvConTimeout = ini.GetInt(_T("SrvConTimeout"),20000);
	if(m_nSrvConTimeout < 10000)
		m_nSrvConTimeout = 10000;
	if(m_nSrvConTimeout > 60000)
		m_nSrvConTimeout = 60000;
d1811 1
a1811 1
	m_byteIPFilterLevel			= static_cast<unsigned char>(ini.GetInt(_T("FilterLevel"), 127));
d1816 3
a1818 1
	m_iIPFilterUpdateFrequency	= ini.GetInt(_T("IPFilterUpdateFrequency"), 7);
@


1.397
log
@Formatting.
@
text
@d718 1
a718 1
	ini.SetInt(_T("MaxSourcesPerFile"), m_nMaxSourcePerFile);
d727 1
a727 1
	ini.SetInt(_T("ToolTipDelay"), m_nTooltipDelayTime);
d742 3
a744 3
	ini.SetInt(_T("BadClientBanTime"), m_nBadClientBanTime);
	ini.SetInt(_T("BadClientMinRequestTime"), m_nMinRequestTime);
	ini.SetInt(_T("BadClientMinRequestNum"), m_nBadClientBan);
d748 2
a749 2
	ini.SetInt(_T("SLS_WhenSourcesOutdated"), m_nSLSOutdated);
	ini.SetInt(_T("SLS_MaxSourcesPerFile"),m_SLSMaxSourcesPerFile);
d966 1
a966 1
	ini.SetInt(_T("ConnectionsGraphRatio"), m_nGraphRatio);
d1076 3
a1078 3
	ini.SetBool(_T("Enabled"), m_LancastEnabled);
	ini.SetBool(_T("UseDefaultIP"), m_UseDefaultIP);
	strBuf.Format(_T("%i.%i.%i.%i"),(byte)m_LancastIP,(byte)(m_LancastIP>>8),(byte)(m_LancastIP>>16),(byte)(m_LancastIP>>24));
d1080 1
a1080 1
	strBuf.Format(_T("%i.%i.%i.%i"),(byte)m_LancastSubnet,(byte)(m_LancastSubnet>>8),(byte)(m_LancastSubnet>>16),(byte)(m_LancastSubnet>>24));
d1082 1
a1082 1
	ini.SetInt(_T("Port"), m_LancastPort);
d1355 5
a1359 1
	m_nMaxSourcePerFile = ini.GetInt(_T("MaxSourcesPerFile"), 400);
d1380 3
a1382 1
	m_nTooltipDelayTime = ini.GetInt(_T("ToolTipDelay"), 1);
d1402 1
a1402 1
	else if(m_nMaxConPerFive < 5)
d1405 18
a1422 11
	m_nBadClientBanTime = ini.GetInt(_T("BadClientBanTime"),3600000);
	if(m_nBadClientBanTime > 18000000)
		m_nBadClientBanTime = 18000000;

	m_nMinRequestTime = ini.GetInt(_T("BadClientMinRequestTime"),590000);
	if(m_nMinRequestTime > 590000)
		m_nMinRequestTime = 590000;

	m_nBadClientBan = ini.GetInt(_T("BadClientMinRequestNum"),3);
	if(m_nBadClientBan < 3)
		m_nBadClientBan = 3;
d1426 11
a1436 11
	m_nSLSOutdated = ini.GetInt(_T("SLS_WhenSourcesOutdated"),1);
	if(m_nSLSOutdated > 2)
		m_nSLSOutdated = 2;
	else if(m_nSLSOutdated < 1)
		m_nSLSOutdated = 1;

	m_SLSMaxSourcesPerFile = ini.GetInt(_T("SLS_MaxSourcesPerFile"),10);
	if(m_SLSMaxSourcesPerFile > 20)
		m_SLSMaxSourcesPerFile = 20;
	else if(m_SLSMaxSourcesPerFile < 5)
		m_SLSMaxSourcesPerFile = 5;
d1455 1
a1455 1
		m_nMaxSourcePerFile = m_nMinAutoSourcesPerFile;
d1772 4
a1775 2
	m_nGraphRatio = ini.GetInt(_T("ConnectionsGraphRatio"),1);

d1919 6
a1924 6
	m_LancastEnabled = ini.GetBool(_T("Enabled"), false);
	m_UseDefaultIP = ini.GetBool(_T("UseDefaultIP"), true);
	m_DefaultLancastIP = inet_addr(strBuf);
	m_LancastIP = inet_addr(ini.GetString(_T("IPAddress"), strBuf));
	m_LancastSubnet = inet_addr(ini.GetString(_T("Subnet"), _T("255.255.0.0")));
	m_LancastPort = ini.GetInt(_T("Port"), 5000);
d2286 1
a2286 1
	return (GetLancastUseDefaultIP()) ? m_DefaultLancastIP : m_LancastIP;
d3577 1
a3577 1
	unsigned ui = static_cast<unsigned>(m_nMaxSourcePerFile) * 9u / 10u;
d3584 1
a3584 1
	unsigned ui = (static_cast<unsigned>(m_nMaxSourcePerFile) * 3u) >> 2u;
@


1.396
log
@changed the intialization of thread locale
@
text
@d3612 2
a3613 2
		if (pLangs->wLangs == m_nLanguageID)
			strCodepage.Format(_T(".%u"), pLangs->wCodepage);
d3615 1
a3615 1
	} while (pLangs->wLangs != 0);
@


1.395
log
@Proper share mode for open files (before other applications could write to a file while we were reading);
Suppressed compiler warnings.
@
text
@d91 37
d2491 1
d2553 2
a2554 4
			if (m_bIsNTBased)
				SetThreadLocale(m_nLanguageID); // THIS FUNCTION DOES NOT WORK ON WIN9X !!!!!!!!
			else
				ASSERT(false); // locale NOT set because we just can't do it on Win9x!!!!
a2561 2
	if (m_bIsNTBased)
		SetThreadLocale(m_nLanguageID);
d3588 30
@


1.394
log
@Preparation to add player parameters; Added value check for "AcceptMessageFrom".
@
text
@d19 1
d254 1
a254 1
	FILE	*pHashFile = _tfopen(strFullPath, _T("rb"));
d331 1
a331 1
	FILE	*pPrefFile = _tfopen(strFullPath, _T("wb"));
d355 1
a355 1
	FILE	*pHashFile = _tfopen(strFullPath, _T("wb"));
d694 1
a694 1
	ini.SetInt(_T("DetailColumnWidth"), m_nDetailColumnWidth);
d1342 1
a1342 1
	m_nDetailColumnWidth = ini.GetInt(_T("DetailColumnWidth"), 150);
d1618 1
a1618 1
		m_uSCHShift2Upload = m_dwMaxGraphUploadRate;
d1623 1
a1623 1
		m_uSCHShift2Download = m_dwMaxGraphDownloadRate;
d1980 1
a1980 1
	FILE	*pPrefsFile = _tfopen(strFullPath, _T("rb"));
@


1.393
log
@added Unicode support for hello packets
@
text
@d668 1
d943 1
a943 1
	ini.SetInt(_T("AcceptMessageFrom"), m_nAcceptMessagesFrom);
d1237 1
d1737 3
a1739 1
	m_nAcceptMessagesFrom = ini.GetInt(_T("AcceptMessageFrom"),1);
@


1.392
log
@Preparation to add player parameters; Suppressed compiler warnings; Formatting;
Removed protection for video player path, as it isn't accessed from other threads it should be safe without it;
Added read value verification for part traffic configuration;
Better file sharing scheme while reading filter.dat.
@
text
@d3508 1
a3508 1
	tagWr.WriteToFile(CT_NAME, m_sNick.Get(), NameBuff);
@


1.391
log
@added unicode support for 'filter.dat'
@
text
@d667 1
a667 1
	ini.SetString(_T("VideoPlayer"), *m_sVideoPlayer.Get(&strBuf));
d685 2
a686 2
	ini.SetInt(_T("UploadbarStyle"), m_nUpbarPartTraffic);
	ini.SetInt(_T("UploadbarColor"), m_nUpbarColorPartTraffic);
d794 10
a803 10
	ini.SetInt(_T("SortServersCode"), m_nServerSortCol);
	ini.SetInt(_T("SortUploadsCode"), m_nUploadSortCol);
	ini.SetInt(_T("SortQueueCode"), m_nQueueSortCol);
	ini.SetInt(_T("SortSearchCode"), m_nSearchSortCol);
	ini.SetInt(_T("SortIrcCode"), m_nIRCSortCol);
	ini.SetInt(_T("SortFilesCode"), m_nFileSortCol);
	ini.SetInt(_T("SortDownloadsCode"), m_nDownloadSortCol);
	ini.SetInt(_T("SortClientListCode"), m_nClientListSortCol);
	ini.SetInt(_T("1stSortSourcesCode"), m_nSrcSortCol1);
	ini.SetInt(_T("2ndSortSourcesCode"), m_nSrcSortCol2);
d947 1
a947 1
	ini.SetBool(_T("PreviewSmallBlocks"), m_iPreviewSmallBlocks);
d1235 1
a1235 1
	ini.GetString(m_sVideoPlayer.GetRaw(), _T("VideoPlayer"), _T(""));
d1237 1
a1237 1
	m_iPreviewSmallBlocks = ini.GetBool(_T("PreviewSmallBlocks"), false);
d1240 1
a1240 1
	if (_taccess(m_sVideoPlayer.Get().Trim(), 0) != 0)
d1253 2
a1254 2
				m_sVideoPlayer.Put(szBuf);
				m_iPreviewSmallBlocks = true;
d1269 1
a1269 2
					m_sVideoPlayer.Put(strBuf);
					//	m_iPreviewSmallBlocks = true;	//	not needed, check for VLC is done in CPartFile::PreviewAvailable()
d1330 6
a1335 2
	m_nUpbarPartTraffic = ini.GetInt(_T("UploadbarStyle"), 2);
	m_nUpbarColorPartTraffic = ini.GetInt(_T("UploadbarColor"), 0);
d1503 30
a1532 30
	m_nServerSortCol = ini.GetInt(_T("SortServersCode"), SL_COLUMN_SERVERNAME);
	if ((m_nServerSortCol & MLC_COLUMNMASK) >= SL_COLUMN_NUMCOLUMNS)
		m_nServerSortCol = SL_COLUMN_SERVERNAME;
	m_nUploadSortCol = ini.GetInt(_T("SortUploadsCode"), MLC_SORTDESC | ULCOL_UPLOADTIME);
	if ((m_nUploadSortCol & MLC_COLUMNMASK) >= ULCOL_NUMCOLUMNS)
		m_nUploadSortCol = MLC_SORTDESC | ULCOL_UPLOADTIME;
	m_nQueueSortCol = ini.GetInt(_T("SortQueueCode"), MLC_SORTDESC | QLCOL_QLRATING);
	if ((m_nQueueSortCol & MLC_COLUMNMASK) >= QLCOL_NUMCOLUMNS)
		m_nQueueSortCol = MLC_SORTDESC | QLCOL_QLRATING;
	m_nSearchSortCol = ini.GetInt(_T("SortSearchCode"), MLC_SORTDESC | SL_COLUMN_SOURCES);
	if ((m_nSearchSortCol & MLC_COLUMNMASK) >= SL_NUMCOLUMNS)
		m_nSearchSortCol = MLC_SORTDESC | SL_COLUMN_SOURCES;
	m_nIRCSortCol = ini.GetInt(_T("SortIrcCode"), IRC2COL_NAME);
	if ((m_nIRCSortCol & MLC_COLUMNMASK) >= IRC2COL_NUMCOLUMNS)
		m_nIRCSortCol = IRC2COL_NAME;
	m_nFileSortCol = ini.GetInt(_T("SortFilesCode"), SFL_COLUMN_FILENAME);
	if ((m_nFileSortCol & MLC_COLUMNMASK) >= SFL_NUMCOLUMNS)
		m_nFileSortCol = SFL_COLUMN_FILENAME;
	m_nClientListSortCol = ini.GetInt(_T("SortClientListCode"), CLCOL_USERNAME);
	if ((m_nClientListSortCol & MLC_COLUMNMASK) >= CLCOL_NUMCOLUMNS)
		m_nClientListSortCol = CLCOL_USERNAME;
	m_nDownloadSortCol = ini.GetInt(_T("SortDownloadsCode"), DLCOL_STATUS);
	if ((m_nDownloadSortCol & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_nDownloadSortCol = DLCOL_STATUS;
	m_nSrcSortCol1 = ini.GetInt(_T("1stSortSourcesCode"), DLCOL_PRIORITY);
	if ((m_nSrcSortCol1 & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_nSrcSortCol1 = DLCOL_PRIORITY;
	m_nSrcSortCol2 = ini.GetInt(_T("2ndSortSourcesCode"), DLCOL_FILENAME);
	if ((m_nSrcSortCol2 & MLC_COLUMNMASK) >= DLCOL_NUMCOLUMNS)
		m_nSrcSortCol2 = DLCOL_FILENAME;
d2025 1
a2025 1
	if (!FilterFile.Open(strFullPath, CFile::modeRead | CFile::typeBinary))
@


1.390
log
@Simplified transfer statistics gathering;
Increased upper range for 'File Buffer Size', setting was made compatible with original (setting name was changed from "FileBufferSizePref" to "FileBufferSize", smooth migration is in place with slight deviation of values; Bigger File Buffer Size is recommended for higher speeds to stabilize and slightly improve downloading speed; New configuration is done with different granuality).
@
text
@d2004 3
a2006 3
		static const TCHAR	acHdr[] = _T("# filter search result using listed words\n")
			_T("# min 2 characters\n")
			_T("# empty lines are ok, '#' for comment\n");
d2008 1
a2008 1
		if (!FilterFile.Open(strFullPath, CFile::modeCreate | CFile::modeWrite | CFile::typeText))
d2011 5
d2022 1
a2022 1
	if (!FilterFile.Open(strFullPath, CFile::modeRead | CFile::typeText))
d2025 13
d2043 1
a2043 1
		strLine.Trim();
@


1.389
log
@Transfer window sub-pane state was moved to preferenes.ini (gui.dat is not used anymore) -- sub-pane state will be set to default on the first start;
Optimized saving of Lancast IP parameters; Suppressed compiler warnings.
@
text
@d830 1
a830 1
	ini.SetInt(_T("FileBufferSizePref"), m_nFileBufferSize);
d1316 1
a1316 1
	m_nMaxSourcePerFile = ini.GetInt(_T("MaxSourcesPerFile"),400);
d1571 11
a1581 1
	m_nFileBufferSize = ini.GetInt(_T("FileBufferSizePref"), 16);
d3161 1
a3161 1
void CPreferences::Add2SessionTransferData(byte uClientID, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes, BOOL bCommunity, byte byteFilePriority)
d3164 1
a3164 1
	//	as well as to the totals for all clients. - Khaos
d3166 1
a3166 2
	//	uClientID - The identifier for which client software sent or received this data, eg SO_EMULE
	//	uClientPort - The remote port of the client that sent or received this data, eg 4662
a3167 1
	//	bUpDown - True is Up, False is Down
d3171 1
a3171 8
	switch (eUpDown)
	{
		case TRANSFERTYPE_UPLOAD:	//Upline Data

			if (uClientID < SO_LAST)
				sesUpDataClients[uClientID] += bytes;
			else
				sesUpDataClients[SO_UNKNOWN] += bytes;
d3173 1
a3173 1
			//	Add to our total for sent bytes...
d3175 2
a3176 2
			g_App.UpdateSentBytes(bytes);
#endif //NEW_SOCKETS_ENGINE
d3178 4
a3181 4
			if (bFromPF)
				sesUpData_PartFile+=bytes;
			else
				sesUpData_File+=bytes;
d3183 4
a3186 4
			if (bCommunity)
				sesUpData_Community+=bytes;
			else
				sesUpData_NoCommunity+=bytes;
d3188 7
a3194 6
			if (byteFilePriority < ARRSIZE(sesUpDataPriority))
				sesUpDataPriority[byteFilePriority] += bytes;

			break;

		case TRANSFERTYPE_DOWNLOAD: // Downline Data
d3196 1
a3196 6
			if (uClientID < SO_LAST)
				sesDownDataClients[uClientID] += bytes;
			else
				sesDownDataClients[SO_UNKNOWN] += bytes;

			//	Add to our total for received bytes...
d3198 2
a3199 3
			g_App.UpdateReceivedBytes(bytes);
#endif //NEW_SOCKETS_ENGINE
	}
@


1.388
log
@Removed secure protection for password hashes -- no point to do it for something changed once in a blue moon;
Reduced H-file dependency; Formatting.
@
text
@d975 3
a1035 4
	CString t_strLanCastIP;
	t_strLanCastIP.Format(_T("%i.%i.%i.%i"),(byte)m_LancastIP,(byte)(m_LancastIP>>8),(byte)(m_LancastIP>>16),(byte)(m_LancastIP>>24));
	CString t_strLanCastSubnet;
	t_strLanCastSubnet.Format(_T("%i.%i.%i.%i"),(byte)m_LancastSubnet,(byte)(m_LancastSubnet>>8),(byte)(m_LancastSubnet>>16),(byte)(m_LancastSubnet>>24));
d1037 7
a1043 5
	ini.SetBool(_T("Enabled"),m_LancastEnabled);
	ini.SetBool(_T("UseDefaultIP"),m_UseDefaultIP);
	ini.SetString(_T("IPAddress"),t_strLanCastIP);
	ini.SetString(_T("Subnet"),t_strLanCastSubnet);
	ini.SetInt(_T("Port"),m_LancastPort);
d1734 1
a1734 1
	m_byteDetailedPartsFilter = ini.GetInt(_T("DetailedPartsFilter"), 0);
d1755 3
@


1.387
log
@changes after review
@
text
@d18 3
a21 1
#include <time.h>
a24 3
#include "stdlib.h"
#include "stdio.h"
#include <locale.h>
d31 2
a32 1
#include <io.h>
d370 1
a370 1
	if (sharedDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite|CFile::typeBinary))
d373 1
a373 1
		uint16	wBOM = 0xFEFF;
d375 1
a375 1
		sharedDirsFile.Write(&wBOM, sizeof(wBOM));
d382 1
a382 1
			sharedDirsFile.Write(_T("\r\n"),2*sizeof(TCHAR));
d394 1
a394 1
	if (tempDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite|CFile::typeBinary))
d397 1
a397 1
		uint16	wBOM = 0xFEFF;
d399 1
a399 1
		tempDirsFile.Write(&wBOM, sizeof(wBOM));
d406 1
a406 1
			tempDirsFile.Write(_T("\r\n"),2*sizeof(TCHAR));
a988 2
	HashType PasswdDigest;

d992 2
a993 2
	ini.SetString(_T("Password"), HashToString(reinterpret_cast<const byte*>(m_sWebPassword.Get(&PasswdDigest))));
	ini.SetString(_T("PasswordLow"), HashToString(reinterpret_cast<const byte*>(m_sLowWebPassword.Get(&PasswdDigest))));
d1028 1
a1028 1
	ini.SetString(_T("Password"), HashToString(reinterpret_cast<const byte*>(m_sMMPassword.Get(&PasswdDigest))));
a1775 2
	byte	abyteDigest[16];

d1777 2
a1778 2
	m_sWebPassword.Put(*reinterpret_cast<const HashType*>(StringToHash(ini.GetString(_T("Password"), _T("")), abyteDigest)));
	m_sLowWebPassword.Put(*reinterpret_cast<const HashType*>(StringToHash(ini.GetString(_T("PasswordLow"), _T("")), abyteDigest)));
d1827 1
a1827 1
	m_sMMPassword.Put(*reinterpret_cast<const HashType*>(StringToHash(ini.GetString(_T("Password"), _T("")), abyteDigest)));
d2035 1
a2035 1
		uint16 wBOM;
d2037 2
a2038 2
		sDirFile.Read(&wBOM,sizeof(wBOM));
		if (wBOM != 0xFEFFu)
d2040 1
d2069 1
a2069 1
		uint16 wBOM;
d2071 2
a2072 2
		tempDirFile.Read(&wBOM,sizeof(wBOM));
		if (wBOM != 0xFEFFu)
d2074 1
d2498 1
a2498 1
	return (m_bIsNTBased);
d3301 1
a3301 1
		//	If directory exist, add it to the list, otherwise report error
d3494 34
@


1.386
log
@added Unicode support for: shareddir.dat, tempdir.dat and addresses.dat
@
text
@d373 1
a373 1
		WORD	wBOM = 0xFEFF;
d377 1
a377 1
		CSingleLock	sLock(&m_csDirList, TRUE);
d397 1
a397 1
		WORD	wBOM = 0xFEFF;
d401 1
a401 1
		CSingleLock	sLock(&m_csDirList, TRUE);
d2036 4
a2039 1
	ETextFileFormat eTFF = GetTextFileFormat(strTmp);
d2041 8
a2048 2
	if (sDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | (eTFF == tffUnicode ? CFile::typeBinary : 0)))
	{
a2050 3
			if (eTFF == tffUnicode)
				sDirFile.Seek(sizeof(WORD), SEEK_CUR); 

d2052 1
a2052 1
				SharedDirListCheckAndAdd(strTmp, true);
d2069 4
a2072 1
	ETextFileFormat eTFF = GetTextFileFormat(strTmp);
d2074 8
a2081 2
	if (tempDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite | (eTFF == tffUnicode ? CFile::typeBinary : 0)))
	{
a2083 3
			if (eTFF == tffUnicode)
				tempDirFile.Seek(sizeof(WORD), SEEK_CUR); 

d3274 1
d3277 1
a3277 1
bool CPreferences::SharedDirListCheckAndAdd(const CString &strNewDir, bool bAdd)
d3299 3
a3301 1
		DWORD dwFileAttributes = GetFileAttributes(strDir);
d3303 6
a3308 5
	//	If directory exist, add it to the list, otherwise report error
		if ((dwFileAttributes == INVALID_FILE_ATTRIBUTES) || !(dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
		{
			m_csDirList.Unlock();
			return false;
@


1.385
log
@fixed paste & copy errors (thanks to KuSh)
@
text
@d232 1
a232 1
	if (addressesFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite))
a233 1
		m_addressesList.RemoveAll();
d370 1
a370 1
	if (sharedDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite))
d372 6
a377 1
		CSingleLock	sLock(&m_csDirList, true);
d382 1
a382 1
			sharedDirsFile.Write("\n",1);
d394 1
a394 1
	if (tempDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite|CFile::shareDenyWrite))
d396 6
a401 1
		CSingleLock	sLock(&m_csDirList, true);
d406 1
a406 1
			tempDirsFile.Write("\n",1);
d2036 3
a2038 1
	if (sDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite))
d2042 3
d2046 1
a2046 5
			{
				DWORD dwFileAttributes = GetFileAttributes(strTmp);
				if ((dwFileAttributes != INVALID_FILE_ATTRIBUTES) && (dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
					SharedDirListCheckAndAdd(strTmp, true);
			}
d2063 3
a2065 1
	if (tempDirFile.Open(strTmp, CFile::modeRead | CFile::shareDenyWrite))
d2069 3
d3268 1
a3270 1
	{
a3271 1
	}
d3286 8
d3369 1
a3371 1
	{
a3372 1
	}
a3375 1
	{
a3376 1
	}
@


1.384
log
@correction after review
@
text
@d174 1
a174 1
		_trename(m_strDownloadLogFilePath, m_strDownloadLogFilePath);
@


1.383
log
@Remove unused but active code that can be used to retrieve IP and port of users through IRC {Bruno}
@
text
@d166 1
d169 3
a171 1
		CString strBackupFile = m_strDownloadLogFilePath + _T(".ansi");
d174 1
a174 1
		_trename(m_strDownloadLogFilePath, m_strDownloadLogFilePath + _T(".ansi"));
d176 1
@


1.382
log
@added unicode support for log files (emule, debug, upload, download, status, backup)
@
text
@a774 1
//	ini.SetBool("IRCAcceptLinks", m_bIRCAcceptLinks);
a775 1
	ini.SetBool(_T("IRCIgnoreEmuleProtoInfoMessage"), m_bIRCIgnoreEmuleProtoInfoMessage);
a1469 1
	//	m_bIRCAcceptLinks = ini.GetBool("IRCAcceptLinks", false);
a1470 1
	m_bIRCIgnoreEmuleProtoInfoMessage = ini.GetBool(_T("IRCIgnoreEmuleProtoInfoMessage"), true);
@


1.381
log
@fixed unicode compiling issues
@
text
@d166 7
@


1.380
log
@Added facility to update comment filter and file cleanup tags for current installation (comment filter was extended with "fastest eMule ever", file cleanup tags with "shareconnector");
Removed migration from very old irc servers "irc.liquidirc.com" and "217.172.179.168" (were dropped in v1k);
Updated default file cleanup tag filter -- added "shareconnector", removed ".com" (as it could be a part of a file name);
Optimized ini interface for reading string values to avoid unrequired memory reallocations;
Suppressed some compiler warnings.
@
text
@d1752 1
a1752 1
	ini.GetString(&m_proxy.m_strName, _T("Name"), _T(""));
d1754 1
a1754 1
	ini.GetString(&m_proxy.m_strUser, _T("User"), _T(""));
@


1.379
log
@Corrected ini interface usage according to new changes; Suppressed few warnings;
Adjusted default comment filter, as one variant was covered by recently introduced.
@
text
@d90 46
d273 1
a273 1
	m_uMaxDownload = dwMaxDownload;
d285 1
a285 1
	m_uMaxUpload = dwMaxUpload;
d308 1
a308 1
		dwMaxDown = m_uMaxDownload;
d649 1
a649 1
	FractionalRate2String(&strBuf, m_uMaxUpload);
d651 1
a651 1
	FractionalRate2String(&strBuf, m_uMaxDownload);
d756 1
d1032 1
d1205 1
a1205 1
	m_sNick.Put(ini.GetString(_T("Nick"), acNick));
d1211 1
a1211 1
	m_sIncomingDir.Put(ini.GetString(_T("IncomingDir"), strBuf));
d1215 1
a1215 1
	m_sTempDir.Put(ini.GetString(_T("TempDir"), strBuf));
d1218 1
a1218 1
	m_sVideoPlayer.Put(ini.GetString(_T("VideoPlayer"), _T("")));
d1264 2
a1265 2
	m_uMaxUpload = static_cast<uint16>((ini.GetDouble(_T("MaxUpload"), m_dwMaxGraphUploadRate) * 10) + 0.5);
	SetMaxUploadWithCheck(m_uMaxUpload);
d1267 2
a1268 2
	m_uMaxDownload = static_cast<uint16>((ini.GetDouble(_T("MaxDownload"), m_dwMaxGraphDownloadRate) * 10) + 0.5);
	SetMaxDownloadWithCheck(m_uMaxDownload);
d1390 3
a1392 3
	m_sToolbarSettings.Put(ini.GetString(_T("ToolbarSettings"), GetDefaultToolbarSettings()));
	m_sToolbarBitmap.Put(ini.GetString(_T("ToolbarBitmap"), _T("")));
	m_sToolbarBitmapFolder.Put(ini.GetString(_T("ToolbarBitmapFolder"), _T("")));
d1430 1
a1430 1
	m_byteDepth3D = ini.GetInt(_T("3DDepth"), 0);
d1444 1
a1444 3
	m_sNotifierSoundFilePath.Put(ini.GetString(_T("NotifierSoundPath"), _T("")));

	m_sIRCServer.Put(ini.GetString(_T("IRCServer"), _T("irc.emuleplus.info")));
d1446 2
a1448 1
	m_sIRCServer.Get(&strBuf);
d1450 6
a1455 2
	if ((strBuf == _T("irc.liquidirc.com")) || (strBuf == _T("217.172.179.168")) || (strBuf.Left(13) == _T("irc.freshirc.")))
		m_sIRCServer.Put(_T("irc.emuleplus.info"));
d1457 1
a1457 1
	m_sIRCNick.Put(ini.GetString(_T("IRCNick"), m_sNick.Get()));
d1459 1
a1459 1
	m_sIRCChanNameFilter.Put(ini.GetString(_T("IRCFilterName"), _T("")));
d1462 1
a1462 1
	m_sIRCPerformString.Put(ini.GetString(_T("IRCPerformString"), _T("/join #emule+")));
d1473 7
a1479 3
	m_strTxtEditor = ini.GetString(_T("TxtEditor"), _T("notepad.exe"));
	m_strMessageFilter = ini.GetString(_T("MessageFilter"), _T("Defcon|Your client has an infinite queue"));
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"), _T("http://www.|emulespeedup|fastest eMule ever")));
d1517 1
a1517 1
	m_sCommunityString.Put(ini.GetString(_T("CommunityString"), _T("")));
d1544 1
a1544 1
	m_sUsedFont.Put(ini.GetString(_T("UsedFont"), _T("MS Sans Serif")));
d1709 1
a1709 1
	m_sAwayStateMessage.Put(ini.GetString(_T("AwayStateMessage"),_T("")));
d1718 1
a1718 1
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"), _T("www.microsoft.com|www.google.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org")));
d1725 1
a1725 1
	m_strIPFilterURL			= ini.GetString(_T("UpdateURLIPFilter"), _T("http://emulepawcio.sourceforge.net/nieuwe_site/eplus_fakes/ipfilter.dat"));
d1733 2
a1734 2
	m_strAVPath					= ini.GetString(_T("AVPath"), _T(""));
	m_strAVParams				= ini.GetString(_T("AVParams"), _T(""));
d1752 1
a1752 1
	m_proxy.m_strName = ini.GetString(_T("Name"), _T(""));
d1754 1
a1754 1
	m_proxy.m_strUser = ini.GetString(_T("User"), _T(""));
d1776 1
a1776 1
	m_strTemplateFile = ini.GetString(_T("WebTemplateFile"), _T("eMuleXP.tmpl"));
d1844 5
a1848 1
	m_sFilenameCleanups.Put(ini.GetString(_T("FilenameCleanups"), _T("http|www.|.com|sharereactor|sharelive|filedonkey|saugstube|eselfilme|eseldownloads|donkey-mania|emulemovies|spanishare|eselpsychos.de|saughilfe.de|goldesel.6x.to|goldesel.tk|freedivx.org|elitedivx|deviance|filenexus|ac3-guru")));
d1852 6
a1857 6
	m_sSMTPServer.Put(ini.GetString(_T("Server"), _T("smtp.server.com")));
	m_sSMTPName.Put(ini.GetString(_T("Name"), CLIENT_NAME _T(" Messenger")));
	m_sSMTPFrom.Put(ini.GetString(_T("From"), _T("messenger@@emuleplus.info")));
	m_sSMTPTo.Put(ini.GetString(_T("To"), _T("user@@domain.com")));
	m_sSMTPUserName.Put(ini.GetString(_T("UserName"), _T("username")));
	m_sSMTPPassword.Put(Decrypt(ini.GetString(_T("Password"), Crypt(_T("password")))));
d1874 1
a1874 1
	m_sBackupDir.Put(ini.GetString(_T("BackupDir"), strBuf));
d1882 1
a1882 1
	m_sFakeListURL			= ini.GetString(_T("FakeListURL"), _T("http://www.donkeyfakes.net/download/ed2kfakes.txt"));
d1885 1
a1885 1
	m_strDLingFakeListLink	= ini.GetString(_T("DownloadingFakeListLink"), _T(""));
d2124 1
a2124 1
		pNewCat->m_strTitle = iniCat.GetString(_T("Title"), _T(""));
d2142 1
a2142 1
		pNewCat->m_strComment = iniCat.GetString(_T("Comment"), _T(""));
d2150 1
a2150 1
		pNewCat->m_strAutoCatExt = iniCat.GetString(_T("AutoCat"), _T(""));
d2752 1
a2752 1
		m_strStatsExpandedTreeItems = ini.GetString(_T("statsExpandedTreeItems"), PREF_DEF_STATREE_MASK);
d3017 1
a3017 1
			cumSrvrsMostWorkingServers = servtotal - servfail;
d3088 1
a3088 1
		cumSrvrsMostWorkingServers = servtotal - servfail;
@


1.378
log
@unicode prepararions:
1) added the code for conversion
2) unicode support for ini files
3) unicode support for URL en(de)coding
4) statistic output in UTF8 format
@
text
@d1108 1
a1108 1
	CIni* pIni = new CIni(strFileName, true);
d1112 1
a1112 1
	CString strPrefsVersion;
a1113 1
	strPrefsVersion = pIni->GetString(_T("AppVersion"), _T(""));
d1238 1
a1238 1
	m_uPort = dwVal;
d1244 1
a1244 1
	m_uUDPPort = dwVal;
d1424 1
a1424 1
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"), _T("http://www.|emulespeedup|HyperMule|fastest emule ever")));
@


1.377
log
@Extended default comment filter to reduce spam; Suppressed few compiler warnings.
@
text
@a1102 1
//	Quick hack to add version tag to preferences.ini-file and solve the issue with the FlatStatusBar tag...
d1107 2
a1108 1
	CIni* pIni = new CIni(strFileName);
a1114 2
	pIni->SetString(_T("AppVersion"), CURRENT_VERSION_LONG);
	pIni->SaveAndClose();
d1141 1
a1141 1
	CIni ini(strFileName, true);
@


1.376
log
@Preserve WebServer list statuses between restarts; Removed unused float services;
Save FakeListDownloadColor as number instead of string; Suppressed compiler warnings [Aw3].
@
text
@d1425 4
a1428 4
	m_strTxtEditor = ini.GetString(_T("TxtEditor"),_T("notepad.exe"));
	m_strMessageFilter = ini.GetString(_T("MessageFilter"),_T("Defcon|Your client has an infinite queue"));
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"), _T("http://www.|emulespeedup|HyperMule")));
	m_bShowRatingIcons=ini.GetBool(_T("ShowRatingIcons"), true);
d1845 1
a1845 1
		m_anShortcutCode[i] = ini.GetInt(s_apcShortcutNames[i], VK_RETURN);
d1847 4
a1850 4
	m_anShortcutCode[SCUT_FILE_OPENDIR] = ini.GetInt(_T("ShareOpenShortcut"), m_anShortcutCode[SCUT_FILE_OPENDIR]);
	m_anShortcutCode[SCUT_LINK] = ini.GetInt(_T("ShareED2KLinkShortcut"), m_anShortcutCode[SCUT_LINK]);
	m_anShortcutCode[SCUT_LINK_HTML] = ini.GetInt(_T("ShareED2kLinkHtmlShortcut"), m_anShortcutCode[SCUT_LINK_HTML]);
	m_anShortcutCode[SCUT_LINK_SOURCE] = ini.GetInt(_T("ShareED2kLinkSourceShortcut"), m_anShortcutCode[SCUT_LINK_SOURCE]);
d2644 1
a2644 1
			cumSrvrsMostWorkingServers = dwVal;
d2652 1
a2652 1
			cumSharedMostFilesShared = dwVal;
@


1.375
log
@Suppressed compiler warnings [Aw3].
@
text
@d263 1
a263 1
	return TieUploadDownload(dwMaxUp, dwMaxDown);
d950 12
d1020 1
a1020 3
	CString strColor;
	strColor.Format(_T("%u"), m_clrFakeListDownloadColor);
	ini.SetString(_T("FakeListDownloadColor"), strColor);
d1736 24
d1824 1
a1824 1
	m_nFakesDatVersion		= ini.GetInt(_T("FakesDatVersion"),0);
d1830 1
a1830 1
	m_clrFakeListDownloadColor = _tstoi64(ini.GetString(_T("FakeListDownloadColor"), _T("0")));
d2092 1
a2092 1
		pNewCat->m_iPriority = uiVal;
d2115 1
a2115 1
		BOOL		bIsNTNBased	= FALSE;
d2117 1
a2117 1
		m_wWinVer = DetectWinVersion(bIsNTNBased);
d2616 6
a2621 6
	cumConnAvgDownRate = ini.GetFloat(_T("ConnAvgDownRate"), 0);
	cumConnMaxAvgDownRate = ini.GetFloat(_T("ConnMaxAvgDownRate"), 0);
	cumConnMaxDownRate = ini.GetFloat(_T("ConnMaxDownRate"), 0);
	cumConnAvgUpRate = ini.GetFloat(_T("ConnAvgUpRate"), 0);
	cumConnMaxAvgUpRate = ini.GetFloat(_T("ConnMaxAvgUpRate"), 0);
	cumConnMaxUpRate = ini.GetFloat(_T("ConnMaxUpRate"), 0);
d2759 2
a2760 1
	CString strFullPath = m_strConfigDir;
a2870 1
	double tempRate = 0.0;
d2877 2
a2878 2
			tempRate = g_App.m_pMDlg->m_dlgStatistics.GetAvgDownloadRate(AVG_TOTAL);
			ini.SetFloat(_T("ConnAvgDownRate"), tempRate);
d2880 3
a2882 2
			if (tempRate>GetConnMaxAvgDownRate()) Add2ConnMaxAvgDownRate(tempRate);
			ini.SetFloat(_T("ConnMaxAvgDownRate"), GetConnMaxAvgDownRate());
d2884 2
a2885 2
			tempRate = g_App.m_pMDlg->m_dlgStatistics.GetAvgUploadRate(AVG_TOTAL);
			ini.SetFloat(_T("ConnAvgUpRate"), tempRate);
d2887 3
a2889 2
			if (tempRate>GetConnMaxAvgUpRate()) Add2ConnMaxAvgUpRate(tempRate);
			ini.SetFloat(_T("ConnMaxAvgUpRate"), GetConnMaxAvgUpRate());
d2895 4
a2898 3
		tempRate = static_cast<double>(g_App.m_pDownloadQueue->GetDataRate()) / 1024.0;
		if (tempRate>GetConnMaxDownRate()) Add2ConnMaxDownRate(tempRate);
		ini.SetFloat(_T("ConnMaxDownRate"), GetConnMaxDownRate());
d2903 4
a2906 3
		tempRate = static_cast<double>(g_App.m_pUploadQueue->GetDataRate()) / 1024.0;
		if (tempRate>GetConnMaxUpRate()) Add2ConnMaxUpRate(tempRate);
		ini.SetFloat(_T("ConnMaxUpRate"), GetConnMaxUpRate());
d2930 1
a2930 1
		if (g_App.m_pListenSocket->GetMaxConnectionsReachedCount() > 0 )
@


1.374
log
@WebServer: preserve client queue statuses between restarts (preferences.ini) [Aw3];
WebServer: don't load/save preferences.ini on change of particular parameters (load is done only on startup to avoid double preferences.ini reading when WS is enabled; Save is done with other preferences when it happens) [Aw3].
@
text
@d936 1
a936 1
	ini.SetInt(_T("TempDisableLogin"), m_nWebTempDisableLogin);
d1399 1
a1399 1
	m_sIRCNick.Put(ini.GetString(_T("IRCNick"), m_sNick));
d1646 1
a1646 1
	m_nAwayState = false;
d1710 3
a1712 1
	m_nWebTempDisableLogin = ini.GetInt(_T("TempDisableLogin"), 30);
d1792 2
a1793 1
	m_sFakeListURL			= ini.GetString(_T("FakeListURL"), _T("http://www.donkeyfakes.net/download/ed2kfakes.txt")).Trim();
d2454 4
a2457 1
	time_t	timeNow;time(&timeNow);stat_datetimeLastReset = (__int64) timeNow;
d2600 1
a2600 1
	stat_datetimeLastReset = ini.GetUInt64(_T("statsDateTimeLastReset"),0);
d2685 1
a2685 1
		stat_datetimeLastReset = (__int64) timeNow;
d2908 4
a2911 4
			ini.SetInt(_T("ConnTransferTime"), GetConnTransferTime() + g_App.m_pMDlg->m_dlgStatistics.GetTransferTime());
			ini.SetInt(_T("ConnUploadTime"), GetConnUploadTime() + g_App.m_pMDlg->m_dlgStatistics.GetUploadTime());
			ini.SetInt(_T("ConnDownloadTime"), GetConnDownloadTime() + g_App.m_pMDlg->m_dlgStatistics.GetDownloadTime());
			ini.SetInt(_T("ConnServerDuration"), GetConnServerDuration() + g_App.m_pMDlg->m_dlgStatistics.GetServerDuration());
d2957 1
a2957 1
		ini.SetUInt64(_T("statsDateTimeLastReset"), stat_datetimeLastReset);
@


1.373
log
@Speeded up some disk operations [Aw3];
Extended INI interface to allow opening only in read-only mode (this way file isn't created when it didn't exist before) [Aw3];
Corrected broken carriage return in the header of 'filter.dat' (fix works only for a new file -- when it didn't exist before startup) [Aw3];
Removed file flush operation on close for 'userhash.dat' to increase performance a little -- there's nothing so improtant in this file to waste disk performance with a flush [Aw3].
@
text
@d274 1
a274 1
	FILE	*pPrefFile = _tfopen(strFullPath,_T("wb"));
d296 1
a296 1
	strFullPath.Format(_T("%suserhash.dat"), m_strConfigDir) ;
d298 1
a298 1
	FILE	*pHashFile = _tfopen(strFullPath, _T("wb")) ;
d310 1
a310 1
	strFullPath.Format(_T("%sshareddir.dat"),m_strConfigDir);
d939 11
a949 1
	ini.SetBool(_T("MenuLocked"), m_bWebMenuLocked);
d1713 11
a1723 1
	m_bWebMenuLocked = ini.GetBool(_T("MenuLocked"), false);
@


1.372
log
@Added 'Keep search history' setting to preserve or not search history [Aw3];
Keep "ConnRunTime" setting as 32bit instead of 64bit value -- enough for over 100 years; Clean-up [Aw3].
@
text
@a302 5
#ifndef NEW_SOCKETS_ENGINE
	//	Force OS to flush data direct to disk on shutdown
		if (!g_App.m_pMDlg->IsRunning())
			_commit(_fileno(pHashFile));
#endif //NEW_SOCKETS_ENGINE
d1123 1
a1123 1
	CIni ini(strFileName);
d1865 3
a1867 3
		static const TCHAR	acHdr[] = _T("# filter search result using listed words\r\n")
			_T("# min 2 characters\r\n")
			_T("# empty lines are ok, '#' for comment\r\n");
@


1.371
log
@Reenabled saving/loading encryption settings.
@
text
@d768 1
d807 30
a836 30
	ini.SetArray(m_auDownloadColumnWidths, ELEMENT_COUNT(m_auDownloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SetArray(m_abDownloadColumnHidden, ELEMENT_COUNT(m_abDownloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SetArray(m_aiDownloadColumnOrder, ELEMENT_COUNT(m_aiDownloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SetArray(m_auUploadColumnWidths, ELEMENT_COUNT(m_auUploadColumnWidths), _T("UploadColumnWidths"));
	ini.SetArray(m_abUploadColumnHidden, ELEMENT_COUNT(m_abUploadColumnHidden), _T("UploadColumnHidden"));
	ini.SetArray(m_aiUploadColumnOrder, ELEMENT_COUNT(m_aiUploadColumnOrder), _T("UploadColumnOrder"));
	ini.SetArray(m_auQueueColumnWidths, ELEMENT_COUNT(m_auQueueColumnWidths), _T("QueueColumnWidths"));
	ini.SetArray(m_abQueueColumnHidden, ELEMENT_COUNT(m_abQueueColumnHidden), _T("QueueColumnHidden"));
	ini.SetArray(m_aiQueueColumnOrder, ELEMENT_COUNT(m_aiQueueColumnOrder), _T("QueueColumnOrder"));
	ini.SetArray(m_auSearchColumnWidths, ELEMENT_COUNT(m_auSearchColumnWidths), _T("SearchColumnWidths"));
	ini.SetArray(m_abSearchColumnHidden, ELEMENT_COUNT(m_abSearchColumnHidden), _T("SearchColumnHidden"));
	ini.SetArray(m_aiSearchColumnOrder, ELEMENT_COUNT(m_aiSearchColumnOrder), _T("SearchColumnOrder"));
	ini.SetArray(m_auSharedColumnWidths, ELEMENT_COUNT(m_auSharedColumnWidths), _T("SharedColumnWidths"));
	ini.SetArray(m_abSharedColumnHidden, ELEMENT_COUNT(m_abSharedColumnHidden), _T("SharedColumnHidden"));
	ini.SetArray(m_aiSharedColumnOrder, ELEMENT_COUNT(m_aiSharedColumnOrder), _T("SharedColumnOrder"));
	ini.SetArray(m_auServerColumnWidths, ELEMENT_COUNT(m_auServerColumnWidths), _T("ServerColumnWidths"));
	ini.SetArray(m_abServerColumnHidden, ELEMENT_COUNT(m_abServerColumnHidden), _T("ServerColumnHidden"));
	ini.SetArray(m_aiServerColumnOrder, ELEMENT_COUNT(m_aiServerColumnOrder), _T("ServerColumnOrder"));
	ini.SetArray(m_auIrcColumnWidths, ELEMENT_COUNT(m_auIrcColumnWidths), _T("IrcColumnWidths"));
	ini.SetArray(m_abIrcColumnHidden, ELEMENT_COUNT(m_abIrcColumnHidden), _T("IrcColumnHidden"));
	ini.SetArray(m_aiIrcColumnOrder, ELEMENT_COUNT(m_aiIrcColumnOrder), _T("IrcColumnOrder"));
	ini.SetArray(m_auClientListColumnWidths, ELEMENT_COUNT(m_auClientListColumnWidths), _T("ClientListColumnWidths"));
	ini.SetArray(m_abClientListColumnHidden, ELEMENT_COUNT(m_abClientListColumnHidden), _T("ClientListColumnHidden"));
	ini.SetArray(m_aiClientListColumnOrder, ELEMENT_COUNT(m_aiClientListColumnOrder), _T("ClientListColumnOrder"));
	ini.SetArray(m_auPartStatusColumnWidths, ELEMENT_COUNT(m_auPartStatusColumnWidths), _T("PartStatusColumnWidths"));
	ini.SetArray(m_abPartStatusColumnHidden, ELEMENT_COUNT(m_abPartStatusColumnHidden), _T("PartStatusColumnHidden"));
	ini.SetArray(m_aiPartStatusColumnOrder, ELEMENT_COUNT(m_aiPartStatusColumnOrder), _T("PartStatusColumnOrder"));
	ini.SetArray(m_auFriendColumnWidths, ELEMENT_COUNT(m_auFriendColumnWidths), _T("FriendColumnWidths"));
	ini.SetArray(m_abFriendColumnHidden, ELEMENT_COUNT(m_abFriendColumnHidden), _T("FriendColumnHidden"));
	ini.SetArray(m_aiFriendColumnOrder, ELEMENT_COUNT(m_aiFriendColumnOrder), _T("FriendColumnOrder"));
d862 1
a862 1
	for (unsigned i = 0; i < ELEMENT_COUNT(m_dwStatColors); i++)
d1080 1
a1080 1
	if (uiIdx >= ELEMENT_COUNT(acrDefColors))
d1487 1
d1533 30
a1562 30
	ini.GetArray(m_auDownloadColumnWidths, ELEMENT_COUNT(m_auDownloadColumnWidths), _T("DownloadColumnWidths"));
	ini.GetArray(m_abDownloadColumnHidden, ELEMENT_COUNT(m_abDownloadColumnHidden), _T("DownloadColumnHidden"));
	ini.GetArray(m_aiDownloadColumnOrder, ELEMENT_COUNT(m_aiDownloadColumnOrder), _T("DownloadColumnOrder"));
	ini.GetArray(m_auUploadColumnWidths, ELEMENT_COUNT(m_auUploadColumnWidths), _T("UploadColumnWidths"));
	ini.GetArray(m_abUploadColumnHidden, ELEMENT_COUNT(m_abUploadColumnHidden), _T("UploadColumnHidden"));
	ini.GetArray(m_aiUploadColumnOrder, ELEMENT_COUNT(m_aiUploadColumnOrder), _T("UploadColumnOrder"));
	ini.GetArray(m_auQueueColumnWidths, ELEMENT_COUNT(m_auQueueColumnWidths), _T("QueueColumnWidths"));
	ini.GetArray(m_abQueueColumnHidden, ELEMENT_COUNT(m_abQueueColumnHidden), _T("QueueColumnHidden"));
	ini.GetArray(m_aiQueueColumnOrder, ELEMENT_COUNT(m_aiQueueColumnOrder), _T("QueueColumnOrder"));
	ini.GetArray(m_auSearchColumnWidths, ELEMENT_COUNT(m_auSearchColumnWidths), _T("SearchColumnWidths"));
	ini.GetArray(m_abSearchColumnHidden, ELEMENT_COUNT(m_abSearchColumnHidden), _T("SearchColumnHidden"));
	ini.GetArray(m_aiSearchColumnOrder, ELEMENT_COUNT(m_aiSearchColumnOrder), _T("SearchColumnOrder"));
	ini.GetArray(m_auSharedColumnWidths, ELEMENT_COUNT(m_auSharedColumnWidths), _T("SharedColumnWidths"));
	ini.GetArray(m_abSharedColumnHidden, ELEMENT_COUNT(m_abSharedColumnHidden), _T("SharedColumnHidden"));
	ini.GetArray(m_aiSharedColumnOrder, ELEMENT_COUNT(m_aiSharedColumnOrder), _T("SharedColumnOrder"));
	ini.GetArray(m_auServerColumnWidths, ELEMENT_COUNT(m_auServerColumnWidths), _T("ServerColumnWidths"));
	ini.GetArray(m_abServerColumnHidden, ELEMENT_COUNT(m_abServerColumnHidden), _T("ServerColumnHidden"));
	ini.GetArray(m_aiServerColumnOrder, ELEMENT_COUNT(m_aiServerColumnOrder), _T("ServerColumnOrder"));
	ini.GetArray(m_auIrcColumnWidths, ELEMENT_COUNT(m_auIrcColumnWidths), _T("IrcColumnWidths"));
	ini.GetArray(m_abIrcColumnHidden, ELEMENT_COUNT(m_abIrcColumnHidden), _T("IrcColumnHidden"));
	ini.GetArray(m_aiIrcColumnOrder, ELEMENT_COUNT(m_aiIrcColumnOrder), _T("IrcColumnOrder"));
	ini.GetArray(m_auClientListColumnWidths, ELEMENT_COUNT(m_auClientListColumnWidths), _T("ClientListColumnWidths"));
	ini.GetArray(m_abClientListColumnHidden, ELEMENT_COUNT(m_abClientListColumnHidden), _T("ClientListColumnHidden"));
	ini.GetArray(m_aiClientListColumnOrder, ELEMENT_COUNT(m_aiClientListColumnOrder), _T("ClientListColumnOrder"));
	ini.GetArray(m_auPartStatusColumnWidths, ELEMENT_COUNT(m_auPartStatusColumnWidths), _T("PartStatusColumnWidths"));
	ini.GetArray(m_abPartStatusColumnHidden, ELEMENT_COUNT(m_abPartStatusColumnHidden), _T("PartStatusColumnHidden"));
	ini.GetArray(m_aiPartStatusColumnOrder, ELEMENT_COUNT(m_aiPartStatusColumnOrder), _T("PartStatusColumnOrder"));
	ini.GetArray(m_auFriendColumnWidths, ELEMENT_COUNT(m_auFriendColumnWidths), _T("FriendColumnWidths"));
	ini.GetArray(m_abFriendColumnHidden, ELEMENT_COUNT(m_abFriendColumnHidden), _T("FriendColumnHidden"));
	ini.GetArray(m_aiFriendColumnOrder, ELEMENT_COUNT(m_aiFriendColumnOrder), _T("FriendColumnOrder"));
d1617 1
a1617 1
	for (unsigned ui = 0; ui < ELEMENT_COUNT(m_dwStatColors); ui++)
d2412 1
a2412 1
	cumConnRunTime = 0;
d2487 10
a2496 10
	cumDownOverheadTotal = ini.GetUInt64(_T("DownOverheadTotal"),0);
	cumDownOverheadFileReq = ini.GetUInt64(_T("DownOverheadFileReq"),0);
	cumDownOverheadSrcEx = ini.GetUInt64(_T("DownOverheadSrcEx"),0);
	cumDownOverheadServer=ini.GetUInt64(_T("DownOverheadServer"),0);
	cumDownOverheadOther=ini.GetUInt64(_T("DownOverheadOther"),0);
	cumDownOverheadTotalPackets=ini.GetUInt64(_T("DownOverheadTotalPackets"),0);
	cumDownOverheadFileReqPackets=	ini.GetUInt64(_T("DownOverheadFileReqPackets"),0);
	cumDownOverheadSrcExPackets=ini.GetUInt64(_T("DownOverheadSrcExPackets"),0);
	cumDownOverheadServerPackets=ini.GetUInt64(_T("DownOverheadServerPackets"),0);
	cumDownOverheadOtherPackets=ini.GetUInt64(_T("DownOverheadOtherPackets"),0);
d2499 10
a2508 10
	cumUpOverheadTotal = ini.GetUInt64(_T("UpOverheadTotal"),0);  // BavarianSnail - spelling corrected
	cumUpOverheadFileReq = ini.GetUInt64(_T("UpOverheadFileReq"),0);
	cumUpOverheadSrcEx = ini.GetUInt64(_T("UpOverheadSrcEx"),0);
	cumUpOverheadServer = ini.GetUInt64(_T("UpOverheadServer"),0);
	cumUpOverheadOther = ini.GetUInt64(_T("UpOverheadOther"),0);
	cumUpOverheadTotalPackets = ini.GetUInt64(_T("UpOverheadTotalPackets"),0); // BavarianSnail - spelling corrected
	cumUpOverheadFileReqPackets = ini.GetUInt64(_T("UpOverheadFileReqPackets"),0);
	cumUpOverheadSrcExPackets = ini.GetUInt64(_T("UpOverheadSrcExPackets"),0);
	cumUpOverheadServerPackets = ini.GetUInt64(_T("UpOverheadServerPackets"),0);
	cumUpOverheadOtherPackets = ini.GetUInt64(_T("UpOverheadOtherPackets"),0);
d2516 3
a2518 3
	cumUpDataClients[SO_EDONKEY] = ini.GetUInt64(_T("UpData_EDONKEY"),0);
	cumUpDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64(_T("UpData_EDONKEYHYBRID"),0);
	cumUpDataClients[SO_EMULE] = ini.GetUInt64(_T("UpData_EMULE"),0);
d2520 2
a2521 2
	cumUpDataClients[SO_MLDONKEY] = ini.GetUInt64(_T("UpData_MLDONKEY"),0);
	cumUpDataClients[SO_XMULE] = ini.GetUInt64(_T("UpData_LMULE"),0);
d2524 1
a2524 1
	cumUpDataClients[SO_OLDEMULE] = 0;	// eklmn: initialize unused
d2526 1
a2526 1
	cumUpDataClients[SO_UNKNOWN] = 0;	// eklmn: initialize unused
d2529 2
a2530 2
	cumUpData_File = ini.GetUInt64(_T("UpData_File"),0);
	cumUpData_PartFile = ini.GetUInt64(_T("UpData_Partfile"),0);
d2533 2
a2534 2
	cumUpData_Community = ini.GetUInt64(_T("UpData_Community"),0);
	cumUpData_NoCommunity = ini.GetUInt64(_T("UpData_NoCommunity"),0);
d2548 3
a2550 3
	cumDownDataClients[SO_EDONKEY] = ini.GetUInt64(_T("DownData_EDONKEY"),0);
	cumDownDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64(_T("DownData_EDONKEYHYBRID"),0);
	cumDownDataClients[SO_EMULE] = ini.GetUInt64(_T("DownData_EMULE"),0);
d2552 2
a2553 2
	cumDownDataClients[SO_MLDONKEY] = ini.GetUInt64(_T("DownData_MLDONKEY"),0);
	cumDownDataClients[SO_XMULE] = ini.GetUInt64(_T("DownData_LMULE"),0);
d2557 1
a2557 1
	cumDownDataClients[SO_SHAREAZA] = ini.GetUInt64(_T("DownData_SHAREAZA"),0);
d2568 1
a2568 2
	cumConnRunTime = ini.GetUInt64(_T("ConnRunTime"), 0);

d2853 1
a2853 3
	uint64 timeseconds = (uint64)(::GetTickCount()-g_App.stat_starttime)/1000;
	timeseconds += GetConnRunTime();
	ini.SetUInt64(_T("ConnRunTime"),timeseconds );
d3036 1
a3036 1
			if (byteFilePriority < ELEMENT_COUNT(sesUpDataPriority))
@


1.370
log
@Temporary disabled obfuscation options.
@
text
@a913 1
#if 0
a916 1
#endif
a1670 1
#if 0
a1677 5
#else
	m_bCryptLayerRequested = false;
	m_bCryptLayerRequired = false;
	m_bCryptLayerSupported = false;
#endif
@


1.369
log
@Disabled Hungarian until there's any progress on it.
@
text
@d914 1
d918 1
d1673 1
d1681 5
@


1.368
log
@Fixed user configuration corruption introduced by the previous revision;
Optimized string processing regarding warning level 4;
Fixed wrong return code from CPreferences::Save() -- not really in use at the moment;
Fixed m_nSmartIdState initialization (used to handle smart LowID detection on serve connection) in case preferences.dat doesn't exist (first run).
@
text
@d2293 1
a2293 1
				case LANG_HUNGARIAN:
@


1.367
log
@Fix incorrect userhash (0000000000000E00000000000000006F00) on preferences.dat file corruption;
Suppressed level 4 warnings.
@
text
@d127 1
d146 1
a146 1
	CString	strIncomingDir = GetIncomingDir(), strTempDir = GetTempDir();
d148 2
a149 2
	CreateAllDirectories(&strIncomingDir);
	CreateAllDirectories(&strTempDir);
d197 1
a197 1
	FILE	*pHashFile = _tfopen(strFullPath, _T("rb")) ;
d201 1
a201 2
		if ( fread(m_userHash, sizeof(m_userHash), 1, pHashFile) != sizeof(m_userHash) ||
			ferror(pHashFile) != 0 )
d284 1
a284 1
		bError = fwrite(&m_prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefFile);
d302 1
a302 1
		bError = fwrite(m_userHash, sizeof(m_userHash), 1, pHashFile);
d353 2
a354 4
	CString	strIncomingDir = GetIncomingDir(), strTempDir = GetTempDir();

	CreateAllDirectories(&strIncomingDir);
	CreateAllDirectories(&strTempDir);
d1844 1
a1844 2
	if ( fread(&m_prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefsFile) == sizeof(Preferences_Ext_Struct) &&
		ferror(pPrefsFile) == 0 )
a1852 1
	m_nSmartIdState = 0;
@


1.366
log
@Serbian localization.
@
text
@d145 4
a148 2
	CreateAllDirectories(&GetIncomingDir());
	CreateAllDirectories(&GetTempDir());
d200 2
a201 1
		if (!fread(m_userHash, sizeof(m_userHash), 1, pHashFile))
d353 4
a356 2
	CreateAllDirectories(&GetIncomingDir());
	CreateAllDirectories(&GetTempDir());
d1620 1
a1620 1
		m_dwStatColors[ui] = ini.GetUInt32(strBuf, ~0);
d1846 7
a1852 3
	fread(&m_prefsExt, sizeof(Preferences_Ext_Struct), 1, pPrefsFile);

	if (ferror(pPrefsFile))
a1854 3
	md4cpy(m_userHash, m_prefsExt.abyteUserHash);
	m_WindowPlacement = m_prefsExt.EmuleWindowPlacement;

@


1.365
log
@Fixed new time formatting not based on the current system user settings;
Extended default file comment filter to filter out HyperMule spamming;
Removed a string from the default chat message filter, as it's used for banning based on message content.
@
text
@d2265 1
d2273 1
a2273 1
			byte nLocalLang = ::GetThreadLocale();
d2275 2
a2276 1
			switch(PRIMARYLANGID(nLocalLang))
a2282 1
				case LANG_CROATIAN:
d2299 1
a2301 1
				case LANG_ROMANIAN:
d2305 1
a2305 1
					m_nLanguageID = MAKELANGID(PRIMARYLANGID(nLocalLang), SUBLANG_DEFAULT);
d2308 6
d2315 15
a2329 1
					m_nLanguageID = MAKELANGID(LANG_ENGLISH, SUBLANG_DEFAULT);
@


1.364
log
@fix time disappearing at midnight
@
text
@d1407 2
a1408 2
	m_strMessageFilter = ini.GetString(_T("MessageFilter"),_T("Defcon|Your client has an infinite queue|http://www.chez.com/theworld/"));
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"), _T("http://www.|emulespeedup")));
d2238 32
a2269 31
		case MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "english");break;
		case MAKELANGID(LANG_BASQUE,SUBLANG_DEFAULT):setlocale( LC_ALL, "basque");break;
		case MAKELANGID(LANG_BELARUSIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "");break;
		case MAKELANGID(LANG_CATALAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "esp");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_SIMPLIFIED):setlocale( LC_ALL, "chs");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_TRADITIONAL):setlocale( LC_ALL, "cht");break;
		case MAKELANGID(LANG_CROATIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "");break;
		case MAKELANGID(LANG_CZECH, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
		case MAKELANGID(LANG_DANISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "danish");break;
		case MAKELANGID(LANG_DUTCH,SUBLANG_DEFAULT):setlocale( LC_ALL, "dutch");break;
		case MAKELANGID(LANG_SPECIAL, SUBLNG_EXTREMADURAN):setlocale( LC_ALL, "");break;
		case MAKELANGID(LANG_FINNISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "finnish");break;
		case MAKELANGID(LANG_FRENCH,SUBLANG_DEFAULT):setlocale( LC_ALL, "french");break;
		case MAKELANGID(LANG_GERMAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "german");break;
		case MAKELANGID(LANG_GREEK,SUBLANG_DEFAULT):setlocale( LC_ALL, "greek");break;
		case MAKELANGID(LANG_HEBREW,SUBLANG_DEFAULT):setlocale( LC_ALL, "hebrew");break;
		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
		case MAKELANGID(LANG_ITALIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "italian");break;
		case MAKELANGID(LANG_KOREAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "korean");break;
		case MAKELANGID(LANG_LITHUANIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "lithuanian");break;
		case MAKELANGID(LANG_MALAY, SUBLANG_MALAY_MALAYSIA):setlocale(LC_ALL, "");break;
		case MAKELANGID(LANG_NORWEGIAN,SUBLANG_NORWEGIAN_BOKMAL):setlocale( LC_ALL, "nor");break;
		case MAKELANGID(LANG_POLISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "polish");break;
		case MAKELANGID(LANG_PORTUGUESE,SUBLANG_PORTUGUESE):setlocale( LC_ALL, "ptg");break;
		case MAKELANGID(LANG_PORTUGUESE,SUBLANG_PORTUGUESE_BRAZILIAN):setlocale( LC_ALL, "ptb");break;
		case MAKELANGID(LANG_ROMANIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "romanian");break;
		case MAKELANGID(LANG_RUSSIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "russian");break;
		case MAKELANGID(LANG_SLOVENIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
		case MAKELANGID(LANG_SPANISH,SUBLANG_SPANISH):setlocale( LC_ALL, "spanish");break;
		case MAKELANGID(LANG_TURKISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "turkish");break;
		case MAKELANGID(LANG_UKRAINIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
@


1.363
log
@Fixed startup with file system corruption of the configuration file {fran}.
@
text
@d2663 1
a2663 1
		returnStr = statsResetLocalized.Format();
@


1.362
log
@More appropriate name for service to avoid confusion.
@
text
@a136 1

d1866 1
a1866 1
		const TCHAR	acHdr[] = _T("# filter search result using listed words\r\n")
d1910 1
a1910 1
		while (sDirFile.ReadString(strTmp))
d1912 1
a1912 2
			DWORD dwFileAttributes = GetFileAttributes(strTmp);
			if ((dwFileAttributes != INVALID_FILE_ATTRIBUTES) && (dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
d1914 3
a1916 1
				SharedDirListCheckAndAdd(strTmp, true);
d1919 3
d1936 1
a1936 1
		while (tempDirFile.ReadString(strTmp))
d1938 2
a1939 1
			TempDirListCheckAndAdd(strTmp, true);
d1941 3
@


1.361
log
@Delete on start onlinesig.dat located in old place {Fuxie - DK}.
@
text
@d798 1
a798 1
	ini.SetBool(_T("ManualHighPrio"), m_bManualHighPrio);
d1404 1
a1404 1
	m_bManualHighPrio=ini.GetBool(_T("ManualHighPrio"), false);
@


1.360
log
@Encryption preparations.
@
text
@d114 5
@


1.359
log
@Setting 'Remove dead server retries' was made compatible with the original (old setting is still kept for smooth migration).
@
text
@d907 4
d1664 8
@


1.358
log
@removed the port statistic (part 2)
@
text
@d627 1
d629 2
d1248 1
d1250 4
d2520 8
a2527 8
	cumConnTransferTime=			ini.GetUInt32(_T("ConnTransferTime"), 0);
	cumConnDownloadTime=		ini.GetUInt32(_T("ConnDownloadTime"), 0);
	cumConnUploadTime=			ini.GetUInt32(_T("ConnUploadTime"), 0);
	cumConnServerDuration=		ini.GetUInt32(_T("ConnServerDuration"), 0);
	cumConnNumReconnects =		ini.GetInt(_T("ConnNumReconnects"), 0);
	cumConnAvgConnections =		ini.GetInt(_T("ConnAvgConnections"), 0);
	cumConnMaxConnLimitReached=	ini.GetInt(_T("ConnMaxConnLimitReached"), 0);
	cumConnPeakConnections =		ini.GetInt(_T("ConnPeakConnections"), 0);
@


1.357
log
@Reenabled Hungarian;
Removed code to support importing of the old add server setting from clients.
@
text
@a2334 2
	cumUpDataPort_4662 = 0;
	cumUpDataPort_OTHER = 0;
a2349 2
	cumDownDataPort_4662 = 0;
	cumDownDataPort_OTHER = 0;
a2469 4
	// Load cumulative port breakdown stats for sent bytes
	cumUpDataPort_4662 =	ini.GetUInt64(_T("UpDataPort_4662"),0);
	cumUpDataPort_OTHER = ini.GetUInt64(_T("UpDataPort_OTHER"),0);

a2501 4
	// Load cumulative port breakdown stats for received bytes
	cumDownDataPort_4662 =	ini.GetUInt64(_T("DownDataPort_4662"),0);
	cumDownDataPort_OTHER = ini.GetUInt64(_T("DownDataPort_OTHER"),0);

a2596 4
		sesUpDataPort_4662 = 0;
		sesUpDataPort_OTHER = 0;
		sesDownDataPort_4662 = 0;
		sesDownDataPort_OTHER = 0;
a2696 4
	// Save cumulative port breakdown stats for received bytes
	ini.SetUInt64(_T("DownDataPort_4662"), GetCumDownDataPort_4662());
	ini.SetUInt64(_T("DownDataPort_OTHER"), GetCumDownDataPort_OTHER());

a2748 4
	// Save cumulative port breakdown stats for sent bytes
	ini.SetUInt64(_T("UpDataPort_4662"), GetCumUpDataPort_4662());
	ini.SetUInt64(_T("UpDataPort_OTHER"), GetCumUpDataPort_OTHER());

d2945 1
a2945 1
void CPreferences::Add2SessionTransferData(byte uClientID, uint16 uClientPort, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes, BOOL bCommunity, byte byteFilePriority)
a2965 10
			switch (uClientPort)
			{
				// Update session port breakdown stats for sent bytes...
				case 4662:
					sesUpDataPort_4662 += bytes;
					break;
				default:
					sesUpDataPort_OTHER+=bytes;
			}

a2992 13
			switch (uClientPort)
			{
				// Update session port breakdown stats for received bytes...
				// For now we are only going to break it down by default and non-default.
				// A statistical analysis of all data sent from every single port/domain is
				// beyond the scope of this add-on.
				case 4662:
					sesDownDataPort_4662+=bytes;
					break;
				default:
					sesDownDataPort_OTHER+=bytes;
			}

@


1.356
log
@Again temporary disabled Hungarian.
@
text
@a1316 5
#if 1//temp migration of prev.setting -- remove in v1.2c
	m_bAddServersFromServer = ini.GetBool(_T("AddServersFromConnections"), true);
	m_bAddServersFromClients = ini.GetBool(_T("AddServersFromClient"), m_bAddServersFromServer);
	m_bAddServersFromServer = ini.GetBool(_T("AddServersFromServer"), m_bAddServersFromServer);
#else
a1318 1
#endif
d2222 1
a2222 1
//		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
d2257 1
a2257 1
//				case LANG_HUNGARIAN:
@


1.355
log
@Added proper Vista detection {muleteer}.
@
text
@d2228 1
a2228 1
		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
d2263 1
a2263 1
				case LANG_HUNGARIAN:
@


1.354
log
@Integrated Slovenian localization.
@
text
@a2053 1
			return 20;
a2054 1
			return 20;
d2056 1
@


1.353
log
@Enabled Hungarian.
@
text
@d2240 1
d2273 1
@


1.352
log
@Temporary disabled Hungarian as not finished.
@
text
@d2229 1
a2229 1
//		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
d2263 1
a2263 1
//				case LANG_HUNGARIAN:
@


1.351
log
@Proper importing of the original eMule category priority.
@
text
@d2229 1
a2229 1
		case MAKELANGID(LANG_HUNGARIAN, SUBLANG_DEFAULT):setlocale(LC_ALL, "");break;
d2263 1
a2263 1
				case LANG_HUNGARIAN:
@


1.350
log
@Set default main category parameters in the constructor.
@
text
@d1975 1
a1975 1
	unsigned uiMax = static_cast<unsigned>(iniCat.GetInt(_T("Count"), 0));
d2005 6
a2010 1
		pNewCat->m_iPriority = iniCat.GetInt(_T("Priority"), 0);
d2016 1
a2016 2
	//	Add category
		CCat::AddCat(pNewCat, false);
@


1.349
log
@Added filename cleanup shortcut {Towelie}.
@
text
@a1937 2
	pNewCat->m_iPriority = 0;
	pNewCat->m_crColor = RGB(0, 0, 0);
a1966 2
			pNewCat->m_iPriority = 0;
			pNewCat->m_crColor = 0;
d2006 1
a2006 1
		pNewCat->m_crColor = static_cast<COLORREF>(iniCat.GetUInt32(_T("Color"), 0));
@


1.348
log
@Server list update option was split into update from servers and clients {ElAguila};
Corrected saving of statistics plot colors to preferences.ini (were saved as 64bit numbers before);
Save only used plot colors to the configuration file.
@
text
@d86 2
a87 1
	_T("CopyHashShortcut")							//SCUT_LINK_HASH
@


1.347
log
@Dropped configuration file migration from old versions (< v1h).
@
text
@d666 2
a667 1
	ini.SetBool(_T("AddServersFromConnections"), m_bAddServersFromConn);
d850 1
a850 2
	CString buffer2;
	for (int i=0;i<15;i++)
d852 2
a853 3
		strBuf.Format(_T("%I64Lu"),GetStatsColor(i));
		buffer2.Format(_T("StatColor%i"),i);
		ini.SetString(buffer2, strBuf);
d1056 1
a1056 1
DWORD CPreferences::GetDefaultStatsColor(int index)
d1058 1
a1058 1
	switch(index)
d1060 7
a1066 14
		case 0 : return RGB(0,0,64);
		case 1 : return RGB(192,192,255);
		case 2 : return RGB(128, 255, 128);
		case 3 : return RGB(0, 210, 0);
		case 4 : return RGB(0, 128, 0);
		case 5 : return RGB(255, 128, 128);
		case 6 : return RGB(200, 0, 0);
		case 7 : return RGB(140, 0, 0);
		case 8 : return RGB(150, 150, 255);
		case 9 : return RGB(192,   0, 192);
		case 10 : return RGB(255, 192, 255);
		case 11 : return RGB(255, 255, 128);
		default : return RGB(255, 255, 255);
	}
d1240 3
a1242 3
	m_nTooltipDelayTime = ini.GetInt(_T("ToolTipDelay"),1);
	m_nTrafficOMeterInterval = ini.GetInt(_T("StatGraphsInterval"),3);
	m_nStatsInterval = ini.GetInt(_T("StatsInterval"),5);
d1247 3
a1249 3
	m_nStatsMax = ini.GetInt(_T("VariousStatisticsMaxValue"),100);
	m_nStatsAverageMinutes = ini.GetInt(_T("StatsAverageMinutes"),5);
	m_nMaxConPerFive = ini.GetInt(_T("MaxConnectionsPerFiveSeconds"),GetDefaultMaxConPerFiveSecs());
d1252 5
a1256 9
	int nMax = (IsNTBased()) ? 200 : 100;

	if(m_nMaxConPerFive > nMax)
		m_nMaxConPerFive = nMax;
	else
	{
		if(m_nMaxConPerFive < 5)
			m_nMaxConPerFive = 5;
	}
d1316 8
a1323 1
	m_bAddServersFromConn = ini.GetBool(_T("AddServersFromConnections"), true);
d1601 1
a1601 3
	CString strBuf2;

	for (unsigned ui = 0; ui < 15; ui++)
d1603 4
a1606 5
		strBuf2.Format(_T("StatColor%u"), ui);
		strBuf = ini.GetString(strBuf2, _T("-1"));	// We can now have black as background
		m_nStatColors[ui] = _tstoi64(strBuf);
		if (m_nStatColors[ui] == -1)
			m_nStatColors[ui] = GetDefaultStatsColor(ui);
@


1.346
log
@Removed not working 'Automatic serverconnect without proxy' feature;
Don't save NoProxy type in preferences.ini; Check proxy type values on read.
@
text
@a109 1
//	m_strLangDir = m_strAppDir + _T("lang\\");
d111 1
a111 28
	::CreateDirectory(GetConfigDir(),0);

	// lets move config-files in the appdir to the configdir
	if ( PathFileExists(m_strAppDir + _T("adresses.dat"))) MoveFile(m_strAppDir + _T("adresses.dat"), m_strConfigDir + _T("addresses.dat"));
//	Fix spelling (uncomment the following line after we're ready to use original eMule unicode file format)
//	if ( PathFileExists(m_strConfigDir + _T("adresses.dat"))) MoveFile(m_strConfigDir + _T("adresses.dat"), m_strConfigDir + _T("addresses.dat"));

	if ( PathFileExists(m_strAppDir + _T("cryptkey.dat"))) MoveFile(m_strAppDir + _T("cryptkey.dat"), m_strConfigDir + _T("cryptkey.dat"));
	if ( PathFileExists(m_strAppDir + _T("gui.dat"))) MoveFile(m_strAppDir + _T("gui.dat"),m_strConfigDir + _T("gui.dat"));
	if ( PathFileExists(m_strAppDir + _T("IPFilter.dat"))) MoveFile(m_strAppDir + _T("IPFilter.dat"), m_strConfigDir + _T("IPFilter.dat"));
	if ( PathFileExists(m_strAppDir + _T("onlinesig.dat"))) MoveFile(m_strAppDir + _T("onlinesig.dat"), m_strConfigDir + _T("onlinesig.dat"));
	if ( PathFileExists(m_strAppDir + _T("partperm.dat"))) MoveFile(m_strAppDir + _T("partperm.dat"), m_strConfigDir + _T("partperm.dat"));
	if ( PathFileExists(m_strAppDir + _T("preferences.dat"))) MoveFile(m_strAppDir + _T("preferences.dat"), m_strConfigDir + _T("preferences.dat"));
	if ( PathFileExists(m_strAppDir + _T("shareddir.dat"))) MoveFile(m_strAppDir + _T("shareddir.dat"), m_strConfigDir + _T("shareddir.dat"));
	if ( PathFileExists(m_strAppDir + _T("staticservers.dat"))) MoveFile(m_strAppDir + _T("staticservers.dat"), m_strConfigDir + _T("staticservers.dat"));
	if ( PathFileExists(m_strAppDir + _T("tempdir.dat"))) MoveFile(m_strAppDir + _T("tempdir.dat"), m_strConfigDir + _T("tempdir.dat"));
	if ( PathFileExists(m_strAppDir + _T("traffic.dat"))) MoveFile(m_strAppDir + _T("traffic.dat"), m_strConfigDir + _T("traffic.dat"));
	if ( PathFileExists(m_strAppDir + _T("userhash.dat"))) MoveFile(m_strAppDir + _T("userhash.dat"), m_strConfigDir + _T("userhash.dat"));
	if ( PathFileExists(m_strAppDir + _T("webservices.dat"))) MoveFile(m_strAppDir + _T("webservices.dat"), m_strConfigDir + _T("webservices.dat"));
	if ( PathFileExists(m_strAppDir + _T("category.ini"))) MoveFile(m_strAppDir + _T("category.ini"), m_strConfigDir + _T("category.ini"));
	if ( PathFileExists(m_strAppDir + _T("fileinfo.ini"))) MoveFile(m_strAppDir + _T("fileinfo.ini"), m_strConfigDir + _T("fileinfo.ini"));
	if ( PathFileExists(m_strAppDir + _T("preferences.ini"))) MoveFile(m_strAppDir + _T("preferences.ini"), m_strConfigDir + _T("preferences.ini"));
	if ( PathFileExists(m_strAppDir + _T("statbkup.ini"))) MoveFile(m_strAppDir + _T("statbkup.ini"), m_strConfigDir + _T("statbkup.ini"));
	if ( PathFileExists(m_strAppDir + _T("statbkuptmp.ini"))) MoveFile(m_strAppDir + _T("statbkuptmp.ini"), m_strConfigDir + _T("statbkuptmp.ini"));
	if ( PathFileExists(m_strAppDir + _T("clients.met"))) MoveFile(m_strAppDir + _T("clients.met"), m_strConfigDir + _T("clients.met"));
	if ( PathFileExists(m_strAppDir + _T("emfriends.met"))) MoveFile(m_strAppDir + _T("emfriends.met"), m_strConfigDir + _T("emfriends.met"));
	if ( PathFileExists(m_strAppDir + _T("known.met"))) MoveFile(m_strAppDir + _T("known.met"), m_strConfigDir + _T("known.met"));
	if ( PathFileExists(m_strAppDir + _T("server.met"))) MoveFile(m_strAppDir + _T("server.met"), m_strConfigDir + _T("server.met"));
a135 1
//	Maverick
d139 1
a139 1
//	Make sure the Incoming and primary Temp dirs exist.
@


1.345
log
@Added support for Hungarian localization.
@
text
@a941 1
	ini.SetBool(_T("ConnectWithoutProxy"), m_bIsASCWOP);
d1702 4
a1705 2
	m_proxy.m_nType = ini.GetInt(_T("Type"), PROXYTYPE_NOPROXY);
	m_bIsASCWOP = ini.GetBool(_T("ConnectWithoutProxy"), false);
@


1.344
log
@Added preferences.ini option (AllowLocalHostIP) to allow acceptance of local sources (127.*.*.*).
@
text
@d2264 1
d2298 1
@


1.343
log
@Corrected localization for the title of Language select message box {BouRock};
Removed not working code checking string loading as a string will be loaded anyway
localized or English (besides that this code would cause a crash if it has executed as g_App.m_pPrefs=0 here);
Removed consecutive seeding of random generator (srand).
@
text
@d775 1
d1492 1
@


1.342
log
@Added Ukrainian localization.
@
text
@d92 1
a92 2
//	Seed the random number generator
	srand((uint32)time(0)); // we need random numbers sometimes
a1151 4
//
//	Generate a random six character default nickname and add the version tag to it
	srand((unsigned)time(NULL));

d1162 1
a2278 2
			CString strTmp = GetResString(IDS_MB_LANGUAGEINFO, MAKELANGID(LANG_ENGLISH, SUBLANG_DEFAULT));

a2306 1
				{
a2307 1
					strTmp = GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID);
d2309 1
a2309 1
				}
d2319 2
a2320 1
			::MessageBox(0, strTmp, _T("Language"), MB_ICONASTERISK);
a2325 10

	// if loading a string fails, set language to English
	if (GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID).GetLength()==0)
	{
		m_nLanguageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
#ifndef NEW_SOCKETS_ENGINE
		if (g_App.m_pPrefs->IsNTBased())
#endif //NEW_SOCKETS_ENGINE
			SetThreadLocale(m_nLanguageID);
	}
@


1.341
log
@Configuration of default file permission [DarkSoul/Aw3]
(the feature isn't finished yet -- just GUI and value save/load are ready).
@
text
@d2278 1
d2312 1
@


1.340
log
@Large file size support preparations.
@
text
@d643 1
d1273 5
@


1.339
log
@Large file size support preparations.
@
text
@a2349 1

d2418 3
a2420 3
	cumSharedLargestShareSize = 0;
	dwCumSharedLargestAvgFileSize = 0;
	dwCumSharedLargestFileSize = 0;
d2584 1
a2584 1
		uint64	temp64;
d2599 6
a2604 7
		temp64 = ini.GetUInt64(_T("SharedLargestShareSize"), 0);
		if (temp64 > cumSharedLargestShareSize)
			cumSharedLargestShareSize = temp64;
		if ((dwVal = ini.GetUInt32(_T("SharedLargestAvgFileSize"), 0)) > dwCumSharedLargestAvgFileSize)
			dwCumSharedLargestAvgFileSize = dwVal;
		if ((dwVal = ini.GetUInt32(_T("SharedLargestFileSize"), 0)) > dwCumSharedLargestFileSize)
			dwCumSharedLargestFileSize = dwVal;
d2637 3
a2639 3
		cumSharedLargestShareSize = ini.GetUInt64(_T("SharedLargestShareSize"), 0);
		dwCumSharedLargestAvgFileSize = ini.GetUInt32(_T("SharedLargestAvgFileSize"), 0);
		dwCumSharedLargestFileSize = ini.GetUInt32(_T("SharedLargestFileSize"), 0);
d2934 1
a2934 1
		uint64 allsize = g_App.m_pSharedFilesList->GetDatasize(&qwLargestFile);
d2936 6
a2941 6
		if (allsize > cumSharedLargestShareSize)
			cumSharedLargestShareSize = allsize;
		ini.SetUInt64(_T("SharedLargestShareSize"), cumSharedLargestShareSize);
		if (qwLargestFile > dwCumSharedLargestFileSize)
			dwCumSharedLargestFileSize = qwLargestFile;
		ini.SetUInt32(_T("SharedLargestFileSize"), dwCumSharedLargestFileSize);
d2944 1
a2944 1
			uint32 dwTmp = allsize / g_App.m_pSharedFilesList->GetCount();
d2946 2
a2947 2
			if (dwTmp > dwCumSharedLargestAvgFileSize)
				dwCumSharedLargestAvgFileSize = dwTmp;
d2949 1
a2949 1
		ini.SetUInt32(_T("SharedLargestAvgFileSize"), dwCumSharedLargestAvgFileSize);
d2998 1
a2998 1
	uint64 allsize = g_App.m_pSharedFilesList->GetDatasize(&qwLargestFile);
d3000 4
a3003 4
	if (allsize > cumSharedLargestShareSize)
		cumSharedLargestShareSize = allsize;
	if (qwLargestFile > dwCumSharedLargestFileSize)
		dwCumSharedLargestFileSize = qwLargestFile;
d3006 1
a3006 1
		uint32 dwTmp = allsize / g_App.m_pSharedFilesList->GetCount();
d3008 2
a3009 2
		if (dwTmp > dwCumSharedLargestAvgFileSize)
			dwCumSharedLargestAvgFileSize = dwTmp;
@


1.338
log
@Added default statistics tree mask.
@
text
@d2935 2
a2936 2
		uint32 dwLargestFile;
		uint64 allsize = g_App.m_pSharedFilesList->GetDatasize(&dwLargestFile);
d2941 2
a2942 2
		if (dwLargestFile > dwCumSharedLargestFileSize)
			dwCumSharedLargestFileSize = dwLargestFile;
d2999 2
a3000 2
	uint32 dwLargestFile;
	uint64 allsize = g_App.m_pSharedFilesList->GetDatasize(&dwLargestFile);
d3004 2
a3005 2
	if (dwLargestFile > dwCumSharedLargestFileSize)
		dwCumSharedLargestFileSize = dwLargestFile;
@


1.337
log
@Unicode corrections.
@
text
@d2643 1
a2643 1
		m_strStatsExpandedTreeItems = ini.GetString(_T("statsExpandedTreeItems"), _T("111000000100000110000010000011110000010010"));
@


1.336
log
@Unicode corrections.
@
text
@d1734 1
a1734 1
		strBuf = inet_ntoa(*reinterpret_cast<in_addr*>(*pHost->h_addr_list));	// Get this clients default ip as a string
@


1.335
log
@new email notifier code (adapted from original) - fully UNICODE ready;
option to send email notification messages in subject
@
text
@d936 3
a938 3
	ini.SetString(_T("Name"), m_proxy.m_strName);
	ini.SetString(_T("Password"), Crypt(m_proxy.m_strPassword));
	ini.SetString(_T("User"), m_proxy.m_strUser);
@


1.334
log
@Dropped import of old preferences (preceding eMule v0.21);
Added ta define for default proxy port.
@
text
@d994 1
d1762 1
@


1.333
log
@Crypt/Decrypt only on load/save;
Removed some code related to Indonesian localization.
@
text
@d1697 1
a1697 1
	m_proxy.m_uPort = ini.GetInt(_T("Port"), 1080);
d1840 1
a1840 1
	CString		strFullPath = m_strConfigDir;
d1844 1
a1844 1
	FILE	*pPrefsFile = _tfopen(strFullPath,_T("rb"));
d1857 2
a1858 38
//	Import old pref-files
	if (m_prefsExt.version < 20)
	{
		if (m_prefsExt.version > 17)
		{// v0.20b+
			Preferences_Import20b_Struct prefsImport20b;

			memzero(&prefsImport20b, sizeof(Preferences_Import20b_Struct));
			fseek(pPrefsFile, 0, 0);
			fread(&prefsImport20b, sizeof(Preferences_Import20b_Struct), 1, pPrefsFile);

			md4cpy(m_userHash, prefsImport20b.abyteUserHash);
			m_sIncomingDir.Put(prefsImport20b.incomingdir);
			m_sTempDir.Put(prefsImport20b.tempdir);
			m_sNick.Put(prefsImport20b.nick);

			m_nTotalDownloadedBytes.Put(prefsImport20b.totalDownloadedBytes);
			m_nTotalUploadedBytes.Put(prefsImport20b.totalUploadedBytes);
		}
		else if (m_prefsExt.version > 7)
		{ // v0.20a
			Preferences_Import20a_Struct prefsImport20a;

			memzero(&prefsImport20a, sizeof(Preferences_Import20a_Struct));
			fseek(pPrefsFile, 0, 0);
			fread(&prefsImport20a, sizeof(Preferences_Import20a_Struct), 1, pPrefsFile);

			md4cpy(m_userHash, prefsImport20a.abyteUserHash);
			m_sIncomingDir.Put(prefsImport20a.incomingdir);
			m_sTempDir.Put(prefsImport20a.tempdir);
			m_sNick.Put(prefsImport20a.nick);

			m_nTotalDownloadedBytes.Put(prefsImport20a.totalDownloaded);
			m_nTotalUploadedBytes.Put(prefsImport20a.totalUploaded);
		}
		else
		{	//v0.19c-
			Preferences_Import19c_Struct prefsImport19c;
a1859 18
			memzero(&prefsImport19c, sizeof(Preferences_Import19c_Struct));
			fseek(pPrefsFile, 0, 0);
			fread(&prefsImport19c, sizeof(Preferences_Import19c_Struct), 1, pPrefsFile);

			if (m_prefsExt.version < 3)
				CreateUserHash();
			else
				md4cpy(m_userHash, prefsImport19c.abyteUserHash);
			m_sIncomingDir.Put(prefsImport19c.incomingdir);
			m_sTempDir.Put(prefsImport19c.tempdir);
			m_sNick.Put(prefsImport19c.nick);
		}
 	}
	else
	{
		md4cpy(m_userHash, m_prefsExt.abyteUserHash);
		m_WindowPlacement = m_prefsExt.EmuleWindowPlacement;
	}
@


1.332
log
@Added shortcut for "Download from all A4AF sources (same category)" {Fuxie - DK}.
@
text
@d937 1
a937 1
	ini.SetString(_T("Password"), m_proxy.m_strPassword);
d990 1
a990 1
	ini.SetString(_T("Password"), *m_sSMTPPassword.Get(&strBuf));
d1695 1
a1695 1
	m_proxy.m_strPassword = ini.GetString(_T("Password"), _T(""));
d1757 1
a1757 1
	m_sSMTPPassword.Put(ini.GetString(_T("Password"), Crypt(_T("password"))));
a2311 3
#if 0
		case MAKELANGID(LANG_INDONESIAN, SUBLANG_DEFAULT):setlocale( LC_ALL, "");break;
#endif
a2345 3
#if 0
				case LANG_INDONESIAN:
#endif
@


1.331
log
@Removed preferences stuff (not used anymore) related to gzip compression.
@
text
@d77 1
d3171 1
a3171 2
	// ini.CloseWithoutSave();
	ini.SaveAndClose(); // BavarianSnail
@


1.330
log
@Added Malay localization.
@
text
@a951 1
	ini.SetBool(_T("UseGzip"), m_bWebUseGzip);
a1708 1
	m_bWebUseGzip = ini.GetBool(_T("UseGzip"), true);
@


1.329
log
@UNICODE preparation (first shot) + minor improvements
@
text
@d2319 1
d2356 1
d2365 1
a2365 1
					m_nLanguageID = MAKELANGID(PRIMARYLANGID(nLocalLang),SUBLANG_DEFAULT);
d2370 1
a2370 1
					m_nLanguageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
@


1.328
log
@Minor optimization of calls.
@
text
@d46 1
a46 1
static const TCHAR *s_apcShortcutNames[] = 
d115 1
a115 1
	if ( PathFileExists(m_strAppDir+"adresses.dat")) MoveFile(m_strAppDir+"adresses.dat",m_strConfigDir+"addresses.dat");
d117 1
a117 1
//	if ( PathFileExists(m_strConfigDir+"adresses.dat")) MoveFile(m_strConfigDir+"adresses.dat",m_strConfigDir+"addresses.dat");
d119 21
a139 21
	if ( PathFileExists(m_strAppDir+"cryptkey.dat")) MoveFile(m_strAppDir+"cryptkey.dat",m_strConfigDir+"cryptkey.dat");
	if ( PathFileExists(m_strAppDir+"gui.dat")) MoveFile(m_strAppDir+"gui.dat",m_strConfigDir+"gui.dat");
	if ( PathFileExists(m_strAppDir+"IPFilter.dat")) MoveFile(m_strAppDir+"IPFilter.dat",m_strConfigDir+"IPFilter.dat");
	if ( PathFileExists(m_strAppDir+"onlinesig.dat")) MoveFile(m_strAppDir+"onlinesig.dat",m_strConfigDir+"onlinesig.dat");
	if ( PathFileExists(m_strAppDir+"partperm.dat")) MoveFile(m_strAppDir+"partperm.dat",m_strConfigDir+"partperm.dat");
	if ( PathFileExists(m_strAppDir+"preferences.dat")) MoveFile(m_strAppDir+"preferences.dat",m_strConfigDir+"preferences.dat");
	if ( PathFileExists(m_strAppDir+"shareddir.dat")) MoveFile(m_strAppDir+"shareddir.dat",m_strConfigDir+"shareddir.dat");
	if ( PathFileExists(m_strAppDir+"staticservers.dat")) MoveFile(m_strAppDir+"staticservers.dat",m_strConfigDir+"staticservers.dat");
	if ( PathFileExists(m_strAppDir+"tempdir.dat")) MoveFile(m_strAppDir+"tempdir.dat",m_strConfigDir+"tempdir.dat");
	if ( PathFileExists(m_strAppDir+"traffic.dat")) MoveFile(m_strAppDir+"traffic.dat",m_strConfigDir+"traffic.dat");
	if ( PathFileExists(m_strAppDir+"userhash.dat")) MoveFile(m_strAppDir+"userhash.dat",m_strConfigDir+"userhash.dat");
	if ( PathFileExists(m_strAppDir+"webservices.dat")) MoveFile(m_strAppDir+"webservices.dat",m_strConfigDir+"webservices.dat");
	if ( PathFileExists(m_strAppDir+"category.ini")) MoveFile(m_strAppDir+"category.ini",m_strConfigDir+"category.ini");
	if ( PathFileExists(m_strAppDir+"fileinfo.ini")) MoveFile(m_strAppDir+"fileinfo.ini",m_strConfigDir+"fileinfo.ini");
	if ( PathFileExists(m_strAppDir+"preferences.ini")) MoveFile(m_strAppDir+"preferences.ini",m_strConfigDir+"preferences.ini");
	if ( PathFileExists(m_strAppDir+"statbkup.ini")) MoveFile(m_strAppDir+"statbkup.ini",m_strConfigDir+"statbkup.ini");
	if ( PathFileExists(m_strAppDir+"statbkuptmp.ini")) MoveFile(m_strAppDir+"statbkuptmp.ini",m_strConfigDir+"statbkuptmp.ini");
	if ( PathFileExists(m_strAppDir+"clients.met")) MoveFile(m_strAppDir+"clients.met",m_strConfigDir+"clients.met");
	if ( PathFileExists(m_strAppDir+"emfriends.met")) MoveFile(m_strAppDir+"emfriends.met",m_strConfigDir+"emfriends.met");
	if ( PathFileExists(m_strAppDir+"known.met")) MoveFile(m_strAppDir+"known.met",m_strConfigDir+"known.met");
	if ( PathFileExists(m_strAppDir+"server.met")) MoveFile(m_strAppDir+"server.met",m_strConfigDir+"server.met");
d214 1
a214 1
	CString		strFullPath;
d216 1
a216 1
	strFullPath.Format(_T("%suserhash.dat"), m_strConfigDir);
d218 1
a218 1
	FILE		*pHashFile = _tfopen(strFullPath, _T("rb")) ;
d220 1
a220 1
	if (pHashFile)
d290 2
a291 2
	bool		bError = false;
	CString		strFullPath;
d293 1
a293 1
	strFullPath.Format(_T("%spreferences.dat"),m_strConfigDir);
d295 1
a295 1
	FILE		*pPrefFile = _tfopen(strFullPath,_T("wb"));
a305 1
	//	v1:- eklmn: bugfix(19): by shutdown force OS flush data direct to disk [SlugFiller]
d307 1
d319 1
a319 1
	FILE		*pHashFile = _tfopen(strFullPath, _T("wb")) ;
d321 1
a321 1
	if (pHashFile)
a323 1
	//	v1:- eklmn: bugfix(19): by shutdown force OS flush data direct to disk [SlugFiller]
d325 1
d329 1
a329 1
		fclose(pHashFile) ;
d332 1
a332 1
		bError = true ;
d338 1
a338 1
	CStdioFile		sharedDirsFile;
d342 1
a342 1
		CSingleLock		sLock(&m_csDirList, true);
a354 1
//	start added by InterCeptor (multiple tempdirs) 19.11.02
d357 1
a357 1
	CStdioFile		tempDirsFile;
d361 1
a361 1
		CSingleLock		sLock(&m_csDirList, true);
a372 1
//	end added by InterCeptor (multiple tempdirs) 19.11.02
d962 3
a964 3
	ini.SetString("Password", HashToString(reinterpret_cast<const byte*>(m_sMMPassword.Get(&PasswdDigest))));
	ini.SetBool("Enabled", m_bMMEnabled);
	ini.SetInt("Port", m_uMMPort);
d1017 1
a1017 1
	strColor.Format("%u", m_clrFakeListDownloadColor);
d1038 1
a1038 1
	remove(strTemp);
d1044 1
a1044 1
		catini.SetDefaultCategory("General");
d1062 1
a1062 1
				strTemp.Format("Cat#%i", ix - CCat::GetNumPredefinedCats() + 1);
d1069 1
a1069 1
				//	There's no such directory in the list and its creation failed 
d1163 4
a1166 1
	CString	buffer;
d1168 1
a1168 2
	for (int i = 0; i < 6; i++)
		buffer += char(rand() % ('z' - 'a') + 'a');
d1170 1
a1170 2
	buffer += _T(" [ePlus]");
	m_sNick.Put(ini.GetString(_T("Nick"), buffer));
d1173 2
a1174 2
	buffer.Format(_T("%sIncoming"), m_strAppDir);
	m_sIncomingDir.Put(ini.GetString(_T("IncomingDir"), buffer));
d1177 2
a1178 2
	buffer.Format(_T("%sTemp"), m_strAppDir);
	m_sTempDir.Put(ini.GetString(_T("TempDir"), buffer));
d1186 1
a1186 1
	if (access(m_sVideoPlayer.Get().Trim(), 0) != 0)
d1196 1
a1196 1
			RegCloseKey(hKey); 
d1210 1
a1210 1
				RegCloseKey(hKey); 
d1213 3
a1215 3
					buffer = szBuf;
					buffer += _T("\\vlc.exe");
					m_sVideoPlayer.Put(buffer);
d1371 1
a1371 1
	CCat::SetAllCatType(static_cast<_EnumCategories>(ini.GetInt("AllCatType",CAT_ALL)));
d1403 1
a1403 1
	
d1405 3
a1407 3
	m_sIRCServer.Get(&buffer);
	buffer.Trim().MakeLower();
	if ((buffer == _T("irc.liquidirc.com")) || (buffer == _T("217.172.179.168")) || (buffer.Left(13) == _T("irc.freshirc.")))
d1409 1
a1409 1
	
d1429 1
a1429 1
	m_bShowRatingIcons=ini.GetBool(_T("ShowRatingIcons"), true);	
d1631 3
a1633 2
	CString buffer2;
	for (int i = 0; i < 15; i++)
d1635 5
a1639 5
		buffer2.Format(_T("StatColor%i"),i);
		buffer.Format(ini.GetString(buffer2,_T("-1")));	//we can now have black as background
		m_nStatColors[i] = _tstoi64(buffer);
		if (m_nStatColors[i] == -1)
			m_nStatColors[i] = GetDefaultStatsColor(i);
d1668 1
a1668 1
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"),"www.microsoft.com|www.google.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org"));
d1682 4
a1685 4
	m_bAVEnabled				= ini.GetBool("AVEnabled", false);
	m_strAVPath					= ini.GetString("AVPath", _T(""));
	m_strAVParams				= ini.GetString("AVParams", _T(""));
	m_bAVScanCompleted			= ini.GetBool("AVScanCompleted", false);
d1694 3
a1696 3
	m_proxy.m_strName = ini.GetString(_T("Name"), "");
	m_proxy.m_strPassword = ini.GetString(_T("Password"), "");
	m_proxy.m_strUser = ini.GetString(_T("User"), "");
d1721 2
a1722 2
	m_bMMEnabled = ini.GetBool("Enabled", false);
	m_uMMPort = ini.GetInt("Port", PREF_DEF_MM_PORT);
d1727 1
a1727 3
	char localHost[255];
	gethostname(localHost, 255);						// Get this clients hostname
	struct hostent *host = gethostbyname(localHost);	// Get the host info
d1729 6
a1734 2
	if (host)
		buffer = inet_ntoa(*(struct in_addr*)*host->h_addr_list);	//	Get this clients default ip as a string
d1736 1
a1736 1
		buffer = _T("");
d1740 2
a1741 2
	m_DefaultLancastIP = inet_addr(buffer);
	m_LancastIP = inet_addr(ini.GetString(_T("IPAddress"), buffer));
d1749 1
a1749 2
	buffer2.SetString(_T("http|www.|.com|sharereactor|sharelive|filedonkey|saugstube|eselfilme|eseldownloads|donkey-mania|emulemovies|spanishare|eselpsychos.de|saughilfe.de|goldesel.6x.to|goldesel.tk|freedivx.org|elitedivx|deviance|filenexus|ac3-guru"));
	m_sFilenameCleanups.Put(ini.GetString(_T("FilenameCleanups"), buffer2));
d1753 6
a1758 6
	m_sSMTPServer.Put(ini.GetString(_T("Server"), "smtp.server.com"));
	m_sSMTPName.Put(ini.GetString(_T("Name"), CLIENT_NAME " Messenger"));
	m_sSMTPFrom.Put(ini.GetString(_T("From"), "messenger@@emuleplus.info"));
	m_sSMTPTo.Put(ini.GetString(_T("To"), "user@@domain.com"));
	m_sSMTPUserName.Put(ini.GetString(_T("UserName"), "username"));
	m_sSMTPPassword.Put(ini.GetString(_T("Password"), Crypt("password")));
d1773 2
a1774 2
	buffer.Format(_T("%sBackup"),m_strAppDir);
	m_sBackupDir.Put(ini.GetString(_T("BackupDir"), buffer));
d1786 1
a1786 1
	
d1812 1
a1812 1
		buffer = GetResString(IDS_MULTIPLE, m_nLanguageID);
d1815 1
a1815 1
		m_bMultiple = (IDYES == ::MessageBox(0, buffer, CLIENT_NAME, MB_YESNO | MB_ICONQUESTION | MB_DEFBUTTON2));	// make "no" the default
d1841 1
a1841 1
	CString		strFullPath;
d1843 1
a1843 1
	strFullPath.Format(_T("%spreferences.dat"),m_strConfigDir);
d1845 1
a1845 1
	FILE		*pPrefsFile = _tfopen(strFullPath,_T("rb"));
d1924 1
a1924 1
	FILE	*fpFilterFile;
d1926 1
a1926 1
	
a1934 2
		CFile	pFilterFile;
		CFileException FileException;
d1936 1
a1936 1
		if (0 == pFilterFile.Open(strFullPath, CFile::modeCreate | CFile::modeWrite, &FileException))
d1939 1
a1939 1
		pFilterFile.Write(acHdr, sizeof(acHdr) - sizeof(acHdr[0]));
d1945 1
a1945 2
	fpFilterFile = _tfopen(strFullPath, "r");
	if (fpFilterFile == NULL)
d1948 1
a1948 2
	CStdioFile	FilterFile(fpFilterFile);
	CString		strLine;
d1951 1
a1951 1
	while (FilterFile.ReadString(strLine) != false) 
d2009 1
a2009 1
	CString		ixStr, catinif;
d2011 1
a2011 1
	CCat::g_iNumPredefinedCats = 0;
d2013 1
a2013 1
	catinif.Format(_T("%sCategory.ini"), m_strConfigDir);
d2015 2
a2016 2
	// default cat
	CCat		*newcat = new CCat();
d2018 10
a2027 10
	newcat->m_strTitle = CCat::GetPredefinedCatTitle(CAT_ALL,GetLanguageID());
	newcat->m_strSavePath = GetIncomingDir();
	newcat->m_strTempPath = GetTempDir();
	newcat->m_strComment = _T("");
	newcat->m_iPriority = 0;
	newcat->m_crColor = RGB(0,0,0);
	newcat->m_strAutoCatExt = _T("");
	newcat->m_eCatID = CAT_ALL;
	newcat->m_bIsPredefined = true;
	CCat::AddCat(newcat, false);
d2030 1
a2030 1
	if(!PathFileExists(catinif))
d2033 1
a2033 1
	CIni catini(catinif);
d2035 1
a2035 1
	catini.SetDefaultCategory("General");
d2037 3
a2039 1
	for (int i = 1; i <= CAT_MAXPREDEFINEDCATS; i++)
d2041 2
a2042 4
		EnumCategories		eCatID = CAT_NONE;

		ixStr.Format("PredefinedCat%i",i);
		eCatID = static_cast<_EnumCategories>(catini.GetInt(ixStr, CAT_NONE));
d2047 1
a2047 1
			CCat		*newcat = new CCat();
d2049 10
a2058 10
			newcat->m_strTitle = CCat::GetPredefinedCatTitle(eCatID,GetLanguageID());
			newcat->m_strSavePath = GetIncomingDir();
			newcat->m_strTempPath = GetTempDir();
			newcat->m_strComment = _T("");
			newcat->m_iPriority = 0;
			newcat->m_crColor = 0;
			newcat->m_strAutoCatExt = _T("");
			newcat->m_eCatID = eCatID;
			newcat->m_bIsPredefined = true;
			CCat::AddCat(newcat, false);
d2063 1
a2063 1
	int max = catini.GetInt(_T("Count"), 0);
d2065 1
a2065 1
	for (int ix = 1; ix <= max; ix++)
d2067 3
a2069 2
		ixStr.Format(_T("Cat#%i"), ix);
		catini.SetDefaultCategory(ixStr);
a2070 1
		CCat	*newcat = new CCat();
d2074 1
a2074 1
		newcat->m_strTitle = catini.GetString(_T("Title"), _T(""));
d2076 1
a2076 1
		_tcscpy(strSavePath, catini.GetString(_T("Incoming"), _T("")));
d2080 1
a2080 1
			_tcsncpy(strSavePath, GetIncomingDir(),ARRSIZE(strSavePath));
d2083 1
a2083 1
		newcat->m_strSavePath = strSavePath;
d2085 1
a2085 1
		_tcscpy(strTempPath, catini.GetString(_T("Temp"), GetTempDir()));
d2087 1
a2087 1
		newcat->m_strTempPath = strTempPath;
d2089 9
a2097 11
		if (TempDirListCheckAndAdd(newcat->m_strTempPath, true) < 0)
		{
		//	There's no such directory in the list and its creation failed 
			newcat->m_strTempPath = GetTempDir();
		}
		newcat->m_strComment = catini.GetString(_T("Comment"), _T(""));
		newcat->m_iPriority = catini.GetInt(_T("Priority"), 0);
		newcat->m_crColor = static_cast<COLORREF>(catini.GetUInt32(_T("Color"), 0));
		newcat->m_strAutoCatExt = catini.GetString(_T("AutoCat"), _T(""));
		newcat->m_eCatID = static_cast<_EnumCategories>(catini.GetInt(_T("CategoryID"), ix));
		newcat->m_bIsPredefined = false;
d2100 1
a2100 1
		CCat::AddCat(newcat, false);
d2504 3
a2506 3
	CString fullpath;
	CFileFind findBackUp;
	bool alreadySaved = false;
d2511 1
a2511 1
			fullpath.Format(_T("%spreferences.ini"),m_strConfigDir);
d2514 4
a2517 3
			fullpath.Format(_T("%sstatbkup.ini"),m_strConfigDir);
			if (!findBackUp.FindFile(fullpath))	return false;
			SaveStats(2); // Save our temp backup of current values to statbkuptmp.ini, we will be renaming it at the end of this function.
d2520 5
a2524 3
			if (sFileName.IsEmpty()) return false;
			fullpath = sFileName;
			if (!findBackUp.FindFile(fullpath))	return false;
d2528 1
a2528 1
	CIni	ini(fullpath);
d2674 3
a2676 3
			CFile::Remove(fullpath); // Remove the backup that we just restored from
			CFile::Rename(sINIBackUp, fullpath); // Rename our temporary backup to the normal statbkup.ini filename.
			alreadySaved = true;
d2700 1
a2700 1
		m_strStatsExpandedTreeItems = ini.GetString(_T("statsExpandedTreeItems"), "111000000100000110000010000011110000010010");
d2723 1
a2723 1
	if(stat_datetimeLastReset == 0)
d2731 1
a2731 1
	if(!alreadySaved)
d2767 1
a2767 1
	CString fullpath; // i_a
d2772 1
a2772 1
			fullpath.Format(_T("%spreferences.ini"),m_strConfigDir);
d2775 1
a2775 1
			fullpath.Format(_T("%sstatbkup.ini"),m_strConfigDir);
d2778 1
a2778 1
			fullpath.Format(_T("%sstatbkuptmp.ini"),m_strConfigDir);
d2782 1
a2782 1
	CIni ini(fullpath);
d3159 5
a3163 2
	CString fullpath; // i_a
	fullpath.Format(_T("%spreferences.ini"),m_strConfigDir);
a3164 1
	CIni ini(fullpath);
d3291 1
a3291 1
	{	
d3358 1
a3358 1
      iRc = 1;
d3403 1
a3403 1
	{	
@


1.327
log
@Updated fake URL {DonGato} (automatic substitution of the old URL wasn't added).
@
text
@d1164 1
d1490 3
a1492 3
	m_nXSUpTo = ini.GetInt(_T("XSUpTo"), GetMaxSourcePerFileSoft());
	if(m_nXSUpTo > GetMaxSourcePerFileSoft())
		m_nXSUpTo = GetMaxSourcePerFileSoft();
d1494 1
a1494 1
	m_nFontSize = ini.GetInt(_T("FontSize"),80);
d1504 2
a1505 2
	m_nFileBufferSize = ini.GetInt(_T("FileBufferSizePref"),16);
	m_nMainProcessPriority = ini.GetInt(_T("MainProcessPriority"),0);
@


1.326
log
@Czech localization.
@
text
@d1780 1
a1780 1
	m_sFakeListURL			= ini.GetString(_T("FakeListURL"), _T("http://donkeyfakes.gambri.net/public/ed2kfakes.txt")).Trim();
d1790 1
a1790 1
		m_sFakeListURL = _T("http://donkeyfakes.gambri.net/public/ed2kfakes.txt");
@


1.325
log
@Disabled Indonesian due to not finished work (maintain it for future attempts).
@
text
@d2308 1
d2339 14
a2352 13
				case	LANG_ENGLISH:
				case	LANG_BASQUE:
				case	LANG_BELARUSIAN:
				case	LANG_CATALAN:
				case	LANG_CHINESE:
				case	LANG_CROATIAN:
				case	LANG_DANISH:
				case	LANG_DUTCH:
				case	LANG_FINNISH:
				case	LANG_FRENCH:
				case	LANG_GERMAN:
				case	LANG_GREEK:
				case	LANG_HEBREW:
d2354 1
a2354 1
				case	LANG_INDONESIAN:
d2356 10
a2365 10
				case	LANG_ITALIAN:
				case	LANG_KOREAN:
				case	LANG_LITHUANIAN:
				case	LANG_NORWEGIAN:
				case	LANG_POLISH:
				case	LANG_PORTUGUESE:
				case	LANG_RUSSIAN:
				case	LANG_ROMANIAN:
				case	LANG_SPANISH:
				case	LANG_TURKISH:
@


1.324
log
@Fixed session statistics 'Parts Saved Due To ICH' {Fuxie - DK}.
@
text
@d2316 1
d2318 1
d2351 1
d2353 1
@


1.323
log
@Renaming in comments.
@
text
@d2446 1
a2446 1
	cumPartsSavedByICH = 0;
d2593 1
a2593 1
	cumPartsSavedByICH = ini.GetUInt32(_T("PartsSavedByICH"), 0);
d2704 10
a2713 10
		sesUpData_File = 			0;
		sesUpData_PartFile = 		0;
		sesUpData_Community =		0;
		sesUpData_NoCommunity =		0;
		sesUpDataPort_4662 =		0;
		sesUpDataPort_OTHER =		0;
		sesDownDataPort_4662 =		0;
		sesDownDataPort_OTHER =		0;
		sesDownSuccessfulSessions=	0;
		sesDownFailedSessions=		0;
d2715 1
a2715 1
		sesPartsSavedByICH=			0;
d2799 1
a2799 1
	ini.SetInt(_T("PartsSavedByICH"), cumPartsSavedByICH + sesPartsSavedByICH);
@


1.322
log
@renamed g_pPrefs->m_pPrefs (f... paste & copy :( )
@
text
@d2784 1
a2784 1
	ini.SetUInt64(_T("TotalDownloadedBytes"), /* g_eMuleApp.stat_sessionReceivedBytes */ + GetTotalDownloaded());
d2835 1
a2835 1
	ini.SetUInt64(_T("TotalUploadedBytes"), /* g_eMuleApp.stat_sessionSentBytes */ + GetTotalUploaded() );
@


1.321
log
@renamed 3 variables
@
text
@d2386 1
a2386 1
		if (g_App.g_pPrefs->IsNTBased())
@


1.320
log
@Removed "Drop sources with highest queue ranking".
@
text
@d308 1
a308 1
		if (!g_eMuleApp.m_pdlgEmule->IsRunning())
d326 1
a326 1
		if (!g_eMuleApp.m_pdlgEmule->IsRunning())
d2386 1
a2386 1
		if (g_eMuleApp.m_pGlobPrefs->IsNTBased())
d2677 1
a2677 1
		g_eMuleApp.m_pdlgEmule->m_dlgStatistics.ShowStatistics();
d2818 1
a2818 1
	if (g_eMuleApp.m_pDownloadQueue)
d2820 5
a2824 5
		ini.SetUInt64(_T("DownOverheadTotal"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequest() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServer() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadTotal() );
		ini.SetUInt64(_T("DownOverheadFileReq"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		ini.SetUInt64(_T("DownOverheadSrcEx"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
		ini.SetUInt64(_T("DownOverheadServer"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServer() + GetDownOverheadServer() );
		ini.SetUInt64(_T("DownOverheadOther"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOther() + GetDownOverheadOther() );
d2826 5
a2830 5
		ini.SetUInt64(_T("DownOverheadTotalPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServerPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		ini.SetUInt64(_T("DownOverheadFileReqPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + GetDownOverheadFileReqPackets() );
		ini.SetUInt64(_T("DownOverheadSrcExPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		ini.SetUInt64(_T("DownOverheadServerPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
		ini.SetUInt64(_T("DownOverheadOtherPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadOtherPackets() );
d2837 1
a2837 1
	if (g_eMuleApp.m_pUploadQueue)
d2839 3
a2841 3
		ini.SetInt(_T("UpSuccessfulSessions"), g_eMuleApp.m_pUploadQueue->GetSuccessfulUpCount()+GetUpSuccessfulSessions());
		ini.SetInt(_T("UpFailedSessions"), g_eMuleApp.m_pUploadQueue->GetFailedUpCount()+GetUpFailedSessions());
		ini.SetInt(_T("UpAvgTime"), (g_eMuleApp.m_pUploadQueue->GetAverageUpTime()+GetUpAvgTime())/2);
d2844 10
a2853 10
		ini.SetUInt64(_T("UpOverheadTotal"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequest() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchange() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServer() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadTotal() );
		ini.SetUInt64(_T("UpOverheadFileReq"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		ini.SetUInt64(_T("UpOverheadSrcEx"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		ini.SetUInt64(_T("UpOverheadServer"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		ini.SetUInt64(_T("UpOverheadOther"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadOther() );
		ini.SetUInt64(_T("UpOverheadTotalPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServerPackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets() );
		ini.SetUInt64(_T("UpOverheadFileReqPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets() );
		ini.SetUInt64(_T("UpOverheadSrcExPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		ini.SetUInt64(_T("UpOverheadServerPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
		ini.SetUInt64(_T("UpOverheadOtherPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadOtherPackets() );
d2883 1
a2883 1
	if(g_eMuleApp.m_pdlgEmule)
d2885 1
a2885 1
		if (g_eMuleApp.m_pdlgEmule->m_dlgStatistics)
d2888 1
a2888 1
			tempRate = g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetAvgDownloadRate(AVG_TOTAL);
d2894 1
a2894 1
			tempRate = g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetAvgUploadRate(AVG_TOTAL);
d2901 1
a2901 1
	if (g_eMuleApp.m_pDownloadQueue)
d2904 1
a2904 1
		tempRate = static_cast<double>(g_eMuleApp.m_pDownloadQueue->GetDataRate()) / 1024.0;
d2909 1
a2909 1
	if (g_eMuleApp.m_pUploadQueue)
d2911 1
a2911 1
		tempRate = static_cast<double>(g_eMuleApp.m_pUploadQueue->GetDataRate()) / 1024.0;
d2919 1
a2919 1
	uint64 timeseconds = (uint64)(::GetTickCount()-g_eMuleApp.stat_starttime)/1000;
d2923 2
a2924 2
	if (g_eMuleApp.stat_reconnects>0)
		ini.SetWORD(_T("ConnNumReconnects"), g_eMuleApp.stat_reconnects - 1 + GetConnNumReconnects());
d2930 1
a2930 1
	if (g_eMuleApp.m_pServerConnect)
d2933 2
a2934 2
		if (g_eMuleApp.m_pServerConnect->IsConnected())
			ini.SetUInt32(_T("ConnAvgConnections"), (uint32)(g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetAverageConnections()+cumConnAvgConnections)/2);
d2936 1
a2936 1
	if (g_eMuleApp.m_pListenSocket)
d2939 2
a2940 2
		if (g_eMuleApp.m_pListenSocket->GetMaxConnectionsReachedCount() > 0 )
			ini.SetUInt32(_T("ConnMaxConnLimitReached"), g_eMuleApp.m_pListenSocket->GetMaxConnectionsReachedCount() + cumConnMaxConnLimitReached);
d2945 1
a2945 1
	if(g_eMuleApp.m_pdlgEmule)
d2947 1
a2947 1
		if (g_eMuleApp.m_pdlgEmule->m_dlgStatistics)
d2950 2
a2951 2
			if (g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetPeakConnections()>cumConnPeakConnections)
				cumConnPeakConnections = g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetPeakConnections();
d2955 4
a2958 4
			ini.SetInt(_T("ConnTransferTime"), GetConnTransferTime() + g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetTransferTime());
			ini.SetInt(_T("ConnUploadTime"), GetConnUploadTime() + g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetUploadTime());
			ini.SetInt(_T("ConnDownloadTime"), GetConnDownloadTime() + g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetDownloadTime());
			ini.SetInt(_T("ConnServerDuration"), GetConnServerDuration() + g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetServerDuration());
d2964 1
a2964 1
	if (g_eMuleApp.m_pServerList)
d2966 1
a2966 1
		g_eMuleApp.m_pServerList->GetServersStatus( servtotal, servfail, servuser, servfile,
d2980 1
a2980 1
	if (g_eMuleApp.m_pSharedFilesList)
d2983 2
a2984 2
		if (g_eMuleApp.m_pSharedFilesList->GetCount()>cumSharedMostFilesShared)
			cumSharedMostFilesShared = g_eMuleApp.m_pSharedFilesList->GetCount();
d2988 1
a2988 1
		uint64 allsize = g_eMuleApp.m_pSharedFilesList->GetDatasize(&dwLargestFile);
d2996 1
a2996 1
		if (g_eMuleApp.m_pSharedFilesList->GetCount() != 0)
d2998 1
a2998 1
			uint32 dwTmp = allsize / g_eMuleApp.m_pSharedFilesList->GetCount();
d3038 1
a3038 1
	g_eMuleApp.m_pServerList->GetServersStatus( servtotal, servfail, servuser, servfile,
d3048 2
a3049 2
	if (g_eMuleApp.m_pSharedFilesList->GetCount() > cumSharedMostFilesShared)
		cumSharedMostFilesShared = g_eMuleApp.m_pSharedFilesList->GetCount();
d3052 1
a3052 1
	uint64 allsize = g_eMuleApp.m_pSharedFilesList->GetDatasize(&dwLargestFile);
d3058 1
a3058 1
	if (g_eMuleApp.m_pSharedFilesList->GetCount() != 0)
d3060 1
a3060 1
		uint32 dwTmp = allsize / g_eMuleApp.m_pSharedFilesList->GetCount();
d3101 1
a3101 1
			g_eMuleApp.UpdateSentBytes(bytes);
d3141 1
a3141 1
			g_eMuleApp.UpdateReceivedBytes(bytes);
@


1.319
log
@Make sure that DeadServerRetries is never zero.
@
text
@a650 1
	ini.SetBool(_T("DropHighestQR"), m_bDropHighestQR);
a1268 2
	m_bDropHighestQR = ini.GetBool(_T("UseRemoteQueueLimit"), true);
	m_bDropHighestQR = ini.GetBool(_T("DropHighestQR"), m_bDropHighestQR);
@


1.318
log
@Renamed service to follow real actions.
@
text
@d1281 3
a1283 1
	m_nDeadServerRetries = ini.GetInt(_T("DeadServerRetries"),1);
@


1.317
log
@Added support of Indonesian localization.
@
text
@d673 1
a673 1
	ini.SetBool(_T("Scoresystem"), m_nScoreSystem);
d1326 1
a1326 1
	m_nScoreSystem = ini.GetBool(_T("Scoresystem"), true);
@


1.316
log
@download log (part1: without GUI)
@
text
@d2317 1
d2350 1
@


1.315
log
@Shortcut to copy file hash to clipboard.
@
text
@d141 2
d775 1
d1487 1
@


1.314
log
@Fixed saving and display of "Gained Due To Compression" global statistics.
@
text
@d84 2
a85 1
	_T("ShareEditFileCommentsShortcut")				//SCUT_FILE_EDITCOMMENTS
@


1.313
log
@Save state of Friends list.
@
text
@d2407 29
a2435 29
	cumDownOverheadTotal=0;
	cumDownOverheadFileReq=0;
	cumDownOverheadSrcEx=0;
	cumDownOverheadServer=0;
	cumDownOverheadOther=0;
	cumDownOverheadTotalPackets=0;
	cumDownOverheadFileReqPackets=0;
	cumDownOverheadSrcExPackets=0;
	cumDownOverheadServerPackets=0;
	cumDownOverheadOtherPackets=0;
	cumUpOverheadTotal=0;
	cumUpOverheadFileReq=0;
	cumUpOverheadSrcEx=0;
	cumUpOverheadServer=0;
	cumUpOverheadOther=0;
	cumUpOverheadTotalPackets=0;
	cumUpOverheadFileReqPackets=0;
	cumUpOverheadSrcExPackets=0;
	cumUpOverheadServerPackets=0;
	cumUpOverheadOtherPackets=0;
	cumUpSuccessfulSessions=0;
	cumUpFailedSessions=0;
	cumUpAvgTime=0;
	cumUpDataPort_4662=0;
	cumUpDataPort_OTHER=0;
	cumDownCompletedFiles=0;
	cumDownSuccessfulSessions=0;
	cumDownFailedSessions=0;
	cumDownAvgTime=0;
d2438 2
a2439 1
	cumSavedFromCompression = 0;
d2586 1
a2586 1
	cumSavedFromCompression = ini.GetUInt64(_T("SavedFromCompression"), 0);
d2792 1
a2792 1
	ini.SetUInt64(_T("SavedFromCompression"), cumSavedFromCompression);
@


1.312
log
@Removed unused ini file variable; Friend splitter preparations.
@
text
@d414 2
d451 3
d479 2
d516 3
d544 2
d581 3
d847 3
d862 1
d873 1
d1570 3
d1609 3
d1622 1
d2173 2
d2204 2
d2245 3
d2286 3
@


1.311
log
@Removed a no longer required IRC server test and a minor correction.
@
text
@a639 1
	ini.SetInt(_T("SplitterbarPosition"), m_nSplitterBarPosition);
d907 3
a1257 1
	m_nSplitterBarPosition = ini.GetInt(_T("SplitterbarPosition"),75);
d1655 3
d2448 1
a2448 1
// This used to be integrated in LoadPreferences, but it has been altered
a2449 1
// Last Modified: 2-22-03 by Khaos
d2455 1
a2455 1
	// loadBackUp = 0: Load the stats normally like we used to do in LoadPreferences
@


1.310
log
@filter.txt -> filter.dat.
@
text
@d1378 1
a1378 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"), _T("irc.irc-gate.com")));
d1383 1
a1383 1
	if ((buffer == _T("irc.liquidirc.com")) || (buffer == _T("217.172.179.168")) || (buffer.Left(13) == _T("irc.freshirc.") || (buffer.Left(13) == _T("irc.irc-gate."))))
@


1.309
log
@Changed IRC server to irc.emuleplus.info.
@
text
@d148 1
a148 1
//	Load filter words from "filter.txt" file
d1883 1
a1883 1
// Load filter words from "filter.txt"
d1890 1
a1890 1
	strFullPath += _T("filter.txt");
@


1.308
log
@Added Extremaduran localization support.
@
text
@d1383 2
a1384 2
	if ((buffer == _T("irc.liquidirc.com")) || (buffer == _T("217.172.179.168")) || (buffer.Left(13) == _T("irc.freshirc.") || (buffer.Left(11) == _T("irc.redirc."))))
		m_sIRCServer.Put(_T("irc.irc-gate.com"));
@


1.307
log
@Cumulative statistics of lost due to corruption was always zero after restart {muleteer}.
@
text
@d2265 1
@


1.306
log
@main menu lock
@
text
@d2280 1
a2280 1
        	case MAKELANGID(LANG_TURKISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "turkish");break;
d2394 4
a2397 3
	cumLostFromCorruption=0;
	cumSavedFromCompression=0;
	cumPartsSavedByICH=0;
d2543 2
a2544 2
	cumLostFromCorruption = ini.GetUInt64(_T("LostFromCorruption"),0);
	cumSavedFromCompression = ini.GetUInt64(_T("SavedFromCompression"),0);
d2746 1
a2746 1
	ini.SetInt(_T("DownAvgTime"), (GetDownC_AvgTime() + GetDownS_AvgTime()) / 2 );
d2749 1
a2749 1
	ini.SetUInt64(_T("LostFromCorruption"), cumLostFromCorruption );
d2751 1
a2751 1
	ini.SetInt(_T("PartsSavedByICH"), cumPartsSavedByICH+sesPartsSavedByICH);
@


1.305
log
@added number of download failed sessions due to NNS sources to the statistic
@
text
@d935 1
d1680 1
@


1.304
log
@Unified and regrouped shortcuts.
@
text
@d2663 1
@


1.303
log
@IRC server changed to irc.irc-gate.com {Madmax75adsl}.
@
text
@d46 41
d998 2
a999 41
	ini.SetInt(_T("GeneralMinimizeWindowToTrayShortcut"),	m_anShortcutCode[IndexGalMinimize]);
	ini.SetInt(_T("GeneralSwitchWindowShortcut"),			m_anShortcutCode[IndexGalSwitchWindow]);
	ini.SetInt(_T("GeneralShowServerWndShortcut"),			m_anShortcutCode[IndexGalShowServer]);
	ini.SetInt(_T("GeneralShowTransferWndShortcut"),		m_anShortcutCode[IndexGalShowTransfer]);
	ini.SetInt(_T("GeneralShowSearchWndShortcut"),			m_anShortcutCode[IndexGalShowSearch]);
	ini.SetInt(_T("GeneralShowSharedFilesWndShortcut"),		m_anShortcutCode[IndexGalShowShare]);
	ini.SetInt(_T("GeneralShowChatWndShortcut"),			m_anShortcutCode[IndexGalShowChat]);
	ini.SetInt(_T("GeneralShowIRCWndShortcut"),				m_anShortcutCode[IndexGalShowIRC]);
	ini.SetInt(_T("GeneralShowStatisticsWndShortcut"),		m_anShortcutCode[IndexGalShowStats]);
	ini.SetInt(_T("GeneralShowPreferencesWndShortcut"),		m_anShortcutCode[IndexGalShowPrefs]);
	ini.SetInt(_T("DownloadCancelShortcut"),				m_anShortcutCode[IndexDLCancel]);
	ini.SetInt(_T("DownloadStopShortcut"),					m_anShortcutCode[IndexDLStop]);
	ini.SetInt(_T("DownloadPauseShortcut"),					m_anShortcutCode[IndexDLPause]);
	ini.SetInt(_T("DownloadResumeShortcut"),				m_anShortcutCode[IndexDLResume]);
	ini.SetInt(_T("DownloadOpenShortcut"),					m_anShortcutCode[IndexDLOpen]);
	ini.SetInt(_T("DownloadOpenFolderShortcut"),			m_anShortcutCode[IndexDLOpenFolder]);
	ini.SetInt(_T("DownloadPreviewShortcut"),				m_anShortcutCode[IndexDLPreview]);
	ini.SetInt(_T("DownloadRenameShortcut"),				m_anShortcutCode[IndexDLRename]);
	ini.SetInt(_T("DownloadViewFileCommentsShortcut"),		m_anShortcutCode[IndexDLComments]);
	ini.SetInt(_T("DownloadViewFileDetailsShortcut"),		m_anShortcutCode[IndexDLDetails]);
	ini.SetInt(_T("DownloadViewFileDetailsSourcesShortcut"),m_anShortcutCode[IndexDLDetailsSources]);
	ini.SetInt(_T("DownloadClearCompletedFilesShortcut"),	m_anShortcutCode[IndexDLClear]);
	ini.SetInt(_T("DownloadClearAllCompletedFilesShortcut"),m_anShortcutCode[IndexDLClearAll]);
	ini.SetInt(_T("DownloadShowAllUploadsShortcut"),		m_anShortcutCode[IndexDLShowAllUp]);
	ini.SetInt(_T("DownloadUseDefaultSortShortcut"),		m_anShortcutCode[IndexDLUseDefaultSort]);
	ini.SetInt(_T("DownloadPreallocateShortcut"),			m_anShortcutCode[IndexDLPreallocate]);
	ini.SetInt(_T("DownloadA4AFShortcut"),					m_anShortcutCode[IndexDLA4AF]);
	ini.SetInt(_T("DownloadA4AFAutoShortcut"),				m_anShortcutCode[IndexDLA4AFAuto]);
	ini.SetInt(_T("DownloadA4AFOtherShortcut"),				m_anShortcutCode[IndexDLA4AFOther]);
	ini.SetInt(_T("DownloadED2KLinkShortcut"),				m_anShortcutCode[IndexDLED2KLink]);
	ini.SetInt(_T("DownloadED2kLinkHtmlShortcut"),			m_anShortcutCode[IndexDLED2kLinkHtml]);
	ini.SetInt(_T("DownloadED2kLinkSourceShortcut"),		m_anShortcutCode[IndexDLED2kLinkSource]);
	ini.SetInt(_T("UploadViewClientDetailsShortcut"),		m_anShortcutCode[IndexULDetails]);
	ini.SetInt(_T("UploadAddClientToFriendsShortcut"),		m_anShortcutCode[IndexULFriend]);
	ini.SetInt(_T("UploadSendMessageClientShortcut"),		m_anShortcutCode[IndexULMessage]);
	ini.SetInt(_T("UploadViewClientFilesShortcut"),			m_anShortcutCode[IndexULFiles]);
	ini.SetInt(_T("ShareOpenShortcut"),						m_anShortcutCode[IndexShOpenFolder]);
	ini.SetInt(_T("ShareEditFileCommentsShortcut"),			m_anShortcutCode[IndexShComments]);
	ini.SetInt(_T("ShareED2KLinkShortcut"),					m_anShortcutCode[IndexShED2KLink]);
	ini.SetInt(_T("ShareED2kLinkHtmlShortcut"),				m_anShortcutCode[IndexShED2kLinkHtml]);
	ini.SetInt(_T("ShareED2kLinkSourceShortcut"),			m_anShortcutCode[IndexShED2kLinkSource]);
d1760 7
a1766 41
	m_anShortcutCode[IndexGalMinimize]		= ini.GetInt(_T("GeneralMinimizeWindowToTrayShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalSwitchWindow]	= ini.GetInt(_T("GeneralSwitchWindowShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowServer]	= ini.GetInt(_T("GeneralShowServerWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowTransfer]	= ini.GetInt(_T("GeneralShowTransferWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowSearch]	= ini.GetInt(_T("GeneralShowSearchWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowShare]		= ini.GetInt(_T("GeneralShowSharedFilesWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowChat]		= ini.GetInt(_T("GeneralShowChatWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowIRC]		= ini.GetInt(_T("GeneralShowIRCWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowStats]		= ini.GetInt(_T("GeneralShowStatisticsWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexGalShowPrefs]		= ini.GetInt(_T("GeneralShowPreferencesWndShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLCancel]			= ini.GetInt(_T("DownloadCancelShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLStop]			= ini.GetInt(_T("DownloadStopShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLPause]			= ini.GetInt(_T("DownloadPauseShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLResume]			= ini.GetInt(_T("DownloadResumeShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLOpen]			= ini.GetInt(_T("DownloadOpenShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLOpenFolder]		= ini.GetInt(_T("DownloadOpenFolderShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLPreview]		= ini.GetInt(_T("DownloadPreviewShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLRename]			= ini.GetInt(_T("DownloadRenameShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLComments]		= ini.GetInt(_T("DownloadViewFileCommentsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLDetails]		= ini.GetInt(_T("DownloadViewFileDetailsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLDetailsSources]	= ini.GetInt(_T("DownloadViewFileDetailsSourcesShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLClear]			= ini.GetInt(_T("DownloadClearCompletedFilesShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLClearAll]		= ini.GetInt(_T("DownloadClearAllCompletedFilesShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLShowAllUp]		= ini.GetInt(_T("DownloadShowAllUploadsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLUseDefaultSort]	= ini.GetInt(_T("DownloadUseDefaultSortShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLPreallocate]	= ini.GetInt(_T("DownloadPreallocateShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLA4AF]			= ini.GetInt(_T("DownloadA4AFShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLA4AFAuto]		= ini.GetInt(_T("DownloadA4AFAutoShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLA4AFOther]		= ini.GetInt(_T("DownloadA4AFOtherShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLED2KLink]		= ini.GetInt(_T("DownloadED2KLinkShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLED2kLinkHtml]	= ini.GetInt(_T("DownloadED2kLinkHtmlShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLED2kLinkSource]	= ini.GetInt(_T("DownloadED2kLinkSourceShortcut"), VK_RETURN);
	m_anShortcutCode[IndexULDetails]		= ini.GetInt(_T("UploadViewClientDetailsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexULFriend]			= ini.GetInt(_T("UploadAddClientToFriendsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexULMessage]		= ini.GetInt(_T("UploadSendMessageClientShortcut"), VK_RETURN);
	m_anShortcutCode[IndexULFiles]			= ini.GetInt(_T("UploadViewClientFilesShortcut"), VK_RETURN);
	m_anShortcutCode[IndexShOpenFolder]		= ini.GetInt(_T("ShareOpenShortcut"), VK_RETURN);
	m_anShortcutCode[IndexShComments]		= ini.GetInt(_T("ShareEditFileCommentsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexShED2KLink]		= ini.GetInt(_T("ShareED2KLinkShortcut"), VK_RETURN);
	m_anShortcutCode[IndexShED2kLinkHtml]	= ini.GetInt(_T("ShareED2kLinkHtmlShortcut"), VK_RETURN);
	m_anShortcutCode[IndexShED2kLinkSource]	= ini.GetInt(_T("ShareED2kLinkSourceShortcut"), VK_RETURN);
@


1.302
log
@Changed IRC server to irc.redirc.com {Madmax75adsl}.
@
text
@d1375 1
a1375 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"), _T("irc.redirc.com")));
d1380 2
a1381 2
	if ((buffer == _T("irc.liquidirc.com")) || (buffer == _T("217.172.179.168")) || (buffer.Left(13) == _T("irc.freshirc.")))
		m_sIRCServer.Put(_T("irc.redirc.com"));
@


1.301
log
@Added Croatian localization by lhay.
@
text
@d1375 1
a1375 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"), _T("irc.freshirc.com")));
d1380 2
a1381 2
	if ((buffer == _T("irc.liquidirc.com")) || (buffer == _T("217.172.179.168")))
		m_sIRCServer.Put(_T("irc.freshirc.com"));
@


1.300
log
@Try to auto-detect Media Player Classic path if no valid player is set.
@
text
@d2292 1
d2324 1
@


1.299
log
@Some renaming.
@
text
@d1157 1
a1157 1
	// If Video Player path is invalid, try to find VLC path in the registry
d1163 1
a1163 1
		LONG	lResult = RegOpenKeyEx(HKEY_LOCAL_MACHINE, _T("SOFTWARE\\VideoLAN\\VLC"), 0, KEY_QUERY_VALUE, &hKey);
d1167 1
a1167 1
			lResult = RegQueryValueEx(hKey, _T("InstallDir"), NULL, NULL, (LPBYTE) szBuf, &dwBufLen);
d1171 19
a1189 4
				buffer = szBuf;
				buffer += _T("\\vlc.exe");
				m_sVideoPlayer.Put(buffer);
			//	m_iPreviewSmallBlocks = true;	//	not needed, check for VLC is done in CPartFile::PreviewAvailable()
@


1.298
log
@Unified search methods; Check possible values of search method.
@
text
@d1456 3
a1458 3
	m_byteSearchMethod = ini.GetInt(_T("SearchMethod"), EP_SEARCHTYPE_SERV);
	if (m_byteSearchMethod >= EP_SEARCHTYPE_COUNT)
		m_byteSearchMethod = EP_SEARCHTYPE_SERV;
@


1.297
log
@Corrections and optimization for local exception filter.
@
text
@d726 1
a726 1
	ini.SetInt(_T("SearchMethod"), m_nSearchMethod);
d1456 3
a1458 1
	m_nSearchMethod = ini.GetInt(_T("SearchMethod"),0);
@


1.296
log
@happyslinky's changes to search
@
text
@d1900 4
a1903 4
	CFile	pFilterFile;
	FILE* fpFilterFile;
	CString	strFileText;
	CFileException FileException;
d1905 1
a1905 3
	CString strFullPath = m_strConfigDir + "filter.txt";

	//	if filters.txt doesnt exist make a new one and write directions
d1908 5
a1912 4

		CString strTop = _T("# filter search result using listed words\r\n");
		strTop += _T("# min 2 characters\r\n");
		strTop += _T("# empty lines are ok, '#' for comment\r\n");
a1914 1
		{
a1915 8
		}
		else
		{	
			//EMULE_TRY
			pFilterFile.Write((LPCTSTR)strTop, strTop.GetLength());
			pFilterFile.Close();
			//EMULE_CATCH
		}
d1917 2
d1922 1
a1922 1
	// open filter file
d1924 1
a1924 1
	if (fpFilterFile == NULL) {
a1925 3
	}

	CStdioFile FilterFile(fpFilterFile);
d1927 2
a1928 1
	CString strLine; 
d1930 1
a1930 1
	// parse each line
d1935 2
a1936 2
		// ignore '#' comment lines and single letters
		if (_T('#') != strLine[0] && strLine.GetLength() > 1)
d1938 2
a1939 1
			m_strFilterWords = strLine + _T(" ") + m_strFilterWords;
a1941 3

	m_strFilterWords.TrimRight();

@


1.295
log
@Saving of second sorting level for shared files list when default sorting settings're not in use.
@
text
@d107 3
d1894 63
@


1.294
log
@As IDS_MULTIPLE is used in preferences and in message box on first start,
I removed trailing '?' to make preferences look better and
added question mark icon for the first start message box.
@
text
@d1545 2
a1546 1
	if (m_iTableSortItemShared >= SFL_NUMCOLUMNS)
@


1.293
log
@Better way to prepare user name tag;
Faster access to secured preferences strings (improved string processing).
@
text
@d1787 1
a1787 1
		m_bMultiple = (IDYES == ::MessageBox(0, buffer, CLIENT_NAME, MB_YESNO | MB_DEFBUTTON2));	// make "no" the default
@


1.292
log
@Type of statistics values Max. Shared File Size and Max. Shared Average File Size
was changed from 64-bit into 32-bit to speed up processing as max. supported ed2k file size fits 32-bit.
@
text
@a43 2
#define ELEMENT_COUNT(X) (sizeof(X) / sizeof(X[0]))

a67 1
//	m_strWebServerDir = m_strAppDir + _T("WebServer\\");
d125 2
a126 3
//	eklmn: cache 2 tags from hellotype packet to decrease memory fragmetation
	m_pVersionTag = new CClientTag(CT_VERSION, EDONKEYVERSION);
	m_pNameTag = new CClientTag(CT_NAME, m_sNick.Get());
d135 2
a136 2
	safe_delete(m_pVersionTag);
	safe_delete(m_pNameTag);
d555 1
a555 1
	CString		buffer;
d557 1
a557 1
	buffer.Format(_T("%spreferences.ini"), m_strConfigDir);
d559 1
a559 1
	CIni		ini(buffer);
d564 9
a572 9
	ini.SetString(_T("Nick"), m_sNick.Get());
	ini.SetString(_T("IncomingDir"), m_sIncomingDir.Get());
	ini.SetString(_T("TempDir"), m_sTempDir.Get());
	ini.SetString(_T("VideoPlayer"), m_sVideoPlayer.Get());

	FractionalRate2String(&buffer, m_uMaxUpload);
	ini.SetString(_T("MaxUpload"), buffer);
	FractionalRate2String(&buffer, m_uMaxDownload);
	ini.SetString(_T("MaxDownload"), buffer);
d629 3
a631 3
	ini.SetString(_T("ToolbarSettings"), m_sToolbarSettings.Get());
	ini.SetString(_T("ToolbarBitmap"), m_sToolbarBitmap.Get());
	ini.SetString(_T("ToolbarBitmapFolder"), m_sToolbarBitmapFolder.Get());
d669 1
a669 1
	ini.SetString(_T("NotifierSoundPath"), m_sNotifierSoundFilePath.Get());
d672 1
a672 1
	ini.SetString(_T("CommentFilter"), m_sCommentFilter.Get());
d675 2
a676 2
	ini.SetString(_T("IRCServer"), m_sIRCServer.Get());
	ini.SetString(_T("IRCNick"), m_sIRCNick.Get());
d678 1
a678 1
	ini.SetString(_T("IRCFilterName"), m_sIRCChanNameFilter.Get());
d681 1
a681 1
	ini.SetString(_T("IRCPerformString"), m_sIRCPerformString.Get());
d704 1
a704 1
	ini.SetString(_T("CommunityString"), m_sCommunityString.Get());
d717 1
a717 1
	ini.SetString(_T("UsedFont"), m_sUsedFont.Get());
d739 4
a742 4
	FractionalRate2String(&buffer, m_uSCHShift1Upload);
	ini.SetString(_T("SCHShift1Up"), buffer);
	FractionalRate2String(&buffer, m_uSCHShift1Download);
	ini.SetString(_T("SCHShift1Down"), buffer);
d745 4
a748 4
	FractionalRate2String(&buffer, m_uSCHShift2Upload);
	ini.SetString(_T("SCHShift2Up"), buffer);
	FractionalRate2String(&buffer, m_uSCHShift2Download);
	ini.SetString(_T("SCHShift2Down"), buffer);
d815 1
a815 1
		buffer.Format(_T("%I64Lu"),GetStatsColor(i));
d817 1
a817 1
		ini.SetString(buffer2,buffer);
d834 2
a835 2
	ini.SetInt(_T("AcceptMessageFrom"),m_nAcceptMessagesFrom);
	ini.SetString(_T("AwayStateMessage"), CString(m_sAwayStateMessage.Get()));
d845 1
a845 1
	ini.SetString(_T("URLsForICC"), m_sURLsForICC.Get());
d913 1
a913 1
	ini.SetString(_T("FilenameCleanups"), m_sFilenameCleanups.Get());
d917 6
a922 6
	ini.SetString(_T("Server"), m_sSMTPServer.Get());
	ini.SetString(_T("Name"), m_sSMTPName.Get());
	ini.SetString(_T("From"), m_sSMTPFrom.Get());
	ini.SetString(_T("To"), m_sSMTPTo.Get());
	ini.SetString(_T("UserName"), m_sSMTPUserName.Get());
	ini.SetString(_T("Password"), m_sSMTPPassword.Get());
d937 1
a937 1
	ini.SetString(_T("BackupDir"), m_sBackupDir.Get());
d1359 4
a1362 4
	// Change old invalid values to current default
	if ((m_sIRCServer.Get().Trim().MakeLower() == _T("irc.liquidirc.com"))
		|| (m_sIRCServer.Get().Trim() == _T("217.172.179.168")))
	{
a1363 1
	}
d3320 15
@


1.291
log
@Don't try use old "adresses.dat" (because official file has different format);
Correction for revision 1.289, Lancast parameters could be lost or became random.
@
text
@d2359 1
a2359 1
	for (int i = 0; i<SO_LAST; i++)
d2364 28
a2391 28
	cumDownDataPort_4662=0;
	cumDownDataPort_OTHER=0;
	cumConnAvgDownRate=0;
	cumConnMaxAvgDownRate=0;
	cumConnMaxDownRate=0;
	cumConnAvgUpRate=0;
	cumConnRunTime=0;
	cumConnNumReconnects=0;
	cumConnAvgConnections=0;
	cumConnMaxConnLimitReached=0;
	cumConnPeakConnections=0;
	cumConnDownloadTime=0;
	cumConnUploadTime=0;
	cumConnTransferTime=0;
	cumConnServerDuration=0;
	cumConnMaxAvgUpRate=0;
	cumConnMaxUpRate=0;
	cumSrvrsMostWorkingServers=0;
	cumSrvrsMostUsersOnline=0;
	cumSrvrsMostFilesAvail=0;
	cumSharedMostFilesShared=0;
	cumSharedLargestShareSize=0;
	cumSharedLargestAvgFileSize=0;
	cumSharedLargestFileSize=0;
	cumUpData_File=0;
	cumUpData_PartFile=0;
	cumUpData_Community=0;
	cumUpData_NoCommunity=0;
d2564 7
a2570 6
		temp64 = ini.GetUInt64(_T("SharedLargestShareSize"),0);
		if (temp64 > cumSharedLargestShareSize) cumSharedLargestShareSize = temp64;
		temp64 = ini.GetUInt64(_T("SharedLargestAvgFileSize"),0);
		if (temp64 > cumSharedLargestAvgFileSize) cumSharedLargestAvgFileSize = temp64;
		temp64 = ini.GetUInt64(_T("SharedLargestFileSize"),0);
		if (temp64 > cumSharedLargestFileSize) cumSharedLargestFileSize = temp64;
d2572 1
a2572 1
		// Check to make sure the backup of the values we just overwrote exists.  If so, rename it to the backup file.
d2601 1
a2601 1
		cumSharedMostFilesShared = ini.GetInt(_T("SharedMostFilesShared"), 0 );
d2603 3
a2605 3
		cumSharedLargestShareSize = ini.GetUInt64(_T("SharedLargestShareSize"),0);
		cumSharedLargestAvgFileSize = ini.GetUInt64(_T("SharedLargestAvgFileSize"),0);
		cumSharedLargestFileSize =	ini.GetUInt64(_T("SharedLargestFileSize"),0);
d2610 1
a2610 1
		sesDownCompletedFiles =		0;
d2897 6
a2902 3
		uint64 bytesLargestFile = 0;
		uint64 allsize=g_eMuleApp.m_pSharedFilesList->GetDatasize(bytesLargestFile);
		if (allsize>cumSharedLargestShareSize) cumSharedLargestShareSize = allsize;
d2904 3
a2906 2
		if (bytesLargestFile>cumSharedLargestFileSize) cumSharedLargestFileSize = bytesLargestFile;
		ini.SetUInt64(_T("SharedLargestFileSize"), cumSharedLargestFileSize);
d2909 4
a2912 2
			uint64 tempint = allsize/g_eMuleApp.m_pSharedFilesList->GetCount();
			if (tempint>cumSharedLargestAvgFileSize)	cumSharedLargestAvgFileSize = tempint;
d2914 1
a2914 2
		ini.SetUInt64(_T("SharedLargestAvgFileSize"), cumSharedLargestAvgFileSize);

d2959 10
a2968 5
	if (g_eMuleApp.m_pSharedFilesList->GetCount()>cumSharedMostFilesShared) cumSharedMostFilesShared = g_eMuleApp.m_pSharedFilesList->GetCount();
	uint64 bytesLargestFile = 0;
	uint64 allsize=g_eMuleApp.m_pSharedFilesList->GetDatasize(bytesLargestFile);
	if (allsize>cumSharedLargestShareSize) cumSharedLargestShareSize = allsize;
	if (bytesLargestFile>cumSharedLargestFileSize) cumSharedLargestFileSize = bytesLargestFile;
d2971 4
a2974 2
		uint64 tempint = allsize/g_eMuleApp.m_pSharedFilesList->GetCount();
		if (tempint > cumSharedLargestAvgFileSize) cumSharedLargestAvgFileSize = tempint;
@


1.290
log
@AutoDL GUI preferences, to be finished
@
text
@d17 2
a18 2
#include "StdAfx.h"
#include "preferences.h"
d76 3
a78 3
	if ( PathFileExists(m_strAppDir+"adresses.dat")) MoveFile(m_strAppDir+"adresses.dat",m_strConfigDir+"adresses.dat");
//	Fix spelling
	if ( PathFileExists(m_strConfigDir+"adresses.dat")) MoveFile(m_strConfigDir+"adresses.dat",m_strConfigDir+"addresses.dat");
d1674 12
a1685 12
	if(host)
	{
//		Get this clients default ip as a string
		CString defaultIP(inet_ntoa (*(struct in_addr*)*host->h_addr_list));
		ini.SetDefaultCategory(_T("Lancast"));
		m_LancastEnabled = ini.GetBool(_T("Enabled"), false);
		m_UseDefaultIP = ini.GetBool(_T("UseDefaultIP"), true);
		m_DefaultLancastIP = inet_addr(defaultIP);
		m_LancastIP = inet_addr(ini.GetString(_T("IPAddress"),defaultIP));
		m_LancastSubnet = inet_addr(ini.GetString(_T("Subnet"),_T("255.255.0.0")));
		m_LancastPort = ini.GetInt(_T("Port"),5000);
	}
d2040 1
a2040 4
	if (GetLancastUseDefaultIP())
		return m_DefaultLancastIP;
	else
		return m_LancastIP;
@


1.289
log
@Connecting preferences and known/shared files
@
text
@d1791 1
d1793 3
d2289 1
d2291 1
@


1.288
log
@Server LowID users statistics.
@
text
@d27 5
a31 1
#include "emule.h"
d135 1
d137 1
d264 1
d267 1
d282 1
d285 1
d1674 12
a1685 9
//	Get this clients default ip as a string
	CString defaultIP(inet_ntoa (*(struct in_addr*)*host->h_addr_list));
	ini.SetDefaultCategory(_T("Lancast"));
	m_LancastEnabled = ini.GetBool(_T("Enabled"), false);
	m_UseDefaultIP = ini.GetBool(_T("UseDefaultIP"), true);
	m_DefaultLancastIP = inet_addr(defaultIP);
	m_LancastIP = inet_addr(ini.GetString(_T("IPAddress"),defaultIP));
	m_LancastSubnet = inet_addr(ini.GetString(_T("Subnet"),_T("255.255.0.0")));
	m_LancastPort = ini.GetInt(_T("Port"),5000);
d1934 1
d2030 1
d2295 1
d2297 1
d2584 1
d2586 1
d2724 1
d2739 1
d2743 1
d2762 1
d2789 1
d2822 1
d2825 1
d2834 1
d2851 1
d2908 1
d2934 1
d2960 1
d2995 1
d2997 1
d3035 1
d3037 1
@


1.287
log
@Added Belarusian localization by Kryvich.
@
text
@d2841 1
a2841 1
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile;
d2845 2
a2846 1
		g_eMuleApp.m_pServerList->GetStatus( servtotal, servfail, servuser, servfile, servtuser, servtfile, servocc );
d2848 2
a2849 1
		if ((servtotal-servfail)>cumSrvrsMostWorkingServers)	cumSrvrsMostWorkingServers = servtotal-servfail;
d2851 2
a2852 1
		if (servtuser>cumSrvrsMostUsersOnline) cumSrvrsMostUsersOnline = servtuser;
d2854 2
a2855 1
		if (servtfile>cumSrvrsMostFilesAvail) cumSrvrsMostFilesAvail = servtfile;
d2908 10
a2917 5
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile; double servocc;
	g_eMuleApp.m_pServerList->GetStatus( servtotal, servfail, servuser, servfile, servtuser, servtfile, servocc );
	if ((servtotal-servfail)>cumSrvrsMostWorkingServers) cumSrvrsMostWorkingServers = (servtotal-servfail);
	if (servtuser>cumSrvrsMostUsersOnline) cumSrvrsMostUsersOnline = servtuser;
	if (servtfile>cumSrvrsMostFilesAvail) cumSrvrsMostFilesAvail = servtfile;
@


1.286
log
@Removed useless ShowCatTabInfo setting and all related processing.
@
text
@d2205 1
d2237 1
@


1.285
log
@Add sources possibly received from global search (official).
Added missing translations in case countryflag.dll / ip-to-country.cvs is not found.
Notifier informs if a new version is available (not annoying, but still more likely
 to be noticed than just a log line).
Added 'Folder' column to Shared files window.
Prevent adding install/working dirs (\Webserver, \Db...) to Shared files.
+ some other minor changes/fixes.
@
text
@a754 1
	ini.SetBool(_T("ShowInfoOnCatTabs"), m_bShowCatTabInfo);
a1320 1
	m_bShowCatTabInfo = ini.GetBool("ShowInfoOnCatTabs", false);
a1923 1
	m_bShowCatTabInfo = true;
@


1.284
log
@Fixed VLC auto-detection in registry.
@
text
@d2635 1
a2635 1
		returnStr.Format("%s", statsResetLocalized.Format());
a2642 1
// -khaos--+++> A whole bunch of methods!  Keep going until you reach the end tag.
a3020 1
// <-----khaos-
d3034 1
a3034 1
	if(!CompareDirectories(strFullPath, GetTempDir()))			// ".\eMule\temp"
d3049 1
a3049 1
	if (!CompareDirectories(strFullPath, GetAppDir()))			// ".\eMule"
d3051 7
a3057 1
	if (!CompareDirectories(strFullPath, GetConfigDir()))		// ".\eMule\config"
a3058 4
//	if (!CompareDirectories(strFullPath, GetWebServerDir()))	// ".\eMule\WebServer"
//		return true;
//	if (!CompareDirectories(strFullPath, GetLangDir()))			// ".\eMule\lang"
//		return true;
@


1.283
log
@Allow to save double-level sorting state for the server list
when default sorting setting are not in use.
@
text
@d1144 2
a1145 8
//	Get the VLC directory (default appdir\VLC)
	buffer.Format(_T("%sVLC"), m_strAppDir);
	m_sVlcDir.Put(ini.GetString(_T("VLCDir"), buffer));

//	Get the Video Player path (default VLCDir\vlc.exe)
	buffer.Format(_T("%s\\vlc.exe"), GetVlcDir());		//Cax2 - for backward compatibility
	m_sVideoPlayer.Put(ini.GetString(_T("VideoPlayer"), buffer));		//Cax2 - replace buffer with "" in later (non b-compatible) versions

d1159 1
a1159 1
			lResult = RegQueryValueEx(hKey, _T("Install_Dir"), NULL, NULL, (LPBYTE) szBuf, &dwBufLen);
d1166 1
a1166 1
				m_iPreviewSmallBlocks = true;
@


1.282
log
@Search list sorting by Complete Sources.
@
text
@d1551 2
a1552 1
	if (m_iTableSortItemServer >= SL_COLUMN_NUMCOLUMNS)
@


1.281
log
@Open client ports on Windows XP internal firewall (adopted from koizo)
@
text
@d1544 2
a1545 1
	if (m_iTableSortItemSearch >= SL_NUMCOLUMNS)
@


1.280
log
@Save state of the Parts Status list.
@
text
@d571 1
d1212 3
@


1.279
log
@Added protection to correctly check 3DDepth parameter
(there could be memory access outside boundaries);
Removed insignificant conversion of very old version setting.
@
text
@d362 2
d396 3
d422 2
d456 3
d482 2
d516 3
d780 3
d1522 3
@


1.278
log
@Detailed file parts information.
@
text
@d635 1
a635 1
	ini.SetInt (_T("3DDepth"), m_nDepth3D);
d1321 3
a1323 8
	m_nDepth3D = ini.GetInt(_T("3DDepth"), 0);

//	As a temporary converter for previous versions
	if (strPrefsVersion < _T("0.25a")) // before 0.25a
		if (ini.GetBool(_T("FlatStatusBar"), false))
			m_nDepth3D = 0;
		else
			m_nDepth3D = 5;
@


1.277
log
@Fixed Multiple Instances configuration on the fresh start of the second instance {muleteer};
Modified resource strings to removed run-time string preparation.
@
text
@d776 1
d786 1
d822 1
d1538 4
d1551 1
d1593 1
d2035 1
a2035 3
			if ( m_bIsNTBased )
				return 10;
			return 5;
d2074 2
d2103 2
d2141 3
d2179 3
@


1.276
log
@Random TCP and UDP ports for new users.
@
text
@d1750 11
a2230 1
					LANGID langid = LANGIDFROMLCID(::GetThreadLocale());
a2238 9

			strTmp = (nLocalLang == LANG_SPANISH) ? _T("\xbf") : _T("");
			strTmp += GetResString(IDS_MULTIPLE, m_nLanguageID);
			strTmp += _T('?');

			if (IDNO == ::MessageBox(0, strTmp, CLIENT_NAME, MB_YESNO | MB_DEFBUTTON2))	// make "no" the default
				return;
			else
				m_bMultiple = true;
d2248 1
a2248 1
		if ( g_eMuleApp.m_pGlobPrefs->IsNTBased() )
@


1.275
log
@Fixed locale setting for correct preferences reading {DoubleT}.
@
text
@a1051 3
//	CSingleLock PrefLock(&m_Pref_Mutex, true);

//
d1105 2
a1106 1
	CString buffer;
d1168 22
a1189 5
	m_nDeadServer = ini.GetInt(_T("DeadServerAction"),2);
//	Get the TCP port (default 4662)
	m_uPort = ini.GetInt(_T("Port"),4662);
//	Get the UDP port (default 4672)
	m_uUDPPort = ini.GetInt(_T("UDPPort"),m_uPort + 10);
d1619 1
a1619 1
	m_nWebPort = ini.GetInt(_T("Port"), 4711);
d1633 1
a1633 1
	m_uMMPort = ini.GetInt("Port", 80);
@


1.274
log
@New interpretation of limitless download and its configuration;
More robust settings validation.
@
text
@d1102 6
a1185 1
	m_nLanguageID = ini.GetWORD(_T("Language"),0);
a1732 2
	SetLanguage();

@


1.273
log
@Fixed temporary directory list processing (double list entries which could be caused
by case sensitive compares; remove incorrect entries from the list; don't allow
main temp dir to be added to the list);
Minor corrections for category temporary directory processing.
@
text
@d219 2
a220 2
	uint16		nMaxUp = GetMaxUpload();
	uint16		nMaxDown = GetMaxDownloadValue();
d226 7
a232 5
	if (nMaxUp >= 100 && LimitlessDownload())
		return UNLIMITED;

	if (nMaxUp < 40)
		return ((nMaxUp * 3 < nMaxDown) ? nMaxUp * 3 : nMaxDown);
d234 2
a235 1
		return (((nMaxUp < 100) && (nMaxUp * 4 < nMaxDown)) ? nMaxUp * 4 : nMaxDown);
d1151 4
a1154 4
//	Get the Upload Capacity (default 16)
	m_dwMaxGraphUploadRate = 10 * ini.GetInt(_T("UploadCapacity"), 16);
//	Get the Download Capacity (default 96)
	m_dwMaxGraphDownloadRate = 10 * ini.GetInt(_T("DownloadCapacity"), 96);
@


1.272
log
@Proper function to add and check TempDirs
@
text
@d286 1
a286 1
		CSingleLock		sLock(&m_csSharedDirList, true);
d306 2
d313 1
d1007 6
a1018 3

			//	Add Temp Directory before checking if already exists in list
				TempDirListCheckAndAdd(pCat->m_strTempPath, true);
d1824 1
a1824 1
//	LoadSharedDirs() loads the shared file paths from "config/shareddir.dat" into 'm_sharedDirList'.
d1837 1
a1837 1
			if ((dwFileAttributes != -1) && (dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY))
d1846 1
a1846 1
//	LoadTempDirs() loads the supplemental temp directory paths from "config/tempdir.dat" into 'm_tempDirList'.
d1858 1
a1858 5
			if(m_tempDirList.Find(strTmp) == NULL)
			{
				m_tempDirList.AddHead(strTmp);
				CreateAllDirectories(&strTmp);
			}
d1946 6
a1960 3

	//	Create all required directories
		CreateAllDirectories(&newcat->m_strSavePath);
d3024 1
a3024 1
	m_csSharedDirList.Lock();
d3031 1
a3031 1
			m_csSharedDirList.Unlock();
d3040 1
a3040 1
	m_csSharedDirList.Unlock();
d3044 57
a3100 1
//	TempDirListCheckAndAdd() checks existence of a directory in the list.
d3103 1
a3103 1
//			bAdd      - add or not a directory to the list if it wasn't found in it.
d3105 4
a3108 2
//			TRUE if a directory wasn't found in the list, else FALSE.
bool CPreferences::TempDirListCheckAndAdd(const CString &strNewDir, bool bAdd)
d3112 2
a3113 2
//	All list entries shouldn't have trailing '\'
	if (strDir.GetLength() == 3)
d3115 1
a3115 1
		strDir.Replace(_T("\\"), _T("")); 
d3118 2
a3119 2
//	Such directory is the same as default one
	if (strDir.CompareNoCase(GetTempDir()) == 0)
d3121 1
a3121 1
		return false;
d3124 2
d3131 2
a3132 1
			return false;
d3135 3
d3140 10
a3149 1
		m_tempDirList.AddTail(strDir);
d3152 2
a3153 1
	return true;
d3156 1
a3156 1
//	SharedDirListRefill() fills the list with new values.
d3159 1
a3159 1
void CPreferences::SharedDirListRefill(CStringList *pNewList)
d3161 1
a3161 1
	m_csSharedDirList.Lock();
d3163 2
a3164 2
	m_sharedDirList.RemoveAll();
	m_sharedDirList.AddTail(pNewList);
d3166 1
a3166 1
	m_csSharedDirList.Unlock();
d3169 1
a3169 1
//	SharedDirListCopy() makes a copy of the current list.
d3172 1
a3172 1
void CPreferences::SharedDirListCopy(CStringList *pOutputList)
d3174 1
a3174 1
	m_csSharedDirList.Lock();
d3176 1
a3176 1
	pOutputList->AddTail(&m_sharedDirList);
d3178 1
a3178 1
	m_csSharedDirList.Unlock();
d3181 1
a3181 1
//	SharedDirListCmp() compare two lists.
d3186 1
a3186 1
bool CPreferences::SharedDirListCmp(CStringList *pNewList)
d3190 1
a3190 1
	m_csSharedDirList.Lock();
d3192 1
a3192 1
	if (pNewList->GetCount() == m_sharedDirList.GetCount())
d3198 1
a3198 1
		for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != NULL; )
d3200 1
a3200 1
			if (m_sharedDirList.GetNext(pos).CompareNoCase(pNewList->GetNext(pos1)) != 0)
d3208 1
a3208 1
	m_csSharedDirList.Unlock();
@


1.271
log
@Changed default WebServer template eMule.tmpl -> eMuleXP.tmpl;
Removed unused variable.
@
text
@a1009 2
				
				CString strTempCat = pCat->m_strTempPath;
d1011 2
a1012 23
				if (strTempCat.GetLength() == 3)
				{
					strTempCat.Replace(_T("\\"), _T("")); 
				}

				if (strTempCat != GetTempDir())
				{
					if (m_tempDirList.GetHeadPosition() == NULL)
					{
						m_tempDirList.AddTail(strTempCat);
					}
					else
					{
						for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != NULL;)
						{
							if(m_tempDirList.GetNext(pos).GetBuffer() != strTempCat)
							{
								m_tempDirList.AddTail(strTempCat);
								break;
							}
						}
					}
				}
d3039 38
@


1.270
log
@More fixes for temp_dir_cat
@
text
@d1621 1
a1621 1
	m_strTemplateFile = ini.GetString(_T("WebTemplateFile"), _T("eMule.tmpl"));
a1951 1
		CString strFixedTempPath;
@


1.269
log
@Fractional upload/download limits (min 1 KB/s, granularity 0.1 KB/s);
Corrected speed configuration (possible speed limits weren't check in many places).
@
text
@d1010 2
d1013 6
a1018 1
				if (pCat->m_strTempPath != GetTempDir())
d1022 1
a1022 1
						m_tempDirList.AddTail(pCat->m_strTempPath);
d1028 1
a1028 1
							if(m_tempDirList.GetNext(pos).GetBuffer() != pCat->m_strTempPath)
d1030 1
a1030 1
								m_tempDirList.AddTail(pCat->m_strTempPath);
d1952 1
d1955 1
d1964 1
d1975 1
d1977 1
@


1.268
log
@First fix for Custom Temp for Cats... :-(
@
text
@d191 24
d226 1
a226 1
	if (nMaxUp >= 10 && LimitlessDownload()) // DonGato
d229 1
a229 1
	if (nMaxUp < 4)
d232 1
a232 1
		return (((nMaxUp < 10) && (nMaxUp * 4 < nMaxDown)) ? nMaxUp * 4 : nMaxDown);
d542 4
a545 2
	ini.SetInt(_T("MaxUpload"), m_nMaxUpload);
	ini.SetInt(_T("MaxDownload"), m_nMaxDownload);
d565 2
a566 2
	ini.SetInt(_T("DownloadCapacity"), m_nMaxGraphDownloadRate);
	ini.SetInt(_T("UploadCapacity"), m_nMaxGraphUploadRate);
d711 4
a714 2
	ini.SetInt(_T("SCHShift1Up"),m_nSCHShift1Upload);
	ini.SetInt(_T("SCHShift1Down"),m_nSCHShift1Download);
d717 4
a720 2
	ini.SetInt(_T("SCHShift2Up"),m_nSCHShift2Upload);
	ini.SetInt(_T("SCHShift2Down"),m_nSCHShift2Download);
d1159 1
a1159 1
	m_nMaxGraphUploadRate = ini.GetInt(_T("UploadCapacity"),16);
d1161 7
a1167 9
	m_nMaxGraphDownloadRate = ini.GetInt(_T("DownloadCapacity"),96);
//	Get the Upload Limit (default UNLIMITED - pinned to Upload Capacity)
	m_nMaxUpload = ini.GetInt(_T("MaxUpload"),UNLIMITED);		//Cax2 new limits enforced on old settings
	if (m_nMaxUpload>m_nMaxGraphUploadRate)
		m_nMaxUpload = m_nMaxGraphUploadRate;
//	Get the Download limit (default UNLIMITED - pinned to Download Capacity)
	m_nMaxDownload = ini.GetInt(_T("MaxDownload"),UNLIMITED);
	if (m_nMaxDownload>m_nMaxGraphDownloadRate)
		m_nMaxDownload = m_nMaxGraphDownloadRate;
d1440 10
a1449 2
	m_nSCHShift1Upload = ini.GetInt(_T("SCHShift1Up"),UNLIMITED);
	m_nSCHShift1Download = ini.GetInt(_T("SCHShift1Down"),UNLIMITED);
d1452 11
a1462 2
	m_nSCHShift2Upload = ini.GetInt(_T("SCHShift2Up"),UNLIMITED);
	m_nSCHShift2Download = ini.GetInt(_T("SCHShift2Down"),UNLIMITED);
@


1.267
log
@Customizable temporary directory for categories
@
text
@d1910 1
a1910 1
		_tcscpy(strTempPath, catini.GetString(_T("Temp"), _T("")));
@


1.266
log
@Fixed loading of incorrect sorting settings {DonGato}.
@
text
@d974 1
d980 19
d1847 1
d1878 1
d1899 1
d1910 3
@


1.265
log
@One more storage reorganization.
@
text
@d1311 30
a1340 10
	m_nServerSortCol = ini.GetInt(_T("SortServersCode"),0);
	m_nUploadSortCol = ini.GetInt(_T("SortUploadsCode"),12);
	m_nQueueSortCol = ini.GetInt(_T("SortQueueCode"),105);
	m_nSearchSortCol = ini.GetInt(_T("SortSearchCode"),12);
	m_nIRCSortCol = ini.GetInt(_T("SortIrcCode"),11);
	m_nFileSortCol = ini.GetInt(_T("SortFilesCode"),0);
	m_nDownloadSortCol = ini.GetInt(_T("SortDownloadsCode"),8);
	m_nClientListSortCol = ini.GetInt(_T("SortClientListCode"),0);
	m_nSrcSortCol1 = ini.GetInt(_T("1stSortSourcesCode"),0);
	m_nSrcSortCol2 = ini.GetInt(_T("2ndSortSourcesCode"),DL_DEFAULTSOURCESORT);
d1430 27
a1456 9
	m_iTableSortItemDownload = ini.GetInt(_T("TableSortItemDownload"), 0);
	m_iTableSortItemDownload2 = ini.GetInt(_T("TableSortItemDownload2"), 0);
	m_iTableSortItemUpload = ini.GetInt(_T("TableSortItemUpload"), 0);
	m_iTableSortItemQueue = ini.GetInt(_T("TableSortItemQueue"), 0);
	m_iTableSortItemSearch = ini.GetInt(_T("TableSortItemSearch"), 0);
	m_iTableSortItemShared = ini.GetInt(_T("TableSortItemShared"), 0);
	m_iTableSortItemServer = ini.GetInt(_T("TableSortItemServer"), 0);
	m_iTableSortItemIRCChannel = ini.GetInt(_T("TableSortItemIRCChannel"), 0);
	m_iTableSortItemClientList = ini.GetInt(_T("TableSortItemClientList"), 0);
@


1.264
log
@Preferences storage reorganization and minor optimization.
@
text
@d51 2
a52 5
//
//	Create the legacy preferences structs
//
	m_prefsExt = new Preferences_Ext_Struct;
	memzero(m_prefsExt, sizeof(Preferences_Ext_Struct));
a132 2
	delete m_prefsExt;

d221 1
a221 1
	m_prefsExt->version = PREFFILE_VERSION;
d225 3
a227 3
		m_prefsExt->version = PREFFILE_VERSION;
		m_prefsExt->EmuleWindowPlacement = m_WindowPlacement;
		md4cpy(m_prefsExt->m_userHash, m_userHash);
d229 1
a229 1
		bError = fwrite(m_prefsExt,sizeof(Preferences_Ext_Struct),1,pPrefFile);
d1665 1
a1665 1
	fread(m_prefsExt,sizeof(Preferences_Ext_Struct),1,pPrefsFile);
d1671 1
a1671 1
	if (m_prefsExt->version < 20)
d1673 1
a1673 1
		if (m_prefsExt->version > 17)
d1675 1
a1675 4
			prefsImport20b=new Preferences_Import20b_Struct;
			memzero(prefsImport20b, sizeof(Preferences_Import20b_Struct));
			fseek(pPrefsFile,0,0);
			fread(prefsImport20b,sizeof(Preferences_Import20b_Struct),1,pPrefsFile);
d1677 3
a1679 4
			md4cpy(m_userHash, prefsImport20b->m_userHash);
			m_sIncomingDir.Put(prefsImport20b->incomingdir);
			m_sTempDir.Put(prefsImport20b->tempdir);
			m_sNick.Put(prefsImport20b->nick);
d1681 4
a1684 2
			m_nTotalDownloadedBytes.Put(prefsImport20b->totalDownloadedBytes);
			m_nTotalUploadedBytes.Put(prefsImport20b->totalUploadedBytes);
d1686 2
d1689 1
a1689 1
		else if (m_prefsExt->version > 7)
d1691 3
a1693 2
			prefsImport20a = new Preferences_Import20a_Struct;
			memzero(prefsImport20a, sizeof(Preferences_Import20a_Struct));
d1695 1
a1695 6
			fread(prefsImport20a, sizeof(Preferences_Import20a_Struct), 1, pPrefsFile);

			md4cpy(m_userHash, prefsImport20a->m_userHash);
			m_sIncomingDir.Put(prefsImport20a->incomingdir);
			m_sTempDir.Put(prefsImport20a->tempdir);
			m_sNick.Put(prefsImport20a->nick);
d1697 4
a1700 2
			m_nTotalDownloadedBytes.Put(prefsImport20a->totalDownloaded);
			m_nTotalUploadedBytes.Put(prefsImport20a->totalUploaded);
d1702 2
d1707 1
a1707 2
			prefsImport19c = new Preferences_Import19c_Struct;
			memzero(prefsImport19c, sizeof(Preferences_Import19c_Struct));
d1709 1
d1711 1
a1711 1
			fread(prefsImport19c, sizeof(Preferences_Import19c_Struct), 1, pPrefsFile);
d1713 1
a1713 1
			if (m_prefsExt->version<3)
d1716 4
a1719 4
				md4cpy(m_userHash, prefsImport19c->m_userHash);
			m_sIncomingDir.Put(prefsImport19c->incomingdir);
			m_sTempDir.Put(prefsImport19c->tempdir);
			m_sNick.Put(prefsImport19c->nick);
d1724 2
a1725 2
		md4cpy(m_userHash, m_prefsExt->m_userHash);
		m_WindowPlacement = m_prefsExt->EmuleWindowPlacement;
@


1.263
log
@Optional filtering of small fake RX packets.
@
text
@d54 1
a54 2
	m_prefs = new Preferences_Struct_DONTUSE;
	m_prefsExt=new Preferences_Ext_Struct;
d101 1
a101 1
//	Generate a random user hash in 'm_userHash', mark it as eMule, and copy it to 'm_prefs->m_userHash'.
a102 1
	md4cpy(&m_prefs->m_userHash,&m_userHash);
d109 1
a109 1
//	Mark as emule client. that will be need in later version
a135 1
	delete m_prefs;
d179 1
a179 1
            CreateUserHash();
a181 1
	md4cpy(&m_prefs->m_userHash,&m_userHash);
d186 6
a191 6
	defaultWPM.rcNormalPosition.left=10;
	defaultWPM.rcNormalPosition.top=10;
	defaultWPM.rcNormalPosition.right=700;
	defaultWPM.rcNormalPosition.bottom=500;
	defaultWPM.showCmd=0;
	m_prefs->EmuleWindowPlacement=defaultWPM;
d231 2
a232 2
		m_prefsExt->EmuleWindowPlacement = m_prefs->EmuleWindowPlacement;
		md4cpy(&m_prefsExt->m_userHash,&m_prefs->m_userHash);
d250 1
a250 1
		bError = fwrite(m_prefs->m_userHash, sizeof(m_prefs->m_userHash), 1, pHashFile) ;
d312 1
a312 1
//	Mark as emule client. that will be needed in later version
d322 1
a322 1
			return m_prefs->downloadColumnWidths[index];
d324 1
a324 1
			return m_prefs->uploadColumnWidths[index];
d326 1
a326 1
			return m_prefs->queueColumnWidths[index];
d328 1
a328 1
			return m_prefs->searchColumnWidths[index];
d330 1
a330 1
			return m_prefs->sharedColumnWidths[index];
d332 1
a332 1
			return m_prefs->serverColumnWidths[index];
d334 1
a334 1
			return m_prefs->ircColumnWidths[index];
d336 1
a336 1
			return m_prefs->clientListColumnWidths[index];
d346 1
a346 1
			m_prefs->downloadColumnWidths[index] = width;
d349 1
a349 1
			m_prefs->uploadColumnWidths[index] = width;
d352 1
a352 1
			m_prefs->queueColumnWidths[index] = width;
d355 1
a355 1
			m_prefs->searchColumnWidths[index] = width;
d358 1
a358 1
			m_prefs->sharedColumnWidths[index] = width;
d361 1
a361 1
			m_prefs->serverColumnWidths[index] = width;
d364 1
a364 1
			m_prefs->ircColumnWidths[index] = width;
d367 1
a367 1
			m_prefs->clientListColumnWidths[index] = width;
d377 1
a377 1
			return m_prefs->downloadColumnHidden[index];
d379 1
a379 1
			return m_prefs->uploadColumnHidden[index];
d381 1
a381 1
			return m_prefs->queueColumnHidden[index];
d383 1
a383 1
			return m_prefs->searchColumnHidden[index];
d385 1
a385 1
			return m_prefs->sharedColumnHidden[index];
d387 1
a387 1
			return m_prefs->serverColumnHidden[index];
d389 1
a389 1
			return m_prefs->ircColumnHidden[index];
d391 1
a391 1
			return m_prefs->clientListColumnHidden[index];
d396 1
a396 1
void CPreferences::SetColumnHidden(EnumTable t, int index, BOOL bHidden)
d401 1
a401 1
			m_prefs->downloadColumnHidden[index] = bHidden;
d404 1
a404 1
			m_prefs->uploadColumnHidden[index] = bHidden;
d407 1
a407 1
			m_prefs->queueColumnHidden[index] = bHidden;
d410 1
a410 1
			m_prefs->searchColumnHidden[index] = bHidden;
d413 1
a413 1
			m_prefs->sharedColumnHidden[index] = bHidden;
d416 1
a416 1
			m_prefs->serverColumnHidden[index] = bHidden;
d419 1
a419 1
			m_prefs->ircColumnHidden[index] = bHidden;
d422 1
a422 1
			m_prefs->clientListColumnHidden[index] = bHidden;
d432 1
a432 1
			return m_prefs->downloadColumnOrder[index];
d434 1
a434 1
			return m_prefs->uploadColumnOrder[index];
d436 1
a436 1
			return m_prefs->queueColumnOrder[index];
d438 1
a438 1
			return m_prefs->searchColumnOrder[index];
d440 1
a440 1
			return m_prefs->sharedColumnOrder[index];
d442 1
a442 1
			return m_prefs->serverColumnOrder[index];
d444 1
a444 1
			return m_prefs->ircColumnOrder[index];
d446 1
a446 1
			return m_prefs->clientListColumnOrder[index];
d451 1
a451 1
void CPreferences::SetColumnOrder(EnumTable t, INT *piOrder)
d456 1
a456 1
			memcpy2(m_prefs->downloadColumnOrder, piOrder, sizeof(m_prefs->downloadColumnOrder));
d459 1
a459 1
			memcpy2(m_prefs->uploadColumnOrder, piOrder, sizeof(m_prefs->uploadColumnOrder));
d462 1
a462 1
			memcpy2(m_prefs->queueColumnOrder, piOrder, sizeof(m_prefs->queueColumnOrder));
d465 1
a465 1
			memcpy2(m_prefs->searchColumnOrder, piOrder, sizeof(m_prefs->searchColumnOrder));
d468 1
a468 1
			memcpy2(m_prefs->sharedColumnOrder, piOrder, sizeof(m_prefs->sharedColumnOrder));
d471 1
a471 1
			memcpy2(m_prefs->serverColumnOrder, piOrder, sizeof(m_prefs->serverColumnOrder));
d474 1
a474 1
			memcpy2(m_prefs->ircColumnOrder, piOrder, sizeof(m_prefs->ircColumnOrder));
d477 1
a477 1
			memcpy2(m_prefs->clientListColumnOrder, piOrder, sizeof(m_prefs->clientListColumnOrder));
a509 1
	CString		fullpath;
d511 1
a511 1
	fullpath.Format(_T("%spreferences.ini"),m_strConfigDir);
d513 1
a513 1
	CIni		ini( fullpath );
d605 1
a605 1
	ini.SetBool(_T("ShowRatesOnTitle"),m_prefs->showRatesInTitle);
d622 1
a622 1
	ini.SetString(_T("MessageFilter"),m_prefs->messageFilter);
d624 1
a624 1
	ini.SetString(_T("TxtEditor"),m_prefs->TxtEditor);
d665 1
a665 1
	ini.SetBool(_T("BugReport"), m_prefs->BugReport);
d710 44
a753 44
	ini.SetArray(m_prefs->downloadColumnWidths, ELEMENT_COUNT(m_prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SetArray(m_prefs->downloadColumnHidden, ELEMENT_COUNT(m_prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SetArray(m_prefs->downloadColumnOrder, ELEMENT_COUNT(m_prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SetArray(m_prefs->uploadColumnWidths, ELEMENT_COUNT(m_prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.SetArray(m_prefs->uploadColumnHidden, ELEMENT_COUNT(m_prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.SetArray(m_prefs->uploadColumnOrder, ELEMENT_COUNT(m_prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.SetArray(m_prefs->queueColumnWidths, ELEMENT_COUNT(m_prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.SetArray(m_prefs->queueColumnHidden, ELEMENT_COUNT(m_prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.SetArray(m_prefs->queueColumnOrder, ELEMENT_COUNT(m_prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.SetArray(m_prefs->searchColumnWidths, ELEMENT_COUNT(m_prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.SetArray(m_prefs->searchColumnHidden, ELEMENT_COUNT(m_prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.SetArray(m_prefs->searchColumnOrder, ELEMENT_COUNT(m_prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.SetArray(m_prefs->sharedColumnWidths, ELEMENT_COUNT(m_prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.SetArray(m_prefs->sharedColumnHidden, ELEMENT_COUNT(m_prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.SetArray(m_prefs->sharedColumnOrder, ELEMENT_COUNT(m_prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.SetArray(m_prefs->serverColumnWidths, ELEMENT_COUNT(m_prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.SetArray(m_prefs->serverColumnHidden, ELEMENT_COUNT(m_prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.SetArray(m_prefs->serverColumnOrder, ELEMENT_COUNT(m_prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.SetArray(m_prefs->ircColumnWidths, ELEMENT_COUNT(m_prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.SetArray(m_prefs->ircColumnHidden, ELEMENT_COUNT(m_prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.SetArray(m_prefs->ircColumnOrder, ELEMENT_COUNT(m_prefs->ircColumnOrder), _T("IrcColumnOrder"));
	ini.SetArray(m_prefs->clientListColumnWidths, ELEMENT_COUNT(m_prefs->clientListColumnWidths), _T("ClientListColumnWidths"));
	ini.SetArray(m_prefs->clientListColumnHidden, ELEMENT_COUNT(m_prefs->clientListColumnHidden), _T("ClientListColumnHidden"));
	ini.SetArray(m_prefs->clientListColumnOrder, ELEMENT_COUNT(m_prefs->clientListColumnOrder), _T("ClientListColumnOrder"));

//	Barry - Provide a mechanism for all tables to store/retrieve sort order
	ini.SetInt(_T("TableSortItemDownload"), m_prefs->tableSortItemDownload);
	ini.SetInt(_T("TableSortItemDownload2"), m_prefs->tableSortItemDownload2);
	ini.SetInt(_T("TableSortItemUpload"), m_prefs->tableSortItemUpload);
	ini.SetInt(_T("TableSortItemQueue"), m_prefs->tableSortItemQueue);
	ini.SetInt(_T("TableSortItemSearch"), m_prefs->tableSortItemSearch);
	ini.SetInt(_T("TableSortItemShared"), m_prefs->tableSortItemShared);
	ini.SetInt(_T("TableSortItemServer"), m_prefs->tableSortItemServer);
	ini.SetInt(_T("TableSortItemIRCChannel"), m_prefs->tableSortItemIRCChannel);
	ini.SetInt(_T("TableSortItemClientList"), m_prefs->tableSortItemClientList);
	ini.SetBool(_T("TableSortAscendingDownload"), m_prefs->tableSortAscendingDownload);
	ini.SetBool(_T("TableSortAscendingDownload2"), m_prefs->tableSortAscendingDownload2);
	ini.SetBool(_T("TableSortAscendingUpload"), m_prefs->tableSortAscendingUpload);
	ini.SetBool(_T("TableSortAscendingQueue"), m_prefs->tableSortAscendingQueue);
	ini.SetBool(_T("TableSortAscendingSearch"), m_prefs->tableSortAscendingSearch);
	ini.SetBool(_T("TableSortAscendingShared"), m_prefs->tableSortAscendingShared);
	ini.SetBool(_T("TableSortAscendingServer"), m_prefs->tableSortAscendingServer);
	ini.SetBool(_T("TableSortAscendingIRCChannel"), m_prefs->tableSortAscendingIRCChannel);
	ini.SetBool(_T("TableSortAscendingClientList"), m_prefs->tableSortAscendingClientList);
d774 1
a774 1
	ini.SetString(_T("A4AFAutoFileHash"), HashToString(m_prefs->A4AF_file_hash));
d808 8
a815 8
	ini.SetBool(_T("EnablePassword"),m_prefs->proxy.m_bEnablePassword);
	ini.SetBool(_T("EnableProxy"),m_prefs->proxy.m_bUseProxy);
	ini.SetString(_T("Name"),m_prefs->proxy.m_strName);
	ini.SetString(_T("Password"),m_prefs->proxy.m_strPassword);
	ini.SetString(_T("User"),m_prefs->proxy.m_strUser);
	ini.SetInt(_T("Port"),m_prefs->proxy.m_uPort);
	ini.SetInt(_T("Type"),m_prefs->proxy.m_nType);
	ini.SetBool(_T("ConnectWithoutProxy"),m_bIsASCWOP);
d832 1
a832 1
	ini.SetString(_T("WebTemplateFile"),m_prefs->m_sTemplateFile);
d1159 1
a1159 1
	m_prefs->showRatesInTitle=ini.GetBool(_T("ShowRatesOnTitle"), false);
d1161 1
a1161 1
	int nMax = (IsNTBased())? 200:100;
d1308 2
a1309 2
	m_prefs->TxtEditor = ini.GetString(_T("TxtEditor"),_T("notepad.exe"));
	m_prefs->messageFilter=ini.GetString(_T("MessageFilter"),_T("Defcon|Your client has an infinite queue|http://www.chez.com/theworld/"));
d1348 1
a1348 1
	m_prefs->BugReport = ini.GetBool(_T("BugReport"), false);
d1350 1
a1350 1
	m_nXSUpTo = ini.GetInt(_T("XSUpTo"),GetMaxSourcePerFileSoft());
d1389 24
a1412 24
	ini.GetArray(m_prefs->downloadColumnWidths, ELEMENT_COUNT(m_prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.GetArray(m_prefs->downloadColumnHidden, ELEMENT_COUNT(m_prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.GetArray(m_prefs->downloadColumnOrder, ELEMENT_COUNT(m_prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.GetArray(m_prefs->uploadColumnWidths, ELEMENT_COUNT(m_prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.GetArray(m_prefs->uploadColumnHidden, ELEMENT_COUNT(m_prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.GetArray(m_prefs->uploadColumnOrder, ELEMENT_COUNT(m_prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.GetArray(m_prefs->queueColumnWidths, ELEMENT_COUNT(m_prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.GetArray(m_prefs->queueColumnHidden, ELEMENT_COUNT(m_prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.GetArray(m_prefs->queueColumnOrder, ELEMENT_COUNT(m_prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.GetArray(m_prefs->searchColumnWidths, ELEMENT_COUNT(m_prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.GetArray(m_prefs->searchColumnHidden, ELEMENT_COUNT(m_prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.GetArray(m_prefs->searchColumnOrder, ELEMENT_COUNT(m_prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.GetArray(m_prefs->sharedColumnWidths, ELEMENT_COUNT(m_prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.GetArray(m_prefs->sharedColumnHidden, ELEMENT_COUNT(m_prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.GetArray(m_prefs->sharedColumnOrder, ELEMENT_COUNT(m_prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.GetArray(m_prefs->serverColumnWidths, ELEMENT_COUNT(m_prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.GetArray(m_prefs->serverColumnHidden, ELEMENT_COUNT(m_prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.GetArray(m_prefs->serverColumnOrder, ELEMENT_COUNT(m_prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.GetArray(m_prefs->ircColumnWidths, ELEMENT_COUNT(m_prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.GetArray(m_prefs->ircColumnHidden, ELEMENT_COUNT(m_prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.GetArray(m_prefs->ircColumnOrder, ELEMENT_COUNT(m_prefs->ircColumnOrder), _T("IrcColumnOrder"));
	ini.GetArray(m_prefs->clientListColumnWidths, ELEMENT_COUNT(m_prefs->clientListColumnWidths), _T("ClientListColumnWidths"));
	ini.GetArray(m_prefs->clientListColumnHidden, ELEMENT_COUNT(m_prefs->clientListColumnHidden), _T("ClientListColumnHidden"));
	ini.GetArray(m_prefs->clientListColumnOrder, ELEMENT_COUNT(m_prefs->clientListColumnOrder), _T("ClientListColumnOrder"));
d1415 18
a1432 18
	m_prefs->tableSortItemDownload = ini.GetInt(_T("TableSortItemDownload"), 0);
	m_prefs->tableSortItemDownload2 = ini.GetInt(_T("TableSortItemDownload2"), 0);
	m_prefs->tableSortItemUpload = ini.GetInt(_T("TableSortItemUpload"), 0);
	m_prefs->tableSortItemQueue = ini.GetInt(_T("TableSortItemQueue"), 0);
	m_prefs->tableSortItemSearch = ini.GetInt(_T("TableSortItemSearch"), 0);
	m_prefs->tableSortItemShared = ini.GetInt(_T("TableSortItemShared"), 0);
	m_prefs->tableSortItemServer = ini.GetInt(_T("TableSortItemServer"), 0);
	m_prefs->tableSortItemIRCChannel = ini.GetInt(_T("TableSortItemIRCChannel"), 0);
	m_prefs->tableSortItemClientList = ini.GetInt(_T("TableSortItemClientList"), 0);
	m_prefs->tableSortAscendingDownload = ini.GetBool(_T("TableSortAscendingDownload"), true);
	m_prefs->tableSortAscendingDownload2 = ini.GetBool(_T("TableSortAscendingDownload2"), true);
	m_prefs->tableSortAscendingUpload = ini.GetBool(_T("TableSortAscendingUpload"), true);
	m_prefs->tableSortAscendingQueue = ini.GetBool(_T("TableSortAscendingQueue"), true);
	m_prefs->tableSortAscendingSearch = ini.GetBool(_T("TableSortAscendingSearch"), true);
	m_prefs->tableSortAscendingShared = ini.GetBool(_T("TableSortAscendingShared"), true);
	m_prefs->tableSortAscendingServer = ini.GetBool(_T("TableSortAscendingServer"), true);
	m_prefs->tableSortAscendingIRCChannel = ini.GetBool(_T("TableSortAscendingIRCChannel"), true);
	m_prefs->tableSortAscendingClientList = ini.GetBool(_T("TableSortAscendingClientList"), true);
d1459 1
a1459 1
	StringToHash(ini.GetString(_T("A4AFAutoFileHash"), _T("")), m_prefs->A4AF_file_hash);
d1486 4
a1489 4
	m_bAVEnabled				= ini.GetBool("AVEnabled",false);
	m_strAVPath					= ini.GetString("AVPath",_T(""));
	m_strAVParams				= ini.GetString("AVParams",_T(""));
	m_bAVScanCompleted			= ini.GetBool("AVScanCompleted",false);
d1493 7
a1499 7
	m_prefs->proxy.m_bEnablePassword = ini.GetBool(_T("EnablePassword"), false);
	m_prefs->proxy.m_bUseProxy = ini.GetBool(_T("EnableProxy"), false);
	m_prefs->proxy.m_strName = ini.GetString(_T("Name"), "");
	m_prefs->proxy.m_strPassword = ini.GetString(_T("Password"), "");
	m_prefs->proxy.m_strUser = ini.GetString(_T("User"), "");
	m_prefs->proxy.m_uPort = ini.GetInt(_T("Port"),1080);
	m_prefs->proxy.m_nType = ini.GetInt(_T("Type"),PROXYTYPE_NOPROXY);
d1516 1
a1516 1
	sprintf(m_prefs->m_sTemplateFile,"%s",ini.GetString(_T("WebTemplateFile"),_T("eMule.tmpl")));
d1685 1
a1685 1
			md4cpy(&m_prefs->m_userHash,&prefsImport20b->m_userHash);
d1701 1
a1701 1
			md4cpy(&m_prefs->m_userHash,&prefsImport20a->m_userHash);
a1718 1
			{
a1719 2
				md4cpy(&m_prefs->m_userHash,&m_userHash);
			}
d1721 1
a1721 1
				md4cpy(&m_prefs->m_userHash,&prefsImport19c->m_userHash);
d1729 2
a1730 2
		md4cpy(&m_prefs->m_userHash,&m_prefsExt->m_userHash);
		m_prefs->EmuleWindowPlacement = m_prefsExt->EmuleWindowPlacement;
a1732 1
	md4cpy(&m_userHash,&m_prefs->m_userHash);
d1921 1
a1921 1
			return m_prefs->tableSortItemDownload;
d1923 1
a1923 1
			return m_prefs->tableSortItemDownload2;
d1925 1
a1925 1
			return m_prefs->tableSortItemUpload;
d1927 1
a1927 1
			return m_prefs->tableSortItemQueue;
d1929 1
a1929 1
			return m_prefs->tableSortItemSearch;
d1931 1
a1931 1
			return m_prefs->tableSortItemShared;
d1933 1
a1933 1
			return m_prefs->tableSortItemServer;
d1935 1
a1935 1
			return m_prefs->tableSortItemIRCChannel;
d1937 1
a1937 1
			return m_prefs->tableSortItemClientList;
d1948 1
a1948 1
			return m_prefs->tableSortAscendingDownload;
d1950 1
a1950 1
			return m_prefs->tableSortAscendingDownload2;
d1952 1
a1952 1
			return m_prefs->tableSortAscendingUpload;
d1954 1
a1954 1
			return m_prefs->tableSortAscendingQueue;
d1956 1
a1956 1
			return m_prefs->tableSortAscendingSearch;
d1958 1
a1958 1
			return m_prefs->tableSortAscendingShared;
d1960 1
a1960 1
			return m_prefs->tableSortAscendingServer;
d1962 1
a1962 1
			return m_prefs->tableSortAscendingIRCChannel;
d1964 1
a1964 1
			return m_prefs->tableSortAscendingClientList;
d1975 1
a1975 1
			m_prefs->tableSortItemDownload = sortItem;
d1978 1
a1978 1
			m_prefs->tableSortItemDownload2 = sortItem;
d1981 1
a1981 1
			m_prefs->tableSortItemUpload = sortItem;
d1984 1
a1984 1
			m_prefs->tableSortItemQueue = sortItem;
d1987 1
a1987 1
			m_prefs->tableSortItemSearch = sortItem;
d1990 1
a1990 1
			m_prefs->tableSortItemShared = sortItem;
d1993 1
a1993 1
			m_prefs->tableSortItemServer = sortItem;
d1996 1
a1996 1
			m_prefs->tableSortItemIRCChannel = sortItem;
d1999 1
a1999 1
			m_prefs->tableSortItemClientList = sortItem;
d2010 1
a2010 1
			m_prefs->tableSortAscendingDownload = sortAscending;
d2013 1
a2013 1
			m_prefs->tableSortAscendingDownload2 = sortAscending;
d2016 1
a2016 1
			m_prefs->tableSortAscendingUpload = sortAscending;
d2019 1
a2019 1
			m_prefs->tableSortAscendingQueue = sortAscending;
d2022 1
a2022 1
			m_prefs->tableSortAscendingSearch = sortAscending;
d2025 1
a2025 1
			m_prefs->tableSortAscendingShared = sortAscending;
d2028 1
a2028 1
			m_prefs->tableSortAscendingServer = sortAscending;
d2031 1
a2031 1
			m_prefs->tableSortAscendingIRCChannel = sortAscending;
d2034 1
a2034 1
			m_prefs->tableSortAscendingClientList = sortAscending;
d2243 1
a2243 1
	CString fullpath; // i_a
d2433 1
a2433 2
		// These are not stats, but they're part of my mod, so we will load them here anyway.
		statsExpandedTreeItems = ini.GetString(_T("statsExpandedTreeItems"), "111000000100000110000010000011110000010010");
d2728 1
a2728 1
	ini.SetString(_T("statsExpandedTreeItems"), statsExpandedTreeItems);
@


1.262
log
@Own client type for eMule Plus clients; Separate eMule Plus statistics.
@
text
@d786 1
d1472 1
@


1.261
log
@LMULE -> XMULE; Final stage of MD5 changes (MobileMule code);
Removed some unused settings; Minor preferences storage reorganization.
@
text
@d2311 1
d2347 1
d2550 4
a2553 3
	ini.SetUInt64(_T("DownData_EMULE"), GetCumDownData(SO_EMULE) );
	ini.SetUInt64(_T("DownData_MLDONKEY"), GetCumDownData(SO_MLDONKEY) );
	ini.SetUInt64(_T("DownData_LMULE"), GetCumDownData(SO_XMULE) );
d2556 1
a2556 1
	ini.SetUInt64(_T("DownData_SHAREAZA"), GetCumDownData(SO_SHAREAZA) );
d2603 1
@


1.260
log
@Faster processing of ini-file settings and preferences values;
Fixed restoring of 'Max. Files Ever Shared' value from statistics backup;
Improved string to hash conversion; MD5 optimization
@
text
@a54 1
//	memzero(m_prefs, sizeof(Preferences_Struct));
a612 1
	ini.SetBool(_T("GlobalSearch"), m_prefs->globalsearch);
d821 2
d826 2
a827 4
	HashType WebPasswd;

	ini.SetString(_T("Password"), HashToString(reinterpret_cast<const byte*>(m_sWebPassword.Get(&WebPasswd))));
	ini.SetString(_T("PasswordLow"), HashToString(reinterpret_cast<const byte*>(m_sLowWebPassword.Get(&WebPasswd))));
d840 3
a842 3
	ini.SetString("Password", GetMMPass());
	ini.SetBool("Enabled", m_prefs->m_bMMEnabled);
	ini.SetInt("Port", m_prefs->m_nMMPort);
a1265 1
	m_prefs->globalsearch = ini.GetBool(_T("GlobalSearch"), true);
d1523 3
a1525 3
	sprintf(m_prefs->m_sMMPassword,"%s",ini.GetString("Password", ""));
	m_prefs->m_bMMEnabled=ini.GetBool("Enabled", false);
	m_prefs->m_nMMPort = ini.GetInt("Port", 80);
d2312 1
a2312 1
	cumUpDataClients[SO_LMULE] = ini.GetUInt64(_T("UpData_LMULE"),0);
d2347 1
a2347 1
	cumDownDataClients[SO_LMULE] = ini.GetUInt64(_T("DownData_LMULE"),0);
d2550 1
a2550 1
	ini.SetUInt64(_T("DownData_LMULE"), GetCumDownData(SO_LMULE) );
d2598 4
a2601 4
	ini.SetUInt64(_T("UpData_EDONKEYHYBRID"), GetCumUpData(SO_EDONKEYHYBRID) );
	ini.SetUInt64(_T("UpData_EMULE"), GetCumUpData(SO_EMULE) );
	ini.SetUInt64(_T("UpData_MLDONKEY"), GetCumUpData(SO_MLDONKEY) );
	ini.SetUInt64(_T("UpData_LMULE"), GetCumUpData(SO_LMULE) );
d2604 1
a2604 1
	ini.SetUInt64(_T("UpData_SHAREAZA"), GetCumUpData(SO_SHAREAZA) );
d2607 2
a2608 2
	ini.SetUInt64(_T("UpDataPort_4662"), GetCumUpDataPort_4662() );
	ini.SetUInt64(_T("UpDataPort_OTHER"), GetCumUpDataPort_OTHER() );
d2611 2
a2612 2
	ini.SetUInt64(_T("UpData_File"), GetCumUpData_File() );
	ini.SetUInt64(_T("UpData_Partfile"), GetCumUpData_PartFile() );
@


1.259
log
@Fixed very specific startup crash.
@
text
@d132 1
a132 1
	m_pNameTag = new CClientTag(CT_NAME, CString(m_sNick.Get()).GetBuffer());
d524 4
a527 12

	buffer = m_sNick.Get();
	ini.SetString(_T("Nick"),buffer);

	buffer = m_sIncomingDir.Get();
	ini.SetString(_T("IncomingDir"),buffer );

	buffer = m_sTempDir.Get();
	ini.SetString(_T("TempDir"),buffer );

	buffer = m_sVideoPlayer.Get();
	ini.SetString(_T("VideoPlayer"),buffer );
d538 1
a538 1
	ini.SetInt(_T("SeeShare"), m_nSeeShares.Get());
d586 3
a588 5
	ini.SetString(_T("ToolbarSettings"), m_sToolbarSettings.Get()); // Added by reCDVst
	buffer = m_sToolbarBitmap.Get();
	ini.SetString(_T("ToolbarBitmap"),buffer);
	buffer = m_sToolbarBitmapFolder.Get();
	ini.SetString(_T("ToolbarBitmapFolder"),buffer);
d627 1
a627 1
	ini.SetString(_T("NotifierSoundPath"), CString(m_sNotifierSoundFilePath.Get()));
d794 1
a794 1
	ini.SetString(_T("URLsForICC"), CString(m_sURLsForICC.Get()));
d823 1
a823 1
//	Web Server
d825 5
a829 2
	ini.SetString(_T("Password"), CString(m_sWebPassword.Get()));
	ini.SetString(_T("PasswordLow"), CString(m_sLowWebPassword.Get()));
d861 1
a861 1
	ini.SetString(_T("FilenameCleanups"), CString(m_sFilenameCleanups.Get()));
d865 6
a870 6
	ini.SetString(_T("Server"), CString(m_sSMTPServer.Get()));
	ini.SetString(_T("Name"), CString(m_sSMTPName.Get()));
	ini.SetString(_T("From"), CString(m_sSMTPFrom.Get()));
	ini.SetString(_T("To"), CString(m_sSMTPTo.Get()));
	ini.SetString(_T("UserName"), CString(m_sSMTPUserName.Get()));
	ini.SetString(_T("Password"), CString(m_sSMTPPassword.Get()));
d885 1
a885 1
	ini.SetString(_T("BackupDir"), CString(m_sBackupDir.Get()));
d954 1
a954 2
	// Cats
	CString		catinif, ixStr, buffer;
d956 2
a957 2
	catinif.Format(_T("%scategory.ini"), m_strConfigDir);
	remove(catinif);
d961 1
a961 1
		CIni		catini(catinif);
d963 2
a964 2
		catini.AddCategory("General");
		catini.SetInt(_T("Count"),CCat::GetNumCats()-CCat::GetNumPredefinedCats(),_T("General"));
d970 2
a971 2
			ixStr.Format(_T("PredefinedCat%#i"),i);
			catini.SetInt(ixStr,pCat->m_eCatID,_T("General"));
d981 9
a989 10
				ixStr.Format("Cat#%i",ix-CCat::GetNumPredefinedCats()+1);
				catini.AddCategory(ixStr);
				catini.SetString(_T("Title"), pCat->m_strTitle, ixStr);
				catini.SetString(_T("Incoming"), pCat->m_strSavePath, ixStr);
				catini.SetString(_T("Comment"), pCat->m_strComment, ixStr);
				buffer.Format("%lu",pCat->m_crColor,ixStr);
				catini.SetString(_T("Color"), buffer, ixStr);
				catini.SetInt(_T("Priority"), pCat->m_iPriority, ixStr);
				catini.SetString(_T("AutoCat"),pCat->m_strAutoCatExt,ixStr);
				catini.SetInt(_T("CategoryID"),pCat->m_eCatID,ixStr);
a990 1
			catini.SaveAndClose();
a1067 2
	CString		strDefNick;

d1075 2
a1076 2
	strDefNick.Format(_T("%s [ePlus]"), buffer);
	m_sNick.Put(ini.GetString(_T("Nick"),strDefNick).GetBuffer(0));
d1079 2
a1080 2
	buffer.Format(_T("%sIncoming"),m_strAppDir);
	m_sIncomingDir.Put(ini.GetString(_T("IncomingDir"),buffer).GetBuffer(0));
d1083 2
a1084 2
	buffer.Format(_T("%sTemp"),m_strAppDir);
	m_sTempDir.Put(ini.GetString(_T("TempDir"),buffer).GetBuffer(0));
d1087 2
a1088 2
	buffer.Format(_T("%sVLC"),m_strAppDir);
	m_sVlcDir.Put(ini.GetString(_T("VLCDir"),buffer).GetBuffer(0));
d1091 2
a1092 2
	buffer.Format(_T("%s\\vlc.exe"),GetVlcDir());		//Cax2 - for backward compatibility
	m_sVideoPlayer.Put(ini.GetString(_T("VideoPlayer"),buffer).GetBuffer(0));		//Cax2 - replace buffer with "" in later (non b-compatible) versions
d1152 1
a1152 1
	m_nSeeShares.Put((enSeeShare)ini.GetInt(_T("SeeShare"), SEE_SHARE_NOONE));
d1228 3
a1230 3
	m_sToolbarSettings.Put(ini.GetString(_T("ToolbarSettings"), GetDefaultToolbarSettings()).GetBuffer(0));
	m_sToolbarBitmap.Put(ini.GetString(_T("ToolbarBitmap"), _T("")).GetBuffer(0));
	m_sToolbarBitmapFolder.Put(ini.GetString(_T("ToolbarBitmapFolder"), _T("")).GetBuffer(0));
d1288 1
a1288 1
	m_sNotifierSoundFilePath.Put(ini.GetString(_T("NotifierSoundPath"),_T("")).GetBuffer(0));
d1290 1
a1290 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"),_T("irc.freshirc.com")).GetBuffer(0));
d1299 1
a1299 1
	m_sIRCNick.Put(ini.GetString(_T("IRCNick"), m_sNick /*_T("eMule Plus")*/).GetBuffer(0));
d1301 1
a1301 1
	m_sIRCChanNameFilter.Put(ini.GetString(_T("IRCFilterName"), _T("")).GetBuffer(0));
d1304 1
a1304 1
	m_sIRCPerformString.Put(ini.GetString(_T("IRCPerformString"), _T("/join #emule+")).GetBuffer(0));
d1317 1
a1317 1
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"),_T("http://www.|emulespeedup")).GetBuffer(0));
d1335 1
a1335 1
	m_sCommunityString.Put(ini.GetString(_T("CommunityString"),_T("")).GetBuffer(0));
d1360 1
a1360 1
	m_sUsedFont.Put(ini.GetString(_T("UsedFont"), _T("MS Sans Serif")).GetBuffer(0));
d1362 1
a1362 1
	m_HashingPriority.Put((enHashPriority)ini.GetInt(_T("HashingPriority"),2));
d1466 1
a1466 12
	char hex_byte[3];
	int byte;
	CString A4AF_hash = ini.GetString(_T("A4AFAutoFileHash"), _T("00000000000000000000000000000000"));
	if (A4AF_hash.GetLength() != 32) A4AF_hash = _T("00000000000000000000000000000000");
	hex_byte[2] = '\0';
	for (int i = 0, j = 0; i < 16; i++, j += 2)
	{
		hex_byte[0] = A4AF_hash.GetAt(j);
		hex_byte[1] = A4AF_hash.GetAt((j + 1));
		sscanf(hex_byte, "%02X", &byte);
		m_prefs->A4AF_file_hash[i] = (uchar)byte;
	}
d1471 1
a1471 1
	m_sAwayStateMessage.Put(ini.GetString(_T("AwayStateMessage"),_T("")).GetBuffer(0));
d1479 1
a1479 1
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"),"www.microsoft.com|www.google.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org").GetBuffer(0));
d1501 3
a1503 3
	m_prefs->proxy.m_strName = ini.GetString(_T("Name"),"").GetBuffer(0);
	m_prefs->proxy.m_strPassword = ini.GetString(_T("Password"), "").GetBuffer(0);
	m_prefs->proxy.m_strUser = ini.GetString(_T("User"),"").GetBuffer(0);
d1508 3
a1510 1
//	Web Server
d1512 2
a1513 2
	m_sWebPassword.Put(ini.GetString(_T("Password"), _T("mypass")).GetBuffer(0));
	m_sLowWebPassword.Put(ini.GetString(_T("PasswordLow"), _T("mypass")).GetBuffer(0));
d1522 1
a1522 1
	sprintf(m_prefs->m_sTemplateFile,"%s",ini.GetString(_T("WebTemplateFile"),_T("eMule.tmpl")));	// netwolf
d1551 1
a1551 1
	m_sFilenameCleanups.Put(ini.GetString(_T("FilenameCleanups"), buffer2).GetBuffer(0));
d1555 6
a1560 6
	m_sSMTPServer.Put(ini.GetString(_T("Server"), "smtp.server.com").GetBuffer(0));
	m_sSMTPName.Put(ini.GetString(_T("Name"), CLIENT_NAME " Messenger").GetBuffer(0));
	m_sSMTPFrom.Put(ini.GetString(_T("From"), "messenger@@emuleplus.info").GetBuffer(0));
	m_sSMTPTo.Put(ini.GetString(_T("To"), "user@@domain.com").GetBuffer(0));
	m_sSMTPUserName.Put(ini.GetString(_T("UserName"), "username").GetBuffer(0));
	m_sSMTPPassword.Put(ini.GetString(_T("Password"), Crypt("password")).GetBuffer(0));
d1576 1
a1576 1
	m_sBackupDir.Put(ini.GetString(_T("BackupDir"),buffer).GetBuffer(0));
a1792 1
	TCHAR		buffer[100];
d1818 2
d1825 1
a1825 1
		eCatID = static_cast<_EnumCategories>(catini.GetInt(ixStr,CAT_NONE,"General"));
d1845 1
a1845 1
	int max = catini.GetInt(_T("Count"), 0, _T("General"));
d1855 2
a1856 2
		newcat->m_strTitle = catini.GetString(_T("Title"),_T(""),ixStr);
		_tcscpy(strSavePath, catini.GetString(_T("Incoming"),_T(""),ixStr));
d1864 5
a1868 6
		newcat->m_strComment = catini.GetString(_T("Comment"),_T(""),ixStr);
		newcat->m_iPriority = catini.GetInt(_T("Priority"),0,ixStr);
		_tcscpy(buffer, catini.GetString(_T("Color"),_T("0"),ixStr));
		newcat->m_crColor = _tstoi64(buffer);
		newcat->m_strAutoCatExt = catini.GetString(_T("AutoCat"),_T(""),ixStr);
		newcat->m_eCatID = static_cast<_EnumCategories>(catini.GetInt(_T("CategoryID"),ix,ixStr));
d2306 3
a2308 3
	cumUpSuccessfulSessions =	ini.GetUInt32(_T("UpSuccessfulSessions"), 0 );
	cumUpFailedSessions =		ini.GetUInt32(_T("UpFailedSessions"), 0 );
	cumUpAvgTime =			ini.GetUInt32(_T("UpAvgTime"), 0 );
d2335 4
a2338 4
	cumDownCompletedFiles = ini.GetUInt32(_T("DownCompletedFiles"), 0 );
	cumDownSuccessfulSessions = ini.GetInt(_T("DownSuccessfulSessions"), 0 );
	cumDownFailedSessions = ini.GetInt(_T("DownFailedSessions"), 0 );
	cumDownAvgTime = ini.GetUInt32(_T("DownAvgTime"), 0 );
d2343 1
a2343 1
	cumPartsSavedByICH = ini.GetUInt32(_T("PartsSavedByICH"), 0 );
d2362 17
a2378 17
	cumConnAvgDownRate = ini.GetFloat(_T("ConnAvgDownRate"), 0 );
	cumConnMaxAvgDownRate = ini.GetFloat(_T("ConnMaxAvgDownRate"), 0 );
	cumConnMaxDownRate = ini.GetFloat(_T("ConnMaxDownRate"), 0 );
	cumConnAvgUpRate = ini.GetFloat(_T("ConnAvgUpRate"), 0 );
	cumConnMaxAvgUpRate = ini.GetFloat(_T("ConnMaxAvgUpRate"), 0 );
	cumConnMaxUpRate = ini.GetFloat(_T("ConnMaxUpRate"), 0 );

	cumConnRunTime = ini.GetUInt64(_T("ConnRunTime"), 0 );

	cumConnTransferTime=			ini.GetUInt32(_T("ConnTransferTime"), 0 );
	cumConnDownloadTime=		ini.GetUInt32(_T("ConnDownloadTime"), 0 );
	cumConnUploadTime=			ini.GetUInt32(_T("ConnUploadTime"), 0 );
	cumConnServerDuration=		ini.GetUInt32(_T("ConnServerDuration"), 0 );
	cumConnNumReconnects =		ini.GetInt(_T("ConnNumReconnects"), 0 );
	cumConnAvgConnections =		ini.GetInt(_T("ConnAvgConnections"), 0 );
	cumConnMaxConnLimitReached=	ini.GetInt(_T("ConnMaxConnLimitReached"), 0 );
	cumConnPeakConnections =		ini.GetInt(_T("ConnPeakConnections"), 0 );
d2386 2
a2387 8
		uint64 temp64;
		// Load records for servers / network
		if (ini.GetInt(_T("SrvrsMostWorkingServers"), 0) > cumSrvrsMostWorkingServers)
			cumSrvrsMostWorkingServers = ini.GetInt(_T("SrvrsMostWorkingServers"), 0 );
		if (ini.GetUInt32(_T("SrvrsMostUsersOnline"), 0) > cumSrvrsMostUsersOnline)
			cumSrvrsMostUsersOnline =	ini.GetUInt32(_T("SrvrsMostUsersOnline"), 0 );
		if (ini.GetUInt32(_T("SrvrsMostFilesAvail"), 0) > cumSrvrsMostFilesAvail)
			cumSrvrsMostFilesAvail = ini.GetUInt32(_T("SrvrsMostFilesAvail"), 0 );
d2389 11
a2399 3
		// Load records for shared files
		if (ini.GetInt(_T("SharedMostFilesShared "), 0) > cumSharedMostFilesShared)
			cumSharedMostFilesShared = ini.GetInt(_T("SharedMostFilesShared"), 0 );
a2424 1

d2430 3
a2432 3
		cumSrvrsMostWorkingServers = ini.GetInt(_T("SrvrsMostWorkingServers"), 0 );
		cumSrvrsMostUsersOnline =	ini.GetUInt32(_T("SrvrsMostUsersOnline"), 0 );
		cumSrvrsMostFilesAvail = ini.GetUInt32(_T("SrvrsMostFilesAvail"), 0 );
@


1.258
log
@harden default security settings
@
text
@d1042 1
a1042 1
	CString strCurrVersion, strPrefsVersion;
d1044 2
a1045 3
	strCurrVersion = CURRENT_VERSION_LONG;
	strPrefsVersion = pIni->GetString(_T("AppVersion"),_T(""));
	pIni->SetString(_T("AppVersion"),CURRENT_VERSION_LONG);
d1054 1
a1054 1
	if ((strCurrVersion != strPrefsVersion) && findFileName.FindFile(strFileName) && strPrefsVersion!= _T(""))
a1055 2
		CFile file;
		CFileFind findNewName;
d1060 7
a1066 5
		strNewName.Format(_T("%spreferences[%s].ini"), m_strConfigDir,strPrefsVersion);
		if (findNewName.FindFile(strNewName))
			file.Remove(strNewName);
		file.Rename(strFileName, strNewName);
		strFileName = strNewName;
d1068 3
a1070 2
		bChangedVersion = true;
		loadstatsFromOld = 2; // -khaos--+++> Set this to 2 so that LoadStats will load 'em from ini.old
@


1.257
log
@Fixed directory creating [reported by Cheesy]; Removed unused local variables.
@
text
@d1164 1
a1164 1
	m_nSeeShares.Put((enSeeShare)ini.GetInt(_T("SeeShare"),SEE_SHARE_EVERYBODY));
d1255 1
a1255 1
	m_bFilterServersByIP = ini.GetBool(_T("FilterServersByIP"), false);
d1328 1
a1328 1
	m_prefs->messageFilter=ini.GetString(_T("MessageFilter"),_T("Your client has an infinite queue|http://www.chez.com/theworld/"));
d1496 1
a1496 1
	m_bScanFilter = ini.GetBool(_T("ScanFilter"), false);
d1508 2
a1509 2
	m_strIPFilterURL			= ini.GetString(_T("UpdateURLIPFilter"), _T(""));	// Value name same as eMule Morph for maximum compatibility
	m_bIPFilterUpdateOnStart	= ini.GetBool(_T("AutoUPdateIPFilter"), false);	// Value name same as eMule Morph for maximum compatibility
@


1.256
log
@Limitless download option is disabled by default to avoid user confusing
by tray menu controls (requested by Psy).
@
text
@d127 2
a128 2
	CreateDirectory(GetIncomingDir(),0);
	CreateDirectory(GetTempDir(),0);
d303 2
a304 2
	CreateDirectory(GetIncomingDir(),0);
	CreateDirectory(GetTempDir(),0);
d1804 1
a1804 1
				::CreateDirectory(strTmp, 0);
d1813 1
a1813 1
	CString		ixStr,catinif,cat_a,cat_b,cat_c;
d1893 2
a1894 2
		if (!PathFileExists(newcat->m_strSavePath))
			::CreateDirectory(newcat->m_strSavePath,0);
@


1.255
log
@removed "leave q"
@
text
@d1384 1
a1384 1
	m_bLimitlessDownload = ini.GetBool(_T("LimitlessDownload"), true);
@


1.254
log
@simplified code and removed some unneeded checks, added dynamic droplimit, added not to drop queuefull until asked twice, added preferences option with import of old ini parameter
@
text
@a553 1
	ini.SetBool(_T("UseRemoteQueueLimit"), m_bUseRQlimit);
a1159 3
//	Get the Remote Queue Size Limit (default Queue Size Limit - pinned above 2000)
	m_nRQlimit = (m_nQueueSize >= 2000)? m_nQueueSize : 2000;
	m_bUseRQlimit = ini.GetBool(_T("UseRemoteQueueLimit"), false);
@


1.253
log
@lphant client support.
@
text
@d555 1
d1164 2
@


1.252
log
@Fixed array boundary check added in the previous version.
@
text
@d2339 1
d2374 1
d2576 1
d2627 1
@


1.251
log
@1) statistic for file priority
2) optimization in category processing
@
text
@d2841 2
a2842 2
			if (byteFilePriority>= 0 && byteFilePriority <=5)
				sesUpDataPriority[byteFilePriority] +=bytes;
@


1.250
log
@Possibility to backup .part.txtsrc files.
@
text
@d2797 1
a2797 1
void CPreferences::Add2SessionTransferData(byte uClientID, uint16 uClientPort, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes, BOOL bCommunity)
d2841 3
@


1.249
log
@1) corrected default toolbar definition
2) improved processing of the username by anti-leecher feature
3) unified async GUI updade of Upload, Queue & Client lists
@
text
@d123 1
a123 1
    m_bUseProxyListenPort = false;
d889 1
d1594 1
@


1.248
log
@Some changes...
@
text
@d69 1
a69 1
	m_strAppDir = CString(drive) + dir;
a719 2
	ini.SetBool(_T("UpdateQueueList"), m_bUpdateQueueList);
	ini.SetBool(_T("UpdateKnownList"), m_bUpdateKnownList);
d1240 1
a1240 1
	m_sToolbarSettings.Put(ini.GetString(_T("ToolbarSettings"), strDefaultToolbar).GetBuffer(0));
a1323 2
	m_bUpdateQueueList = ini.GetBool(_T("UpdateQueueList"), false);
	m_bUpdateKnownList = ini.GetBool(_T("UpdateKnownList"), false);
@


1.247
log
@Removed AddDebugLogLine statusbar message option, added client transfer debug log option
@
text
@d642 1
a642 1
	ini.SetBool(_T("DisableRatingIcons"), m_bDisableRatingIcons);
d1334 1
a1334 1
	m_bDisableRatingIcons=ini.GetBool(_T("DisableRatingIcons"), false);	
@


1.246
log
@Reverted some changes...
@
text
@d592 1
d1240 1
@


1.245
log
@Minor change
@
text
@d1087 1
a1087 1
	strDefNick.Format(_T("%s |ePlus|"), buffer);
@


1.244
log
@Community statistics
@
text
@d1087 1
a1087 1
	strDefNick.Format(_T("%s [ePlus]"), buffer);
@


1.243
log
@if the preference URL for fakelist doesn't link to a ed2kfakes.txt file, it is changed to the default URL (http://donkeyfakes.gambri.net/public/ed2kfakes.txt)
@
text
@d2251 2
d2351 4
d2470 5
a2474 3
		sesUpData_File = 				0;
		sesUpData_PartFile = 			0;
		sesUpDataPort_4662 =			0;
d2634 4
d2797 1
a2797 1
void CPreferences::Add2SessionTransferData(byte uClientID, uint16 uClientPort, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes)
d2807 1
d2836 5
@


1.242
log
@Added missed save of IRC channel list sort direction when sort settings aren't in use.
@
text
@d1612 3
a1614 3
	if ( (m_sFakeListURL == _T("http://donkeyfakes.gambri.net/fakecheck/update/")) ||
		 (m_sFakeListURL == _T("http://www.emuleitor.com/downloads/morph/")) ||
		 (m_sFakeListURL == _T("http://donkeyfakes.gambri.net/fakecheck/update/fakes.rar")) )
@


1.241
log
@Add aMule client support;
CDonkey client support is eliminated.
@
text
@d761 1
d770 1
d1443 1
d1452 1
d1947 1
a1947 1
// Barry - Provide a mechanism for all tables to store/retrieve sort order
d1966 2
d1974 1
a1974 1
// Barry - Provide a mechanism for all tables to store/retrieve sort order
d1993 2
d2001 1
a2001 1
// Barry - Provide a mechanism for all tables to store/retrieve sort order
d2027 3
d2036 1
a2036 1
// Barry - Provide a mechanism for all tables to store/retrieve sort order
d2062 3
@


1.240
log
@Unified definitions for client name.
@
text
@d2322 1
a2322 1
	cumUpDataClients[SO_CDONKEY] = ini.GetUInt64(_T("UpData_CDONKEY"),0);
d2352 1
a2352 1
	cumDownDataClients[SO_CDONKEY] = ini.GetUInt64(_T("DownData_CDONKEY"),0);
d2551 1
a2551 1
	ini.SetUInt64(_T("DownData_CDONKEY"), GetCumDownData(SO_CDONKEY) );
d2601 1
a2601 1
	ini.SetUInt64(_T("UpData_CDONKEY"), GetCumUpData(SO_CDONKEY));
@


1.239
log
@Added option "Resume from other category when all done".
@
text
@d1575 1
a1575 1
	m_sSMTPName.Put(ini.GetString(_T("Name"), "eMule Plus Messenger").GetBuffer(0));
d2134 1
a2134 1
			if (IDNO == ::MessageBox(0, strTmp, _T("eMule Plus"), MB_YESNO | MB_DEFBUTTON2))	// make "no" the default
@


1.238
log
@Reduced range of possible copy buffer sizes from 4-512 to 8-256
(due to large buffer only slows down copying).
@
text
@d584 1
d1224 1
@


1.237
log
@Removed Slow Completion setting; Improved string processing;
Corrected copy buffer value range check;
@
text
@d1270 4
a1273 4
	if (m_nSlowCompleteBlockSize < 4)
		m_nSlowCompleteBlockSize = 4;
	if (m_nSlowCompleteBlockSize > 512)
		m_nSlowCompleteBlockSize = 512;
@


1.236
log
@If Video Player path is invalid, try to find VLC path in the registry
@
text
@a617 1
	ini.SetBool(_T("SlowComplete"), m_bSlowComplete);
d1266 1
a1266 1
	else if(m_nSrvConTimeout > 60000)
d1269 5
a1273 4
	m_bSlowComplete = ini.GetBool(_T("SlowComplete"), false);
	m_nSlowCompleteBlockSize = ini.GetInt(_T("SlowCompleteBlockSize"),32);
	if(m_nSlowCompleteBlockSize > 1024)
		m_nSlowCompleteBlockSize = 1024;
d2087 2
a2088 2
            CString strLng1 = GetResString(IDS_MB_LANGUAGEINFO,MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT));
			CString strLng2 = _T("");
d2092 1
a2092 1
				case    LANG_BASQUE:
d2094 3
a2096 3
				case 	LANG_CHINESE:
				case 	LANG_DANISH:
				case 	LANG_DUTCH:
d2098 2
a2099 2
				case 	LANG_FRENCH:
				case 	LANG_GERMAN:
d2103 1
a2103 1
				case 	LANG_KOREAN:
d2106 6
a2111 6
				case 	LANG_POLISH:
				case 	LANG_PORTUGUESE:
				case 	LANG_RUSSIAN:
				case    LANG_ROMANIAN:
				case 	LANG_SPANISH:
				case    LANG_TURKISH:
d2114 1
a2114 1
					strLng1 = GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID);//Cax2 fix
d2121 2
a2122 2
			if ( m_bIsNTBased )
				SetThreadLocale(m_nLanguageID); // THIS FUNCTION DOES NOT WORK ON WIN9X !!!!!!!!1
d2126 1
a2126 2
			CString strMessage = strLng1 + CString("\n\n") + strLng2;
			MessageBox(0, strMessage.GetBuffer(),_T("Language"),64);
d2128 3
a2130 6
			// DonGato
			CString strQuestion;
			if (nLocalLang == LANG_SPANISH)
				strQuestion = CString("\xbf") + GetResString(IDS_MULTIPLE, m_nLanguageID) + CString("?");
			else
				strQuestion = GetResString(IDS_MULTIPLE, m_nLanguageID) + CString("?");
d2132 1
a2132 1
			if (IDNO==MessageBox(0, strQuestion.GetBuffer(),_T("eMule Plus"),MB_YESNO | MB_DEFBUTTON2))	//SyruS make "no" the default for users
d2138 1
a2138 1
	if ( m_bIsNTBased )
@


1.235
log
@Support for external antivirus program + removed SUI preferences + minor changes
@
text
@d1104 25
a1323 1
	m_bBackupPreview = ini.GetBool(_T("VideoPreviewBackupped"), false);	//Cax2 string kept for compatibility with off client
a1492 1
	m_iPreviewSmallBlocks = ini.GetBool(_T("PreviewSmallBlocks"), false);
@


1.234
log
@Fixed open of configuration files accessed for reading by other processes
<thanks Fuxie - DK for report and testing>;
Improved string processing.
@
text
@a802 1
	ini.SetBool("SecureIdent", m_bUseSecureIdent);// change the name in future version to enable it by default
d815 6
a1059 2

	//
a1072 1
	//--- end Ozon :)
d1134 2
a1135 2
	m_nRQlimit = (m_nQueueSize >= 2000)? m_nQueueSize : 2000; //Cax2 - remote queue limit linked to queue size, but no lower than 2000
	m_bUseRQlimit = ini.GetBool(_T("UseRemoteQueueLimit"), false); //bond006 - set default value
a1138 1
	//--- xrmb:partTrafficPrefs ---
a1141 1
	//--- :xrmb ---
a1152 1
	// DonGato
d1213 2
a1214 2
	m_sToolbarBitmap.Put(ini.GetString(_T("ToolbarBitmap"), _T("")).GetBuffer(0)); // Added by reCDVst
	m_sToolbarBitmapFolder.Put(ini.GetString(_T("ToolbarBitmapFolder"), _T("")).GetBuffer(0)); // Added by reCDVst
d1239 1
a1239 1
	m_nSrvConTimeout = ini.GetInt(_T("SrvConTimeout"),20000);		//Cax2 - bugfix for time out - ticks are in milliseconds!!!!!
a1249 1
	// Barry - New properties...
d1254 1
a1254 1
	// as a temporary converter for previous versions
a1260 1
	// Added by enkeyDEV
d1303 2
a1304 2
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"),_T("http://www.|emulespeedup")).GetBuffer(0));	//(SyruS) netwolf commentfilter
	m_bDisableRatingIcons=ini.GetBool(_T("DisableRatingIcons"), false);	//netwolf: disable icons
d1356 1
a1356 1
	m_nMainProcessPriority = ini.GetInt(_T("MainProcessPriority"),0);	// netwolf 05.05.03 (default: normal MainProcessPriority)
d1407 1
a1407 1
//	Barry - Provide a mechanism for all tables to store/retrieve sort order
d1440 1
a1440 1
	m_bCMNotLog = ini.GetBool(_T("CMNotLog"), false);	//netwolf
d1445 1
a1445 1
	//AutoCheck for new version
d1449 1
a1449 1
	// Added by Tarod -to load hash of A4AF auto file
d1463 1
a1463 1
	//START enkeyDEV(kei-kun) -Messaging preferences-
a1474 1
	m_bUseSecureIdent=ini.GetBool(_T("SecureIdent"), true);
d1487 7
a1493 1
	// Maverick
d1504 1
a1504 1
	// Web Server
d1518 1
a1518 1
	// mobilemule
d1524 3
a1526 3
	// LANCAST (moosetea) - Read the settings
	// Get the Default Local IP address, using this clients hostname,
	// we will use this ip as the "default" Lancast ip, if no ip is found in the ini file.
d1530 1
a1530 1
	// Get this clients default ip as a string
a1531 1
	// Get the ini file settings
d1540 1
a1540 1
	//SyruS: cleanup
d1547 1
a1547 1
	//DonGato: SMTP
d1559 1
a1559 1
    //N@@boleo (Backup feature)
d1573 1
a1573 1
	//FakeCheck
d1582 1
a1582 1
	// Change old invalid values to current default
d1590 1
a1590 1
	// Shortcut management
d1592 2
a1593 2
	// VK_RETURN is used as the default value because it is the first element
	// in the dropdown list of the shortcut dialog (in the settings)
d1644 1
a1644 1
	//	Categories
@


1.233
log
@new FakeCheck autoupdate system
@
text
@a148 1
// Added by Tarod
d152 1
a152 2
	CString		strServerAddress ;
	CString		strFullPath = CString(m_strConfigDir) + _T("addresses.dat") ;
d155 2
a156 1
	if (addressesFile.Open(strFullPath, CFile::modeRead))
d159 1
a159 1
		while (addressesFile.ReadString(strServerAddress))
d161 4
a164 4
        // [i_a] allow commented-out entries in the addresses.dat file.
			strServerAddress.TrimLeft();
			if (strServerAddress.GetLength() > 0 && strServerAddress[0] != '#')
				m_addressesList.AddHead(strServerAddress);
d270 1
a270 1
	if (sharedDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite))
d290 1
a290 1
	if (tempDirsFile.Open(strFullPath,CFile::modeCreate|CFile::modeWrite))
d622 3
a624 3
    ini.SetBool(_T("AutoConnectStaticOnly"), m_bAutoConnectStaticOnly);
    ini.SetBool(_T("GlobalSearch"), m_prefs->globalsearch);
    ini.SetInt (_T("3DDepth"), m_nDepth3D);
d642 1
a642 1
    ini.SetString(_T("IRCServer"), m_sIRCServer.Get());
d1742 1
d1746 1
a1746 3
	CStdioFile	sDirFile;

	if (sDirFile.Open(strTmp, CFile::modeRead))
d1763 2
a1764 1
	CString			strFullPath;
d1766 1
a1766 4
// start added by InterCeptor (multiple tempdirs) 19.11.02
	strFullPath.Format(_T("%stempdir.dat"),m_strConfigDir);

	CStdioFile		tempDirFile;
d1768 1
a1768 1
	if (tempDirFile.Open(strFullPath,CFile::modeRead))
d1770 1
a1770 3
		CString		strTempPath;

		while (tempDirFile.ReadString(strTempPath))
d1772 1
a1772 1
			if(m_tempDirList.Find(strTempPath) == NULL)
d1774 2
a1775 2
				m_tempDirList.AddHead(strTempPath);
				::CreateDirectory(strTempPath,0);
a1779 1
// end added by InterCeptor (multiple tempdirs) 19.11.02
@


1.232
log
@minor changes (function renamings, unused typedef removal)
@
text
@d895 5
d1575 6
a1580 3
	m_nFakesDatVersion=ini.GetInt(_T("FakesDatVersion"),0);
	m_bUpdateFakeStartup	= ini.GetBool(_T("UpdateFakeStartup"), true);
	m_sFakeListURL		= ini.GetString(_T("FakeListURL"), "http://donkeyfakes.gambri.net/fakecheck/update/fakes.rar").Trim();
d1583 3
a1585 2
	if ((m_sFakeListURL.Trim().MakeLower() == "http://donkeyfakes.gambri.net/fakecheck/update/")
		|| (m_sFakeListURL.Trim().MakeLower() == "http://www.emuleitor.com/downloads/morph/"))
d1587 1
a1587 1
		m_sFakeListURL = "http://donkeyfakes.gambri.net/fakecheck/update/fakes.rar";
@


1.231
log
@Added the CPreferences code part for the shortcut "Clear all completed" (which has been forgotten)
@
text
@d781 1
a781 1
	ini.SetBool(_T("MlDonkeyCM"), m_bMlDonkeyCM);
d1438 1
a1438 1
	m_bMlDonkeyCM = ini.GetBool(_T("MlDonkeyCM"), true);
@


1.230
log
@New option to disable round of sizes for files and transfers
@
text
@d920 1
d1602 1
a1602 1
	m_anShortcutCode[IndexDLRename]		= ini.GetInt(_T("DownloadRenameShortcut"), VK_RETURN);
d1607 1
@


1.229
log
@added Scheduled Backup feature
@
text
@d801 1
d1470 1
@


1.228
log
@minor changes (Partfile --> PartFile...)
@
text
@d886 2
d1562 2
@


1.227
log
@'Open containing folder' added to download list context menu + minor changes
@
text
@d2204 1
a2204 1
	cumUpData_Partfile=0;
d2301 1
a2301 1
	cumUpData_Partfile = ini.GetUInt64(_T("UpData_Partfile"),0);
d2419 1
a2419 1
		sesUpData_Partfile = 			0;
d2578 1
a2578 1
	ini.SetUInt64(_T("UpData_Partfile"), GetCumUpData_Partfile() );
d2773 1
a2773 1
				sesUpData_Partfile+=bytes;
@


1.226
log
@added IP to Country from MorphXT (Please extract ip-to-country.rar in your config dir in order for this to work)
@
text
@d910 1
d1593 1
@


1.225
log
@added auto-update for ipfilter
@
text
@d615 1
d1224 1
@


1.224
log
@removed auto-changing of irc-server from 'irc.freshirc.de' to 'irc.freshirc.com' cause both are valid hosts now
@
text
@d808 7
d1472 7
@


1.223
log
@auto max sources per file
@
text
@d1262 1
a1262 2
		|| (m_sIRCServer.Get().Trim() == _T("217.172.179.168"))
		|| (m_sIRCServer.Get().Trim() == _T("irc.freshirc.de")))
@


1.222
log
@Fixed shared directory list corruption caused by asynchronous access (bug #502);
Fixed shared directory list processing to eliminate double list entries (that can be caused by case sensitive compares, by the bug on file completion after file destination change, or by initial shareddir.dat values).
@
text
@d586 6
d1184 11
@


1.221
log
@added auxiliary port support from KuSh (commited with eklmn's authorization)
@
text
@d273 2
d277 1
a277 1
			sharedDirsFile.WriteString(m_sharedDirList.GetNext(pos).GetBuffer());
d280 1
d1691 1
a1691 1
	CString		strFullPath;
d1693 1
a1693 1
	strFullPath.Format(_T("%sshareddir.dat"),m_strConfigDir);
d1697 1
a1697 1
	if (sDirFile.Open(strFullPath,CFile::modeRead))
d1699 1
a1699 3
		CString		strSharedFilePath;

		while (sDirFile.ReadString(strSharedFilePath))
d1701 1
a1701 1
			DWORD dwFileAttributes = GetFileAttributes(strSharedFilePath);
d1703 3
a1705 1
				m_sharedDirList.AddHead(strSharedFilePath);
d2834 91
@


1.220
log
@replaced  pos != 0 to pos != NULL
@
text
@d541 1
d1096 1
@


1.219
log
@Updated preferences dialogs.
Added upload log file (should be tested).
@
text
@d273 1
a273 1
		for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != 0;)
d290 1
a290 1
		for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != 0;)
@


1.218
log
@speed optimization (caching of 2 tags with constant value from hello packet)
@
text
@d670 1
d1304 1
@


1.217
log
@auto change old invalid pref values for fakelist and ircserver to new values
@
text
@d129 4
d141 3
@


1.216
log
@Added optional confirmations for disconnect and friend deletion
@
text
@d1229 9
d1518 8
a1525 1
	m_sFakeListURL			= ini.GetString(_T("FakeListURL"), "http://donkeyfakes.gambri.net/fakecheck/update/fakes.rar").Trim();
@


1.215
log
@KuSh fix for sorting completing files when 'Show paused and stopped files last' is enabled ; Updated default IRC server to 'irc.freshirc.com' ; Show attempted file send source on IRC.
@
text
@d590 2
d1178 2
@


1.214
log
@improved fakelist download, and added fakes.rar file support
@
text
@d1224 1
a1224 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"),_T("irc.freshirc.de")).GetBuffer(0));
@


1.213
log
@formatting;
optimzations in UploadQueue.cpp;
removing doubled ';'
@
text
@d1504 2
a1505 2
	m_bUpdateFakeStartup=ini.GetBool(_T("UpdateFakeStartup"), false);
	m_sFakeListURL = ini.GetString(_T("FakeListURL"), "http://www.emuleitor.com/downloads/Morph/").Trim();
@


1.212
log
@added "Watch clipboard for ed2k links"
@
text
@d2024 1
a2024 1
			CString strMessage = strLng1 + CString("\n\n") + strLng2;;
@


1.211
log
@formatting;
minor change in LanCast preferences loading;
changed the SearchDlg code to not duplicate the code
@
text
@d525 1
a525 1
	buffer = m_sVideoPlayer.Get();	//Cax2 - official mule code.
d537 1
a537 1
	//--- xrmb:partTrafficPrefs ---
d541 1
a541 1
	//--- :xrmb ---
a543 1
	//ini.SetInt(_T("RemoteQueueLimit"), m_prefs->remotequeuelimit); //remote QR
a602 1
	// Barry - New properties...
d702 1
a702 2
//	ini.SetBool("StartNextFile", m_prefs->m_bstartnextfile); //duplicates downloadpausedoncomplete
	ini.SetBool(_T("ShowOverhead"), m_bShowOverhead);	//Cax2 re-enabled this preference
d764 1
d766 1
a766 1
	//AutoCheck for new version
d772 1
a772 1
	//START enkeyDEV(kei-kun) -Messaging preferences-
d788 1
a788 1
	// Maverick
d799 1
a799 1
	// Web Server
d813 1
a813 1
	//mobileMule
d819 1
a819 1
	// LANCAST (moosetea) - Save the settings
d836 1
a836 1
	//DonGato: SMTP
d848 1
a848 1
	//N@@boleo (Backup feature)
d859 1
a859 1
	//FakeCheck
d865 1
a865 1
	// Shortcut management
d909 1
a909 1
//	Now file is close, so we can update a stats over SaveStats()
d1385 1
@


1.210
log
@Changed some code by other devs
@
text
@d1455 1
a1455 1
	// Get the Defualt Local IP address, using this clients hostname,
d1466 1
a1466 1
	m_DefaultLancastIP = inet_addr(ini.GetString(_T("IPAddress"),defaultIP));
@


1.209
log
@Unrequired code removal
@
text
@d641 1
d1253 1
@


1.208
log
@Changed uint32 to unsigned long from unsigned int and made necessary code changes. Got rid of _unsigned_ types int8,int16,int32,int64. Eliminated uint8 to avoid confusion. Use "byte".
@
text
@d771 1
a771 2
	CString hex_hash = FileHashToString(m_prefs->A4AF_file_hash);
	ini.SetString(_T("A4AFAutoFileHash"), hex_hash);
@


1.207
log
@removed MOBILE_MULE and JUMPSTART defines + minor improvements (thx aw3)
@
text
@d823 1
a823 1
	t_strLanCastIP.Format(_T("%i.%i.%i.%i"),(uint8)m_LancastIP,(uint8)(m_LancastIP>>8),(uint8)(m_LancastIP>>16),(uint8)(m_LancastIP>>24));
d825 1
a825 1
	t_strLanCastSubnet.Format(_T("%i.%i.%i.%i"),(uint8)m_LancastSubnet,(uint8)(m_LancastSubnet>>8),(uint8)(m_LancastSubnet>>16),(uint8)(m_LancastSubnet>>24));
d1983 1
a1983 1
			uint8 nLocalLang = ::GetThreadLocale();
d2671 1
a2671 1
void CPreferences::Add2SessionTransferData(uint8 uClientID, uint16 uClientPort, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes)
@


1.206
log
@Improved user hash generation algorithm (more unique values) -- before the most significant bit in every second byte was always zero.
@
text
@d2105 1
@


1.205
log
@Replaced all zero filled memsets with optimized memzero (Thx Aw3 !) + some more Aw3 optimizations
@
text
@d303 2
d306 1
a306 2
	{
		uint16	random = rand();
a307 2
		memcpy2(&m_userHash[i*2],&random,2);
	}
@


1.204
log
@changed A4AF sources count display as an option + minor cosmetic changes
@
text
@d55 1
a55 1
//	memset2(m_prefs,0,sizeof(Preferences_Struct));
d57 1
a57 1
	memset2(m_prefsExt,0,sizeof(Preferences_Ext_Struct));
d1596 1
a1596 1
			memset2(prefsImport20b,0,sizeof(Preferences_Import20b_Struct));
d1612 3
a1614 3
			memset2(prefsImport20a,0,sizeof(Preferences_Import20a_Struct));
			fseek(pPrefsFile,0,0);
			fread(prefsImport20a,sizeof(Preferences_Import20a_Struct),1,pPrefsFile);
d1628 1
a1628 1
			memset2(prefsImport19c,0,sizeof(Preferences_Import19c_Struct));
d1630 2
a1631 2
			fseek(pPrefsFile,0,0);
			fread(prefsImport19c,sizeof(Preferences_Import19c_Struct),1,pPrefsFile);
@


1.203
log
@smartfilter preferences "core"
@
text
@d671 1
d1295 1
@


1.202
log
@minor changes to DebugLog and remove some marks
@
text
@d787 3
d1415 1
a1415 1
	m_bUseSecureIdent=ini.GetBool("SecureIdent", true);
d1418 3
@


1.201
log
@updated fakes.dat URL (for now, don't know how often it's updated...)
@
text
@d562 1
a562 1
	ini.SetBool(_T("BanEnabled"), m_bBanEnabled); // DbT:BanEnDisable
d810 1
a810 1
	ini.SetString(_T("WebTemplateFile"),m_prefs->m_sTemplateFile);	// netwolf
a829 1
	//SyruS: cleanup
d1137 1
a1137 1
	m_bBanEnabled = ini.GetBool(_T("BanEnabled"), true); // DbT:BanEnDisable
@


1.200
log
@added 'Swap all A4AF sources to other files' by right-click menu or shortcut + minor changes
@
text
@d1499 1
a1499 1
	m_sFakeListURL = ini.GetString(_T("FakeListURL"), "http://donkeyfakes.gambri.net/fakecheck/update/").Trim();
@


1.199
log
@added 'auto-clear completed files' option
@
text
@d893 1
d1531 1
@


1.198
log
@Minor updates (domain change)
@
text
@d576 1
d1161 1
d2012 1
a2012 1
				SetThreadLocale(m_nLanguageID); // THIS FUNCTION DOEN NOT WORK ON WIN9X !!!!!!!!1
@


1.197
log
@More Kush changes for localization, minor optimizations and fix for Upload AutoPriority.
@
text
@d1472 1
a1472 1
	m_sSMTPFrom.Put(ini.GetString(_T("From"), "messenger@@emuleplus.sf.net").GetBuffer(0));
@


1.196
log
@Fix of shortcut preferences reload
@
text
@d63 1
a63 1
	
d67 3
a69 3
	_tsplitpath(path, drive, dir, NULL, NULL); 
	
	m_strAppDir = CString(drive) + dir;	
d119 1
a119 1
		
d132 1
a132 1
{	
d161 1
a161 1
	}	
d173 1
a173 1
	
d175 1
a175 1
	{ 
d226 1
a226 1
	
d246 1
a246 1
	
d259 1
a259 1
	
d266 1
a266 1
		for (POSITION pos = m_sharedDirList.GetHeadPosition(); pos != 0; m_sharedDirList.GetNext(pos))
d268 1
a268 1
			sharedDirsFile.WriteString(m_sharedDirList.GetAt(pos).GetBuffer());
d276 1
a276 1
//	start added by InterCeptor (multiple tempdirs) 19.11.02	
d283 1
a283 1
		for (POSITION pos = m_tempDirList.GetHeadPosition(); pos != 0; m_tempDirList.GetNext(pos))
d285 1
a285 1
			tempDirsFile.WriteString(m_tempDirList.GetAt(pos).GetBuffer());
d292 1
a292 1
//	end added by InterCeptor (multiple tempdirs) 19.11.02	
d304 1
a304 1
	{ 
d510 1
a510 1
	
d545 1
a545 1
	//ini.SetInt(_T("RemoteQueueLimit"), m_prefs->remotequeuelimit); //remote QR 
d576 1
a576 1
	
d605 3
a607 3
    ini.SetBool(_T("AutoConnectStaticOnly"), m_bAutoConnectStaticOnly);  
    ini.SetBool(_T("GlobalSearch"), m_prefs->globalsearch);  
    ini.SetInt (_T("3DDepth"), m_nDepth3D); 
d611 1
a611 1
	ini.SetBool(_T("NotifyOnChat"), m_bUseChatNotifier);		  
d641 1
a641 1
	ini.SetInt(_T("SortServersCode"), m_nServerSortCol);	
d671 1
a671 1
	ini.SetBool(_T("AutoTakeED2KLinks"), m_bAutoTakeLinks); 
d765 1
a765 1
	
d771 1
a771 1
	ini.SetString(_T("A4AFAutoFileHash"), hex_hash);	
d774 1
a774 1
	ini.SetInt(_T("AcceptMessageFrom"),m_nAcceptMessagesFrom);	
d799 2
a800 2
	ini.SetString(_T("Password"), CString(m_sWebPassword.Get()));	
	ini.SetString(_T("PasswordLow"), CString(m_sLowWebPassword.Get()));	
d927 1
a927 1
		
d951 1
a951 1
				catini.SetString(_T("AutoCat"),pCat->m_strAutoCatExt,ixStr); 
d985 1
a985 1
	
d1019 1
a1019 1
		strNewName.Format(_T("%spreferences[%s].ini"), m_strConfigDir,strPrefsVersion);	
d1127 1
a1127 1
	
d1131 1
a1131 1
	
d1154 1
a1154 1
	
d1160 1
a1160 1
	
d1179 2
a1180 2
	m_bCloseToTray = ini.GetBool(_T("CloseToTray"), false);	
	m_bDetailsOnClick = ini.GetBool(_T("DetailsOnClick"), false);	
d1190 2
a1191 2
	
	m_bSlowComplete = ini.GetBool(_T("SlowComplete"), false);	
d1197 2
a1198 2
	m_bAutoConnectStaticOnly = ini.GetBool(_T("AutoConnectStaticOnly"), false); 
	m_prefs->globalsearch = ini.GetBool(_T("GlobalSearch"), true); 
d1205 1
a1205 1
		else 
d1371 1
a1371 1
		if (m_nStatColors[i] == -1) 
d1546 1
a1546 1
	// statsitic 
d1559 1
a1559 1
//		"config/preferences.dat" 
d1626 2
a1627 2
			} 
			else 
d1694 1
a1694 1
void CPreferences::LoadCats() 
d1718 1
a1718 1
	if(!PathFileExists(catinif)) 
d1793 1
a1793 1
	{	
d1798 1
a1798 1
		m_wWinVer = DetectWinVersion(bIsNTNBased);	
d1800 1
a1800 1
	}	
d1814 1
a1814 1
		case _WINVER_95_:	
d1832 1
a1832 1
	switch (t) 
d1857 1
a1857 1
	switch (t) 
d1882 1
a1882 1
	switch (t) 
d1914 1
a1914 1
	switch(t) 
d1974 1
a1974 1
			
d2016 1
a2016 1
			
d2023 1
a2023 1
			
d2042 1
a2042 1
void CPreferences::SetMainProcessPriority(int Value) 			
d2126 1
a2126 1
		
d2143 1
a2143 1
	
d2273 1
a2273 1
	if (loadBackUp == 1) 
d2297 2
a2298 2
		
		
d2312 1
a2312 1
		
d2315 1
a2315 1
	else 
d2373 1
a2373 1
	if (GetStatsLastResetLng()) 
d2380 1
a2380 1
	else 
d2405 1
a2405 1
		case 2: 
d2533 1
a2533 1
		ini.SetFloat(_T("ConnMaxUpRate"), GetConnMaxUpRate());	
d2535 1
a2535 1
	
d2541 1
a2541 1
	if (g_eMuleApp.stat_reconnects>0) 
d2556 1
a2556 1
		if (g_eMuleApp.m_pListenSocket->GetMaxConnectionsReachedCount() > 0 ) 
d2574 1
a2574 1
			ini.SetInt(_T("ConnServerDuration"), GetConnServerDuration() + g_eMuleApp.m_pdlgEmule->m_dlgStatistics.GetServerDuration());		
d2578 1
a2578 1
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile; 
d2595 1
a2595 1
		if (g_eMuleApp.m_pSharedFilesList->GetCount()>cumSharedMostFilesShared)	
d2653 1
a2653 1
	if (g_eMuleApp.m_pSharedFilesList->GetCount() != 0) 
d2683 1
a2683 1
				case 4662:			
d2695 1
a2695 1
			else						
d2714 1
a2714 1
					sesDownDataPort_4662+=bytes;	
d2744 1
a2744 1
	
d2760 1
a2760 1
	
d2775 1
a2775 1
	
@


1.195
log
@Fixed memleak (it was me! :P)
@
text
@d1522 3
a1524 3
	m_anShortcutCode[IndexDLClear]			= ini.GetInt(_T("DownloadShowAllUploadsShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLShowAllUp]		= ini.GetInt(_T("DownloadUseDefaultSortShortcut"), VK_RETURN);
	m_anShortcutCode[IndexDLUseDefaultSort]	= ini.GetInt(_T("DownloadClearCompletedFilesShortcut"), VK_RETURN);
@


1.194
log
@wrong values in categories because completed files weren't counted
@
text
@d1114 1
a1114 1
	int nMax = (LOBYTE(GetWindowsVersion()) == 0x04)?100:200;
@


1.193
log
@some minor loop corrections
@
text
@d1659 2
a1660 2
			DWORD Code = GetFileAttributes(strSharedFilePath);
			if ((Code != -1) && (Code & FILE_ATTRIBUTE_DIRECTORY))
@


1.192
log
@Fixed: having non existing directories in shareddir.dat inhibits setting drive letter bold
@
text
@d303 1
a303 1
	for (int i = 0; i != 8; i++)
d309 1
a309 1
//	Mark as emule client. that will be need in later version
d1366 1
a1366 1
	for (int i=0;i<15;i++)
d1750 1
a1750 1
	for(int ix = 1; ix <= max; ix++)
d2334 1
a2334 1
		for (int i = 0; i<SO_LAST;i++)
@


1.191
log
@Updated shortcut management
@
text
@d1658 5
a1662 1
			m_sharedDirList.AddHead(strSharedFilePath);
@


1.190
log
@fixed cumulative statistics totals for uploads and downloads and other minor changes
@
text
@d882 1
d885 1
d887 2
d1518 1
d1521 4
a1524 1
	m_anShortcutCode[IndexDLClear]			= ini.GetInt(_T("DownloadClearCompletedFilesShortcut"), VK_RETURN);
@


1.189
log
@Minor changes
@
text
@d2405 1
a2405 1
	ini.SetUInt64(_T("TotalDownloadedBytes"), g_eMuleApp.stat_sessionReceivedBytes+GetTotalDownloaded());
d2452 1
a2452 1
	ini.SetUInt64(_T("TotalUploadedBytes"), g_eMuleApp.stat_sessionSentBytes+GetTotalUploaded() );
@


1.188
log
@Connect to ePlus IRC channel by default.
@
text
@d980 1
a980 1
//	CSingleLock PrefLock(&m_Pref_Mutex,TRUE);
d1039 1
a1039 1
	
d1042 1
a1042 1
	
d1094 1
a1094 1
	m_bUsePartTraffic = ini.GetBool(_T("PartTrafficEnabled"),false);
d1107 1
a1107 1
	m_prefs->showRatesInTitle=ini.GetBool(_T("ShowRatesOnTitle"),false);
d1132 1
a1132 1
	m_bBanEnabled = ini.GetBool(_T("BanEnabled"),true); // DbT:BanEnDisable
d1146 1
a1146 1
	m_bSLSEnable = ini.GetBool(_T("SLS_Enable"),false);
d1148 2
a1149 2
	m_bReconnect = ini.GetBool(_T("Reconnect"),true);
	m_nScoreSystem = ini.GetBool(_T("Scoresystem"),true);
d1161 13
a1173 13
	m_bAutoServerList = ini.GetBool(_T("Serverlist"),false);
	m_bUpdateNotify = ini.GetBool(_T("UpdateNotify"),true);
	m_bMinToTray = ini.GetBool(_T("MinimizeToTray"),true);
	m_bAddServersFromConn = ini.GetBool(_T("AddServersFromConnections"),true);
	m_bSplashScreen = ini.GetBool(_T("Splashscreen"),true);
	m_bBringToForeground = ini.GetBool(_T("BringToFront"),true);
	m_bBeepOnError = ini.GetBool(_T("BeepOnError"),true);
	m_bConfirmExit = ini.GetBool(_T("ConfirmExit"),true);
	m_bFilterBadIP = ini.GetBool(_T("FilterBadIPs"),true);
	m_bFilterServersByIP = ini.GetBool(_T("FilterServersByIP"),false);
	m_bAutoConnect = ini.GetBool(_T("Autoconnect"),false);
	m_bOnlineSig = ini.GetBool(_T("OnlineSignature"),false);
	m_bStartMinimized = ini.GetBool(_T("StartupMinimized"),false);
d1175 2
a1176 2
	m_bCloseToTray = ini.GetBool(_T("CloseToTray"),false);	
	m_bDetailsOnClick = ini.GetBool(_T("DetailsOnClick"),false);	
d1179 1
a1179 1
	m_bShowCatTabInfo = ini.GetBool("ShowInfoOnCatTabs",false);
d1187 1
a1187 1
	m_bSlowComplete = ini.GetBool(_T("SlowComplete"),false);	
d1193 2
a1194 2
	m_bAutoConnectStaticOnly = ini.GetBool(_T("AutoConnectStaticOnly"),false); 
	m_prefs->globalsearch = ini.GetBool(_T("GlobalSearch"),true); 
d1199 1
a1199 1
		if (ini.GetBool(_T("FlatStatusBar"),false))
d1205 10
a1214 10
	m_bUseDownloadAddNotifier = ini.GetBool(_T("NotifyOnDownloadAdd"),false);
	m_bUseDownloadNotifier = ini.GetBool(_T("NotifyOnDownload"),false);
	m_bUseChatNotifier = ini.GetBool(_T("NotifyOnChat"),false);
	m_bUseLogNotifier = ini.GetBool(_T("NotifyOnLog"),false);
	m_bUseSoundInNotifier = ini.GetBool(_T("NotifierUseSound"),false);
	m_bUseSchedulerNotifier = ini.GetBool(_T("NotifierUseScheduler"),false);
	m_bNotifierPopsEveryChatMsg = ini.GetBool(_T("NotifierPopEveryChatMessage"),false);
	m_bNotifierImportantError = ini.GetBool(_T("NotifyOnImportantError"),false);
	m_bNotifierWebServerError = ini.GetBool(_T("NotifyOnWebServerError"),false);
	m_bNotifierServerError = ini.GetBool(_T("NotifyOnServerError"),false);
d1218 2
a1219 2
	m_sIRCNick.Put(ini.GetString(_T("IRCNick"),_T("eMule Plus")).GetBuffer(0));
	m_bIRCAddTimestamp = ini.GetBool(_T("IRCAddTimestamp"),true);
d1229 7
a1235 7
	m_bSmartIdCheck = ini.GetBool(_T("SmartIdCheck"),true);
	m_bVerbose = ini.GetBool(_T("Verbose"),false);
	m_bUpdateQueueList = ini.GetBool(_T("UpdateQueueList"),false);
	m_bUpdateKnownList = ini.GetBool(_T("UpdateKnownList"),false);
	m_bManualHighPrio=ini.GetBool(_T("ManualHighPrio"),false);
	m_bShowOverhead = ini.GetBool(_T("ShowOverhead"),true);
	m_bBackupPreview = ini.GetBool(_T("VideoPreviewBackupped"),false);	//Cax2 string kept for compatibility with off client
d1240 1
a1240 1
	m_bDisableRatingIcons=ini.GetBool(_T("DisableRatingIcons"),false);	//netwolf: disable icons
d1242 2
a1243 2
	m_bUseSort = ini.GetBool(_T("UseSortingDefaults"),true);
	m_bUseSrcSortCol2 = ini.GetBool(_T("Use2ndSortSources"),false);
d1273 4
a1276 4
	m_bRestartWaiting = ini.GetBool(_T("RestartWaiting"),true);
	m_bLogToFile = ini.GetBool(_T("LogToFile"),false);
	m_prefs->BugReport = ini.GetBool(_T("BugReport"),false);
	m_bDisableXSUpTo = ini.GetBool(_T("DisableXSUpTo"),false);
d1283 1
a1283 1
	m_bUploadParts = ini.GetBool(_T("UploadParts"),false);
d1287 1
a1287 1
	m_bAutoTakeLinks = ini.GetBool(_T("AutoTakeED2KLinks"),false);
d1290 2
a1291 2
	m_bShowAverageDataRate = ini.GetBool(_T("ShowAverageDataRate"),false);
	m_bLimitlessDownload = ini.GetBool(_T("LimitlessDownload"),false);
d1313 1
a1313 1
	m_bMultiple = ini.GetBool(_T("MultipleInstances"),false);
d1372 2
a1373 2
	m_bMlDonkeyCM = ini.GetBool(_T("MlDonkeyCM"),true);
	m_bCMNotLog = ini.GetBool(_T("CMNotLog"),false);	//netwolf
d1400 1
a1400 1
	m_bScanFilter = ini.GetBool(_T("ScanFilter"),false);
d1406 1
a1406 1
	m_bUseSecureIdent=ini.GetBool("SecureIdent",true);
d1411 2
a1412 2
	m_prefs->proxy.m_bEnablePassword = ini.GetBool(_T("EnablePassword"),false);
	m_prefs->proxy.m_bUseProxy = ini.GetBool(_T("EnableProxy"),false);
d1418 1
a1418 1
	m_bIsASCWOP = ini.GetBool(_T("ConnectWithoutProxy"),false);
d1450 2
a1451 2
	m_LancastEnabled = ini.GetBool(_T("Enabled"),false);
	m_UseDefaultIP = ini.GetBool(_T("UseDefaultIP"),true);
d1478 5
a1482 5
	m_bDatFiles = ini.GetBool(_T("DatFiles"),false);
	m_bMetFiles = ini.GetBool(_T("MetFiles"),false);
	m_bIniFiles = ini.GetBool(_T("IniFiles"),false);
	m_bPartFiles = ini.GetBool(_T("PartFiles"),false);
	m_bPartMetFiles = ini.GetBool(_T("PartMetFiles"),false);
d1491 1
a1491 1
	m_bUpdateFakeStartup=ini.GetBool(_T("UpdateFakeStartup"),false);
d1703 1
a1703 1
	CCat::AddCat(newcat,false);
d1731 1
a1731 1
			CCat::AddCat(newcat,false);
d1763 1
a1763 1
		CCat::AddCat(newcat,false);
@


1.187
log
@Changed the way the preference for update of upload lists is handled
@
text
@d1224 1
a1224 1
	m_bIRCUsePerform = ini.GetBool(_T("IRCUsePerform"), false);
@


1.186
log
@Changed default IRC server to irc.freshirc.de
@
text
@d700 1
d1232 1
@


1.185
log
@Ops! Don't tell morevit...
@
text
@d1216 1
a1216 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"),_T("217.172.179.168")).GetBuffer(0));
@


1.184
log
@Keep-Alive for server connections
@
text
@d763 1
a763 1
	ini.SetInt(_T("ServerKeepAliveTimeout"), m_nServerKeepAliveTimeout);
d1373 1
a1373 1
	m_nServerKeepAliveTimeout = ini.GetInt(_T("ServerKeepAliveTimeout"),0);
@


1.183
log
@Updated default IRC network addresss
@
text
@d763 2
d1372 2
@


1.182
log
@Fix for update stats value not retrieved
@
text
@d1214 1
a1214 1
	m_sIRCServer.Put(ini.GetString(_T("IRCServer"),_T("irc.liquidirc.com")).GetBuffer(0));
@


1.181
log
@Fix for cumulative downloads
@
text
@d1097 1
a1097 1
	m_nStatsInterval = ini.GetInt(_T("statsInterval"),5);
@


1.180
log
@Fix for default sorting of Client List
@
text
@d2402 1
d2406 1
d2432 1
a2432 1
		ini.SetUInt64(_T("DownOverheadTotal"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequest()+g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchange()+g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServer()+g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOther()+GetDownOverheadTotal() );
d2435 2
a2436 2
		ini.SetUInt64(_T("DownOverheadServer"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServer()+GetDownOverheadServer() );
		ini.SetUInt64(_T("DownOverheadOther"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOther()+GetDownOverheadOther() );
d2438 1
a2438 1
		ini.SetUInt64(_T("DownOverheadTotalPackets"), (uint64)g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServerPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets());
d2454 1
a2454 1
		ini.SetUInt64(_T("UpOverheadTotal"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequest() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchange() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServer() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOther() + GetUpOverheadTotal());
d2459 2
a2460 2
		ini.SetUInt64(_T("UpOverheadTotalPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadSourceExchangePackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadServerPackets() + g_eMuleApp.m_pUploadQueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets());
		ini.SetUInt64(_T("UpOverheadFileReqPackets"), (uint64)g_eMuleApp.m_pUploadQueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets());
@


1.179
log
@new standard-channel "/join #emule+"
@
text
@d648 1
d1247 1
@


1.178
log
@formatting
@
text
@d1219 1
a1219 1
	m_sIRCPerformString.Put(ini.GetString(_T("IRCPerformString"), _T("/join #emule")).GetBuffer(0));
@


1.177
log
@defaulting "show avg speed/time" to off; no brackets in seperate columns
@
text
@a176 1
		{
a177 1
		}
d751 2
a752 1
	for (int i=0;i<15;i++) {
a1108 1
	{
a1109 1
	}
d1257 2
a1258 1
	if(m_nPriorityLow != 0){
d1261 3
a1263 1
	} else {
d1356 2
a1357 1
	for (int i=0;i<15;i++) {
d1379 2
a1380 1
	for (int i = 0, j = 0; i < 16; i++, j += 2) {
d1399 1
a1399 1
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"),"www.microsoft.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org").GetBuffer(0));
a1535 1
	{	
a1536 1
	}
a1611 1
			{
a1612 1
			}
a1709 1
		{
a1710 1
		}
a1756 1
		{	
a1757 1
		}
a1791 1
			{
a1792 1
			}
d1957 2
a1958 1
			switch(PRIMARYLANGID(nLocalLang)) {
a1989 1
			{
a1990 1
			}
a1991 1
			{
a1992 1
			}
a2010 1
	{
a2011 1
	}
d2014 2
a2015 1
	if (GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID).GetLength()==0) {
a2017 1
		{
a2018 1
		}
d2582 2
a2583 1
		if (g_eMuleApp.m_pSharedFilesList->GetCount() != 0) {
a2729 1
	{	
a2730 1
	}
a2734 1
	{	
a2735 1
	}
a2736 1
	{	
a2737 1
	}
a2740 1
	{	
a2741 1
	}
a2749 1
	{	
a2750 1
	}
a2751 1
	{	
a2752 1
	}
@


1.176
log
@Change to shortcut management code (it's easier to add an action now) / Added a lot of actions to shortcut management / Added some keys to shortcut management
@
text
@d1284 1
a1284 1
	m_bShowAverageDataRate = ini.GetBool(_T("ShowAverageDataRate"),true);
@


1.175
log
@added Norwegian (Bokmal) language [True Neo]
@
text
@d861 1
d863 34
a896 17
	ini.SetInt(_T("GeneralMinimizeWindowToTrayShortcut"), m_nGeneralMinimizeWindowToTrayShortcut);
	ini.SetInt(_T("GeneralShowServerWndShortcut"), m_nGeneralShowServerWndShortcut);
	ini.SetInt(_T("GeneralShowTransferWndShortcut"), m_nGeneralShowTransferWndShortcut);
	ini.SetInt(_T("GeneralShowSearchWndShortcut"), m_nGeneralShowSearchWndShortcut);
	ini.SetInt(_T("GeneralShowSharedFilesWndShortcut"), m_nGeneralShowSharedFilesWndShortcut);
	ini.SetInt(_T("GeneralShowChatWndShortcut"), m_nGeneralShowChatWndShortcut);
	ini.SetInt(_T("GeneralShowIRCWndShortcut"), m_nGeneralShowIRCWndShortcut);
	ini.SetInt(_T("GeneralShowStatisticsWndShortcut"), m_nGeneralShowStatisticsWndShortcut);
	ini.SetInt(_T("GeneralShowPreferencesWndShortcut"), m_nGeneralShowPreferencesWndShortcut);
	ini.SetInt(_T("DownloadViewFileCommentsShortcut"), m_nDownloadViewFileCommentsShortcut);
	ini.SetInt(_T("DownloadViewFileDetailsShortcut"), m_nDownloadViewFileDetailsShortcut);
	ini.SetInt(_T("DownloadClearCompletedFilesShortcut"), m_nDownloadClearCompletedFilesShortcut);
	ini.SetInt(_T("UploadViewClientDetailsShortcut"), m_nUploadViewClientDetailsShortcut);
	ini.SetInt(_T("UploadAddClientToFriendsShortcut"), m_nUploadAddClientToFriendsShortcut);
	ini.SetInt(_T("UploadSendMessageClientShortcut"), m_nUploadSendMessageClientShortcut);
	ini.SetInt(_T("UploadViewClientFilesShortcut"), m_nUploadViewClientFilesShortcut);
	ini.SetInt(_T("ShareEditFileCommentsShortcut"), m_nShareEditFileCommentsShortcut);
d1484 1
d1486 36
a1521 19
	// I'm using VK_RETURN as the default value because it is the first
	// element in the dropdown list of the shortcut dialog (in the settings)
	m_nGeneralMinimizeWindowToTrayShortcut	= ini.GetInt(_T("GeneralMinimizeWindowToTrayShortcut"), VK_RETURN);
	m_nGeneralShowServerWndShortcut			= ini.GetInt(_T("GeneralShowServerWndShortcut"), VK_RETURN);
	m_nGeneralShowTransferWndShortcut		= ini.GetInt(_T("GeneralShowTransferWndShortcut"), VK_RETURN);
	m_nGeneralShowSearchWndShortcut			= ini.GetInt(_T("GeneralShowSearchWndShortcut"), VK_RETURN);
	m_nGeneralShowSharedFilesWndShortcut	= ini.GetInt(_T("GeneralShowSharedFilesWndShortcut"), VK_RETURN);
	m_nGeneralShowChatWndShortcut			= ini.GetInt(_T("GeneralShowChatWndShortcut"), VK_RETURN);
	m_nGeneralShowIRCWndShortcut			= ini.GetInt(_T("GeneralShowIRCWndShortcut"), VK_RETURN);
	m_nGeneralShowStatisticsWndShortcut		= ini.GetInt(_T("GeneralShowStatisticsWndShortcut"), VK_RETURN);
	m_nGeneralShowPreferencesWndShortcut	= ini.GetInt(_T("GeneralShowPreferencesWndShortcut"), VK_RETURN);
	m_nDownloadViewFileCommentsShortcut		= ini.GetInt(_T("DownloadViewFileCommentsShortcut"), VK_RETURN);
	m_nDownloadViewFileDetailsShortcut		= ini.GetInt(_T("DownloadViewFileDetailsShortcut"), VK_RETURN);
	m_nDownloadClearCompletedFilesShortcut	= ini.GetInt(_T("DownloadClearCompletedFilesShortcut"), VK_RETURN);
	m_nUploadViewClientDetailsShortcut		= ini.GetInt(_T("UploadViewClientDetailsShortcut"), VK_RETURN);
	m_nUploadAddClientToFriendsShortcut		= ini.GetInt(_T("UploadAddClientToFriendsShortcut"), VK_RETURN);
	m_nUploadSendMessageClientShortcut		= ini.GetInt(_T("UploadSendMessageClientShortcut"), VK_RETURN);
	m_nUploadViewClientFilesShortcut		= ini.GetInt(_T("UploadViewClientFilesShortcut"), VK_RETURN);
	m_nShareEditFileCommentsShortcut		= ini.GetInt(_T("ShareEditFileCommentsShortcut"), VK_RETURN);
@


1.174
log
@Some minor fixes and unused preferences removed
@
text
@d1901 4
a1904 2
		case MAKELANGID(LANG_GERMAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "german");break;
		case MAKELANGID(LANG_FRENCH,SUBLANG_DEFAULT):setlocale( LC_ALL, "french");break;
a1905 1
		case MAKELANGID(LANG_SPANISH,SUBLANG_SPANISH):setlocale( LC_ALL, "spanish");break;
d1907 6
a1912 3
		case MAKELANGID(LANG_RUSSIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "russian");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_SIMPLIFIED):setlocale( LC_ALL, "chs");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_TRADITIONAL):setlocale( LC_ALL, "cht");break;
d1914 2
a1918 6
		case MAKELANGID(LANG_FINNISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "finnish");break;
		case MAKELANGID(LANG_ITALIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "italian");break;
		case MAKELANGID(LANG_CATALAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "esp");break;
		case MAKELANGID(LANG_GREEK,SUBLANG_DEFAULT):setlocale( LC_ALL, "greek");break;
		case MAKELANGID(LANG_HEBREW,SUBLANG_DEFAULT):setlocale( LC_ALL, "hebrew");break;
		case MAKELANGID(LANG_LITHUANIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "lithuanian");break;
d1920 3
a1922 2
		case MAKELANGID(LANG_BASQUE,SUBLANG_DEFAULT):setlocale( LC_ALL, "basque");break;
        case MAKELANGID(LANG_TURKISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "turkish");break;
d1931 3
a1933 3
				case	LANG_GREEK:
				case 	LANG_GERMAN:
				case 	LANG_FRENCH:
a1934 1
				case 	LANG_SPANISH:
d1936 6
a1941 2
				case 	LANG_RUSSIAN:
				case 	LANG_CHINESE:
d1943 2
d1947 1
a1947 5
				case	LANG_FINNISH:
				case	LANG_ITALIAN:
				case	LANG_CATALAN:
				case	LANG_HEBREW:
				case	LANG_LITHUANIAN:
d1949 1
a1949 1
				case    LANG_BASQUE:
@


1.173
log
@Minor fix
@
text
@a550 1
	ini.SetInt(_T("StatsColumnWidth"), m_nStatsColumnWidth);
a551 1
	ini.SetString(_T("StatsListExpanded"), m_sStatsListExpanded.Get());
d758 1
a758 1
	ini.SetInt(_T("ConnectionsGraphRatio"), m_nGraphRatio); // propstats Cax2
a759 1
	// Added By Maverick
d761 1
a761 1
	ini.SetBool(_T("CMNotLog"), m_bCMNotLog);	// netwolf
a766 1
	// Added by Tarod -saving HASH of A4AF auto file
a767 1
	
d770 13
a802 1
	// Added by Johnny-B
a805 1
	//End Johnny-B
a813 1
	//////////////////////////////////////////////////////////////////
a814 1
	
a816 1

a818 1
				
a825 7
	//////////////////////////////////////////////////////////////////

	//START enkeyDEV(kei-kun) -Messaging preferences-
	ini.SetInt(_T("AcceptMessageFrom"),m_nAcceptMessagesFrom);	
	ini.SetString(_T("AwayStateMessage"), CString(m_sAwayStateMessage.Get()));
	//END enkeyDEV(kei-kun) -Messaging preferences-

a843 3
	ini.SetBool(_T("TransferredOnCompleted"), m_bTransferredOnCompleted);
	ini.SetBool(_T("UseDwlPercentage"), m_bUseDwlPercentage);

a853 8
	ini.SetBool("SecureIdent", m_bUseSecureIdent);// change the name in future version to enable it by default

	ini.SetBool(_T("ScanFilter"), m_bScanFilter);
	ini.SetString(_T("URLsForICC"), CString(m_sURLsForICC.Get()));
	ini.SetBool(_T("PreviewSmallBlocks"), m_iPreviewSmallBlocks);
	ini.SetBool(_T("ShowFullFileStatusIcons"), m_bShowFullFileStatusIcons);
	ini.SetBool(_T("ShowPausedGray"), m_bShowPausedGray);
	ini.SetBool(_T("PreviewSmallBlocks"), m_iPreviewSmallBlocks);
a1079 1
	m_nStatsColumnWidth = ini.GetInt(_T("StatsColumnWidth"), 150);
a1080 3
	
	m_sStatsListExpanded.Put(ini.GetString(_T("StatsListExpanded"), _T("")).GetBuffer(0)); // missing entrys get expanded ("" = all expanded)

d1367 14
a1400 1
	// Added by Johnny-B 
a1403 1
	// End Johnny-B
d1411 1
a1411 1
	//////////////////////////////////////////////////////////////////
a1412 1

a1417 1

a1419 1

a1428 9
	/////////////////////////////////////////////////////////////////////////////

	//START enkeyDEV(kei-kun) -Messaging preferences-
	m_nAcceptMessagesFrom = ini.GetInt(_T("AcceptMessageFrom"),1);
	m_nAwayState = false;
	m_sAwayStateMessage.Put(ini.GetString(_T("AwayStateMessage"),_T("")).GetBuffer(0));
	//END enkeyDEV(kei-kun) -Messaging preferences-
	m_prefs->maxmsgsessions=ini.GetInt(_T("MaxMessageSessions"),50);

a1447 3
	m_bTransferredOnCompleted = ini.GetBool(_T("TransferredOnCompleted"), false);
	m_bUseDwlPercentage = ini.GetBool(_T("UseDwlPercentage"), true);

a1458 7
        m_bUseSecureIdent=ini.GetBool("SecureIdent",true);

	m_bScanFilter = ini.GetBool(_T("ScanFilter"),false);
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"),"www.microsoft.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org").GetBuffer(0));
	m_bShowFullFileStatusIcons = ini.GetBool(_T("ShowFullFileStatusIcons"), true);
	m_bShowPausedGray = ini.GetBool(_T("ShowPausedGray"), false);
	m_iPreviewSmallBlocks = ini.GetBool(_T("PreviewSmallBlocks"), false);
@


1.172
log
@Auto-check every 12 hours + added CPU type to stats
@
text
@d909 1
a909 1
	catinif.Format(_T("%sCategory.ini"), m_strConfigDir);
@


1.171
log
@Ability to turn off auto-check for new version
@
text
@d768 1
d1372 1
@


1.170
log
@Fix for SLS outdate after 0 days
@
text
@d766 3
d1368 3
@


1.169
log
@Formatting, comments, and name changes.
@
text
@d1134 2
@


1.168
log
@*** empty log message ***
@
text
@a872 1
	// DropF START - Keyboard Shortcuts
a890 1
	// DropF END - Keyboard Shortcuts
d894 1
a894 1
	// eklmn: now file is close, so we can update a stats over SaveStats()
a1485 1
	// DropF START - Keyboard Shortcuts
a1505 1
	// DropF END - Keyboard Shortcuts
d1511 1
a1511 1
	//eklmn: now when file is closed, let's call LoadStats()
@


1.167
log
@Formatting, comments, and name changes.
@
text
@d873 21
d1487 23
@


1.166
log
@Formatting, comments, and name changes.
float => double conversion
@
text
@d535 1
a535 1
	ini.SetInt(_T("Port"), m_nPort);
d778 1
a778 1
	ini.SetInt(_T("Port"),m_prefs->proxy.m_nPort);
d1048 1
a1048 1
	m_nPort = ini.GetInt(_T("Port"),4662);
d1050 1
a1050 1
	m_uUDPPort = ini.GetInt(_T("UDPPort"),m_nPort + 10);
d1365 1
a1365 1
	m_prefs->proxy.m_nPort = ini.GetInt(_T("Port"),1080);
@


1.165
log
@Removed NNS feature and changed SLS
@
text
@d2436 1
a2436 1
	float tempRate = 0;
d2458 1
a2458 1
		tempRate = (float) g_eMuleApp.m_pDownloadQueue->GetDataRate() / 1024;
d2465 1
a2465 1
		tempRate = (float) g_eMuleApp.m_pUploadQueue->GetDataRate() / 1024;
d2513 1
a2513 1
	float servocc;
d2574 1
a2574 1
	uint32 servtotal, servfail, servuser, servfile, servtuser, servtfile; float servocc;
@


1.164
log
@Formatting, comments, and name changes.
Completion of download list sorting changes (for now).
Added missing sort on FakeCheck column in search window.
@
text
@a567 1
	ini.SetInt(_T("SLS_RestoreSourcesTime"), m_nSLSRestoreSourcesTime);
d1112 4
a1115 9
	// Original by reCDVst updated by DonGato
	m_nSLSRestoreSourcesTime = ini.GetInt(_T("SLS_RestoreSourcesTime"),7200000);
	if(m_nSLSRestoreSourcesTime < 3600000)
		m_nSLSRestoreSourcesTime = 3600000;

	m_nSLSOutdated = ini.GetInt(_T("SLS_WhenSourcesOutdated"),2);
	if(m_nSLSOutdated > 10)
		m_nSLSOutdated = 10;
	
d1117 4
a1120 4
	if(m_SLSMaxSourcesPerFile > 40)
		m_SLSMaxSourcesPerFile = 40;
	else if(m_SLSMaxSourcesPerFile < 10)
		m_SLSMaxSourcesPerFile = 10;
@


1.163
log
@Formatting, comments, and name changes.
... and a few bug fixes.
@
text
@d1233 1
a1233 1
	m_nSrcSortCol2 = ini.GetInt(_T("2ndSortSourcesCode"),255);
d2612 1
a2612 1
		case Upload:	//Upline Data
d2639 1
a2639 1
		case Download: // Downline Data
a2660 1

a2661 1

@


1.162
log
@Proxy password is now also crypted
@
text
@d536 1
a536 1
	ini.SetInt(_T("UDPPort"), m_nUDPPort);
d1051 1
a1051 1
	m_nUDPPort = ini.GetInt(_T("UDPPort"),m_nPort + 10);
@


1.161
log
@no message
@
text
@d1368 3
a1370 4
	buffer = "";
	m_prefs->proxy.m_strName = ini.GetString(_T("Name"),buffer);
	m_prefs->proxy.m_strPassword = ini.GetString(_T("Password"),buffer);
	m_prefs->proxy.m_strUser = ini.GetString(_T("User"),buffer);
@


1.160
log
@DownloadListCtrl rewrite.
Changed Category ID types to an enumeration.
More async update work.
The usual formatting, comments, and name changes.
@
text
@d739 1
d747 1
d1319 1
d1327 1
d1775 2
d1800 2
d1826 3
d1857 3
@


1.159
log
@Added MMX/AMD/SSE optimized memset [katsyonak]
@
text
@d900 1
a900 1
			catini.SetInt(ixStr,pCat->m_iCatID,_T("General"));
d919 1
a919 1
				catini.SetInt(_T("CategoryID"),pCat->m_iCatID,ixStr);
d1158 1
a1158 1
	CCat::SetAllCatType(ini.GetInt("AllCatType",CAT_ALL));
d1482 1
a1482 1
		CCat::SetAllCatType(CCat::GetCatByIndex(0)->m_iCatID);
d1642 1
a1642 1
	newcat->m_iCatID = CAT_ALL;
d1654 1
a1654 1
		int		catID = 0;
d1657 2
a1658 2
		catID = catini.GetInt(ixStr,-1,"General");
		if (catID == -1)
d1666 1
a1666 1
			newcat->m_strTitle = CCat::GetPredefinedCatTitle(catID,GetLanguageID());
d1672 1
a1672 1
			newcat->m_iCatID = catID;
d1703 1
a1703 1
		newcat->m_iCatID = catini.GetInt(_T("CategoryID"),ix,ixStr);
@


1.158
log
@Formatting, comments, and name changes.
Removed #includes for "memcpy_amd.h".
@
text
@d55 1
a55 1
//	memset(m_prefs,0,sizeof(Preferences_Struct));
d57 1
a57 1
	memset(m_prefsExt,0,sizeof(Preferences_Ext_Struct));
d1516 1
a1516 1
			memset(prefsImport20b,0,sizeof(Preferences_Import20b_Struct));
d1532 1
a1532 1
			memset(prefsImport20a,0,sizeof(Preferences_Import20a_Struct));
d1548 1
a1548 1
			memset(prefsImport19c,0,sizeof(Preferences_Import19c_Struct));
@


1.157
log
@Reinstated ShowFileStatusIcons
@
text
@a27 1
#include "memcpy_amd.h"
@


1.156
log
@FakeCheck for Search Result and Download List (Check and Report ... made by milobac ... merged by DropF ... tested by n@@boleo and me)
@
text
@d1 1
a1 1

d863 1
d867 1
a867 1
        //FakeCheck
d1461 1
@


1.155
log
@Removed option to disable File Status icons
Added old actions to new File Status icons
Removed spamming log from Source Saver
Removed old non used icons from resources
Updated +/- icons with Psy suggestion
@
text
@d864 7
d1462 6
@


1.154
log
@Formatting, comments, and name changes.
@
text
@d1 1
a1 1
//Copyright (C)2002 Merkur ( merkur-@@users.sourceforge.net / http://www.emule-project.net )
a859 1
//	ini.SetString("DateTimeFormat", GetDateTimeFormat());
a860 1

d862 1
a862 3

	//MOREVIT
	ini.SetBool(_T("ShowFullFileStatusIcons"), m_bShowFullFileStatusIcons);
a864 2
	ini.SetBool(_T("PreviewSmallBlocks"), m_iPreviewSmallBlocks);

a1450 1
//	m_sDateTimeFormat.Put(ini.GetString(_T("DateTimeFormat"),"%A, %x, %X").GetBuffer(0));
a1451 1

a1452 3

	//MOREVIT
	m_bShowFullFileStatusIcons = ini.GetBool(_T("ShowFullFileStatusIcons"), true);
a1453 1

a2285 4
	// formatLong dictates the format of the string returned.
	// For example...
	// true: DateTime format from the .ini
	// false: DateTime format from the .ini for the log
d2290 1
a2290 3
		// DonGato: fixed localization of Last reset (old code should be removed if everything is ok)
		//tm		*statsReset;
		//char	strDateReset[128];
a2292 3
		//statsReset = localtime(&lastResetDateTime);
		//strftime(strDateReset, 128, GetDateTimeFormat(), statsReset);
		//returnStr.Format("%s", strDateReset);
@


1.153
log
@Formatting, comments, and name changes.
@
text
@d561 1
a561 1
	ini.SetInt(_T("MaxConnectionsPerFiveSeconds"), m_nMaxConperFive);
d773 7
a779 7
	ini.SetBool(_T("EnablePassword"),m_prefs->proxy.EnablePassword);
	ini.SetBool(_T("EnableProxy"),m_prefs->proxy.UseProxy);
	ini.SetString(_T("Name"),m_prefs->proxy.name);
	ini.SetString(_T("Password"),m_prefs->proxy.password);
	ini.SetString(_T("User"),m_prefs->proxy.user);
	ini.SetInt(_T("Port"),m_prefs->proxy.port);
	ini.SetInt(_T("Type"),m_prefs->proxy.type);
d1080 1
a1080 1
	m_nMaxConperFive = ini.GetInt(_T("MaxConnectionsPerFiveSeconds"),GetDefaultMaxConPerFiveSecs());
d1086 1
a1086 1
	if(m_nMaxConperFive > nMax)
d1088 1
a1088 1
		m_nMaxConperFive = nMax;
d1092 2
a1093 2
		if(m_nMaxConperFive < 5)
			m_nMaxConperFive = 5;
d1361 2
a1362 2
	m_prefs->proxy.EnablePassword = ini.GetBool(_T("EnablePassword"),false);
	m_prefs->proxy.UseProxy = ini.GetBool(_T("EnableProxy"),false);
d1364 5
a1368 5
	m_prefs->proxy.name = ini.GetString(_T("Name"),buffer);
	m_prefs->proxy.password = ini.GetString(_T("Password"),buffer);
	m_prefs->proxy.user = ini.GetString(_T("User"),buffer);
	m_prefs->proxy.port = ini.GetInt(_T("Port"),1080);
	m_prefs->proxy.type = ini.GetInt(_T("Type"),PROXYTYPE_NOPROXY);
@


1.152
log
@Commented old code (let me known if I can remove it)
@
text
@d510 1
a510 1
	CString		fullpath; // i_a
a517 1
//useful!
a614 1
	// Added by enkeyDEV
d628 1
a628 1
	ini.SetString(_T("CommentFilter"), m_sCommentFilter.Get());	//(SyruS) netwolf commentfilter
d630 1
a630 1
	ini.SetBool(_T("DisableRatingIcons"), m_bDisableRatingIcons);	//netwolf: disable icons
d640 1
a640 1
	//	ini.SetBool("IRCAcceptLinks", m_bIRCAcceptLinks);
a656 1
	// DonGato
a700 1
	// EpicStruggle
d706 1
a706 1
	//ini.SetBool("StartNextFile", m_prefs->m_bstartnextfile); //duplicates downloadpausedoncomplete
d738 1
a738 1
	// Barry - Provide a mechanism for all tables to store/retrieve sort order
d860 1
a860 1
	//ini.SetString("DateTimeFormat", GetDateTimeFormat());
d952 2
a953 1
	//--- Quick hack to add version tag to preferences.ini-file and solve the issue with the FlatStatusBar tag...
d981 1
a981 1
		//Cax2 we can add the code to find our version's setting, if the ini file is from a different version...
d1001 1
a1001 1
	CString strDefNick;	// random nick [FoRcHa]
d1007 1
a1007 1
	for(int i = 0; i < 6; i++)
a1231 1
	// DonGato
d1314 1
a1314 1
	// Barry - Provide a mechanism for all tables to store/retrieve sort order
d1457 1
a1457 1
	//m_sDateTimeFormat.Put(ini.GetString(_T("DateTimeFormat"),"%A, %x, %X").GetBuffer(0));
@


1.151
log
@Localization of last reset acted strangely (now really fixed).
Old code must be removed if it's working ok (and some other unneeded code).
@
text
@a0 1

d864 1
a864 1
	ini.SetString("DateTimeFormat", GetDateTimeFormat());
d1461 1
a1461 1
	m_sDateTimeFormat.Put(ini.GetString(_T("DateTimeFormat"),"%A, %x, %X").GetBuffer(0));
@


1.150
log
@URLs for IRC configuration in GUI
@
text
@d2311 3
a2313 2
		tm		*statsReset;
		char	strDateReset[128];
d2315 5
a2319 3
		statsReset = localtime(&lastResetDateTime);
		strftime(strDateReset, 128, GetDateTimeFormat(), statsReset);
		returnStr.Format("%s", strDateReset);
@


1.149
log
@initialization of some variables were skipped
@
text
@d868 2
d1465 1
a1465 1
	m_sURLsForICC.Put(ini.GetString(_T("URLsForICC"),"www.microsoft.com|www.yahoo.com|www.ibm.com|www.army.mil|www.networksolutions.com|www.ripe.net|www.w3.org|").GetBuffer(0));
@


1.148
log
@Official code merge (katsyonak)
@
text
@d2142 1
d2144 1
d2172 1
d2174 1
d2269 2
@


1.147
log
@Customization for Scan Filter.
Fix for preferences toolbar button (take care when you do code renaming to keep the correct values)
@
text
@d872 2
d1468 2
@


1.146
log
@Formatting, comments, and name changes.
@
text
@d866 1
d1459 2
@


1.145
log
@Completed statistics fix (now new values stored in preferences)
@
text
@d2477 2
a2478 2
		if (g_eMuleApp.m_pListenSocket->GetMaxConnectionReached() > 0 ) 
			ini.SetUInt32(_T("ConnMaxConnLimitReached"), g_eMuleApp.m_pListenSocket->GetMaxConnectionReached() + cumConnMaxConnLimitReached);
@


1.144
log
@Some statistics fixes
@
text
@d1990 1
d1995 1
d2000 1
d2005 1
d2104 1
d2109 1
d2116 1
d2121 1
d2375 1
a2376 2
		// ini.SetUInt64(_T("DownOverheadTotalPackets"), 0);
		// ini.SetUInt64(_T("DownOverheadFileReqPackets"), g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadFileRequestPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadSourceExchangePackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadServerPackets() + g_eMuleApp.m_pDownloadQueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
a2378 1
		// -BavarianSnail
d2381 1
d2397 1
d2402 1
@


1.143
log
@Changes in language detection code
@
text
@d2259 7
a2265 2
	//if (!fileex) {time_t	timeNow;time(&timeNow);m_prefs->stat_datetimeLastReset = (__int64) timeNow;}
	
@


1.142
log
@Formatting, comments, and name changes.
@
text
@d1895 1
a1895 1
			switch(nLocalLang) {
d1917 1
a1917 1
					m_nLanguageID = MAKELANGID(nLocalLang,SUBLANG_DEFAULT);
d1922 1
@


1.141
log
@Added Known List to transfer window. Hope no major bug was introduced. Should be tested!
@
text
@d907 1
a907 1
					CCat	*pCat = CCat::GetCatByIndex(ix);
d909 1
a909 1
					ixStr.Format("Cat#%i",ix-CCat::GetNumPredefinedCats()+1);
d911 4
a914 4
					catini.SetString(_T("Title"), pCat->m_strTitle, ixStr);
					catini.SetString(_T("Incoming"), pCat->m_strSavePath, ixStr);
					catini.SetString(_T("Comment"), pCat->m_strComment, ixStr);
					buffer.Format("%lu",pCat->m_crColor,ixStr);
d916 3
a918 3
					catini.SetInt(_T("Priority"), pCat->m_iPriority, ixStr);
					catini.SetString(_T("AutoCat"),pCat->m_strAutoCatExt,ixStr); 
					catini.SetInt(_T("CategoryID"),pCat->m_iCatID,ixStr);
@


1.140
log
@Re-added the view filter menu.
@
text
@d336 2
d367 3
d391 2
d422 3
d446 2
d477 3
d739 3
d750 1
d757 1
d907 1
a907 1
				CCat	*pCat = CCat::GetCatByIndex(ix);
d909 1
a909 1
				ixStr.Format("Cat#%i",ix-CCat::GetNumPredefinedCats()+1);
d911 4
a914 4
				catini.SetString(_T("Title"), pCat->m_strTitle, ixStr);
				catini.SetString(_T("Incoming"), pCat->m_strSavePath, ixStr);
				catini.SetString(_T("Comment"), pCat->m_strComment, ixStr);
				buffer.Format("%lu",pCat->m_crColor,ixStr);
d916 3
a918 3
				catini.SetInt(_T("Priority"), pCat->m_iPriority, ixStr);
				catini.SetString(_T("AutoCat"),pCat->m_strAutoCatExt,ixStr); 
				catini.SetInt(_T("CategoryID"),pCat->m_iCatID,ixStr);
d1310 3
d1321 1
d1328 1
d1625 1
a1625 1
	catinif.Format(_T("%sCategory.ini"),m_strConfigDir);
d1775 2
d1798 2
d1827 3
d1855 3
@


1.139
log
@*** empty log message ***
@
text
@d886 1
a886 1
		{
d890 1
a890 1
			catini.AddCategory(ixStr);
d895 1
a895 1
			catini.SetString(_T("Color"), buffer, ixStr);
d899 2
a904 1
}
a1135 1
#ifdef OLD
a1136 3
#else
	CCat::SetAllCatType(CAT_ALL);
#endif OLD
d1600 1
a1600 1
	catinif.Format(_T("%sCategory.ini"), m_strConfigDir);
@


1.138
log
@Category rewrite with predefined status/media type categories.
@
text
@a1347 1
	SetLanguage();
d1441 2
@


1.137
log
@Changed preferences (added some missing ones)
Updated unpause/clearcomplete when using FileStatus icons
@
text
@d135 1
a135 8
	Category_Struct		*pCategoryToDelete;

	while (!catMap.IsEmpty()) 
	{
		pCategoryToDelete = catMap.GetAt(0); 
		catMap.RemoveAt(0); 
		delete pCategoryToDelete;
	}
d700 2
a701 2
	ini.SetInt(_T("AllCatType"), m_nAllcatType);
	ini.SetBool(_T("ShowInfoOnCatTabs"), m_bShowCatTabInfos);
d867 1
a867 1
	if (GetCatCount() > 1) 
d872 14
a885 2
		catini.SetInt(_T("Count"), catMap.GetCount()-1, _T("General"));
		for (int ix = 1; ix < catMap.GetCount(); ix++)
d887 3
a889 1
			ixStr.Format("Cat#%i", ix);
d891 4
a894 4
			catini.SetString(_T("Title"), catMap.GetAt(ix)->title, ixStr);
			catini.SetString(_T("Incoming"), catMap.GetAt(ix)->incomingpath, ixStr);
			catini.SetString(_T("Comment"), catMap.GetAt(ix)->comment, ixStr);
			buffer.Format("%lu", catMap.GetAt(ix)->color, ixStr);
d896 3
a898 2
			catini.SetInt(_T("Priority"), catMap.GetAt(ix)->prio, ixStr);
			catini.SetString(_T("AutoCat"),catMap.GetAt(ix)->autocat,ixStr); 
d903 1
d1135 6
a1140 2
	m_nAllcatType = ini.GetInt("AllCatType",0);
	m_bShowCatTabInfos = ini.GetBool("ShowInfoOnCatTabs",false);
d1451 1
a1451 1
	if(GetCatCount() == 1) 
d1453 1
a1453 1
		SetAllcatType(0);
d1596 1
a1596 1
	CString		ixStr, catinif;
d1599 3
d1604 2
d1607 10
a1616 9
	// default cat
	Category_Struct* newcat = new Category_Struct;
	sprintf(newcat->title, _T(""));
	sprintf(newcat->incomingpath, _T(""));
	sprintf(newcat->comment, _T(""));
	newcat->prio = 0;
	newcat->color = 0;
	sprintf(newcat->autocat, _T(""));
	AddCat(newcat);
d1622 28
d1656 8
a1663 5
		Category_Struct* newcat = new Category_Struct;
		sprintf(newcat->title, catini.GetString(_T("Title"), _T(""), ixStr));
		sprintf(newcat->incomingpath, catini.GetString(_T("Incoming"), _T(""), ixStr));
		MakeFolderName(newcat->incomingpath);
		if(!IsShareableDirectory(newcat->incomingpath))
d1665 2
a1666 2
			_snprintf(newcat->incomingpath, ARRSIZE(newcat->incomingpath), GetIncomingDir());
			MakeFolderName(newcat->incomingpath);
d1668 8
a1675 5
		sprintf(newcat->comment, catini.GetString(_T("Comment"), _T(""), ixStr));
		newcat->prio = catini.GetInt(_T("Priority"), 0, ixStr);
		sprintf(buffer, catini.GetString(_T("Color"), _T("0"), ixStr));
		newcat->color = _atoi64(buffer);
		sprintf(newcat->autocat, catini.GetString(_T("AutoCat"), _T(""), ixStr));
d1677 2
a1678 2
		AddCat(newcat);
		if(!PathFileExists(newcat->incomingpath)) 
d1680 1
a1680 1
			::CreateDirectory(newcat->incomingpath, 0);
a1940 21
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::RemoveCat(int index)	
{
	if(index >= 0 && index < catMap.GetCount()) 
	{ 
		Category_Struct* delcat;
		delcat = catMap.GetAt(index); 
		catMap.RemoveAt(index); 
		delete delcat;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool CPreferences::MoveCat(UINT from, UINT to)
{
	if(from >= (UINT)catMap.GetCount() || 
		to >= (UINT)catMap.GetCount()+1 || from == to)
	{
		return false;
	}

	Category_Struct* tomove;
a1941 17
	tomove = catMap.GetAt(from);

	if(from < to) 
	{
		catMap.RemoveAt(from);
		catMap.InsertAt(to-1, tomove);
	} 
	else 
	{
		catMap.InsertAt(to, tomove);
		catMap.RemoveAt(from+1);
	}
	
	SaveCats();
	return true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
d2667 1
a2667 1
//	if (!CompareDirectories(strFullPath, GetWebServerDir()))	// ".\eMule\m_pWebServer"
@


1.136
log
@Added accidentally deleted hash marking.
@
text
@a52 4
//	TODO: Temp - MOREVIT
	m_bShowFullFileStatusIcons = true;
	m_bShowPausedGray = false;

d854 4
d1425 4
@


1.135
log
@A little more method factoring, a few name changes, no (intended) logic changes.
@
text
@d118 4
@


1.134
log
@A little more method factoring, a few name changes, no (intended) logic changes.
@
text
@d240 2
a241 2
		m_prefsExt->version=PREFFILE_VERSION;
		m_prefsExt->EmuleWindowPlacement=m_prefs->EmuleWindowPlacement;
d245 1
a245 1
		// v1:- eklmn: bugfix(19): by shutdown force OS flush data direct to disk [SlugFiller]
d448 1
a448 1
{	
a1570 71
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CPreferences::LoadDatPreferences(FILE *pPrefsFile)
{
	fread(m_prefsExt,sizeof(Preferences_Ext_Struct),1,pPrefsFile);

	if (ferror(pPrefsFile))
		SetStandardValues();

//	Import old pref-files
	if (m_prefsExt->version < 20)
	{
		if (m_prefsExt->version > 17)
		{// v0.20b+
			prefsImport20b=new Preferences_Import20b_Struct;
			memset(prefsImport20b,0,sizeof(Preferences_Import20b_Struct));
			fseek(pPrefsFile,0,0);
			fread(prefsImport20b,sizeof(Preferences_Import20b_Struct),1,pPrefsFile);

			md4cpy(&m_prefs->m_userHash,&prefsImport20b->m_userHash);
			m_sIncomingDir.Put(prefsImport20b->incomingdir);
			m_sTempDir.Put(prefsImport20b->tempdir);
			m_sNick.Put(prefsImport20b->nick);

			m_nTotalDownloadedBytes.Put(prefsImport20b->totalDownloadedBytes);
			m_nTotalUploadedBytes.Put(prefsImport20b->totalUploadedBytes);

		}
		else if (m_prefsExt->version > 7)
		{ // v0.20a
			prefsImport20a=new Preferences_Import20a_Struct;
			memset(prefsImport20a,0,sizeof(Preferences_Import20a_Struct));
			fseek(pPrefsFile,0,0);
			fread(prefsImport20a,sizeof(Preferences_Import20a_Struct),1,pPrefsFile);

			md4cpy(&m_prefs->m_userHash,&prefsImport20a->m_userHash);
			m_sIncomingDir.Put(prefsImport20a->incomingdir);
			m_sTempDir.Put(prefsImport20a->tempdir);
			m_sNick.Put(prefsImport20a->nick);

			m_nTotalDownloadedBytes.Put(prefsImport20a->totalDownloaded);
			m_nTotalUploadedBytes.Put(prefsImport20a->totalUploaded);

		}
		else
		{	//v0.19c-
			prefsImport19c=new Preferences_Import19c_Struct;
			memset(prefsImport19c,0,sizeof(Preferences_Import19c_Struct));

			fseek(pPrefsFile,0,0);
			fread(prefsImport19c,sizeof(Preferences_Import19c_Struct),1,pPrefsFile);

			if (m_prefsExt->version<3) {
				CreateUserHash();
				md4cpy(&m_prefs->m_userHash,&m_userHash);
			} 
			else 
				md4cpy(&m_prefs->m_userHash,&prefsImport19c->m_userHash);
			m_sIncomingDir.Put(prefsImport19c->incomingdir);
			m_sTempDir.Put(prefsImport19c->tempdir);
			m_sNick.Put(prefsImport19c->nick);
		}
 	}
	else
	{
		md4cpy(&m_prefs->m_userHash,&m_prefsExt->m_userHash);
		m_prefs->EmuleWindowPlacement=m_prefsExt->EmuleWindowPlacement;
	}
	fclose(pPrefsFile);
	md4cpy(&m_userHash,&m_prefs->m_userHash);
	m_nSmartIdState = 0;
@


1.133
log
@Removed all #ifndef AMDs and consolidated CPU specific behavior in md4cpy() and new method memcpy2() (come up with a better name if you can :P ). Renamed LoadPreferences() to LoadIniPreferences() and separated preferences.dat loading code out into LoadDatPreferences().
@
text
@d75 4
a78 4
	appdir = CString(drive) + dir;	
	configdir = appdir + _T("Config\\");
//	m_strWebServerDir = appdir + _T("WebServer\\");
//	m_strLangDir = appdir + _T("lang\\");
d83 25
a107 22
	if ( PathFileExists(appdir+"adresses.dat")) MoveFile(appdir+"adresses.dat",configdir+"adresses.dat");
	if ( PathFileExists(appdir+"cryptkey.dat")) MoveFile(appdir+"cryptkey.dat",configdir+"cryptkey.dat");
	if ( PathFileExists(appdir+"gui.dat")) MoveFile(appdir+"gui.dat",configdir+"gui.dat");
	if ( PathFileExists(appdir+"IPFilter.dat")) MoveFile(appdir+"IPFilter.dat",configdir+"IPFilter.dat");
	if ( PathFileExists(appdir+"onlinesig.dat")) MoveFile(appdir+"onlinesig.dat",configdir+"onlinesig.dat");
	if ( PathFileExists(appdir+"partperm.dat")) MoveFile(appdir+"partperm.dat",configdir+"partperm.dat");
	if ( PathFileExists(appdir+"preferences.dat")) MoveFile(appdir+"preferences.dat",configdir+"preferences.dat");
	if ( PathFileExists(appdir+"shareddir.dat")) MoveFile(appdir+"shareddir.dat",configdir+"shareddir.dat");
	if ( PathFileExists(appdir+"staticservers.dat")) MoveFile(appdir+"staticservers.dat",configdir+"staticservers.dat");
	if ( PathFileExists(appdir+"tempdir.dat")) MoveFile(appdir+"tempdir.dat",configdir+"tempdir.dat");
	if ( PathFileExists(appdir+"traffic.dat")) MoveFile(appdir+"traffic.dat",configdir+"traffic.dat");
	if ( PathFileExists(appdir+"userhash.dat")) MoveFile(appdir+"userhash.dat",configdir+"userhash.dat");
	if ( PathFileExists(appdir+"webservices.dat")) MoveFile(appdir+"webservices.dat",configdir+"webservices.dat");
	if ( PathFileExists(appdir+"category.ini")) MoveFile(appdir+"category.ini",configdir+"category.ini");
	if ( PathFileExists(appdir+"fileinfo.ini")) MoveFile(appdir+"fileinfo.ini",configdir+"fileinfo.ini");
	if ( PathFileExists(appdir+"preferences.ini")) MoveFile(appdir+"preferences.ini",configdir+"preferences.ini");
	if ( PathFileExists(appdir+"statbkup.ini")) MoveFile(appdir+"statbkup.ini",configdir+"statbkup.ini");
	if ( PathFileExists(appdir+"statbkuptmp.ini")) MoveFile(appdir+"statbkuptmp.ini",configdir+"statbkuptmp.ini");
	if ( PathFileExists(appdir+"clients.met")) MoveFile(appdir+"clients.met",configdir+"clients.met");
	if ( PathFileExists(appdir+"emfriends.met")) MoveFile(appdir+"emfriends.met",configdir+"emfriends.met");
	if ( PathFileExists(appdir+"known.met")) MoveFile(appdir+"known.met",configdir+"known.met");
	if ( PathFileExists(appdir+"server.met")) MoveFile(appdir+"server.met",configdir+"server.met");
d109 1
a109 1
//	Generate a random user hash in 'm_userHash' and copy it to 'm_prefs->m_userHash'.
a112 7
//	Load preferences.dat or set default values	
	CString fullpath;

	fullpath.Format(_T("%spreferences.dat"),configdir);

	FILE* pPrefFile = _tfopen(fullpath,_T("rb"));

d116 1
a116 39
//	If we were unable to open the "preferences.dat"...
	if (!pPrefFile)
	{
		SetStandardValues();
		//if (Ask4RegFix(true)) Ask4RegFix(false);
	}
	else
	{
		LoadDatPreferences(pPrefFile);
	}

	// shared directories	
	fullpath.Format(_T("%sshareddir.dat"),configdir);
	CStdioFile sdirfile;
	if(sdirfile.Open(fullpath,CFile::modeRead))
	{
		CString toadd;
		while (sdirfile.ReadString(toadd))
			shareddir_list.AddHead(toadd);
		sdirfile.Close();
	}

	// start added by InterCeptor (multiple tempdirs) 19.11.02
	// temp directories	
	fullpath.Format(_T("%stempdir.dat"),configdir);
	CStdioFile tdirfile;
	if (tdirfile.Open(fullpath,CFile::modeRead)){
		CString toadd;
		while (tdirfile.ReadString(toadd)){
			if(tempdir_list.Find(toadd) == NULL)
			{
				tempdir_list.AddHead(toadd);
				::CreateDirectory(toadd,0);
			}
		}
		tdirfile.Close();
	}
	
	// end added by InterCeptor (multiple tempdirs) 19.11.02
d118 1
a118 4
	
	
	//m_pServerList adresses
	LoadServerlistAddresses() ;
d120 3
a122 2
	m_userHash[5] = 14;
	m_userHash[14] = 111;
d124 1
a124 1
	//Maverick
d128 1
d132 11
d144 5
a148 1
// Added by Tarod
d151 7
a157 2
	// First we must free list
	adresses_list.RemoveAll() ;
d159 9
a167 10
	CString toadd ;
	CString fullpath = CString(configdir) + _T("adresses.dat") ;
	CStdioFile sdirfile;
	if (sdirfile.Open(fullpath, CFile::modeRead)) {
		adresses_list.RemoveAll() ;
		while (sdirfile.ReadString(toadd)) {
        	// [i_a] allow commented-out entries in the addresses.dat file.
                toadd.TrimLeft();
                if (toadd.GetLength() > 0 && toadd[0] != '#')
			adresses_list.AddHead(toadd) ;
d169 1
a169 1
		sdirfile.Close() ;
d172 6
d179 1
a179 5
void CPreferences::SetStandardValues(){
	// CreateUserHash();
	// Saving HashID 
	CString fullpath;
	fullpath.Format(_T("%suserhash.dat"), configdir) ;
d181 1
a181 1
	FILE* hashfile = _tfopen(fullpath, _T("rb")) ;
d183 4
a186 2
	if (hashfile) { 
		if (!fread(m_userHash, sizeof(m_userHash), 1, hashfile)) {
d189 1
a189 1
		fclose(hashfile) ;
a190 1
	// End of Saving HashID 
d193 2
a194 1
	WINDOWPLACEMENT defaultWPM;
d196 4
a199 2
	defaultWPM.rcNormalPosition.left=10;defaultWPM.rcNormalPosition.top=10;
	defaultWPM.rcNormalPosition.right=700;defaultWPM.rcNormalPosition.bottom=500;
d205 14
d220 1
a220 7
uint16 CPreferences::GetMaxDownload(){
	//dont be a Lam3r :)
	uint16 nMaxUp = GetMaxUpload();
	uint16 nMaxDown = GetMaxDownloadValue();
	if(nMaxUp >= 10 && LimitlessDownload()) // DonGato
		return UNLIMITED;
	if(nMaxUp < 4)
d222 2
a223 1
	return (((nMaxUp < 10) && (nMaxUp * 4 < nMaxDown)) ? nMaxUp * 4 : nMaxDown);
d225 6
d232 1
a232 1
bool CPreferences::Save(){
d234 1
a234 3
	bool error = false;
	CString fullpath;
	fullpath.Format(_T("%spreferences.dat"),configdir);
a235 1
	FILE* pPrefFile = _tfopen(fullpath,_T("wb"));
d238 2
a239 1
	if (pPrefFile){
d244 1
a244 1
		error = fwrite(m_prefsExt,sizeof(Preferences_Ext_Struct),1,pPrefFile);
d246 2
a247 1
		if ( !g_eMuleApp.m_pdlgEmule->IsRunning() ) _commit(_fileno(pPrefFile));
d251 1
a251 1
		error = true;
d253 2
a254 2
	// Saving HashID 	
	fullpath.Format(_T("%suserhash.dat"), configdir) ;
d256 1
a256 1
	FILE* hashfile = _tfopen(fullpath, _T("wb")) ;
d258 7
a264 5
	if (hashfile) {
		error = fwrite(m_prefs->m_userHash, sizeof(m_prefs->m_userHash), 1, hashfile) ;
		// v1:- eklmn: bugfix(19): by shutdown force OS flush data direct to disk [SlugFiller]
		if ( !g_eMuleApp.m_pdlgEmule->IsRunning() ) _commit(_fileno(hashfile));
		fclose(hashfile) ;
d267 1
a267 2
		error = true ;
	// End of Saving HashID
d269 1
a269 1
	SavePreferences();
d271 3
a273 3
	fullpath.Format(_T("%sshareddir.dat"),configdir);
	CStdioFile sdirfile;
	if (sdirfile.Open(fullpath,CFile::modeCreate|CFile::modeWrite)){
d275 6
a280 3
		for (POSITION pos = shareddir_list.GetHeadPosition();pos != 0;shareddir_list.GetNext(pos)){
			sdirfile.WriteString(shareddir_list.GetAt(pos).GetBuffer());
			sdirfile.Write("\n",1);
d282 1
a282 1
		sdirfile.Close();
d285 1
a285 1
		error = true;
d287 11
a297 7
	// start added by InterCeptor (multiple tempdirs) 19.11.02	
	fullpath.Format(_T("%stempdir.dat"),configdir);
	CStdioFile tdirfile;
	if (tdirfile.Open(fullpath,CFile::modeCreate|CFile::modeWrite)){
		for (POSITION pos = tempdir_list.GetHeadPosition();pos != 0;tempdir_list.GetNext(pos)){
			tdirfile.WriteString(tempdir_list.GetAt(pos).GetBuffer());
			tdirfile.Write("\n",1);
d299 1
a299 1
		tdirfile.Close();
d302 3
a304 2
		error = true;
	// end added by InterCeptor (multiple tempdirs) 19.11.02	
d307 2
a308 1
	return error;
d311 1
a311 1
//	CreateUserHash() generates a random 16 byte id in 
d314 1
a314 1
	for (int i = 0;i != 8; i++)
d320 1
a320 1
	//	Mark as emule client. that will be need in later version
d325 18
a342 16
int CPreferences::GetColumnWidth(Table t, int index) const {
	switch(t) {
	case tableDownload:
		return m_prefs->downloadColumnWidths[index];
	case tableUpload:
		return m_prefs->uploadColumnWidths[index];
	case tableQueue:
		return m_prefs->queueColumnWidths[index];
	case tableSearch:
		return m_prefs->searchColumnWidths[index];
	case tableShared:
		return m_prefs->sharedColumnWidths[index];
	case tableServer:
		return m_prefs->serverColumnWidths[index];
	case tableIrc:
		return m_prefs->ircColumnWidths[index];
d346 26
a371 24

void CPreferences::SetColumnWidth(Table t, int index, int width) {
	switch(t) {
	case tableDownload:
		m_prefs->downloadColumnWidths[index] = width;
		break;
	case tableUpload:
		m_prefs->uploadColumnWidths[index] = width;
		break;
	case tableQueue:
		m_prefs->queueColumnWidths[index] = width;
		break;
	case tableSearch:
		m_prefs->searchColumnWidths[index] = width;
		break;
	case tableShared:
		m_prefs->sharedColumnWidths[index] = width;
		break;
	case tableServer:
		m_prefs->serverColumnWidths[index] = width;
		break;
	case tableIrc:
		m_prefs->ircColumnWidths[index] = width;
		break;
d374 19
a392 17

BOOL CPreferences::GetColumnHidden(Table t, int index) const {
	switch(t) {
	case tableDownload:
		return m_prefs->downloadColumnHidden[index];
	case tableUpload:
		return m_prefs->uploadColumnHidden[index];
	case tableQueue:
		return m_prefs->queueColumnHidden[index];
	case tableSearch:
		return m_prefs->searchColumnHidden[index];
	case tableShared:
		return m_prefs->sharedColumnHidden[index];
	case tableServer:
		return m_prefs->serverColumnHidden[index];
	case tableIrc:
		return m_prefs->ircColumnHidden[index];
d396 26
a421 24

void CPreferences::SetColumnHidden(Table t, int index, BOOL bHidden) {
	switch(t) {
	case tableDownload:
		m_prefs->downloadColumnHidden[index] = bHidden;
		break;
	case tableUpload:
		m_prefs->uploadColumnHidden[index] = bHidden;
		break;
	case tableQueue:
		m_prefs->queueColumnHidden[index] = bHidden;
		break;
	case tableSearch:
		m_prefs->searchColumnHidden[index] = bHidden;
		break;
	case tableShared:
		m_prefs->sharedColumnHidden[index] = bHidden;
		break;
	case tableServer:
		m_prefs->serverColumnHidden[index] = bHidden;
		break;
	case tableIrc:
		m_prefs->ircColumnHidden[index] = bHidden;
		break;
d424 19
a442 17

int CPreferences::GetColumnOrder(Table t, int index) const {
	switch(t) {
	case tableDownload:
		return m_prefs->downloadColumnOrder[index];
	case tableUpload:
		return m_prefs->uploadColumnOrder[index];
	case tableQueue:
		return m_prefs->queueColumnOrder[index];
	case tableSearch:
		return m_prefs->searchColumnOrder[index];
	case tableShared:
		return m_prefs->sharedColumnOrder[index];
	case tableServer:
		return m_prefs->serverColumnOrder[index];
	case tableIrc:
		return m_prefs->ircColumnOrder[index];
d446 2
a447 28

void CPreferences::SetColumnOrder(Table t, INT *piOrder) {
	switch(t) {
	case tableDownload:
		memcpy2(m_prefs->downloadColumnOrder, piOrder, sizeof(m_prefs->downloadColumnOrder));
		break;
	case tableUpload:
		memcpy2(m_prefs->uploadColumnOrder, piOrder, sizeof(m_prefs->uploadColumnOrder));
		break;
	case tableQueue:
		memcpy2(m_prefs->queueColumnOrder, piOrder, sizeof(m_prefs->queueColumnOrder));
		break;
	case tableSearch:
		memcpy2(m_prefs->searchColumnOrder, piOrder, sizeof(m_prefs->searchColumnOrder));
		break;
	case tableShared:
		memcpy2(m_prefs->sharedColumnOrder, piOrder, sizeof(m_prefs->sharedColumnOrder));
		break;
	case tableServer:
		memcpy2(m_prefs->serverColumnOrder, piOrder, sizeof(m_prefs->serverColumnOrder));
		break;
	case tableIrc:
		memcpy2(m_prefs->ircColumnOrder, piOrder, sizeof(m_prefs->ircColumnOrder));
		break;
	}
}

CPreferences::~CPreferences()
d449 1
a449 2
	Category_Struct* delcat;
	while(!catMap.IsEmpty()) 
d451 21
a471 3
		delcat = catMap.GetAt(0); 
		catMap.RemoveAt(0); 
		delete delcat;
a472 3

	delete m_prefs;
	delete m_prefsExt;
d498 1
a498 1
void CPreferences::SavePreferences()
d501 5
a505 3
	CString buffer;
	CString fullpath; // i_a
	fullpath.Format(_T("%spreferences.ini"),configdir);
d507 2
a508 1
	CIni ini( fullpath );
d511 1
a511 1
	//useful!
d867 1
a867 1
	catinif.Format(_T("%sCategory.ini"), configdir);
d870 1
a870 1
	if(GetCatCount() > 1) 
d872 2
a873 1
		CIni catini(catinif);
d876 1
a876 1
		for(int ix = 1; ix < catMap.GetCount(); ix++)
d892 3
a894 1
DWORD CPreferences::DefaultStatsColor(int index){
d921 1
a921 1
	strFileName.Format(_T("%spreferences.ini"), configdir);
d950 1
a950 1
		strNewName.Format(_T("%spreferences[%s].ini"), configdir,strPrefsVersion);	
d979 1
a979 1
	buffer.Format(_T("%sIncoming"),appdir);
d983 1
a983 1
	buffer.Format(_T("%sTemp"),appdir);
d987 1
a987 1
	buffer.Format(_T("%sVLC"),appdir);
d1045 1
a1045 1
	m_nMaxConperFive = ini.GetInt(_T("MaxConnectionsPerFiveSeconds"),GetDefaultMaxConperFive());
d1300 1
a1300 1
			m_nStatColors[i] = DefaultStatsColor(i);
d1415 1
a1415 1
	buffer.Format(_T("%sBackup"),appdir);
d1436 135
a1570 1
		SavePreferences();
d1649 1
a1649 1
	catinif.Format(_T("%sCategory.ini"), configdir);
d1694 1
a1694 1
///////////////////////////////////////////////////////////////////////////
d1696 2
a1697 1
uint32 CPreferences::GetLancastIP(){
d1703 4
a1706 3

WORD CPreferences::GetWindowsVersion(){
	if(!bWinVerAlreadyDetected)
d1709 3
a1711 1
		BOOL bIsNTNBased	=	FALSE;
d1713 1
a1713 1
		m_bIsNTBased = bIsNTNBased;
d1717 7
a1723 3

uint16 CPreferences::GetDefaultMaxConperFive(){
	switch (GetWindowsVersion()){
d1744 1
a1744 1

d1746 1
a1746 1
int CPreferences::GetColumnSortItem(Table t) const
d1748 1
a1748 1
	switch(t) 
d1750 1
a1750 1
		case tableDownload:
d1752 1
a1752 1
		case tableUpload:
d1754 1
a1754 1
		case tableQueue:
d1756 1
a1756 1
		case tableSearch:
d1758 1
a1758 1
		case tableShared:
d1760 1
a1760 1
		case tableServer:
d1765 1
a1765 1

d1767 1
a1767 1
bool CPreferences::GetColumnSortAscending(Table t) const
d1769 1
a1769 1
	switch(t) 
d1771 1
a1771 1
		case tableDownload:
d1773 1
a1773 1
		case tableUpload:
d1775 1
a1775 1
		case tableQueue:
d1777 1
a1777 1
		case tableSearch:
d1779 1
a1779 1
		case tableShared:
d1781 1
a1781 1
		case tableServer:
d1786 1
a1786 1

d1788 1
a1788 1
void CPreferences::SetColumnSortItem(Table t, int sortItem)
d1790 1
a1790 1
	switch(t) 
d1792 1
a1792 1
		case tableDownload:
d1795 1
a1795 1
		case tableUpload:
d1798 1
a1798 1
		case tableQueue:
d1801 1
a1801 1
		case tableSearch:
d1804 1
a1804 1
		case tableShared:
d1807 1
a1807 1
		case tableServer:
d1812 1
a1812 1

d1814 1
a1814 1
void CPreferences::SetColumnSortAscending(Table t, bool sortAscending)
d1818 1
a1818 1
		case tableDownload:
d1821 1
a1821 1
		case tableUpload:
d1824 1
a1824 1
		case tableQueue:
d1827 1
a1827 1
		case tableSearch:
d1830 1
a1830 1
		case tableShared:
d1833 1
a1833 1
		case tableServer:
d1838 5
a1842 3

void CPreferences::SetLanguage() {
	switch(m_nLanguageID) {
d1866 2
a1867 1
		default:{
d1940 1
a1940 1

d1945 1
a1945 1

d1951 1
a1951 1

d1962 1
a1962 1

d1989 1
a1989 1

d2068 1
a2068 1

d2085 2
a2086 1
	switch (loadBackUp) {
d2088 1
a2088 1
			fullpath.Format(_T("%spreferences.ini"),configdir);
d2091 1
a2091 1
			fullpath.Format(_T("%sstatbkup.ini"),configdir);
d2102 2
a2103 1
	CIni ini(fullpath);
d2225 1
a2225 1
		sINIBackUp.Format(_T("%sstatbkuptmp.ini"), configdir);
d2284 1
a2284 1

d2309 1
a2309 2


d2311 2
a2312 1
void CPreferences::SaveStats(int bBackUp){
d2324 1
a2324 1
			fullpath.Format(_T("%spreferences.ini"),configdir);
d2327 1
a2327 1
			fullpath.Format(_T("%sstatbkup.ini"),configdir);
d2330 1
a2330 1
			fullpath.Format(_T("%sstatbkuptmp.ini"),configdir);
d2546 1
a2546 1

d2578 4
a2581 5
} // SetRecordStructMembers()


void CPreferences::Add2SessionTransferData(uint8 uClientID, uint16 uClientPort, BOOL bFromPF, EnumTransferType eUpDown, uint32 bytes){

d2646 1
a2646 2


d2656 1
a2656 1
	fullpath.Format(_T("%spreferences.ini"),configdir);
d2668 2
a2669 2
} // SaveCompletedDownloadsStat()

a2670 1

d2697 1
a2697 1

@


1.132
log
@changed back wrongly renamed filename of ipfilter.dat and folder of webserver icons
@
text
@a107 1
	#ifndef AMD
a108 3
	#else
	memcpy_amd(&m_prefs->m_userHash,&m_userHash,16);
	#endif
d118 1
a118 1
	LoadPreferences();
d126 3
a128 85
	else{
		fread(m_prefsExt,sizeof(Preferences_Ext_Struct),1,pPrefFile);
		if (ferror(pPrefFile))
			SetStandardValues();

		// import old pref-files
		if (m_prefsExt->version<20) {


			if (m_prefsExt->version>17) {// v0.20b+
				prefsImport20b=new Preferences_Import20b_Struct;
				memset(prefsImport20b,0,sizeof(Preferences_Import20b_Struct));
				fseek(pPrefFile,0,0);
				fread(prefsImport20b,sizeof(Preferences_Import20b_Struct),1,pPrefFile);

				#ifndef AMD
				md4cpy(&m_prefs->m_userHash,&prefsImport20b->m_userHash);
				#else
				memcpy_amd(&m_prefs->m_userHash,&prefsImport20b->m_userHash,16);
				#endif
				m_sIncomingDir.Put(prefsImport20b->incomingdir);
				m_sTempDir.Put(prefsImport20b->tempdir);
				m_sNick.Put(prefsImport20b->nick);

				m_nTotalDownloadedBytes.Put(prefsImport20b->totalDownloadedBytes);
				m_nTotalUploadedBytes.Put(prefsImport20b->totalUploadedBytes);

			} else if (m_prefsExt->version>7) { // v0.20a
				prefsImport20a=new Preferences_Import20a_Struct;
				memset(prefsImport20a,0,sizeof(Preferences_Import20a_Struct));
				fseek(pPrefFile,0,0);
				fread(prefsImport20a,sizeof(Preferences_Import20a_Struct),1,pPrefFile);

				#ifndef AMD
				md4cpy(&m_prefs->m_userHash,&prefsImport20a->m_userHash);
				#else
				memcpy_amd(&m_prefs->m_userHash,&prefsImport20a->m_userHash,16);
				#endif
				m_sIncomingDir.Put(prefsImport20a->incomingdir);
				m_sTempDir.Put(prefsImport20a->tempdir);
				m_sNick.Put(prefsImport20a->nick);

				m_nTotalDownloadedBytes.Put(prefsImport20a->totalDownloaded);
				m_nTotalUploadedBytes.Put(prefsImport20a->totalUploaded);

			} else {	//v0.19c-
				prefsImport19c=new Preferences_Import19c_Struct;
				memset(prefsImport19c,0,sizeof(Preferences_Import19c_Struct));

				fseek(pPrefFile,0,0);
				fread(prefsImport19c,sizeof(Preferences_Import19c_Struct),1,pPrefFile);

				if (m_prefsExt->version<3) {
					CreateUserHash();
					#ifndef AMD
					md4cpy(&m_prefs->m_userHash,&m_userHash);
					#else
					memcpy_amd(&m_prefs->m_userHash,&m_userHash,16);
					#endif
				} 
				else 
					#ifndef AMD
					md4cpy(&m_prefs->m_userHash,&prefsImport19c->m_userHash);
					#else
					memcpy(&m_prefs->m_userHash,&prefsImport19c->m_userHash,16);
					#endif
				m_sIncomingDir.Put(prefsImport19c->incomingdir);
				m_sTempDir.Put(prefsImport19c->tempdir);
				m_sNick.Put(prefsImport19c->nick);
			}
 		} else {
 			#ifndef AMD
			md4cpy(&m_prefs->m_userHash,&m_prefsExt->m_userHash);
 			#else
 			memcpy_amd(&m_prefs->m_userHash,&m_prefsExt->m_userHash,16);
 			#endif
			m_prefs->EmuleWindowPlacement=m_prefsExt->EmuleWindowPlacement;
		}
		fclose(pPrefFile);
		#ifndef AMD
		md4cpy(&m_userHash,&m_prefs->m_userHash);
		#else
		memcpy_amd(&m_userHash,&m_prefs->m_userHash,16);
		#endif
		m_nSmartIdState = 0;
a211 1
	#ifndef AMD
a212 3
	#else
	memcpy_amd(&m_prefs->m_userHash,&m_userHash,16);
	#endif
a246 1
		#ifndef AMD
a247 3
		#else
		memcpy_amd(&m_prefsExt->m_userHash,&m_prefs->m_userHash,16);
		#endif
d312 1
a312 5
		#ifndef AMD
		memcpy(&m_userHash[i*2],&random,2);
		#else
		memcpy_amd(&m_userHash[i*2],&random,2);
		#endif
a430 27
#ifndef AMD
void CPreferences::SetColumnOrder(Table t, INT *piOrder) {
	switch(t) {
	case tableDownload:
		memcpy(m_prefs->downloadColumnOrder, piOrder, sizeof(m_prefs->downloadColumnOrder));
		break;
	case tableUpload:
		memcpy(m_prefs->uploadColumnOrder, piOrder, sizeof(m_prefs->uploadColumnOrder));
		break;
	case tableQueue:
		memcpy(m_prefs->queueColumnOrder, piOrder, sizeof(m_prefs->queueColumnOrder));
		break;
	case tableSearch:
		memcpy(m_prefs->searchColumnOrder, piOrder, sizeof(m_prefs->searchColumnOrder));
		break;
	case tableShared:
		memcpy(m_prefs->sharedColumnOrder, piOrder, sizeof(m_prefs->sharedColumnOrder));
		break;
	case tableServer:
		memcpy(m_prefs->serverColumnOrder, piOrder, sizeof(m_prefs->serverColumnOrder));
		break;
	case tableIrc:
		memcpy(m_prefs->ircColumnOrder, piOrder, sizeof(m_prefs->ircColumnOrder));
		break;
	}
}
#else
d434 1
a434 1
		memcpy_amd(m_prefs->downloadColumnOrder, piOrder, sizeof(m_prefs->downloadColumnOrder));
d437 1
a437 1
		memcpy_amd(m_prefs->uploadColumnOrder, piOrder, sizeof(m_prefs->uploadColumnOrder));
d440 1
a440 1
		memcpy_amd(m_prefs->queueColumnOrder, piOrder, sizeof(m_prefs->queueColumnOrder));
d443 1
a443 1
		memcpy_amd(m_prefs->searchColumnOrder, piOrder, sizeof(m_prefs->searchColumnOrder));
d446 1
a446 1
		memcpy_amd(m_prefs->sharedColumnOrder, piOrder, sizeof(m_prefs->sharedColumnOrder));
d449 1
a449 1
		memcpy_amd(m_prefs->serverColumnOrder, piOrder, sizeof(m_prefs->serverColumnOrder));
d452 1
a452 1
		memcpy_amd(m_prefs->ircColumnOrder, piOrder, sizeof(m_prefs->ircColumnOrder));
a455 1
#endif
d903 2
a904 2
//	LoadPreferences() loads preferences stored in the "preferences.ini" file.
void CPreferences::LoadPreferences()
d1427 71
@


1.131
log
@More name changes, reinstated CMuleCtrlItem class, moved srcsarevisible from CPartFile to CMuleCtrlItem (where it belongs), added "Show Full Status Icons" and "Show Gray Paused" features with corresponding preferences, modified "SmartOpen" code to make it sticky and to make it work with sources with changing states.
@
text
@d77 1
a77 1
//	m_strWebServerDir = appdir + _T("pWebServer\\");
d86 1
a86 1
	if ( PathFileExists(appdir+"pIPFilter.dat")) MoveFile(appdir+"pIPFilter.dat",configdir+"pIPFilter.dat");
@


1.130
log
@First batch of the threatened name changes. Shouldn't be any logic changes here.
@
text
@d53 4
d77 1
a77 1
//	m_strWebServerDir = appdir + _T("webserver\\");
d86 1
a86 1
	if ( PathFileExists(appdir+"ipfilter.dat")) MoveFile(appdir+"ipfilter.dat",configdir+"ipfilter.dat");
d248 1
a248 1
	//serverlist adresses
d345 1
a345 1
		if ( !theApp.emuledlg->IsRunning() ) _commit(_fileno(pPrefFile));
d359 1
a359 1
		if ( !theApp.emuledlg->IsRunning() ) _commit(_fileno(hashfile));
d1834 1
a1834 1
		if ( theApp.glob_prefs->IsNTBased() )
d2134 1
a2134 1
		theApp.emuledlg->statisticswnd.ShowStatistics();
d2159 2
a2160 2
			sesDownDataClients[(eClientTypes)i] = 0;
			sesUpDataClients[(eClientTypes)i] = 0;
d2239 1
a2239 1
	ini.SetUInt64(_T("TotalDownloadedBytes"), theApp.stat_sessionReceivedBytes+GetTotalDownloaded());
d2268 1
a2268 1
	if (theApp.downloadqueue)
d2270 4
a2273 4
		ini.SetUInt64(_T("DownOverheadTotal"), (uint64)theApp.downloadqueue->GetDownDataOverheadFileRequest()+theApp.downloadqueue->GetDownDataOverheadSourceExchange()+theApp.downloadqueue->GetDownDataOverheadServer()+theApp.downloadqueue->GetDownDataOverheadOther()+GetDownOverheadTotal() );
		ini.SetUInt64(_T("DownOverheadFileReq"), (uint64)theApp.downloadqueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		ini.SetUInt64(_T("DownOverheadSrcEx"), (uint64)theApp.downloadqueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
		ini.SetUInt64(_T("DownOverheadServer"), (uint64)theApp.downloadqueue->GetDownDataOverheadServer()+GetDownOverheadServer() );
d2276 3
a2278 3
		// ini.SetUInt64(_T("DownOverheadFileReqPackets"), theApp.downloadqueue->GetDownDataOverheadFileRequestPackets() + theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + theApp.downloadqueue->GetDownDataOverheadServerPackets() + theApp.downloadqueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		ini.SetUInt64(_T("DownOverheadTotalPackets"), (uint64)theApp.downloadqueue->GetDownDataOverheadFileRequestPackets() + theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + theApp.downloadqueue->GetDownDataOverheadServerPackets() + theApp.downloadqueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets());
		ini.SetUInt64(_T("DownOverheadFileReqPackets"), (uint64)theApp.downloadqueue->GetDownDataOverheadFileRequestPackets() + GetDownOverheadFileReqPackets() );
d2280 2
a2281 2
		ini.SetUInt64(_T("DownOverheadSrcExPackets"), (uint64)theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		ini.SetUInt64(_T("DownOverheadServerPackets"), (uint64)theApp.downloadqueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
d2285 2
a2286 2
	ini.SetUInt64(_T("TotalUploadedBytes"), theApp.stat_sessionSentBytes+GetTotalUploaded() );
	if (theApp.uploadqueue)
d2288 3
a2290 3
		ini.SetInt(_T("UpSuccessfulSessions"), theApp.uploadqueue->GetSuccessfulUpCount()+GetUpSuccessfulSessions());
		ini.SetInt(_T("UpFailedSessions"), theApp.uploadqueue->GetFailedUpCount()+GetUpFailedSessions());
		ini.SetInt(_T("UpAvgTime"), (theApp.uploadqueue->GetAverageUpTime()+GetUpAvgTime())/2);
d2293 8
a2300 8
		ini.SetUInt64(_T("UpOverheadTotal"), (uint64)theApp.uploadqueue->GetUpDataOverheadFileRequest() + theApp.uploadqueue->GetUpDataOverheadSourceExchange() + theApp.uploadqueue->GetUpDataOverheadServer() + theApp.uploadqueue->GetUpDataOverheadOther() + GetUpOverheadTotal());
		ini.SetUInt64(_T("UpOverheadFileReq"), (uint64)theApp.uploadqueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		ini.SetUInt64(_T("UpOverheadSrcEx"), (uint64)theApp.uploadqueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		ini.SetUInt64(_T("UpOverheadServer"), (uint64)theApp.uploadqueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		ini.SetUInt64(_T("UpOverheadTotalPackets"), (uint64)theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + theApp.uploadqueue->GetUpDataOverheadServerPackets() + theApp.uploadqueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets());
		ini.SetUInt64(_T("UpOverheadFileReqPackets"), (uint64)theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets());
		ini.SetUInt64(_T("UpOverheadSrcExPackets"), (uint64)theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		ini.SetUInt64(_T("UpOverheadServerPackets"), (uint64)theApp.uploadqueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
d2322 1
a2322 1
	if(theApp.emuledlg)
d2324 1
a2324 1
		if (theApp.emuledlg->statisticswnd)
d2327 1
a2327 1
			tempRate = theApp.emuledlg->statisticswnd.GetAvgDownloadRate(AVG_TOTAL);
d2333 1
a2333 1
			tempRate = theApp.emuledlg->statisticswnd.GetAvgUploadRate(AVG_TOTAL);
d2340 1
a2340 1
	if (theApp.downloadqueue)
d2343 1
a2343 1
		tempRate = (float) theApp.downloadqueue->GetDataRate() / 1024;
d2348 1
a2348 1
	if (theApp.uploadqueue)
d2350 1
a2350 1
		tempRate = (float) theApp.uploadqueue->GetDataRate() / 1024;
d2356 1
a2356 1
	uint64 timeseconds = (uint64)(::GetTickCount()-theApp.stat_starttime)/1000;
d2360 2
a2361 2
	if (theApp.stat_reconnects>0) 
		ini.SetWORD(_T("ConnNumReconnects"), theApp.stat_reconnects - 1 + GetConnNumReconnects());
d2366 1
a2366 1
	if (theApp.serverconnect)
d2369 2
a2370 2
		if (theApp.serverconnect->IsConnected())
			ini.SetUInt32(_T("ConnAvgConnections"), (uint32)(theApp.emuledlg->statisticswnd.GetAverageConnections()+cumConnAvgConnections)/2);
d2372 1
a2372 1
	if (theApp.listensocket)
d2375 2
a2376 2
		if (theApp.listensocket->GetMaxConnectionReached() > 0 ) 
			ini.SetUInt32(_T("ConnMaxConnLimitReached"), theApp.listensocket->GetMaxConnectionReached() + cumConnMaxConnLimitReached);
d2380 1
a2380 1
	if(theApp.emuledlg)
d2382 1
a2382 1
		if (theApp.emuledlg->statisticswnd)
d2385 2
a2386 2
			if (theApp.emuledlg->statisticswnd.GetPeakConnections()>cumConnPeakConnections)
				cumConnPeakConnections = theApp.emuledlg->statisticswnd.GetPeakConnections();
d2390 4
a2393 4
			ini.SetInt(_T("ConnTransferTime"), GetConnTransferTime() + theApp.emuledlg->statisticswnd.GetTransferTime());
			ini.SetInt(_T("ConnUploadTime"), GetConnUploadTime() + theApp.emuledlg->statisticswnd.GetUploadTime());
			ini.SetInt(_T("ConnDownloadTime"), GetConnDownloadTime() + theApp.emuledlg->statisticswnd.GetDownloadTime());
			ini.SetInt(_T("ConnServerDuration"), GetConnServerDuration() + theApp.emuledlg->statisticswnd.GetServerDuration());		
d2399 1
a2399 1
	if (theApp.serverlist)
d2401 1
a2401 1
		theApp.serverlist->GetStatus( servtotal, servfail, servuser, servfile, servtuser, servtfile, servocc );
d2411 1
a2411 1
	if (theApp.sharedfiles)
d2414 2
a2415 2
		if (theApp.sharedfiles->GetCount()>cumSharedMostFilesShared)	
			cumSharedMostFilesShared = theApp.sharedfiles->GetCount();
d2418 1
a2418 1
		uint64 allsize=theApp.sharedfiles->GetDatasize(bytesLargestFile);
d2423 2
a2424 2
		if (theApp.sharedfiles->GetCount() != 0) {
			uint64 tempint = allsize/theApp.sharedfiles->GetCount();
d2460 1
a2460 1
	theApp.serverlist->GetStatus( servtotal, servfail, servuser, servfile, servtuser, servtfile, servocc );
d2466 1
a2466 1
	if (theApp.sharedfiles->GetCount()>cumSharedMostFilesShared) cumSharedMostFilesShared = theApp.sharedfiles->GetCount();
d2468 1
a2468 1
	uint64 allsize=theApp.sharedfiles->GetDatasize(bytesLargestFile);
d2471 1
a2471 1
	if (theApp.sharedfiles->GetCount() != 0) 
d2473 1
a2473 1
		uint64 tempint = allsize/theApp.sharedfiles->GetCount();
d2479 1
a2479 1
void CPreferences::Add2SessionTransferData(uint8 uClientID, uint16 uClientPort, BOOL bFromPF, eTransfer eUpDown, uint32 bytes){
d2510 1
a2510 1
			theApp.UpdateSentBytes(bytes);
d2540 1
a2540 1
			theApp.UpdateReceivedBytes(bytes);
d2616 1
a2616 1
//	if (!CompareDirectories(strFullPath, GetWebServerDir()))	// ".\eMule\webserver"
@


1.129
log
@number of successful downloads wasn't saved to ini
@
text
@d46 4
a49 1
CPreferences::CPreferences(){
a51 4
	prefs = new Preferences_Struct_DONTUSE;
//	memset(prefs,0,sizeof(Preferences_Struct));
	prefsExt=new Preferences_Ext_Struct;
	memset(prefsExt,0,sizeof(Preferences_Ext_Struct));
d53 9
a61 1
	//get application start directory
d63 1
d68 1
d102 1
d105 1
a105 1
	md4cpy(&prefs->userhash,&userhash);
d107 1
a107 1
	memcpy_amd(&prefs->userhash,&userhash,16);
d110 1
a110 1
	// load preferences.dat or set standart values	
d112 1
a113 1
	FILE* preffile = _tfopen(fullpath,_T("rb"));
d115 3
d119 5
a123 2
	if (!preffile){
		SetStandartValues();
d127 3
a129 3
		fread(prefsExt,sizeof(Preferences_Ext_Struct),1,preffile);
		if (ferror(preffile))
			SetStandartValues();
d132 1
a132 1
		if (prefsExt->version<20) {
d135 1
a135 1
			if (prefsExt->version>17) {// v0.20b+
d138 2
a139 2
				fseek(preffile,0,0);
				fread(prefsImport20b,sizeof(Preferences_Import20b_Struct),1,preffile);
d142 1
a142 1
				md4cpy(&prefs->userhash,&prefsImport20b->userhash);
d144 1
a144 1
				memcpy_amd(&prefs->userhash,&prefsImport20b->userhash,16);
d153 1
a153 1
			} else if (prefsExt->version>7) { // v0.20a
d156 2
a157 2
				fseek(preffile,0,0);
				fread(prefsImport20a,sizeof(Preferences_Import20a_Struct),1,preffile);
d160 1
a160 1
				md4cpy(&prefs->userhash,&prefsImport20a->userhash);
d162 1
a162 1
				memcpy_amd(&prefs->userhash,&prefsImport20a->userhash,16);
d175 2
a176 2
				fseek(preffile,0,0);
				fread(prefsImport19c,sizeof(Preferences_Import19c_Struct),1,preffile);
d178 1
a178 1
				if (prefsExt->version<3) {
d181 1
a181 1
					md4cpy(&prefs->userhash,&userhash);
d183 1
a183 1
					memcpy_amd(&prefs->userhash,&userhash,16);
d188 1
a188 1
					md4cpy(&prefs->userhash,&prefsImport19c->userhash);
d190 1
a190 1
					memcpy(&prefs->userhash,&prefsImport19c->userhash,16);
d198 1
a198 1
			md4cpy(&prefs->userhash,&prefsExt->userhash);
d200 1
a200 1
 			memcpy_amd(&prefs->userhash,&prefsExt->userhash,16);
d202 1
a202 1
			prefs->EmuleWindowPlacement=prefsExt->EmuleWindowPlacement;
d204 1
a204 1
		fclose(preffile);
d206 1
a206 1
		md4cpy(&userhash,&prefs->userhash);
d208 1
a208 1
		memcpy_amd(&userhash,&prefs->userhash,16);
d247 2
a248 2
	userhash[5] = 14;
	userhash[14] = 111;
d279 1
a279 1
void CPreferences::SetStandartValues(){
d288 1
a288 1
		if (!fread(userhash, sizeof(userhash), 1, hashfile)) {
d295 1
a295 1
	md4cpy(&prefs->userhash,&userhash);
d297 1
a297 1
	memcpy_amd(&prefs->userhash,&userhash,16);
d305 1
a305 1
	prefs->EmuleWindowPlacement=defaultWPM;
d327 2
a328 2
	FILE* preffile = _tfopen(fullpath,_T("wb"));
	prefsExt->version = PREFFILE_VERSION;
d330 3
a332 3
	if (preffile){
		prefsExt->version=PREFFILE_VERSION;
		prefsExt->EmuleWindowPlacement=prefs->EmuleWindowPlacement;
d334 1
a334 1
		md4cpy(&prefsExt->userhash,&prefs->userhash);
d336 1
a336 1
		memcpy_amd(&prefsExt->userhash,&prefs->userhash,16);
d339 1
a339 1
		error = fwrite(prefsExt,sizeof(Preferences_Ext_Struct),1,preffile);
d341 2
a342 2
		if ( !theApp.emuledlg->IsRunning() ) _commit(_fileno(preffile));
		fclose(preffile);
d353 1
a353 1
		error = fwrite(prefs->userhash, sizeof(prefs->userhash), 1, hashfile) ;
d394 7
a401 3
void CPreferences::CreateUserHash(){
	for (int i = 0;i != 8; i++){ 
		uint16	random = rand();
d403 1
a403 1
		memcpy(&userhash[i*2],&random,2);
d405 1
a405 1
		memcpy_amd(&userhash[i*2],&random,2);
d408 3
a410 3
	// mark as emule client. that will be need in later version
	userhash[5] = 14;
	userhash[14] = 111;
d412 1
a412 1

d416 1
a416 1
		return prefs->downloadColumnWidths[index];
d418 1
a418 1
		return prefs->uploadColumnWidths[index];
d420 1
a420 1
		return prefs->queueColumnWidths[index];
d422 1
a422 1
		return prefs->searchColumnWidths[index];
d424 1
a424 1
		return prefs->sharedColumnWidths[index];
d426 1
a426 1
		return prefs->serverColumnWidths[index];
d428 1
a428 1
		return prefs->ircColumnWidths[index];
d436 1
a436 1
		prefs->downloadColumnWidths[index] = width;
d439 1
a439 1
		prefs->uploadColumnWidths[index] = width;
d442 1
a442 1
		prefs->queueColumnWidths[index] = width;
d445 1
a445 1
		prefs->searchColumnWidths[index] = width;
d448 1
a448 1
		prefs->sharedColumnWidths[index] = width;
d451 1
a451 1
		prefs->serverColumnWidths[index] = width;
d454 1
a454 1
		prefs->ircColumnWidths[index] = width;
d462 1
a462 1
		return prefs->downloadColumnHidden[index];
d464 1
a464 1
		return prefs->uploadColumnHidden[index];
d466 1
a466 1
		return prefs->queueColumnHidden[index];
d468 1
a468 1
		return prefs->searchColumnHidden[index];
d470 1
a470 1
		return prefs->sharedColumnHidden[index];
d472 1
a472 1
		return prefs->serverColumnHidden[index];
d474 1
a474 1
		return prefs->ircColumnHidden[index];
d482 1
a482 1
		prefs->downloadColumnHidden[index] = bHidden;
d485 1
a485 1
		prefs->uploadColumnHidden[index] = bHidden;
d488 1
a488 1
		prefs->queueColumnHidden[index] = bHidden;
d491 1
a491 1
		prefs->searchColumnHidden[index] = bHidden;
d494 1
a494 1
		prefs->sharedColumnHidden[index] = bHidden;
d497 1
a497 1
		prefs->serverColumnHidden[index] = bHidden;
d500 1
a500 1
		prefs->ircColumnHidden[index] = bHidden;
d508 1
a508 1
		return prefs->downloadColumnOrder[index];
d510 1
a510 1
		return prefs->uploadColumnOrder[index];
d512 1
a512 1
		return prefs->queueColumnOrder[index];
d514 1
a514 1
		return prefs->searchColumnOrder[index];
d516 1
a516 1
		return prefs->sharedColumnOrder[index];
d518 1
a518 1
		return prefs->serverColumnOrder[index];
d520 1
a520 1
		return prefs->ircColumnOrder[index];
d529 1
a529 1
		memcpy(prefs->downloadColumnOrder, piOrder, sizeof(prefs->downloadColumnOrder));
d532 1
a532 1
		memcpy(prefs->uploadColumnOrder, piOrder, sizeof(prefs->uploadColumnOrder));
d535 1
a535 1
		memcpy(prefs->queueColumnOrder, piOrder, sizeof(prefs->queueColumnOrder));
d538 1
a538 1
		memcpy(prefs->searchColumnOrder, piOrder, sizeof(prefs->searchColumnOrder));
d541 1
a541 1
		memcpy(prefs->sharedColumnOrder, piOrder, sizeof(prefs->sharedColumnOrder));
d544 1
a544 1
		memcpy(prefs->serverColumnOrder, piOrder, sizeof(prefs->serverColumnOrder));
d547 1
a547 1
		memcpy(prefs->ircColumnOrder, piOrder, sizeof(prefs->ircColumnOrder));
d555 1
a555 1
		memcpy_amd(prefs->downloadColumnOrder, piOrder, sizeof(prefs->downloadColumnOrder));
d558 1
a558 1
		memcpy_amd(prefs->uploadColumnOrder, piOrder, sizeof(prefs->uploadColumnOrder));
d561 1
a561 1
		memcpy_amd(prefs->queueColumnOrder, piOrder, sizeof(prefs->queueColumnOrder));
d564 1
a564 1
		memcpy_amd(prefs->searchColumnOrder, piOrder, sizeof(prefs->searchColumnOrder));
d567 1
a567 1
		memcpy_amd(prefs->sharedColumnOrder, piOrder, sizeof(prefs->sharedColumnOrder));
d570 1
a570 1
		memcpy_amd(prefs->serverColumnOrder, piOrder, sizeof(prefs->serverColumnOrder));
d573 1
a573 1
		memcpy_amd(prefs->ircColumnOrder, piOrder, sizeof(prefs->ircColumnOrder));
d589 2
a590 2
	delete prefs;
	delete prefsExt;
d592 7
d600 1
a600 2
int CPreferences::GetRecommendedMaxConnections() {
	int iRealMax = ::GetMaxConnections();
d604 1
d608 1
d612 1
d615 1
a615 1

d657 1
a657 1
	//ini.SetInt(_T("RemoteQueueLimit"), prefs->remotequeuelimit); //remote QR 
d717 1
a717 1
	ini.SetBool(_T("ShowRatesOnTitle"),prefs->showRatesInTitle);
d721 1
a721 1
    ini.SetBool(_T("GlobalSearch"), prefs->globalsearch);  
d737 1
a737 1
	ini.SetString(_T("MessageFilter"),prefs->messageFilter);
d739 1
a739 1
	ini.SetString(_T("TxtEditor"),prefs->TxtEditor);
d778 1
a778 1
	ini.SetBool(_T("BugReport"), prefs->BugReport);
d790 1
a790 1
	ini.SetBool(_T("ShowAverageDatarate"),m_bShowAverageDatarate);
d818 1
a818 1
	//ini.SetBool("StartNextFile", prefs->m_bstartnextfile); //duplicates downloadpausedoncomplete
d822 1
a822 1
	ini.SetInt(_T("AllcatType"), m_nAllcatType);
d825 21
a845 21
	ini.SetArray(prefs->downloadColumnWidths, ELEMENT_COUNT(prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SetArray(prefs->downloadColumnHidden, ELEMENT_COUNT(prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SetArray(prefs->downloadColumnOrder, ELEMENT_COUNT(prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SetArray(prefs->uploadColumnWidths, ELEMENT_COUNT(prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.SetArray(prefs->uploadColumnHidden, ELEMENT_COUNT(prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.SetArray(prefs->uploadColumnOrder, ELEMENT_COUNT(prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.SetArray(prefs->queueColumnWidths, ELEMENT_COUNT(prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.SetArray(prefs->queueColumnHidden, ELEMENT_COUNT(prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.SetArray(prefs->queueColumnOrder, ELEMENT_COUNT(prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.SetArray(prefs->searchColumnWidths, ELEMENT_COUNT(prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.SetArray(prefs->searchColumnHidden, ELEMENT_COUNT(prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.SetArray(prefs->searchColumnOrder, ELEMENT_COUNT(prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.SetArray(prefs->sharedColumnWidths, ELEMENT_COUNT(prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.SetArray(prefs->sharedColumnHidden, ELEMENT_COUNT(prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.SetArray(prefs->sharedColumnOrder, ELEMENT_COUNT(prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.SetArray(prefs->serverColumnWidths, ELEMENT_COUNT(prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.SetArray(prefs->serverColumnHidden, ELEMENT_COUNT(prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.SetArray(prefs->serverColumnOrder, ELEMENT_COUNT(prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.SetArray(prefs->ircColumnWidths, ELEMENT_COUNT(prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.SetArray(prefs->ircColumnHidden, ELEMENT_COUNT(prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.SetArray(prefs->ircColumnOrder, ELEMENT_COUNT(prefs->ircColumnOrder), _T("IrcColumnOrder"));
d848 12
a859 12
	ini.SetInt(_T("TableSortItemDownload"), prefs->tableSortItemDownload);
	ini.SetInt(_T("TableSortItemUpload"), prefs->tableSortItemUpload);
	ini.SetInt(_T("TableSortItemQueue"), prefs->tableSortItemQueue);
	ini.SetInt(_T("TableSortItemSearch"), prefs->tableSortItemSearch);
	ini.SetInt(_T("TableSortItemShared"), prefs->tableSortItemShared);
	ini.SetInt(_T("TableSortItemServer"), prefs->tableSortItemServer);
	ini.SetBool(_T("TableSortAscendingDownload"), prefs->tableSortAscendingDownload);
	ini.SetBool(_T("TableSortAscendingUpload"), prefs->tableSortAscendingUpload);
	ini.SetBool(_T("TableSortAscendingQueue"), prefs->tableSortAscendingQueue);
	ini.SetBool(_T("TableSortAscendingSearch"), prefs->tableSortAscendingSearch);
	ini.SetBool(_T("TableSortAscendingShared"), prefs->tableSortAscendingShared);
	ini.SetBool(_T("TableSortAscendingServer"), prefs->tableSortAscendingServer);
d874 1
a874 1
	CString hex_hash = FileHashToString(prefs->A4AF_file_hash);
d880 7
a886 7
	ini.SetBool(_T("EnablePassword"),prefs->proxy.EnablePassword);
	ini.SetBool(_T("EnableProxy"),prefs->proxy.UseProxy);
	ini.SetString(_T("Name"),prefs->proxy.name);
	ini.SetString(_T("Password"),prefs->proxy.password);
	ini.SetString(_T("User"),prefs->proxy.user);
	ini.SetInt(_T("Port"),prefs->proxy.port);
	ini.SetInt(_T("Type"),prefs->proxy.type);
d903 1
a903 1
	ini.SetString(_T("WebTemplateFile"),prefs->m_sTemplateFile);	// netwolf
d908 2
a909 2
	ini.SetBool("Enabled", prefs->m_bMMEnabled);
	ini.SetInt("Port", prefs->m_nMMPort);
d976 1
a976 1

d980 3
a982 2
	CString catinif, ixStr, buffer;
	catinif.Format(_T("%scategory.ini"), configdir);
d1005 1
a1005 1

d1024 4
a1027 2

void CPreferences::LoadPreferences(){
d1032 1
d1034 1
d1036 1
d1038 1
d1040 1
d1046 1
d1057 1
d1059 3
d1076 2
d1079 1
d1083 1
d1090 1
d1094 1
d1098 1
d1101 2
d1105 2
d1108 1
d1110 1
d1114 1
d1118 1
d1120 1
d1122 1
d1124 1
d1126 1
d1128 1
d1134 1
d1138 1
d1158 1
a1158 1
	prefs->showRatesInTitle=ini.GetBool(_T("ShowRatesOnTitle"),false);
d1162 3
a1164 1
	if(m_nMaxConperFive > nMax) {
d1166 3
a1168 1
	} else {
d1234 1
a1234 1
	m_nAllcatType = ini.GetInt("AllcatType",0);
d1250 1
a1250 1
	prefs->globalsearch = ini.GetBool(_T("GlobalSearch"),true); 
d1292 2
a1293 2
	prefs->TxtEditor = ini.GetString(_T("TxtEditor"),_T("notepad.exe"));
	prefs->messageFilter=ini.GetString(_T("MessageFilter"),_T("Your client has an infinite queue|http://www.chez.com/theworld/"));
d1327 1
a1327 1
	prefs->BugReport = ini.GetBool(_T("BugReport"),false);
d1342 1
a1342 1
	m_bShowAverageDatarate = ini.GetBool(_T("ShowAverageDatarate"),true);
d1367 21
a1387 21
	ini.GetArray(prefs->downloadColumnWidths, ELEMENT_COUNT(prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.GetArray(prefs->downloadColumnHidden, ELEMENT_COUNT(prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.GetArray(prefs->downloadColumnOrder, ELEMENT_COUNT(prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.GetArray(prefs->uploadColumnWidths, ELEMENT_COUNT(prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.GetArray(prefs->uploadColumnHidden, ELEMENT_COUNT(prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.GetArray(prefs->uploadColumnOrder, ELEMENT_COUNT(prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.GetArray(prefs->queueColumnWidths, ELEMENT_COUNT(prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.GetArray(prefs->queueColumnHidden, ELEMENT_COUNT(prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.GetArray(prefs->queueColumnOrder, ELEMENT_COUNT(prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.GetArray(prefs->searchColumnWidths, ELEMENT_COUNT(prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.GetArray(prefs->searchColumnHidden, ELEMENT_COUNT(prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.GetArray(prefs->searchColumnOrder, ELEMENT_COUNT(prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.GetArray(prefs->sharedColumnWidths, ELEMENT_COUNT(prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.GetArray(prefs->sharedColumnHidden, ELEMENT_COUNT(prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.GetArray(prefs->sharedColumnOrder, ELEMENT_COUNT(prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.GetArray(prefs->serverColumnWidths, ELEMENT_COUNT(prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.GetArray(prefs->serverColumnHidden, ELEMENT_COUNT(prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.GetArray(prefs->serverColumnOrder, ELEMENT_COUNT(prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.GetArray(prefs->ircColumnWidths, ELEMENT_COUNT(prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.GetArray(prefs->ircColumnHidden, ELEMENT_COUNT(prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.GetArray(prefs->ircColumnOrder, ELEMENT_COUNT(prefs->ircColumnOrder), _T("IrcColumnOrder"));
d1390 12
a1401 12
	prefs->tableSortItemDownload = ini.GetInt(_T("TableSortItemDownload"), 0);
	prefs->tableSortItemUpload = ini.GetInt(_T("TableSortItemUpload"), 0);
	prefs->tableSortItemQueue = ini.GetInt(_T("TableSortItemQueue"), 0);
	prefs->tableSortItemSearch = ini.GetInt(_T("TableSortItemSearch"), 0);
	prefs->tableSortItemShared = ini.GetInt(_T("TableSortItemShared"), 0);
	prefs->tableSortItemServer = ini.GetInt(_T("TableSortItemServer"), 0);
	prefs->tableSortAscendingDownload = ini.GetBool(_T("TableSortAscendingDownload"), true);
	prefs->tableSortAscendingUpload = ini.GetBool(_T("TableSortAscendingUpload"), true);
	prefs->tableSortAscendingQueue = ini.GetBool(_T("TableSortAscendingQueue"), true);
	prefs->tableSortAscendingSearch = ini.GetBool(_T("TableSortAscendingSearch"), true);
	prefs->tableSortAscendingShared = ini.GetBool(_T("TableSortAscendingShared"), true);
	prefs->tableSortAscendingServer = ini.GetBool(_T("TableSortAscendingServer"), true);
d1429 1
a1429 1
		prefs->A4AF_file_hash[i] = (uchar)byte;
d1434 2
a1435 2
	prefs->proxy.EnablePassword = ini.GetBool(_T("EnablePassword"),false);
	prefs->proxy.UseProxy = ini.GetBool(_T("EnableProxy"),false);
d1437 5
a1441 5
	prefs->proxy.name = ini.GetString(_T("Name"),buffer);
	prefs->proxy.password = ini.GetString(_T("Password"),buffer);
	prefs->proxy.user = ini.GetString(_T("User"),buffer);
	prefs->proxy.port = ini.GetInt(_T("Port"),1080);
	prefs->proxy.type = ini.GetInt(_T("Type"),PROXYTYPE_NOPROXY);
d1459 1
a1459 1
	sprintf(prefs->m_sTemplateFile,"%s",ini.GetString(_T("WebTemplateFile"),_T("eMule.tmpl")));	// netwolf
d1463 3
a1465 3
	sprintf(prefs->m_sMMPassword,"%s",ini.GetString("Password", ""));
	prefs->m_bMMEnabled=ini.GetBool("Enabled", false);
	prefs->m_nMMPort = ini.GetInt("Port", 80);
d1494 1
a1494 1
	prefs->maxmsgsessions=ini.GetInt(_T("MaxMessageSessions"),50);
d1540 1
d1550 1
a1550 1

d1553 4
a1556 2
	CString ixStr, catinif;
	catinif.Format(_T("%scategory.ini"), configdir);
a1557 1
	char buffer[100];
d1582 1
a1582 1
		MakeFoldername(newcat->incomingpath);
d1586 1
a1586 1
			MakeFoldername(newcat->incomingpath);
d1601 1
a1601 1

d1650 1
a1650 1
			return prefs->tableSortItemDownload;
d1652 1
a1652 1
			return prefs->tableSortItemUpload;
d1654 1
a1654 1
			return prefs->tableSortItemQueue;
d1656 1
a1656 1
			return prefs->tableSortItemSearch;
d1658 1
a1658 1
			return prefs->tableSortItemShared;
d1660 1
a1660 1
			return prefs->tableSortItemServer;
d1671 1
a1671 1
			return prefs->tableSortAscendingDownload;
d1673 1
a1673 1
			return prefs->tableSortAscendingUpload;
d1675 1
a1675 1
			return prefs->tableSortAscendingQueue;
d1677 1
a1677 1
			return prefs->tableSortAscendingSearch;
d1679 1
a1679 1
			return prefs->tableSortAscendingShared;
d1681 1
a1681 1
			return prefs->tableSortAscendingServer;
d1692 1
a1692 1
			prefs->tableSortItemDownload = sortItem;
d1695 1
a1695 1
			prefs->tableSortItemUpload = sortItem;
d1698 1
a1698 1
			prefs->tableSortItemQueue = sortItem;
d1701 1
a1701 1
			prefs->tableSortItemSearch = sortItem;
d1704 1
a1704 1
			prefs->tableSortItemShared = sortItem;
d1707 1
a1707 1
			prefs->tableSortItemServer = sortItem;
d1718 1
a1718 1
			prefs->tableSortAscendingDownload = sortAscending;
d1721 1
a1721 1
			prefs->tableSortAscendingUpload = sortAscending;
d1724 1
a1724 1
			prefs->tableSortAscendingQueue = sortAscending;
d1727 1
a1727 1
			prefs->tableSortAscendingSearch = sortAscending;
d1730 1
a1730 1
			prefs->tableSortAscendingShared = sortAscending;
d1733 1
a1733 1
			prefs->tableSortAscendingServer = sortAscending;
d2167 1
a2167 1
	//if (!fileex) {time_t	timeNow;time(&timeNow);prefs->stat_datetimeLastReset = (__int64) timeNow;}
d2284 1
a2284 1
		ini.SetInt(_T("UpSuccessfulSessions"), theApp.uploadqueue->GetSuccessfullUpCount()+GetUpSuccessfulSessions());
d2339 1
a2339 1
		tempRate = (float) theApp.downloadqueue->GetDatarate() / 1024;
d2346 1
a2346 1
		tempRate = (float) theApp.uploadqueue->GetDatarate() / 1024;
d2448 1
a2448 1
	// the current values are greater, the corresponding member of prefs will be updated.
d2576 1
d2586 1
a2586 1
	// skip sharing of several special eMule folders
d2619 1
@


1.128
log
@fixed spelling of ini entry for correct loading of overhead values
@
text
@d2490 2
a2491 1
	ini.CloseWithoutSave();
@


1.127
log
@corrected load/save overhead statistics values from/to preferences.ini
@
text
@d1944 1
a1944 1
	cumUpOverheadTotal = ini.GetUInt64(_T("UpOverHeadTotal"),0);
d1948 1
a1948 1
	cumUpOverheadTotalPackets = ini.GetUInt64(_T("UpOverHeadTotalPackets"),0);
@


1.126
log
@First step of ICC (Internet Connection Check) configuration. Only in ini for now.
@
text
@d2197 2
a2198 2
		ini.SetUInt64(_T("DownOverheadFileReq"), theApp.downloadqueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		ini.SetUInt64(_T("DownOverheadSrcEx"), theApp.downloadqueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
d2200 8
a2207 4
		ini.SetUInt64(_T("DownOverheadTotalPackets"), 0);
		ini.SetUInt64(_T("DownOverheadFileReqPackets"), theApp.downloadqueue->GetDownDataOverheadFileRequestPackets() + theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + theApp.downloadqueue->GetDownDataOverheadServerPackets() + theApp.downloadqueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		ini.SetUInt64(_T("DownOverheadSrcExPackets"), theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		ini.SetUInt64(_T("DownOverheadServerPackets"), theApp.downloadqueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
d2219 8
a2226 8
		ini.SetUInt64(_T("UpOverheadTotal"), theApp.uploadqueue->GetUpDataOverheadFileRequest() + theApp.uploadqueue->GetUpDataOverheadSourceExchange() + theApp.uploadqueue->GetUpDataOverheadServer() + theApp.uploadqueue->GetUpDataOverheadOther() + GetUpOverheadTotal());
		ini.SetUInt64(_T("UpOverheadFileReq"), theApp.uploadqueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		ini.SetUInt64(_T("UpOverheadSrcEx"), theApp.uploadqueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		ini.SetUInt64(_T("UpOverheadServer"), theApp.uploadqueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		ini.SetUInt64(_T("UpOverheadTotalPackets"), theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + theApp.uploadqueue->GetUpDataOverheadServerPackets() + theApp.uploadqueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets());
		ini.SetUInt64(_T("UpOverheadFileReqPackets"), theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets());
		ini.SetUInt64(_T("UpOverheadSrcExPackets"), theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		ini.SetUInt64(_T("UpOverheadServerPackets"), theApp.uploadqueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
@


1.125
log
@Last template changes and fix for realtime update of FileTypeIcons when option changed.
@
text
@d1464 1
@


1.124
log
@Fixed start paused files by category (when option set or by menu)
Removed Reset All Statistics (agreed with Eklmn that has no use and it brings problems)
Removed Mobile Mule profile
Localized 'All' tab when language changed
@
text
@d1041 1
a1041 1
	strDefNick.Format(_T("%s [eMule Plus v%s]"), buffer, CURRENT_VERSION_LONG);
@


1.123
log
@Fixes regarding Category directory handling
@
text
@d1 1
a1 1
//this file is part of eMule
d1815 2
a1816 1
void CPreferences::ResetStatistics(bool all){
a1821 24

	if(all)
	{
		sesDownCompletedFiles=0;
		for (int i = 0; i<SO_LAST; i++)
		{
			sesDownDataClients[(eClientTypes)i]=0;
			sesUpDataClients[(eClientTypes)i]=0;
		}
		sesUpDataPort_4662=0;
		sesUpDataPort_OTHER=0;
		sesDownDataPort_4662=0;
		sesDownDataPort_OTHER=0;
		sesDownSuccessfulSessions=0;
		sesDownFailedSessions=0;
		sesPartsSavedByICH=0;

		theApp.stat_sessionReceivedBytes=0;
		theApp.stat_sessionSentBytes=0;
		theApp.stat_reconnects=0;
		theApp.stat_transferStarttime=0;
		theApp.stat_serverConnectTime=0;
		theApp.stat_filteredclients=0;
	}
@


1.122
log
@More updates.
@
text
@d793 2
a794 3
	ini.SetInt(_T("AllcatType"), prefs->allcatType);
	ini.SetBool(_T("ShowInfoOnCatTabs"), prefs->showCatTabInfos);
	ini.SetBool(_T("ResumeNextFromSameCat"), prefs->resumeSameCat);
d1166 2
a1167 3
	prefs->allcatType = ini.GetInt("AllcatType", 0);
	prefs->showCatTabInfos = ini.GetBool("ShowInfoOnCatTabs", false);
	prefs->resumeSameCat = ini.GetBool("ResumeNextFromSameCat", false);
@


1.121
log
@Fixed Scheduler preferences and Statistics restore.
@
text
@d938 3
a944 7
	/*
	ini.SetDefaultCategory(_T("Statistics"));
	buffer.Format(_T("%I64Lu"), m_nTotalDownloadedBytes.Get());
	ini.SetString(_T("TotalDownloadedBytes"),buffer);
	buffer.Format(_T("%I64Lu"), m_nTotalUploadedBytes.Get());
	ini.SetString(_T("TotalUploadedBytes"),buffer);
	*/
d1464 3
d1469 1
a1469 1
//eklmn: now when file is closed, let's call LoadStats()
a1471 9
	/*
	ini.SetDefaultCategory(_T("Statistics"));
	
	buffer.Format(ini.GetString(_T("TotalDownloadedBytes"),0));
	m_nTotalDownloadedBytes.Put(_tstoi64(buffer));

	buffer.Format(ini.GetString(_T("TotalUploadedBytes"),0));
	m_nTotalUploadedBytes.Put(_tstoi64(buffer));
	*/
d1817 1
a1817 1
void CPreferences::ResetCumulativeStatistics(){
d1824 24
d1906 4
a1909 1

d2135 1
a2135 1
CString CPreferences::GetStatsLastResetStr(bool formatLong)
d2142 1
a2142 1
	/*
d2146 1
a2146 1
		CString	strDateReset;
d2149 1
a2149 1
		strftime(strDateReset, 128, formatLong?GetDateTimeFormat():GetDateTimeFormat4Log(), statsReset);
d2153 1
a2153 1
		*/
a2154 1
		returnStr = GetResString(IDS_UNKNOWN);
@


1.120
log
@Removed DoubleClick option (now is default).
Added cancel for Categories Dialog (now no more ? cats after cancel)
@
text
@d1295 1
a1295 1
	m_nSCHShift1conn = ini.GetInt(_T("SCHShift1conn"),512);
d1299 1
a1299 1
	m_nSCHShift2conn = ini.GetInt(_T("SCHShift2conn"),256);
a1899 1

d1916 1
d2053 2
d2057 3
a2059 1
		if (findBackUp.FindFile(sINIBackUp)) {		
d2062 1
d2107 3
a2109 1
	ini.CloseWithoutSave();
d2366 1
a2366 1
	//if (bBackUp != 0) return;
d2369 1
a2369 1
	if (bBackUp == 0) 
a2373 1

@


1.119
log
@Fixed autocategory (and crashes)
@
text
@a674 1
	ini.SetBool(_T("TransferDoubleClick"), m_nTransferDoubleclick);
a1159 1
	m_nTransferDoubleclick = ini.GetBool(_T("TransferDoubleClick"),true);
d1495 1
a1495 1
	CString ixStr, catinif, cat_a, cat_b, cat_c;
d1533 1
a1533 1
		sprintf(newcat->autocat, catini.GetString(_T("Autocat"), _T(""), ixStr));
@


1.118
log
@Implemented ConfigDir
@
text
@d1509 1
a1509 1
	newcat->autocat = _T("");
d1535 1
a1535 1
		newcat->autocat = catini.GetString(_T("Autocat"), _T(""), ixStr);
@


1.117
log
@SecureIdent Support Mainly
Too many changes to mention here
@
text
@d63 29
d102 1
a102 1
	fullpath.Format(_T("%spreferences.dat"),appdir);
d198 1
a198 1
	fullpath.Format(_T("%sshareddir.dat"),appdir);
d210 1
a210 1
	fullpath.Format(_T("%stempdir.dat"),appdir);
d249 1
a249 1
	CString fullpath = CString(appdir) + _T("adresses.dat") ;
d267 1
a267 1
	fullpath.Format(_T("%suserhash.dat"), appdir) ;
d309 1
a309 1
	fullpath.Format(_T("%spreferences.dat"),appdir);
d332 1
a332 1
	fullpath.Format(_T("%suserhash.dat"), appdir) ;
d348 1
a348 1
	fullpath.Format(_T("%sshareddir.dat"),appdir);
d362 1
a362 1
	fullpath.Format(_T("%stempdir.dat"),appdir);
d592 1
a592 1
	fullpath.Format(_T("%spreferences.ini"),appdir);
d958 1
a958 1
	catinif.Format(_T("%scategory.ini"), appdir);
d1006 1
a1006 1
	strFileName.Format(_T("%spreferences.ini"), appdir);
d1026 1
a1026 1
		strNewName.Format(_T("%spreferences[%s].ini"), appdir,strPrefsVersion);	
d1498 1
a1498 1
	catinif.Format(_T("%scategory.ini"), appdir);
d1922 1
a1922 1
			fullpath.Format(_T("%spreferences.ini"),appdir);
d1925 1
a1925 1
			fullpath.Format(_T("%sstatbkup.ini"),appdir);
d2056 1
a2056 1
		sINIBackUp.Format(_T("%sstatbkuptmp.ini"), appdir);
d2151 1
a2151 1
			fullpath.Format(_T("%spreferences.ini"),appdir);
d2154 1
a2154 1
			fullpath.Format(_T("%sstatbkup.ini"),appdir);
d2157 1
a2157 1
			fullpath.Format(_T("%sstatbkuptmp.ini"),appdir);
d2482 1
a2482 1
	fullpath.Format(_T("%spreferences.ini"),appdir);
d2538 2
a2539 2
//	if (!CompareDirectories(strFullPath, GetConfigDir()))		// ".\eMule\config"
//		return true;
@


1.116
log
@*** empty log message ***
@
text
@d909 1
a909 1

d1440 1
a1440 1

@


1.115
log
@Updates/Fixes
@
text
@a531 1
#ifdef __USE_CATEGORIES__
a538 1
#endif
a764 1
#ifdef __USE_CATEGORIES__	
a767 1
#endif
a924 1
#ifdef __USE_CATEGORIES__
d928 2
a929 1
	CString catinif = "Category.ini", ixStr, buffer;
d935 1
d940 1
d947 1
d949 1
a951 1
#endif
a1143 1
#ifdef __USE_CATEGORIES__
a1146 1
#endif
a1455 1
#ifdef __USE_CATEGORIES__	
d1458 1
d1460 1
a1460 1
#endif
a1465 1
#ifdef __USE_CATEGORIES__
d1468 3
a1470 1
	CString ixStr, catinif = "Category.ini", cat_a, cat_b, cat_c;
d1475 3
a1477 3
	sprintf(newcat->title, "");
	sprintf(newcat->incomingpath, "");
	sprintf(newcat->comment, "");
d1480 1
d1487 1
a1487 1
	int max = catini.GetInt("Count", 0, "General");
d1491 2
a1492 2
		ixStr.Format("Cat#%i", ix);

d1494 2
a1495 2
		sprintf(newcat->title, catini.GetString("Title", "", ixStr));
		sprintf(newcat->incomingpath, catini.GetString("Incoming", "", ixStr));
d1497 8
a1504 3
		sprintf(newcat->comment, catini.GetString("Comment", "", ixStr));
		newcat->prio = catini.GetInt("Priority", 0, ixStr);
		sprintf(buffer, catini.GetString("Color", "0", ixStr));
d1506 1
d1510 1
d1512 1
a1514 1
#endif
d1761 1
a1761 1
#ifdef __USE_CATEGORIES__
a1798 2
#endif

d2276 1
a2276 1
	if (theApp.emuledlg->statisticswnd)
d2278 13
a2290 10
		// Peak Connections
		if (theApp.emuledlg->statisticswnd.GetPeakConnections()>cumConnPeakConnections)
			cumConnPeakConnections = theApp.emuledlg->statisticswnd.GetPeakConnections();
		ini.SetInt(_T("ConnPeakConnections"), cumConnPeakConnections);

		// Time Stuff...
		ini.SetInt(_T("ConnTransferTime"), GetConnTransferTime() + theApp.emuledlg->statisticswnd.GetTransferTime());
		ini.SetInt(_T("ConnUploadTime"), GetConnUploadTime() + theApp.emuledlg->statisticswnd.GetUploadTime());
		ini.SetInt(_T("ConnDownloadTime"), GetConnDownloadTime() + theApp.emuledlg->statisticswnd.GetDownloadTime());
		ini.SetInt(_T("ConnServerDuration"), GetConnServerDuration() + theApp.emuledlg->statisticswnd.GetServerDuration());		
a2291 1
	
d2468 50
@


1.114
log
@Show transferred data on Complete column
@
text
@d901 1
d1430 1
@


1.113
log
@added portuguese (Portugal) language
@
text
@d900 2
d1427 2
@


1.112
log
@*** empty log message ***
@
text
@d1654 1
@


1.111
log
@Another new sockets cumulative update
@
text
@d2207 1
a2207 1
	if (theApp.emuledlg->statisticswnd)
d2209 15
a2223 12
		// Download Rate Average
		tempRate = theApp.emuledlg->statisticswnd.GetAvgDownloadRate(AVG_TOTAL);
		ini.SetFloat(_T("ConnAvgDownRate"), tempRate);
		// Max Download Rate Average
		if (tempRate>GetConnMaxAvgDownRate()) Add2ConnMaxAvgDownRate(tempRate);
		ini.SetFloat(_T("ConnMaxAvgDownRate"), GetConnMaxAvgDownRate());
		// Upload Rate Average
		tempRate = theApp.emuledlg->statisticswnd.GetAvgUploadRate(AVG_TOTAL);
		ini.SetFloat(_T("ConnAvgUpRate"), tempRate);
		// Max Upload Rate Average
		if (tempRate>GetConnMaxAvgUpRate()) Add2ConnMaxAvgUpRate(tempRate);
		ini.SetFloat(_T("ConnMaxAvgUpRate"), GetConnMaxAvgUpRate());
@


1.110
log
@staistic fix... converted to Unicode
@
text
@d33 1
a33 1
const DWORD CCriticalSection_INL::s_dwSafeValue = 0x159D37BF;
@


1.109
log
@Preparing for new sockets
@
text
@d1904 7
a1910 7
	cumDownOverheadFileReq = ini.GetUInt64("DownOverheadFileReq",0);
	cumDownOverheadSrcEx = ini.GetUInt64("DownOverheadSrcEx",0);
	cumDownOverheadServer=ini.GetUInt64("DownOverheadServer",0);
	cumDownOverheadTotalPackets=ini.GetUInt64("DownOverheadTotalPackets",0);
	cumDownOverheadFileReqPackets=	ini.GetUInt64("DownOverheadFileReqPackets",0);
	cumDownOverheadSrcExPackets=ini.GetUInt64("DownOverheadSrcExPackets",0);
	cumDownOverheadServerPackets=ini.GetUInt64("DownOverheadServerPackets",0);
d1913 8
a1920 8
	cumUpOverheadTotal = ini.GetUInt64("UpOverHeadTotal",0);
	cumUpOverheadFileReq = ini.GetUInt64("UpOverheadFileReq",0);
	cumUpOverheadSrcEx = ini.GetUInt64("UpOverheadSrcEx",0);
	cumUpOverheadServer = ini.GetUInt64("UpOverheadServer",0);
	cumUpOverheadTotalPackets = ini.GetUInt64("UpOverHeadTotalPackets",0);
	cumUpOverheadFileReqPackets = ini.GetUInt64("UpOverheadFileReqPackets",0);
	cumUpOverheadSrcExPackets = ini.GetUInt64("UpOverheadSrcExPackets",0);
	cumUpOverheadServerPackets = ini.GetUInt64("UpOverheadServerPackets",0);
d1923 3
a1925 3
	cumUpSuccessfulSessions =	ini.GetUInt32("UpSuccessfulSessions", 0 );
	cumUpFailedSessions =		ini.GetUInt32("UpFailedSessions", 0 );
	cumUpAvgTime =			ini.GetUInt32("UpAvgTime", 0 );
d1928 7
a1934 7
	cumUpDataClients[SO_EDONKEY] = ini.GetUInt64("UpData_EDONKEY",0);
	cumUpDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64("UpData_EDONKEYHYBRID",0);
	cumUpDataClients[SO_EMULE] = ini.GetUInt64("UpData_EMULE",0);
	cumUpDataClients[SO_MLDONKEY] = ini.GetUInt64("UpData_MLDONKEY",0);
	cumUpDataClients[SO_LMULE] = ini.GetUInt64("UpData_LMULE",0);
	cumUpDataClients[SO_CDONKEY] = ini.GetUInt64("UpData_CDONKEY",0);
	cumUpDataClients[SO_SHAREAZA] = ini.GetUInt64("UpData_SHAREAZA",0);
d1937 2
a1938 2
	cumUpDataPort_4662 =	ini.GetUInt64("UpDataPort_4662",0);
	cumUpDataPort_OTHER = ini.GetUInt64("UpDataPort_OTHER",0);
d1941 2
a1942 2
	cumUpData_File = ini.GetUInt64("UpData_File",0);
	cumUpData_Partfile = ini.GetUInt64("UpData_Partfile",0);
d1945 4
a1948 4
	cumDownCompletedFiles = ini.GetUInt32("DownCompletedFiles", 0 );
	cumDownSuccessfulSessions = ini.GetInt("DownSuccessfulSessions", 0 );
	cumDownFailedSessions = ini.GetInt("DownFailedSessions", 0 );
	cumDownAvgTime = ini.GetUInt32("DownAvgTime", 0 );
d1951 3
a1953 3
	cumLostFromCorruption = ini.GetUInt64("LostFromCorruption",0);
	cumSavedFromCompression = ini.GetUInt64("SavedFromCompression",0);
	cumPartsSavedByICH = ini.GetUInt32("PartsSavedByICH"	, 0 );
d1956 7
a1962 7
	cumDownDataClients[SO_EDONKEY] = ini.GetUInt64("DownData_EDONKEY",0);
	cumDownDataClients[SO_EDONKEYHYBRID] = ini.GetUInt64("DownData_EDONKEYHYBRID",0);
	cumDownDataClients[SO_EMULE] = ini.GetUInt64("DownData_EMULE",0);
	cumDownDataClients[SO_MLDONKEY] = ini.GetUInt64("DownData_MLDONKEY",0);
	cumDownDataClients[SO_LMULE] = ini.GetUInt64("DownData_LMULE",0);
	cumDownDataClients[SO_CDONKEY] = ini.GetUInt64("DownData_CDONKEY",0);
	cumDownDataClients[SO_SHAREAZA] = ini.GetUInt64("DownData_SHAREAZA",0);
d1965 2
a1966 2
	cumDownDataPort_4662 =	ini.GetUInt64("DownDataPort_4662",0);
	cumDownDataPort_OTHER = ini.GetUInt64("DownDataPort_OTHER",0);
d1969 17
a1985 17
	cumConnAvgDownRate = ini.GetFloat(	"ConnAvgDownRate", 0 );
	cumConnMaxAvgDownRate = ini.GetFloat("ConnMaxAvgDownRate", 0 );
	cumConnMaxDownRate = ini.GetFloat(	"ConnMaxDownRate", 0 );
	cumConnAvgUpRate = ini.GetFloat("ConnAvgUpRate"	, 0 );
	cumConnMaxAvgUpRate = ini.GetFloat("ConnMaxAvgUpRate", 0 );
	cumConnMaxUpRate = ini.GetFloat("ConnMaxUpRate", 0 );

	cumConnRunTime = ini.GetUInt64("ConnRunTime", 0 );

	cumConnTransferTime=			ini.GetUInt32("ConnTransferTime", 0 );
	cumConnDownloadTime=		ini.GetUInt32("ConnDownloadTime", 0 );
	cumConnUploadTime=			ini.GetUInt32("ConnUploadTime", 0 );
	cumConnServerDuration=		ini.GetUInt32("ConnServerDuration", 0 );
	cumConnNumReconnects =		ini.GetInt("ConnNumReconnects", 0 );
	cumConnAvgConnections =		ini.GetInt("ConnAvgConnections", 0 );
	cumConnMaxConnLimitReached=	ini.GetInt("ConnMaxConnLimitReached", 0 );
	cumConnPeakConnections =		ini.GetInt("ConnPeakConnections", 0 );
d1988 1
a1988 1
	stat_datetimeLastReset = ini.GetUInt64("statsDateTimeLastReset",0);
d1995 6
a2000 6
		if (ini.GetInt("SrvrsMostWorkingServers", 0) > cumSrvrsMostWorkingServers)
			cumSrvrsMostWorkingServers = ini.GetInt("SrvrsMostWorkingServers", 0 );
		if (ini.GetUInt32("SrvrsMostUsersOnline", 0) > cumSrvrsMostUsersOnline)
			cumSrvrsMostUsersOnline =	ini.GetUInt32("SrvrsMostUsersOnline", 0 );
		if (ini.GetUInt32("SrvrsMostFilesAvail", 0) > cumSrvrsMostFilesAvail)
			cumSrvrsMostFilesAvail = ini.GetUInt32("SrvrsMostFilesAvail", 0 );
d2003 2
a2004 2
		if (ini.GetInt("SharedMostFilesShared ", 0) > cumSharedMostFilesShared)
			cumSharedMostFilesShared = ini.GetInt("SharedMostFilesShared", 0 );
d2006 1
a2006 1
		temp64 = ini.GetUInt64("SharedLargestShareSize",0);
d2008 1
a2008 1
		temp64 = ini.GetUInt64("SharedLargestAvgFileSize",0);
d2010 1
a2010 1
		temp64 = ini.GetUInt64("SharedLargestFileSize",0);
d2016 1
a2016 1
		sINIBackUp.Format("%sstatbkuptmp.ini", appdir);
d2031 3
a2033 3
		cumSrvrsMostWorkingServers = ini.GetInt("SrvrsMostWorkingServers", 0 );
		cumSrvrsMostUsersOnline =	ini.GetUInt32("SrvrsMostUsersOnline", 0 );
		cumSrvrsMostFilesAvail = ini.GetUInt32("SrvrsMostFilesAvail", 0 );
d2036 1
a2036 1
		cumSharedMostFilesShared = ini.GetInt("SharedMostFilesShared", 0 );
d2038 3
a2040 3
		cumSharedLargestShareSize = ini.GetUInt64("SharedLargestShareSize",0);
		cumSharedLargestAvgFileSize = ini.GetUInt64("SharedLargestAvgFileSize",0);
		cumSharedLargestFileSize =	ini.GetUInt64("SharedLargestFileSize"	,0);
d2043 1
a2043 1
		statsExpandedTreeItems = ini.GetString("statsExpandedTreeItems", "111000000100000110000010000011110000010010");
d2128 1
a2128 1
	ini.SetUInt64("TotalDownloadedBytes", theApp.stat_sessionReceivedBytes+GetTotalDownloaded());
d2133 1
a2133 1
	ini.SetInt("DownSuccessfulSessions", cumDownSuccessfulSessions);
d2135 2
a2136 2
	ini.SetInt("DownFailedSessions", cumDownFailedSessions);
	ini.SetInt("DownAvgTime", (GetDownC_AvgTime() + GetDownS_AvgTime()) / 2 );
d2139 3
a2141 3
	ini.SetUInt64("LostFromCorruption", cumLostFromCorruption );
	ini.SetUInt64("SavedFromCompression", cumSavedFromCompression);
	ini.SetInt("PartsSavedByICH", cumPartsSavedByICH+sesPartsSavedByICH);
d2144 7
a2150 7
	ini.SetUInt64("DownData_EDONKEY", GetCumDownData(SO_EDONKEY));
	ini.SetUInt64("DownData_EDONKEYHYBRID", GetCumDownData(SO_EDONKEYHYBRID));
	ini.SetUInt64("DownData_EMULE", GetCumDownData(SO_EMULE) );
	ini.SetUInt64("DownData_MLDONKEY", GetCumDownData(SO_MLDONKEY) );
	ini.SetUInt64("DownData_LMULE", GetCumDownData(SO_LMULE) );
	ini.SetUInt64("DownData_CDONKEY", GetCumDownData(SO_CDONKEY) );
	ini.SetUInt64("DownData_SHAREAZA", GetCumDownData(SO_SHAREAZA) );
d2153 2
a2154 2
	ini.SetUInt64("DownDataPort_4662", GetCumDownDataPort_4662());
	ini.SetUInt64("DownDataPort_OTHER", GetCumDownDataPort_OTHER());
d2159 8
a2166 8
		ini.SetUInt64("DownOverheadTotal", (uint64)theApp.downloadqueue->GetDownDataOverheadFileRequest()+theApp.downloadqueue->GetDownDataOverheadSourceExchange()+theApp.downloadqueue->GetDownDataOverheadServer()+theApp.downloadqueue->GetDownDataOverheadOther()+GetDownOverheadTotal() );
		ini.SetUInt64("DownOverheadFileReq", theApp.downloadqueue->GetDownDataOverheadFileRequest() + GetDownOverheadFileReq() );
		ini.SetUInt64("DownOverheadSrcEx", theApp.downloadqueue->GetDownDataOverheadSourceExchange() + GetDownOverheadSrcEx() );
		ini.SetUInt64("DownOverheadServer", (uint64)theApp.downloadqueue->GetDownDataOverheadServer()+GetDownOverheadServer() );
		ini.SetUInt64("DownOverheadTotalPackets", 0);
		ini.SetUInt64("DownOverheadFileReqPackets", theApp.downloadqueue->GetDownDataOverheadFileRequestPackets() + theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + theApp.downloadqueue->GetDownDataOverheadServerPackets() + theApp.downloadqueue->GetDownDataOverheadOtherPackets() + GetDownOverheadTotalPackets() );
		ini.SetUInt64("DownOverheadSrcExPackets", theApp.downloadqueue->GetDownDataOverheadSourceExchangePackets() + GetDownOverheadSrcExPackets() );
		ini.SetUInt64("DownOverheadServerPackets", theApp.downloadqueue->GetDownDataOverheadServerPackets() + GetDownOverheadServerPackets() );
d2170 1
a2170 1
	ini.SetUInt64("TotalUploadedBytes", theApp.stat_sessionSentBytes+GetTotalUploaded() );
d2173 3
a2175 3
		ini.SetInt("UpSuccessfulSessions", theApp.uploadqueue->GetSuccessfullUpCount()+GetUpSuccessfulSessions());
		ini.SetInt("UpFailedSessions", theApp.uploadqueue->GetFailedUpCount()+GetUpFailedSessions());
		ini.SetInt("UpAvgTime", (theApp.uploadqueue->GetAverageUpTime()+GetUpAvgTime())/2);
d2178 8
a2185 8
		ini.SetUInt64("UpOverheadTotal", theApp.uploadqueue->GetUpDataOverheadFileRequest() + theApp.uploadqueue->GetUpDataOverheadSourceExchange() + theApp.uploadqueue->GetUpDataOverheadServer() + theApp.uploadqueue->GetUpDataOverheadOther() + GetUpOverheadTotal());
		ini.SetUInt64("UpOverheadFileReq", theApp.uploadqueue->GetUpDataOverheadFileRequest() + GetUpOverheadFileReq() );
		ini.SetUInt64("UpOverheadSrcEx", theApp.uploadqueue->GetUpDataOverheadSourceExchange() + GetUpOverheadSrcEx() );
		ini.SetUInt64("UpOverheadServer", theApp.uploadqueue->GetUpDataOverheadServer() + GetUpOverheadServer() );
		ini.SetUInt64("UpOverheadTotalPackets", theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + theApp.uploadqueue->GetUpDataOverheadServerPackets() + theApp.uploadqueue->GetUpDataOverheadOtherPackets() + GetUpOverheadTotalPackets());
		ini.SetUInt64("UpOverheadFileReqPackets", theApp.uploadqueue->GetUpDataOverheadFileRequestPackets() + GetUpOverheadFileReqPackets());
		ini.SetUInt64("UpOverheadSrcExPackets", theApp.uploadqueue->GetUpDataOverheadSourceExchangePackets() + GetUpOverheadSrcExPackets() );
		ini.SetUInt64("UpOverheadServerPackets", theApp.uploadqueue->GetUpDataOverheadServerPackets() + GetUpOverheadServerPackets() );
d2189 7
a2195 7
	ini.SetUInt64("UpData_EDONKEY", GetCumUpData(SO_EDONKEY));
	ini.SetUInt64("UpData_EDONKEYHYBRID", GetCumUpData(SO_EDONKEYHYBRID) );
	ini.SetUInt64("UpData_EMULE", GetCumUpData(SO_EMULE) );
	ini.SetUInt64("UpData_MLDONKEY", GetCumUpData(SO_MLDONKEY) );
	ini.SetUInt64("UpData_LMULE", GetCumUpData(SO_LMULE) );
	ini.SetUInt64("UpData_CDONKEY", GetCumUpData(SO_CDONKEY));
	ini.SetUInt64("UpData_SHAREAZA", GetCumUpData(SO_SHAREAZA) );
d2198 2
a2199 2
	ini.SetUInt64("UpDataPort_4662", GetCumUpDataPort_4662() );
	ini.SetUInt64("UpDataPort_OTHER", GetCumUpDataPort_OTHER() );
d2202 2
a2203 2
	ini.SetUInt64("UpData_File", GetCumUpData_File() );
	ini.SetUInt64("UpData_Partfile", GetCumUpData_Partfile() );
d2211 1
a2211 1
		ini.SetFloat("ConnAvgDownRate", tempRate);
d2214 1
a2214 1
		ini.SetFloat("ConnMaxAvgDownRate", GetConnMaxAvgDownRate());
d2217 1
a2217 1
		ini.SetFloat("ConnAvgUpRate", tempRate);
d2220 1
a2220 1
		ini.SetFloat("ConnMaxAvgUpRate", GetConnMaxAvgUpRate());
d2227 1
a2227 1
		ini.SetFloat("ConnMaxDownRate", GetConnMaxDownRate());
d2234 1
a2234 1
		ini.SetFloat("ConnMaxUpRate", GetConnMaxUpRate());	
d2238 3
a2240 3
	uint32 timeseconds = (GetTickCount()-theApp.stat_starttime)/1000;
	timeseconds+=GetConnRunTime();
	ini.SetInt("ConnRunTime",timeseconds );
d2243 1
a2243 1
		ini.SetWORD("ConnNumReconnects", theApp.stat_reconnects - 1 + GetConnNumReconnects());
d2245 1
a2245 1
		ini.SetWORD("ConnNumReconnects", GetConnNumReconnects());
d2252 1
a2252 1
			ini.SetUInt32("ConnAvgConnections", (uint32)(theApp.emuledlg->statisticswnd.GetAverageConnections()+cumConnAvgConnections)/2);
d2258 1
a2258 1
			ini.SetUInt32("ConnMaxConnLimitReached", theApp.listensocket->GetMaxConnectionReached() + cumConnMaxConnLimitReached);
d2267 1
a2267 1
		ini.SetInt("ConnPeakConnections", cumConnPeakConnections);
d2270 4
a2273 4
		ini.SetInt("ConnTransferTime", GetConnTransferTime() + theApp.emuledlg->statisticswnd.GetTransferTime());
		ini.SetInt("ConnUploadTime", GetConnUploadTime() + theApp.emuledlg->statisticswnd.GetUploadTime());
		ini.SetInt("ConnDownloadTime", GetConnDownloadTime() + theApp.emuledlg->statisticswnd.GetDownloadTime());
		ini.SetInt("ConnServerDuration", GetConnServerDuration() + theApp.emuledlg->statisticswnd.GetServerDuration());		
d2284 1
a2284 1
		ini.SetInt("SrvrsMostWorkingServers", cumSrvrsMostWorkingServers);
d2286 1
a2286 1
		ini.SetInt("SrvrsMostUsersOnline", cumSrvrsMostUsersOnline);
d2288 1
a2288 1
		ini.SetInt("SrvrsMostFilesAvail", cumSrvrsMostFilesAvail);
d2296 1
a2296 1
		ini.SetInt("SharedMostFilesShared", cumSharedMostFilesShared);
d2300 1
a2300 1
		ini.SetUInt64("SharedLargestShareSize", cumSharedLargestShareSize);
d2302 1
a2302 1
		ini.SetUInt64("SharedLargestFileSize", cumSharedLargestFileSize);
d2307 1
a2307 1
		ini.SetUInt64("SharedLargestAvgFileSize", cumSharedLargestAvgFileSize);
d2309 1
a2309 1
		ini.SetUInt64("statsDateTimeLastReset", stat_datetimeLastReset);
d2313 1
a2313 1
	ini.SetString("statsExpandedTreeItems", statsExpandedTreeItems);
d2371 2
a2372 1
	switch (eUpDown){
d2442 2
a2443 2
	ini.SetUInt32("DownCompletedFiles", GetDownCompletedFiles());
	ini.SetUInt32("DownSessionCompletedFiles", GetDownSessionCompletedFiles());
@


1.108
log
@new statistic (khaos based)
@
text
@d2247 1
d2260 1
@


1.107
log
@*** empty log message ***
@
text
@a836 7
	ini.SetDefaultCategory(_T("Statistics"));
	buffer.Format(_T("%I64Lu"), m_nTotalDownloadedBytes.Get());
	ini.SetString(_T("TotalDownloadedBytes"),buffer);

	buffer.Format(_T("%I64Lu"), m_nTotalUploadedBytes.Get());
	ini.SetString(_T("TotalUploadedBytes"),buffer);

d913 10
d987 1
d1002 1
a1342 6
	ini.SetDefaultCategory(_T("Statistics"));
	buffer.Format(ini.GetString(_T("TotalDownloadedBytes"),0));
	m_nTotalDownloadedBytes.Put(_tstoi64(buffer));

	buffer.Format(ini.GetString(_T("TotalUploadedBytes"),0));
	m_nTotalUploadedBytes.Put(_tstoi64(buffer));
d1440 13
d1787 661
@


1.106
log
@*** empty log message ***
@
text
@d768 3
a770 3
	ini.SetInt(_T("AllcatType", prefs->allcatType);
	ini.SetBool(_T("ShowInfoOnCatTabs", prefs->showCatTabInfos);
	ini.SetBool(_T("ResumeNextFromSameCat", prefs->resumeSameCat);
d933 1
a933 1
		catini.SetInt(_T("Count", catMap.GetCount()-1, _T("General"));
@


1.105
log
@Removed Safe Connect
@
text
@d530 12
a541 1
CPreferences::~CPreferences(){	
d767 6
d923 25
d1137 6
d1441 6
d1451 41
d1735 41
a1775 1
}@


1.104
log
@eMailNotifier and PopUp CleanUp
@
text
@a644 1
	ini.SetBool(_T("SafeConnect"), m_bSafeConnect);
a1090 1
	m_bSafeConnect = ini.GetBool(_T("SafeConnect"),true);
@


1.103
log
@Purity's changes
@
text
@d665 1
d1126 1
@


1.102
log
@Updated notifications (for eMail alerts feature compatibility).
@
text
@d843 6
d1325 5
@


1.101
log
@changed INI file interface + little bugfix
@
text
@d667 2
d1121 2
@


1.100
log
@Option to disable filetype icons.
@
text
@d556 2
a557 1
	CIni ini( fullpath, _T("eMule") );
d560 1
a560 1
	ini.WriteString(_T("AppVersion"), CURRENT_VERSION_LONG);
d563 1
a563 1
	ini.WriteString(_T("Nick"),buffer);
d566 1
a566 1
	ini.WriteString(_T("IncomingDir"),buffer );
d569 1
a569 1
	ini.WriteString(_T("TempDir"),buffer );
d572 1
a572 1
	ini.WriteString(_T("VideoPlayer"),buffer );
d574 9
a582 9
	ini.WriteInt(_T("MaxUpload"), m_nMaxUpload);
	ini.WriteInt(_T("MaxDownload"), m_nMaxDownload);
	ini.WriteInt(_T("MaxConnections"), m_nMaxConnections);
	ini.WriteInt(_T("DeadServerAction"), m_nDeadServer);
	ini.WriteInt(_T("Port"), m_nPort);
	ini.WriteInt(_T("UDPPort"), m_nUDPPort);
	ini.WriteInt(_T("MaxSourcesPerFile"), m_nMaxSourcePerFile);
	ini.WriteWORD(_T("Language"), m_nLanguageID);
	ini.WriteInt(_T("SeeShare"), m_nSeeShares.Get());
d584 3
a586 3
	ini.WriteBool(_T("PartTrafficEnabled"), m_bUsePartTraffic);
	ini.WriteInt(_T("UploadbarStyle"), m_nUpbarPartTraffic);
	ini.WriteInt(_T("UploadbarColor"), m_nUpbarColorPartTraffic);
d588 36
a623 36
	ini.WriteInt(_T("ToolTipDelay"), m_nTooltipDelayTime);
	ini.WriteInt(_T("QueueSize"), m_nQueueSize);
	//ini.WriteInt(_T("RemoteQueueLimit"), prefs->remotequeuelimit); //remote QR 
	ini.WriteBool(_T("UseRemoteQueueLimit"), m_bUseRQlimit);
	ini.WriteInt(_T("StatGraphsInterval"), m_nTrafficOMeterInterval);
	ini.WriteInt(_T("StatsInterval"), m_nStatsInterval);
	ini.WriteInt(_T("StatsColumnWidth"), m_nStatsColumnWidth);
	ini.WriteInt(_T("DetailColumnWidth"), m_nDetailColumnWidth);
	ini.WriteString(_T("StatsListExpanded"), m_sStatsListExpanded.Get());
	ini.WriteInt(_T("DownloadCapacity"), m_nMaxGraphDownloadRate);
	ini.WriteInt(_T("UploadCapacity"), m_nMaxGraphUploadRate);
	ini.WriteInt(_T("DeadServerRetries"), m_nDeadServerRetries);
	ini.WriteInt(_T("SplitterbarPosition"), m_nSplitterBarPosition);
	ini.WriteInt(_T("VariousStatisticsMaxValue"), m_nStatsMax);
	ini.WriteInt(_T("StatsAverageMinutes"), m_nStatsAverageMinutes);
	ini.WriteInt(_T("MaxConnectionsPerFiveSeconds"), m_nMaxConperFive);

	ini.WriteInt(_T("BadClientBanTime"), m_nBadClientBanTime);
	ini.WriteInt(_T("BadClientMinRequestTime"), m_nMinRequestTime);
	ini.WriteInt(_T("BadClientMinRequestNum"), m_nBadClientBan);
	ini.WriteBool(_T("BanMessageEnabled"), m_bBanMessageEnabled);
	ini.WriteBool(_T("BanEnabled"), m_bBanEnabled); // DbT:BanEnDisable

	ini.WriteInt(_T("SLS_RestoreSourcesTime"), m_nSLSRestoreSourcesTime);
	ini.WriteInt(_T("SLS_WhenSourcesOutdated"), m_nSLSOutdated);
	ini.WriteInt(_T("SLS_MaxSourcesPerFile"),m_SLSMaxSourcesPerFile);
	ini.WriteBool(_T("SLS_Enable"), m_bSLSEnable);

	ini.WriteBool(_T("Reconnect"), m_bReconnect);
	ini.WriteBool(_T("Scoresystem"), m_nScoreSystem);

	ini.WriteBool(_T("UAP"), m_bUAP);
	ini.WriteBool(_T("DAP"), m_bDAP);
	ini.WriteBool(_T("DisableXS"), m_bDisableXS);
	ini.WriteBool(_T("StartDownloadPaused"), m_bStartDownloadPaused);
	ini.WriteBool(_T("DownloadPausedOnComplete"), m_bDownloadPausedOnComplete);
d625 1
a625 1
	ini.WriteString(_T("ToolbarSettings"), m_sToolbarSettings.Get()); // Added by reCDVst
d627 1
a627 1
	ini.WriteString(_T("ToolbarBitmap"),buffer);
d629 24
a652 24
	ini.WriteString(_T("ToolbarBitmapFolder"),buffer);
	ini.WriteInt(_T("ToolbarLabels"), m_nToolbarLabels);
	ini.WriteBool(_T("Serverlist"), m_bAutoServerList);
	ini.WriteBool(_T("UpdateNotify"), m_bUpdateNotify);
	ini.WriteBool(_T("MinimizeToTray"), m_bMinToTray);
	ini.WriteBool(_T("AddServersFromConnections"), m_bAddServersFromConn);
	ini.WriteBool(_T("Splashscreen"), m_bSplashScreen);
	ini.WriteBool(_T("BringToFront"), m_bBringToForeground);
	ini.WriteBool(_T("TransferDoubleClick"), m_nTransferDoubleclick);
	ini.WriteBool(_T("BeepOnError"), m_bBeepOnError);
	ini.WriteBool(_T("ConfirmExit"), m_bConfirmExit);
	ini.WriteBool(_T("FilterBadIPs"), m_bFilterBadIP);
	ini.WriteBool(_T("FilterServersByIP"), m_bFilterServersByIP);
	ini.WriteBool(_T("Autoconnect"), m_bAutoConnect);
	ini.WriteBool(_T("OnlineSignature"), m_bOnlineSig);
	ini.WriteBool(_T("StartupMinimized"), m_bStartMinimized);
	ini.WriteBool(_T("SafeConnect"), m_bSafeConnect);
	ini.WriteBool(_T("ToolbarSpeedMeter"), m_bShowToolbarSpeedMeter);
	ini.WriteBool(_T("CloseToTray"), m_bCloseToTray);
	ini.WriteBool(_T("DetailsOnClick"), m_bDetailsOnClick);
	ini.WriteInt(_T("SrvConTimeout"), m_nSrvConTimeout);
	ini.WriteBool(_T("SlowComplete"), m_bSlowComplete);
	ini.WriteInt(_T("SlowCompleteBlockSize"), m_nSlowCompleteBlockSize);
	ini.WriteBool(_T("ShowRatesOnTitle"),prefs->showRatesInTitle);
d655 3
a657 3
    ini.WriteBool(_T("AutoConnectStaticOnly"), m_bAutoConnectStaticOnly);  
    ini.WriteBool(_T("GlobalSearch"), prefs->globalsearch);  
    ini.WriteInt (_T("3DDepth"), m_nDepth3D); 
d660 38
a697 38
	ini.WriteBool(_T("NotifyOnDownload"), m_bUseDownloadNotifier);
	ini.WriteBool(_T("NotifyOnDownloadAdd"), m_bUseDownloadAddNotifier);
	ini.WriteBool(_T("NotifyOnChat"), m_bUseChatNotifier);		  
	ini.WriteBool(_T("NotifyOnLog"), m_bUseLogNotifier);
	ini.WriteBool(_T("NotifierUseSound"), m_bUseSoundInNotifier);
	ini.WriteBool(_T("NotifierPopEveryChatMessage"), m_bNotifierPopsEveryChatMsg);
	ini.WriteBool(_T("NotifyOnImportantError"), m_bNotifierImportantError);
	ini.WriteString(_T("NotifierSoundPath"), CString(m_sNotifierSoundFilePath.Get()));

	ini.WriteString(_T("MessageFilter"),prefs->messageFilter);
	ini.WriteString(_T("CommentFilter"), m_sCommentFilter.Get());	//(SyruS) netwolf commentfilter
	ini.WriteString(_T("TxtEditor"),prefs->TxtEditor);
	ini.WriteBool(_T("DisableRatingIcons"), m_bDisableRatingIcons);	//netwolf: disable icons
    ini.WriteString(_T("IRCServer"), m_sIRCServer.Get());
	ini.WriteString(_T("IRCNick"), m_sIRCNick.Get());
	ini.WriteBool(_T("IRCAddTimestamp"), m_bIRCAddTimestamp);
	ini.WriteString(_T("IRCFilterName"), m_sIRCChanNameFilter.Get());
	ini.WriteInt(_T("IRCFilterUser"), m_nIRCChannelUserFilter);
	ini.WriteBool(_T("IRCUseFilter"), m_bIRCUseChanFilter);
	ini.WriteString(_T("IRCPerformString"), m_sIRCPerformString.Get());
	ini.WriteBool(_T("IRCUsePerform"), m_bIRCUsePerform);
	ini.WriteBool(_T("IRCListOnConnect"), m_bIRCListOnConnect);
	//	ini.WriteBool("IRCAcceptLinks", m_bIRCAcceptLinks);
	ini.WriteBool(_T("IRCIgnoreInfoMessage"), m_bIRCIgnoreInfoMessage);
	ini.WriteBool(_T("IRCIgnoreEmuleProtoInfoMessage"), m_bIRCIgnoreEmuleProtoInfoMessage);
	ini.WriteBool(_T("SmartIdCheck"), m_bSmartIdCheck);

	ini.WriteBool(_T("UseSortingDefaults"), m_bUseSort);
	ini.WriteBool(_T("Use2ndSortSources"), m_bUseSrcSortCol2);
	ini.WriteInt(_T("SortServersCode"), m_nServerSortCol);	
	ini.WriteInt(_T("SortUploadsCode"), m_nUploadSortCol);
	ini.WriteInt(_T("SortQueueCode"), m_nQueueSortCol);
	ini.WriteInt(_T("SortSearchCode"), m_nSearchSortCol);
	ini.WriteInt(_T("SortIrcCode"), m_nIRCSortCol);
	ini.WriteInt(_T("SortFilesCode"), m_nFileSortCol);
	ini.WriteInt(_T("SortDownloadsCode"), m_nDownloadSortCol);
	ini.WriteInt(_T("1stSortSourcesCode"), m_nSrcSortCol1);
	ini.WriteInt(_T("2ndSortSourcesCode"), m_nSrcSortCol2);
d700 43
a742 43
	ini.WriteBool(_T("CommunityEnabled"), m_bCommunityEnabled);
	ini.WriteString(_T("CommunityString"), m_sCommunityString.Get());
	ini.WriteBool(_T("CommunityNoBan"), m_bCommunityNoBan);
	ini.WriteInt(_T("NotificationDisplayTime"), m_nNotificationDisplayTime);
	ini.WriteInt(_T("NotificationFontSize"), m_nNotificationFontSize);
	ini.WriteInt(_T("Profile"), m_nProfile);
	ini.WriteInt(_T("PriorityHigh"), m_nPriorityHigh);
	ini.WriteInt(_T("PriorityLow"), m_nPriorityLow);
	ini.WriteBool(_T("RestartWaiting"), m_bRestartWaiting);
	ini.WriteBool(_T("LogToFile"), m_bLogToFile);
	ini.WriteBool(_T("BugReport"), prefs->BugReport);
	ini.WriteBool(_T("DisableXSUpTo"), m_bDisableXSUpTo);
	ini.WriteInt(_T("XSUpTo"), m_nXSUpTo);
	ini.WriteString(_T("UsedFont"), m_sUsedFont.Get());
	ini.WriteInt(_T("FontSize"), m_nFontSize);
	ini.WriteInt(_T("HashingPriority"), m_HashingPriority);
	ini.WriteBool(_T("UploadParts"), m_bUploadParts);
	ini.WriteBool(_T("A4AFStringEnabled"), m_bA4AFStringEnabled);
	ini.WriteInt(_T("SearchMethod"), m_nSearchMethod);
	ini.WriteBool(_T("AutoTakeED2KLinks"), m_bAutoTakeLinks); 
	ini.WriteInt(_T("FileBufferSizePref"), m_nFileBufferSize);
	ini.WriteInt(_T("MainProcessPriority"), m_nMainProcessPriority);
	ini.WriteBool(_T("ShowAverageDatarate"),m_bShowAverageDatarate);
	ini.WriteBool(_T("LimitlessDownload"),m_bLimitlessDownload);
	ini.WriteBool(_T("SCHEnabled"), m_bSCHEnabled);
	ini.WriteBool(_T("SCHExceptMon"), m_bSCHExceptMon);
	ini.WriteBool(_T("SCHExceptTue"), m_bSCHExceptTue);
	ini.WriteBool(_T("SCHExceptWed"), m_bSCHExceptWed);
	ini.WriteBool(_T("SCHExceptThu"), m_bSCHExceptThu);
	ini.WriteBool(_T("SCHExceptFri"), m_bSCHExceptFri);
	ini.WriteBool(_T("SCHExceptSat"), m_bSCHExceptSat);
	ini.WriteBool(_T("SCHExceptSun"), m_bSCHExceptSun);
	ini.WriteInt(_T("SCHShift1"),m_nSCHShift1);
	ini.WriteInt(_T("SCHShift2"),m_nSCHShift2);
	ini.WriteInt(_T("SCHShift1Up"),m_nSCHShift1Upload);
	ini.WriteInt(_T("SCHShift1Down"),m_nSCHShift1Download);
	ini.WriteInt(_T("SCHShift1Conn"),m_nSCHShift1conn);
	ini.WriteInt(_T("SCHShift15sec"),m_nSCHShift15sec);
	ini.WriteInt(_T("SCHShift2Up"),m_nSCHShift2Upload);
	ini.WriteInt(_T("SCHShift2Down"),m_nSCHShift2Download);
	ini.WriteInt(_T("SCHShift2Conn"),m_nSCHShift2conn);
	ini.WriteInt(_T("SCHShift25sec"),m_nSCHShift25sec);
	ini.WriteBool(_T("ShowFileTypeIcon"), m_bShowFileTypeIcon);
d745 1
a745 1
	ini.WriteBool(_T("MultipleInstances"), m_bMultiple);
d747 28
a774 49
	ini.WriteBool(_T("Verbose"), m_bVerbose);
	ini.WriteBool(_T("UpdateQueueList"), m_bUpdateQueueList);
	ini.WriteBool(_T("ManualHighPrio"), m_bManualHighPrio);
	//ini.WriteBool("StartNextFile", prefs->m_bstartnextfile); //duplicates downloadpausedoncomplete
	ini.WriteBool(_T("ShowOverhead"), m_bShowOverhead);	//Cax2 re-enabled this preference
	ini.WriteBool(_T("VideoPreviewBackupped"), m_bBackupPreview);	//Cax2 string kept for compatibility with off client

	ini.SerGet(false, prefs->downloadColumnWidths,
		ELEMENT_COUNT(prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SerGet(false, prefs->downloadColumnHidden,
		ELEMENT_COUNT(prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SerGet(false, prefs->downloadColumnOrder,
		ELEMENT_COUNT(prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SerGet(false, prefs->uploadColumnWidths,
		ELEMENT_COUNT(prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.SerGet(false, prefs->uploadColumnHidden,
		ELEMENT_COUNT(prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.SerGet(false, prefs->uploadColumnOrder,
		ELEMENT_COUNT(prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.SerGet(false, prefs->queueColumnWidths,
		ELEMENT_COUNT(prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.SerGet(false, prefs->queueColumnHidden,
		ELEMENT_COUNT(prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.SerGet(false, prefs->queueColumnOrder,
		ELEMENT_COUNT(prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.SerGet(false, prefs->searchColumnWidths,
		ELEMENT_COUNT(prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.SerGet(false, prefs->searchColumnHidden,
		ELEMENT_COUNT(prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.SerGet(false, prefs->searchColumnOrder,
		ELEMENT_COUNT(prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.SerGet(false, prefs->sharedColumnWidths,
		ELEMENT_COUNT(prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.SerGet(false, prefs->sharedColumnHidden,
		ELEMENT_COUNT(prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.SerGet(false, prefs->sharedColumnOrder,
		ELEMENT_COUNT(prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.SerGet(false, prefs->serverColumnWidths,
		ELEMENT_COUNT(prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.SerGet(false, prefs->serverColumnHidden,
		ELEMENT_COUNT(prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.SerGet(false, prefs->serverColumnOrder,
		ELEMENT_COUNT(prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.SerGet(false, prefs->ircColumnWidths,
		ELEMENT_COUNT(prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.SerGet(false, prefs->ircColumnHidden,
		ELEMENT_COUNT(prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.SerGet(false, prefs->ircColumnOrder,
		ELEMENT_COUNT(prefs->ircColumnOrder), _T("IrcColumnOrder"));
d777 12
a788 12
	ini.WriteInt(_T("TableSortItemDownload"), prefs->tableSortItemDownload);
	ini.WriteInt(_T("TableSortItemUpload"), prefs->tableSortItemUpload);
	ini.WriteInt(_T("TableSortItemQueue"), prefs->tableSortItemQueue);
	ini.WriteInt(_T("TableSortItemSearch"), prefs->tableSortItemSearch);
	ini.WriteInt(_T("TableSortItemShared"), prefs->tableSortItemShared);
	ini.WriteInt(_T("TableSortItemServer"), prefs->tableSortItemServer);
	ini.WriteBool(_T("TableSortAscendingDownload"), prefs->tableSortAscendingDownload);
	ini.WriteBool(_T("TableSortAscendingUpload"), prefs->tableSortAscendingUpload);
	ini.WriteBool(_T("TableSortAscendingQueue"), prefs->tableSortAscendingQueue);
	ini.WriteBool(_T("TableSortAscendingSearch"), prefs->tableSortAscendingSearch);
	ini.WriteBool(_T("TableSortAscendingShared"), prefs->tableSortAscendingShared);
	ini.WriteBool(_T("TableSortAscendingServer"), prefs->tableSortAscendingServer);
d794 1
a794 1
		ini.WriteString(buffer2,buffer);
d796 1
a796 1
	ini.WriteInt(_T("ConnectionsGraphRatio"), m_nGraphRatio); // propstats Cax2
d799 2
a800 2
	ini.WriteBool(_T("MlDonkeyCM"), m_bMlDonkeyCM);
	ini.WriteBool(_T("CMNotLog"), m_bCMNotLog);	// netwolf
d805 1
a805 1
	ini.WriteString(_T("A4AFAutoFileHash"), hex_hash);	
d808 9
a816 8
	ini.WriteBool(_T("EnablePassword"),prefs->proxy.EnablePassword,_T("Proxy"));
	ini.WriteBool(_T("EnableProxy"),prefs->proxy.UseProxy,_T("Proxy"));
	ini.WriteString(_T("Name"),prefs->proxy.name,_T("Proxy"));
	ini.WriteString(_T("Password"),prefs->proxy.password,_T("Proxy"));
	ini.WriteString(_T("User"),prefs->proxy.user,_T("Proxy"));
	ini.WriteInt(_T("Port"),prefs->proxy.port,_T("Proxy"));
	ini.WriteInt(_T("Type"),prefs->proxy.type,_T("Proxy"));
	ini.WriteBool(_T("ConnectWithoutProxy"),m_bIsASCWOP,_T("Proxy"));
d818 1
d820 1
a820 1
	ini.WriteString(_T("TotalDownloadedBytes"),buffer ,_T("Statistics"));
d823 1
a823 1
	ini.WriteString(_T("TotalUploadedBytes"),buffer ,_T("Statistics"));
d826 8
a833 7
	ini.WriteString(_T("Password"), CString(m_sWebPassword.Get()), _T("WebServer"));	
	ini.WriteString(_T("PasswordLow"), CString(m_sLowWebPassword.Get()), _T("WebServer"));	
	ini.WriteInt(_T("Port"), m_nWebPort, _T("WebServer"));
	ini.WriteBool(_T("Enabled"), m_bWebEnabled, _T("WebServer"));
	ini.WriteBool(_T("EnabledLow"), m_bWebLowEnabled, _T("WebServer"));
	ini.WriteBool(_T("UseGzip"), m_bWebUseGzip, _T("WebServer"));
	ini.WriteInt(_T("PageRefreshTime"), m_nWebPageRefresh, _T("WebServer"));
d835 3
a837 3
	ini.WriteBool(_T("IntruderDetection"), m_bWebIntruderDetection, _T("WebServer"));
	ini.WriteInt(_T("TempDisableLogin"), m_nWebTempDisableLogin, _T("WebServer"));
	ini.WriteInt(_T("LoginAttemptsAllowed"), m_nWebLoginAttemptsAllowed, _T("WebServer"));
d839 1
a839 1
	ini.WriteString(_T("WebTemplateFile"),prefs->m_sTemplateFile,_T("WebServer"));	// netwolf
d850 6
a855 5
	ini.WriteBool(_T("Enabled"),m_LancastEnabled,_T("Lancast"));
	ini.WriteBool(_T("UseDefaultIP"),m_UseDefaultIP,_T("Lancast"));
	ini.WriteString(_T("IPAddress"),t_strLanCastIP,_T("Lancast"));
	ini.WriteString(_T("Subnet"),t_strLanCastSubnet,_T("Lancast"));
	ini.WriteInt(_T("Port"),m_LancastPort,_T("Lancast"));
d860 2
a861 2
	ini.WriteInt(_T("AcceptMessageFrom"),m_nAcceptMessagesFrom);	
	ini.WriteString(_T("AwayStateMessage"), CString(m_sAwayStateMessage.Get()));
d865 4
a868 3
	ini.WriteBool(_T("AutoFilenameCleanup"), m_bAutoFilenameCleanup, _T("Cleanup"));
	ini.WriteBool(_T("CleanupTags"), m_bFilenameCleanupTags, _T("Cleanup"));
	ini.WriteString(_T("FilenameCleanups"), CString(m_sFilenameCleanups.Get()), _T("Cleanup"));
d871 10
a880 9
	ini.WriteString(_T("Server"), CString(m_sSMTPServer.Get()), _T("SMTP"));
	ini.WriteString(_T("Name"), CString(m_sSMTPName.Get()), _T("SMTP"));
	ini.WriteString(_T("From"), CString(m_sSMTPFrom.Get()), _T("SMTP"));
	ini.WriteString(_T("To"), CString(m_sSMTPTo.Get()), _T("SMTP"));
	ini.WriteString(_T("UserName"), CString(m_sSMTPUserName.Get()), _T("SMTP"));
	ini.WriteString(_T("Password"), CString(m_sSMTPPassword.Get()), _T("SMTP"));
	ini.WriteBool(_T("Authenticated"), m_bSMTPAuthenticated, _T("SMTP"));
	ini.WriteBool(_T("Info"), m_bSMTPInfo, _T("SMTP"));
	ini.WriteBool(_T("Warning"), m_bSMTPWarning, _T("SMTP"));
d883 11
a893 8
	ini.WriteBool(_T("DatFiles"), m_bDatFiles, _T("Backup"));
	ini.WriteBool(_T("MetFiles"), m_bMetFiles, _T("Backup"));
	ini.WriteBool(_T("IniFiles"), m_bIniFiles, _T("Backup"));
	ini.WriteBool(_T("PartFiles"), m_bPartFiles, _T("Backup"));
	ini.WriteBool(_T("PartMetFiles"), m_bPartMetFiles, _T("Backup"));
	ini.WriteBool(_T("AutoBackup"), m_bAutoBackup, _T("Backup"));
	ini.WriteBool(_T("BackupOverwrite"), m_bBackupOverwrite, _T("Backup"));
	ini.WriteString(_T("BackupDir"), CString(m_sBackupDir.Get()), _T("Backup"));
d923 2
a924 1
	CIni* pIni = new CIni(strFileName, _T("eMule"));
d927 3
a929 1
	strPrefsVersion = pIni->GetString(_T("AppVersion"));
d935 1
a935 1
	if ((strCurrVersion != strPrefsVersion) && findFileName.FindFile(strFileName))
d950 2
a951 1
	CIni ini(strFileName, _T("eMule"));
d993 1
a993 1
	m_bUseRQlimit = ini.GetBool(_T("UseRemoteQueueLimit"));
d1215 21
a1235 42
	ini.SerGet(true, prefs->downloadColumnWidths,
		ELEMENT_COUNT(prefs->downloadColumnWidths), _T("DownloadColumnWidths"));
	ini.SerGet(true, prefs->downloadColumnHidden,
		ELEMENT_COUNT(prefs->downloadColumnHidden), _T("DownloadColumnHidden"));
	ini.SerGet(true, prefs->downloadColumnOrder,
		ELEMENT_COUNT(prefs->downloadColumnOrder), _T("DownloadColumnOrder"));
	ini.SerGet(true, prefs->uploadColumnWidths,
		ELEMENT_COUNT(prefs->uploadColumnWidths), _T("UploadColumnWidths"));
	ini.SerGet(true, prefs->uploadColumnHidden,
		ELEMENT_COUNT(prefs->uploadColumnHidden), _T("UploadColumnHidden"));
	ini.SerGet(true, prefs->uploadColumnOrder,
		ELEMENT_COUNT(prefs->uploadColumnOrder), _T("UploadColumnOrder"));
	ini.SerGet(true, prefs->queueColumnWidths,
		ELEMENT_COUNT(prefs->queueColumnWidths), _T("QueueColumnWidths"));
	ini.SerGet(true, prefs->queueColumnHidden,
		ELEMENT_COUNT(prefs->queueColumnHidden), _T("QueueColumnHidden"));
	ini.SerGet(true, prefs->queueColumnOrder,
		ELEMENT_COUNT(prefs->queueColumnOrder), _T("QueueColumnOrder"));
	ini.SerGet(true, prefs->searchColumnWidths,
		ELEMENT_COUNT(prefs->searchColumnWidths), _T("SearchColumnWidths"));
	ini.SerGet(true, prefs->searchColumnHidden,
		ELEMENT_COUNT(prefs->searchColumnHidden), _T("SearchColumnHidden"));
	ini.SerGet(true, prefs->searchColumnOrder,
		ELEMENT_COUNT(prefs->searchColumnOrder), _T("SearchColumnOrder"));
	ini.SerGet(true, prefs->sharedColumnWidths,
		ELEMENT_COUNT(prefs->sharedColumnWidths), _T("SharedColumnWidths"));
	ini.SerGet(true, prefs->sharedColumnHidden,
		ELEMENT_COUNT(prefs->sharedColumnHidden), _T("SharedColumnHidden"));
	ini.SerGet(true, prefs->sharedColumnOrder,
		ELEMENT_COUNT(prefs->sharedColumnOrder), _T("SharedColumnOrder"));
	ini.SerGet(true, prefs->serverColumnWidths,
		ELEMENT_COUNT(prefs->serverColumnWidths), _T("ServerColumnWidths"));
	ini.SerGet(true, prefs->serverColumnHidden,
		ELEMENT_COUNT(prefs->serverColumnHidden), _T("ServerColumnHidden"));
	ini.SerGet(true, prefs->serverColumnOrder,
		ELEMENT_COUNT(prefs->serverColumnOrder), _T("ServerColumnOrder"));
	ini.SerGet(true, prefs->ircColumnWidths,
		ELEMENT_COUNT(prefs->ircColumnWidths), _T("IrcColumnWidths"));
	ini.SerGet(true, prefs->ircColumnHidden,
		ELEMENT_COUNT(prefs->ircColumnHidden), _T("IrcColumnHidden"));
	ini.SerGet(true, prefs->ircColumnOrder,
		ELEMENT_COUNT(prefs->ircColumnOrder), _T("IrcColumnOrder"));
d1280 2
a1281 1
	buffer.Format(ini.GetString(_T("TotalDownloadedBytes"),0,_T("Statistics")));
d1284 1
a1284 1
	buffer.Format(ini.GetString(_T("TotalUploadedBytes"),0,_T("Statistics")));
d1287 3
a1289 2
	prefs->proxy.EnablePassword = ini.GetBool(_T("EnablePassword"),false,_T("Proxy"));
	prefs->proxy.UseProxy = ini.GetBool(_T("EnableProxy"),false,_T("Proxy"));
d1291 6
a1296 6
	prefs->proxy.name = ini.GetString(_T("Name"),buffer,_T("Proxy"));
	prefs->proxy.password = ini.GetString(_T("Password"),buffer,_T("Proxy"));
	prefs->proxy.user = ini.GetString(_T("User"),buffer,_T("Proxy"));
	prefs->proxy.port = ini.GetInt(_T("Port"),1080,_T("Proxy"));
	prefs->proxy.type = ini.GetInt(_T("Type"),PROXYTYPE_NOPROXY,_T("Proxy"));
	m_bIsASCWOP = ini.GetBool(_T("ConnectWithoutProxy"),false,_T("Proxy"));
d1300 8
a1307 7
	m_sWebPassword.Put(ini.GetString(_T("Password"), _T("mypass"), _T("WebServer")).GetBuffer(0));
	m_sLowWebPassword.Put(ini.GetString(_T("PasswordLow"), _T("mypass"), _T("WebServer")).GetBuffer(0));
	m_nWebPort = ini.GetInt(_T("Port"), 4711, _T("WebServer"));
	m_bWebEnabled = ini.GetBool(_T("Enabled"), false, _T("WebServer"));
	m_bWebLowEnabled = ini.GetBool(_T("EnabledLow"), false, _T("WebServer"));
	m_bWebUseGzip = ini.GetBool(_T("UseGzip"), true, _T("WebServer"));
	m_nWebPageRefresh = ini.GetInt(_T("PageRefreshTime"), 120, _T("WebServer"));
d1309 3
a1311 3
	m_bWebIntruderDetection = ini.GetBool(_T("IntruderDetection"), true, _T("WebServer"));
	m_nWebTempDisableLogin = ini.GetInt(_T("TempDisableLogin"), 30, _T("WebServer"));
	m_nWebLoginAttemptsAllowed = ini.GetInt(_T("LoginAttemptsAllowed"), 3, _T("WebServer"));
d1313 1
a1313 1
	sprintf(prefs->m_sTemplateFile,"%s",ini.GetString(_T("WebTemplateFile"),_T("eMule.tmpl")),_T("WebServer"));	// netwolf
d1328 7
a1334 6
	m_LancastEnabled = ini.GetBool(_T("Enabled"),false,_T("Lancast"));
	m_UseDefaultIP = ini.GetBool(_T("UseDefaultIP"),true,_T("Lancast"));
	m_DefaultLancastIP = inet_addr(ini.GetString(_T("IPAddress"),defaultIP,_T("Lancast")));
	m_LancastIP = inet_addr(ini.GetString(_T("IPAddress"),defaultIP,_T("Lancast")));
	m_LancastSubnet = inet_addr(ini.GetString(_T("Subnet"),_T("255.255.0.0"),_T("Lancast")));
	m_LancastPort = ini.GetInt(_T("Port"),5000,_T("Lancast"));
d1346 3
a1348 2
	m_bAutoFilenameCleanup = ini.GetBool(_T("AutoFilenameCleanup"), false, _T("Cleanup"));
	m_bFilenameCleanupTags = ini.GetBool(_T("CleanupTags"), false, _T("Cleanup"));
d1350 1
a1350 1
	m_sFilenameCleanups.Put(ini.GetString(_T("FilenameCleanups"), buffer2, _T("Cleanup")).GetBuffer(0));
d1353 10
a1362 9
	m_sSMTPServer.Put(ini.GetString(_T("Server"), "smtp.server.com", _T("SMTP")).GetBuffer(0));
	m_sSMTPName.Put(ini.GetString(_T("Name"), "eMule Plus Messenger", _T("SMTP")).GetBuffer(0));
	m_sSMTPFrom.Put(ini.GetString(_T("From"), "messenger@@emuleplus.sf.net", _T("SMTP")).GetBuffer(0));
	m_sSMTPTo.Put(ini.GetString(_T("To"), "user@@domain.com", _T("SMTP")).GetBuffer(0));
	m_sSMTPUserName.Put(ini.GetString(_T("UserName"), "username", _T("SMTP")).GetBuffer(0));
	m_sSMTPPassword.Put(ini.GetString(_T("Password"), Crypt("password"), _T("SMTP")).GetBuffer(0));
	m_bSMTPAuthenticated = ini.GetBool(_T("Authenticated"), false, _T("SMTP"));
	m_bSMTPInfo = ini.GetBool(_T("Info"), false, _T("SMTP"));
	m_bSMTPWarning = ini.GetBool(_T("Warning"), false, _T("SMTP"));
d1365 8
a1372 7
	m_bDatFiles = ini.GetBool(_T("DatFiles"),false, _T("Backup"));
	m_bMetFiles = ini.GetBool(_T("MetFiles"),false, _T("Backup"));
	m_bIniFiles = ini.GetBool(_T("IniFiles"),false, _T("Backup"));
	m_bPartFiles = ini.GetBool(_T("PartFiles"),false, _T("Backup"));
	m_bPartMetFiles = ini.GetBool(_T("PartMetFiles"),false, _T("Backup"));
	m_bAutoBackup = ini.GetBool(_T("AutoBackup"), true, _T("Backup"));
	m_bBackupOverwrite = ini.GetBool(_T("BackupOverwrite"), true, _T("Backup"));
d1374 3
a1376 1
	m_sBackupDir.Put(ini.GetString(_T("BackupDir"),buffer,_T("Backup")).GetBuffer(0));
@


1.99
log
@Fixed problem with Backup option
@
text
@d741 1
d1218 1
@


1.98
log
@Added simple encription of SMTP password.
@
text
@d902 1
a902 1
	ini.WriteBool(_T("BackupOverwrite"),true, _T("Backup"));
d1391 1
a1391 1
	m_bAutoBackup = ini.GetBool(_T("BackupOverwrite"), true, _T("Backup"));
@


1.97
log
@BackUp feature [n@@boleo]
@
text
@d895 1
a895 1
        //N@@boleo (Backup feature)
d1379 1
a1379 1
	m_sSMTPPassword.Put(ini.GetString(_T("Password"), "password", _T("SMTP")).GetBuffer(0));
@


1.96
log
@SMTP Messenger: added authentication
@
text
@d895 10
d1383 11
@


1.95
log
@SMTP Messenger
@
text
@d889 3
d1368 3
@


1.94
log
@FEATURE: logging countermeasures made optional [Netwolf]
plus cleanup of unused prefs (transfer full chunks, global load f/l chunks first...)
@
text
@d884 8
d1359 8
@


1.93
log
@FATURE: specify path to WebServer template in preferences
@
text
@a346 1
	//CreateDirectory(GetVlcDir(),0);		//Cax2 - not needed anymore with official video player
a569 2
	//buffer = m_sVlcDir.Get();	//Cax2 we don't save this anymore. m_sVlcDir to be removed in 1b & above
	//ini.WriteString("VLCDir",buffer);
a622 1
//	ini.WriteBool(_T("RemoveNNS"), m_bRemoveNNS);
a708 1
	ini.WriteBool(_T("TransferFullChunks"), m_bTransferFullChunks);
a745 1
	ini.WriteBool(_T("PreviewPrio"), prefs->m_bpreviewprio);
d819 1
d855 1
a855 1
	ini.WriteString(_T("WebTemplateFile"),prefs->m_sTemplateFile,_T("WebServer"));
a1048 1
//	m_bRemoveNNS = ini.GetBool(_T("RemoveNNS"), false);
a1119 1
	prefs->m_bpreviewprio=ini.GetBool(_T("PreviewPrio"),false);
a1159 1
	m_bTransferFullChunks = ini.GetBool(_T("TransferFullChunks"),true);
d1270 1
d1315 1
a1315 1
	sprintf(prefs->m_sTemplateFile,"%s",ini.GetString(_T("WebTemplateFile"),_T("eMule.tmpl")),_T("WebServer"));
a1543 1
					//strLng2 = GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID);
d1599 1
a1599 1
}
@


1.92
log
@Limitless Download
@
text
@a210 1
	//CreateDirectory(GetVlcDir(),0);		//Cax2 not needed anymore
a582 2
	//ini.WriteInt(_T("MaxSourcesPerFileSoft"),prefs->maxsourceperfilesoft);
	//ini.WriteInt(_T("MaxSourcesPerFileUDP"),prefs->maxsourceperfileudp );
d860 1
a976 2
	//prefs->maxsourceperfilesoft=ini.GetInt("MaxSourcesPerFileSoft",360);
	//prefs->maxsourceperfileudp=ini.GetInt("MaxSourcesPerFileUDP",100);
d1322 1
@


1.91
log
@now using Ottavios SLS system [netwolf]
@
text
@d270 5
a274 3
	if( nMaxUp < 4 )
		return ( (nMaxUp * 3 < nMaxDown) ? nMaxUp * 3 : nMaxDown);
	return ( ((nMaxUp < 10) && (nMaxUp * 4 < nMaxDown)) ? nMaxUp * 4 : nMaxDown);
d730 1
a730 1

d1188 1
@


1.90
log
@minor change (filter addition)
@
text
@a614 1
	ini.WriteInt(_T("SLS_LoadQuantities"), m_nSLSLoadQuantities);
d616 1
a616 1
	ini.WriteInt(_T("SLS_MaxSourcesPerFile"),prefs->slsmaxsourcesperfile); // reCDVst
d627 1
a627 1
	ini.WriteBool(_T("RemoveNNS"), m_bRemoveNNS);
d1031 1
a1031 1
	// Original by reCDVst updated by [DonGato]
a1034 4
	
	m_nSLSLoadQuantities = ini.GetInt(_T("SLS_LoadQuantities"),20);
	if(m_nSLSLoadQuantities > 100)
		m_nSLSLoadQuantities = 100;
d1040 6
d1056 1
a1056 1
	m_bRemoveNNS = ini.GetBool(_T("RemoveNNS"), false);
@


1.89
log
@by shutdown force OS flush data direct to disk [Eklmn]&[SlugFiller]
@
text
@d1135 1
a1135 1
	m_sCommentFilter.Put(ini.GetString(_T("CommentFilter"),_T("http://www.")).GetBuffer(0));	//(SyruS) netwolf commentfilter
@


1.88
log
@show average enabled by default
@
text
@d30 1
d294 2
d308 2
@


1.87
log
@unicode cleanup
@
text
@d1179 1
a1179 1
	m_bShowAverageDatarate = ini.GetBool(_T("ShowAverageDatarate"),false);
@


1.86
log
@Added Show Average Datarate option.
@
text
@d551 1
a551 1
	CIni ini( fullpath, "eMule" );
d554 1
a554 1
	ini.WriteString("AppVersion", CURRENT_VERSION_LONG);
d557 1
a557 1
	ini.WriteString("Nick",buffer);
d560 1
a560 1
	ini.WriteString("IncomingDir",buffer );
d563 1
a563 1
	ini.WriteString("TempDir",buffer );
d568 1
a568 1
	ini.WriteString("VideoPlayer",buffer );
d570 11
a580 11
	ini.WriteInt("MaxUpload", m_nMaxUpload);
	ini.WriteInt("MaxDownload", m_nMaxDownload);
	ini.WriteInt("MaxConnections", m_nMaxConnections);
	ini.WriteInt("DeadServerAction", m_nDeadServer);
	ini.WriteInt("Port", m_nPort);
	ini.WriteInt("UDPPort", m_nUDPPort);
	ini.WriteInt("MaxSourcesPerFile", m_nMaxSourcePerFile);
	//ini.WriteInt("MaxSourcesPerFileSoft",prefs->maxsourceperfilesoft);
	//ini.WriteInt("MaxSourcesPerFileUDP",prefs->maxsourceperfileudp );
	ini.WriteWORD("Language", m_nLanguageID);
	ini.WriteInt("SeeShare", m_nSeeShares.Get());
d582 3
a584 3
	ini.WriteBool("PartTrafficEnabled", m_bUsePartTraffic);
	ini.WriteInt("UploadbarStyle", m_nUpbarPartTraffic);
	ini.WriteInt("UploadbarColor", m_nUpbarColorPartTraffic);
d586 38
a623 38
	ini.WriteInt("ToolTipDelay", m_nTooltipDelayTime);
	ini.WriteInt("QueueSize", m_nQueueSize);
	//ini.WriteInt("RemoteQueueLimit", prefs->remotequeuelimit); //remote QR 
	ini.WriteBool("UseRemoteQueueLimit", m_bUseRQlimit);
	ini.WriteInt("StatGraphsInterval", m_nTrafficOMeterInterval);
	ini.WriteInt("StatsInterval", m_nStatsInterval);
	ini.WriteInt("StatsColumnWidth", m_nStatsColumnWidth);
	ini.WriteInt("DetailColumnWidth", m_nDetailColumnWidth);
	ini.WriteString("StatsListExpanded", m_sStatsListExpanded.Get());
	ini.WriteInt("DownloadCapacity", m_nMaxGraphDownloadRate);
	ini.WriteInt("UploadCapacity", m_nMaxGraphUploadRate);
	ini.WriteInt("DeadServerRetries", m_nDeadServerRetries);
	ini.WriteInt("SplitterbarPosition", m_nSplitterBarPosition);
	ini.WriteInt("VariousStatisticsMaxValue", m_nStatsMax);
	ini.WriteInt("StatsAverageMinutes", m_nStatsAverageMinutes);
	ini.WriteInt("MaxConnectionsPerFiveSeconds", m_nMaxConperFive);

	ini.WriteInt("BadClientBanTime", m_nBadClientBanTime);
	ini.WriteInt("BadClientMinRequestTime", m_nMinRequestTime);
	ini.WriteInt("BadClientMinRequestNum", m_nBadClientBan);
	ini.WriteBool("BanMessageEnabled", m_bBanMessageEnabled);
	ini.WriteBool("BanEnabled", m_bBanEnabled); // DbT:BanEnDisable

	ini.WriteInt("SLS_RestoreSourcesTime", m_nSLSRestoreSourcesTime);
	ini.WriteInt("SLS_LoadQuantities", m_nSLSLoadQuantities);
	ini.WriteInt("SLS_WhenSourcesOutdated", m_nSLSOutdated);
	ini.WriteInt("SLS_MaxSourcesPerFile",prefs->slsmaxsourcesperfile); // reCDVst
	ini.WriteBool("SLS_Enable", m_bSLSEnable);

	ini.WriteBool("Reconnect", m_bReconnect);
	ini.WriteBool("Scoresystem", m_nScoreSystem);

	ini.WriteBool("UAP", m_bUAP);
	ini.WriteBool("DAP", m_bDAP);
	ini.WriteBool("DisableXS", m_bDisableXS);
	ini.WriteBool("StartDownloadPaused", m_bStartDownloadPaused);
	ini.WriteBool("DownloadPausedOnComplete", m_bDownloadPausedOnComplete);
	ini.WriteBool("RemoveNNS", m_bRemoveNNS);
d625 1
a625 1
	ini.WriteString("ToolbarSettings", m_sToolbarSettings.Get()); // Added by reCDVst
d627 1
a627 1
	ini.WriteString("ToolbarBitmap",buffer);
d629 24
a652 24
	ini.WriteString("ToolbarBitmapFolder",buffer);
	ini.WriteInt("ToolbarLabels", m_nToolbarLabels);
	ini.WriteBool("Serverlist", m_bAutoServerList);
	ini.WriteBool("UpdateNotify", m_bUpdateNotify);
	ini.WriteBool("MinimizeToTray", m_bMinToTray);
	ini.WriteBool("AddServersFromConnections", m_bAddServersFromConn);
	ini.WriteBool("Splashscreen", m_bSplashScreen);
	ini.WriteBool("BringToFront", m_bBringToForeground);
	ini.WriteBool("TransferDoubleClick", m_nTransferDoubleclick);
	ini.WriteBool("BeepOnError", m_bBeepOnError);
	ini.WriteBool("ConfirmExit", m_bConfirmExit);
	ini.WriteBool("FilterBadIPs", m_bFilterBadIP);
	ini.WriteBool("FilterServersByIP", m_bFilterServersByIP);
	ini.WriteBool("Autoconnect", m_bAutoConnect);
	ini.WriteBool("OnlineSignature", m_bOnlineSig);
	ini.WriteBool("StartupMinimized", m_bStartMinimized);
	ini.WriteBool("SafeConnect", m_bSafeConnect);
	ini.WriteBool("ToolbarSpeedMeter", m_bShowToolbarSpeedMeter);
	ini.WriteBool("CloseToTray", m_bCloseToTray);
	ini.WriteBool("DetailsOnClick", m_bDetailsOnClick);
	ini.WriteInt("SrvConTimeout", m_nSrvConTimeout);
	ini.WriteBool("SlowComplete", m_bSlowComplete);
	ini.WriteInt("SlowCompleteBlockSize", m_nSlowCompleteBlockSize);
	ini.WriteBool("ShowRatesOnTitle",prefs->showRatesInTitle);
d655 3
a657 3
    ini.WriteBool("AutoConnectStaticOnly", m_bAutoConnectStaticOnly);  
    ini.WriteBool("GlobalSearch", prefs->globalsearch);  
    ini.WriteInt ("3DDepth", m_nDepth3D); 
d660 22
a681 22
	ini.WriteBool("NotifyOnDownload", m_bUseDownloadNotifier);
	ini.WriteBool("NotifyOnDownloadAdd", m_bUseDownloadAddNotifier);
	ini.WriteBool("NotifyOnChat", m_bUseChatNotifier);		  
	ini.WriteBool("NotifyOnLog", m_bUseLogNotifier);
	ini.WriteBool("NotifierUseSound", m_bUseSoundInNotifier);
	ini.WriteBool("NotifierPopEveryChatMessage", m_bNotifierPopsEveryChatMsg);
	ini.WriteBool("NotifyOnImportantError", m_bNotifierImportantError);
	ini.WriteString("NotifierSoundPath", CString(m_sNotifierSoundFilePath.Get()));

	ini.WriteString("MessageFilter",prefs->messageFilter);
	ini.WriteString("CommentFilter", m_sCommentFilter.Get());	//(SyruS) netwolf commentfilter
	ini.WriteString("TxtEditor",prefs->TxtEditor);
	ini.WriteBool("DisableRatingIcons", m_bDisableRatingIcons);	//netwolf: disable icons
    ini.WriteString("IRCServer", m_sIRCServer.Get());
	ini.WriteString("IRCNick", m_sIRCNick.Get());
	ini.WriteBool("IRCAddTimestamp", m_bIRCAddTimestamp);
	ini.WriteString("IRCFilterName", m_sIRCChanNameFilter.Get());
	ini.WriteInt("IRCFilterUser", m_nIRCChannelUserFilter);
	ini.WriteBool("IRCUseFilter", m_bIRCUseChanFilter);
	ini.WriteString("IRCPerformString", m_sIRCPerformString.Get());
	ini.WriteBool("IRCUsePerform", m_bIRCUsePerform);
	ini.WriteBool("IRCListOnConnect", m_bIRCListOnConnect);
d683 15
a697 15
	ini.WriteBool("IRCIgnoreInfoMessage", m_bIRCIgnoreInfoMessage);
	ini.WriteBool("IRCIgnoreEmuleProtoInfoMessage", m_bIRCIgnoreEmuleProtoInfoMessage);
	ini.WriteBool("SmartIdCheck", m_bSmartIdCheck);

	ini.WriteBool("UseSortingDefaults", m_bUseSort);
	ini.WriteBool("Use2ndSortSources", m_bUseSrcSortCol2);
	ini.WriteInt("SortServersCode", m_nServerSortCol);	
	ini.WriteInt("SortUploadsCode", m_nUploadSortCol);
	ini.WriteInt("SortQueueCode", m_nQueueSortCol);
	ini.WriteInt("SortSearchCode", m_nSearchSortCol);
	ini.WriteInt("SortIrcCode", m_nIRCSortCol);
	ini.WriteInt("SortFilesCode", m_nFileSortCol);
	ini.WriteInt("SortDownloadsCode", m_nDownloadSortCol);
	ini.WriteInt("1stSortSourcesCode", m_nSrcSortCol1);
	ini.WriteInt("2ndSortSourcesCode", m_nSrcSortCol2);
d700 43
a742 43
	ini.WriteBool("CommunityEnabled", m_bCommunityEnabled);
	ini.WriteString("CommunityString", m_sCommunityString.Get());
	ini.WriteBool("CommunityNoBan", m_bCommunityNoBan);
	ini.WriteInt("NotificationDisplayTime", m_nNotificationDisplayTime);
	ini.WriteInt("NotificationFontSize", m_nNotificationFontSize);
	ini.WriteInt("Profile", m_nProfile);
	ini.WriteInt("PriorityHigh", m_nPriorityHigh);
	ini.WriteInt("PriorityLow", m_nPriorityLow);
	ini.WriteBool("RestartWaiting", m_bRestartWaiting);
	ini.WriteBool("LogToFile", m_bLogToFile);
	ini.WriteBool("TransferFullChunks", m_bTransferFullChunks);
	ini.WriteBool("BugReport", prefs->BugReport);
	ini.WriteBool("DisableXSUpTo", m_bDisableXSUpTo);
	ini.WriteInt("XSUpTo", m_nXSUpTo);
	ini.WriteString("UsedFont", m_sUsedFont.Get());
	ini.WriteInt("FontSize", m_nFontSize);
	ini.WriteInt("HashingPriority", m_HashingPriority);
	ini.WriteBool("UploadParts", m_bUploadParts);
	ini.WriteBool("A4AFStringEnabled", m_bA4AFStringEnabled);
	ini.WriteInt("SearchMethod", m_nSearchMethod);
	ini.WriteBool("AutoTakeED2KLinks", m_bAutoTakeLinks); 
	ini.WriteInt("FileBufferSizePref", m_nFileBufferSize);
	ini.WriteInt("MainProcessPriority", m_nMainProcessPriority);
	ini.WriteBool("ShowAverageDatarate",m_bShowAverageDatarate);

	ini.WriteBool("SCHEnabled", m_bSCHEnabled);
	ini.WriteBool("SCHExceptMon", m_bSCHExceptMon);
	ini.WriteBool("SCHExceptTue", m_bSCHExceptTue);
	ini.WriteBool("SCHExceptWed", m_bSCHExceptWed);
	ini.WriteBool("SCHExceptThu", m_bSCHExceptThu);
	ini.WriteBool("SCHExceptFri", m_bSCHExceptFri);
	ini.WriteBool("SCHExceptSat", m_bSCHExceptSat);
	ini.WriteBool("SCHExceptSun", m_bSCHExceptSun);
	ini.WriteInt("SCHShift1",m_nSCHShift1);
	ini.WriteInt("SCHShift2",m_nSCHShift2);
	ini.WriteInt("SCHShift1Up",m_nSCHShift1Upload);
	ini.WriteInt("SCHShift1Down",m_nSCHShift1Download);
	ini.WriteInt("SCHShift1Conn",m_nSCHShift1conn);
	ini.WriteInt("SCHShift15sec",m_nSCHShift15sec);
	ini.WriteInt("SCHShift2Up",m_nSCHShift2Upload);
	ini.WriteInt("SCHShift2Down",m_nSCHShift2Download);
	ini.WriteInt("SCHShift2Conn",m_nSCHShift2conn);
	ini.WriteInt("SCHShift25sec",m_nSCHShift25sec);
d745 1
a745 1
	ini.WriteBool("MultipleInstances", m_bMultiple);
d747 4
a750 4
	ini.WriteBool("Verbose", m_bVerbose);
	ini.WriteBool("PreviewPrio", prefs->m_bpreviewprio);
	ini.WriteBool("UpdateQueueList", m_bUpdateQueueList);
	ini.WriteBool("ManualHighPrio", m_bManualHighPrio);
d752 2
a753 2
	ini.WriteBool("ShowOverhead", m_bShowOverhead);	//Cax2 re-enabled this preference
	ini.WriteBool("VideoPreviewBackupped", m_bBackupPreview);	//Cax2 string kept for compatibility with off client
d756 1
a756 1
		ELEMENT_COUNT(prefs->downloadColumnWidths), "DownloadColumnWidths");
d758 1
a758 1
		ELEMENT_COUNT(prefs->downloadColumnHidden), "DownloadColumnHidden");
d760 1
a760 1
		ELEMENT_COUNT(prefs->downloadColumnOrder), "DownloadColumnOrder");
d762 1
a762 1
		ELEMENT_COUNT(prefs->uploadColumnWidths), "UploadColumnWidths");
d764 1
a764 1
		ELEMENT_COUNT(prefs->uploadColumnHidden), "UploadColumnHidden");
d766 1
a766 1
		ELEMENT_COUNT(prefs->uploadColumnOrder), "UploadColumnOrder");
d768 1
a768 1
		ELEMENT_COUNT(prefs->queueColumnWidths), "QueueColumnWidths");
d770 1
a770 1
		ELEMENT_COUNT(prefs->queueColumnHidden), "QueueColumnHidden");
d772 1
a772 1
		ELEMENT_COUNT(prefs->queueColumnOrder), "QueueColumnOrder");
d774 1
a774 1
		ELEMENT_COUNT(prefs->searchColumnWidths), "SearchColumnWidths");
d776 1
a776 1
		ELEMENT_COUNT(prefs->searchColumnHidden), "SearchColumnHidden");
d778 1
a778 1
		ELEMENT_COUNT(prefs->searchColumnOrder), "SearchColumnOrder");
d780 1
a780 1
		ELEMENT_COUNT(prefs->sharedColumnWidths), "SharedColumnWidths");
d782 1
a782 1
		ELEMENT_COUNT(prefs->sharedColumnHidden), "SharedColumnHidden");
d784 1
a784 1
		ELEMENT_COUNT(prefs->sharedColumnOrder), "SharedColumnOrder");
d786 1
a786 1
		ELEMENT_COUNT(prefs->serverColumnWidths), "ServerColumnWidths");
d788 1
a788 1
		ELEMENT_COUNT(prefs->serverColumnHidden), "ServerColumnHidden");
d790 1
a790 1
		ELEMENT_COUNT(prefs->serverColumnOrder), "ServerColumnOrder");
d792 1
a792 1
		ELEMENT_COUNT(prefs->ircColumnWidths), "IrcColumnWidths");
d794 1
a794 1
		ELEMENT_COUNT(prefs->ircColumnHidden), "IrcColumnHidden");
d796 1
a796 1
		ELEMENT_COUNT(prefs->ircColumnOrder), "IrcColumnOrder");
d799 12
a810 12
	ini.WriteInt("TableSortItemDownload", prefs->tableSortItemDownload);
	ini.WriteInt("TableSortItemUpload", prefs->tableSortItemUpload);
	ini.WriteInt("TableSortItemQueue", prefs->tableSortItemQueue);
	ini.WriteInt("TableSortItemSearch", prefs->tableSortItemSearch);
	ini.WriteInt("TableSortItemShared", prefs->tableSortItemShared);
	ini.WriteInt("TableSortItemServer", prefs->tableSortItemServer);
	ini.WriteBool("TableSortAscendingDownload", prefs->tableSortAscendingDownload);
	ini.WriteBool("TableSortAscendingUpload", prefs->tableSortAscendingUpload);
	ini.WriteBool("TableSortAscendingQueue", prefs->tableSortAscendingQueue);
	ini.WriteBool("TableSortAscendingSearch", prefs->tableSortAscendingSearch);
	ini.WriteBool("TableSortAscendingShared", prefs->tableSortAscendingShared);
	ini.WriteBool("TableSortAscendingServer", prefs->tableSortAscendingServer);
d814 2
a815 2
		buffer.Format("%I64Lu",GetStatsColor(i));
		buffer2.Format("StatColor%i",i);
d818 1
a818 1
	ini.WriteInt("ConnectionsGraphRatio", m_nGraphRatio); // propstats Cax2
d821 1
a821 1
	ini.WriteBool("MlDonkeyCM", m_bMlDonkeyCM);
d826 1
a826 1
	ini.WriteString("A4AFAutoFileHash", hex_hash);	
d829 8
a836 8
	ini.WriteBool("EnablePassword",prefs->proxy.EnablePassword,"Proxy");
	ini.WriteBool("EnableProxy",prefs->proxy.UseProxy,"Proxy");
	ini.WriteString("Name",prefs->proxy.name,"Proxy");
	ini.WriteString("Password",prefs->proxy.password,"Proxy");
	ini.WriteString("User",prefs->proxy.user,"Proxy");
	ini.WriteInt("Port",prefs->proxy.port,"Proxy");
	ini.WriteInt("Type",prefs->proxy.type,"Proxy");
	ini.WriteBool("ConnectWithoutProxy",m_bIsASCWOP,"Proxy");
d838 2
a839 2
	buffer.Format("%I64Lu", m_nTotalDownloadedBytes.Get());
	ini.WriteString("TotalDownloadedBytes",buffer ,"Statistics");
d841 2
a842 2
	buffer.Format("%I64Lu", m_nTotalUploadedBytes.Get());
	ini.WriteString("TotalUploadedBytes",buffer ,"Statistics");
d845 7
a851 7
	ini.WriteString("Password", CString(m_sWebPassword.Get()), "WebServer");	
	ini.WriteString("PasswordLow", CString(m_sLowWebPassword.Get()), "WebServer");	
	ini.WriteInt("Port", m_nWebPort, "WebServer");
	ini.WriteBool("Enabled", m_bWebEnabled, "WebServer");
	ini.WriteBool("EnabledLow", m_bWebLowEnabled, "WebServer");
	ini.WriteBool("UseGzip", m_bWebUseGzip, "WebServer");
	ini.WriteInt("PageRefreshTime", m_nWebPageRefresh, "WebServer");
d853 3
a855 3
	ini.WriteBool("IntruderDetection", m_bWebIntruderDetection, "WebServer");
	ini.WriteInt("TempDisableLogin", m_nWebTempDisableLogin, "WebServer");
	ini.WriteInt("LoginAttemptsAllowed", m_nWebLoginAttemptsAllowed, "WebServer");
d862 1
a862 1
	t_strLanCastIP.Format("%i.%i.%i.%i",(uint8)m_LancastIP,(uint8)(m_LancastIP>>8),(uint8)(m_LancastIP>>16),(uint8)(m_LancastIP>>24));
d865 1
a865 1
	t_strLanCastSubnet.Format("%i.%i.%i.%i",(uint8)m_LancastSubnet,(uint8)(m_LancastSubnet>>8),(uint8)(m_LancastSubnet>>16),(uint8)(m_LancastSubnet>>24));
d867 5
a871 5
	ini.WriteBool("Enabled",m_LancastEnabled,"Lancast");
	ini.WriteBool("UseDefaultIP",m_UseDefaultIP,"Lancast");
	ini.WriteString("IPAddress",t_strLanCastIP,"Lancast");
	ini.WriteString("Subnet",t_strLanCastSubnet,"Lancast");
	ini.WriteInt("Port",m_LancastPort,"Lancast");
d876 2
a877 2
	ini.WriteInt("AcceptMessageFrom",m_nAcceptMessagesFrom);	
	ini.WriteString("AwayStateMessage", CString(m_sAwayStateMessage.Get()));
d881 3
a883 3
	ini.WriteBool("AutoFilenameCleanup", m_bAutoFilenameCleanup, "Cleanup");
	ini.WriteBool("CleanupTags", m_bFilenameCleanupTags, "Cleanup");
	ini.WriteString("FilenameCleanups", CString(m_sFilenameCleanups.Get()), "Cleanup");
d912 2
a913 2
	strFileName.Format("%spreferences.ini", appdir);
	CIni* pIni = new CIni(strFileName, "eMule");
d916 1
a916 1
	strPrefsVersion = pIni->GetString("AppVersion");
d928 1
a928 1
		strNewName.Format("%spreferences[%s].ini", appdir,strPrefsVersion);	
d937 1
a937 1
	CIni ini(strFileName, "eMule");
d947 2
a948 2
	strDefNick.Format("%s [eMule Plus v%s]", buffer, CURRENT_VERSION_LONG);
	m_sNick.Put(ini.GetString("Nick",strDefNick).GetBuffer(0));
d950 2
a951 2
	buffer.Format("%sIncoming",appdir);
	m_sIncomingDir.Put(ini.GetString("IncomingDir",buffer).GetBuffer(0));
d953 2
a954 2
	buffer.Format("%sTemp",appdir);
	m_sTempDir.Put(ini.GetString("TempDir",buffer).GetBuffer(0));
d956 7
a962 7
	buffer.Format("%sVLC",appdir);
	m_sVlcDir.Put(ini.GetString("VLCDir",buffer).GetBuffer(0));
	buffer.Format("%s\\vlc.exe",GetVlcDir());		//Cax2 - for backward compatibility
	m_sVideoPlayer.Put(ini.GetString("VideoPlayer",buffer).GetBuffer(0));		//Cax2 - replace buffer with "" in later (non b-compatible) versions
	m_nMaxGraphUploadRate = ini.GetInt("UploadCapacity",16);
	m_nMaxGraphDownloadRate = ini.GetInt("DownloadCapacity",96);
	m_nMaxUpload = ini.GetInt("MaxUpload",UNLIMITED);		//Cax2 new limits enforced on old settings
d965 1
a965 1
	m_nMaxDownload = ini.GetInt("MaxDownload",UNLIMITED);
d968 5
a972 5
	m_nMaxConnections = ini.GetInt("MaxConnections",GetRecommendedMaxConnections());
	m_nDeadServer = ini.GetInt("DeadServerAction",2);
	m_nPort = ini.GetInt("Port",4662);
	m_nUDPPort = ini.GetInt("UDPPort",m_nPort + 10);
	m_nMaxSourcePerFile = ini.GetInt("MaxSourcesPerFile",400);
d975 1
a975 1
	m_nQueueSize = ini.GetInt("QueueSize", MIN_QUEUE*3);
d981 3
a983 3
	m_bUseRQlimit = ini.GetBool("UseRemoteQueueLimit");
	m_nLanguageID = ini.GetWORD("Language",0);
	m_nSeeShares.Put((enSeeShare)ini.GetInt("SeeShare",SEE_SHARE_EVERYBODY));
d985 3
a987 3
	m_bUsePartTraffic = ini.GetBool("PartTrafficEnabled",false);
	m_nUpbarPartTraffic = ini.GetInt("UploadbarStyle", 2);
	m_nUpbarColorPartTraffic = ini.GetInt("UploadbarColor", 0);
d989 14
a1002 14
	m_nTooltipDelayTime = ini.GetInt("ToolTipDelay",1);
	m_nTrafficOMeterInterval = ini.GetInt("StatGraphsInterval",3);
	m_nStatsInterval = ini.GetInt("statsInterval",5);
	m_nStatsColumnWidth = ini.GetInt("StatsColumnWidth", 150);
	m_nDetailColumnWidth = ini.GetInt("DetailColumnWidth", 150);
	
	m_sStatsListExpanded.Put(ini.GetString("StatsListExpanded", "").GetBuffer(0)); // missing entrys get expanded ("" = all expanded)

	m_nDeadServerRetries = ini.GetInt("DeadServerRetries",1);
	m_nSplitterBarPosition = ini.GetInt("SplitterbarPosition",75);
	m_nStatsMax = ini.GetInt("VariousStatisticsMaxValue",100);
	m_nStatsAverageMinutes = ini.GetInt("StatsAverageMinutes",5);
	m_nMaxConperFive = ini.GetInt("MaxConnectionsPerFiveSeconds",GetDefaultMaxConperFive());
	prefs->showRatesInTitle=ini.GetBool("ShowRatesOnTitle",false);
d1013 1
a1013 1
	m_nBadClientBanTime = ini.GetInt("BadClientBanTime",3600000);
d1017 1
a1017 1
	m_nMinRequestTime = ini.GetInt("BadClientMinRequestTime",590000);
d1021 1
a1021 1
	m_nBadClientBan = ini.GetInt("BadClientMinRequestNum",3);
d1024 2
a1025 2
	m_bBanMessageEnabled = ini.GetBool("BanMessageEnabled", false);
	m_bBanEnabled = ini.GetBool("BanEnabled",true); // DbT:BanEnDisable
d1028 1
a1028 1
	m_nSLSRestoreSourcesTime = ini.GetInt("SLS_RestoreSourcesTime",7200000);
d1032 1
a1032 1
	m_nSLSLoadQuantities = ini.GetInt("SLS_LoadQuantities",20);
d1036 1
a1036 1
	m_nSLSOutdated = ini.GetInt("SLS_WhenSourcesOutdated",2);
d1040 1
a1040 1
	m_bSLSEnable = ini.GetBool("SLS_Enable",false);
d1042 2
a1043 2
	m_bReconnect = ini.GetBool("Reconnect",true);
	m_nScoreSystem = ini.GetBool("Scoresystem",true);
d1045 29
a1073 29
	m_bUAP = ini.GetBool("UAP", true);
	m_bDAP = ini.GetBool("DAP", true);
	m_bDisableXS = ini.GetBool("DisableXS", false);
	m_bStartDownloadPaused = ini.GetBool("StartDownloadPaused", false);
	m_bDownloadPausedOnComplete = ini.GetBool("DownloadPausedOnComplete", false);
	m_bRemoveNNS = ini.GetBool("RemoveNNS", false);
	
	m_sToolbarSettings.Put(ini.GetString("ToolbarSettings", strDefaultToolbar).GetBuffer(0));
	m_sToolbarBitmap.Put(ini.GetString("ToolbarBitmap", "").GetBuffer(0)); // Added by reCDVst
	m_sToolbarBitmapFolder.Put(ini.GetString("ToolbarBitmapFolder", "").GetBuffer(0)); // Added by reCDVst
	m_nToolbarLabels = ini.GetInt("ToolbarLabels",1);
	m_bAutoServerList = ini.GetBool("Serverlist",false);
	m_bUpdateNotify = ini.GetBool("UpdateNotify",true);
	m_bMinToTray = ini.GetBool("MinimizeToTray",true);
	m_bAddServersFromConn = ini.GetBool("AddServersFromConnections",true);
	m_bSplashScreen = ini.GetBool("Splashscreen",true);
	m_bBringToForeground = ini.GetBool("BringToFront",true);
	m_nTransferDoubleclick = ini.GetBool("TransferDoubleClick",true);
	m_bBeepOnError = ini.GetBool("BeepOnError",true);
	m_bConfirmExit = ini.GetBool("ConfirmExit",true);
	m_bFilterBadIP = ini.GetBool("FilterBadIPs",true);
	m_bFilterServersByIP = ini.GetBool("FilterServersByIP",false);
	m_bAutoConnect = ini.GetBool("Autoconnect",false);
	m_bOnlineSig = ini.GetBool("OnlineSignature",false);
	m_bStartMinimized = ini.GetBool("StartupMinimized",false);
	m_bSafeConnect = ini.GetBool("SafeConnect",true);
	m_bShowToolbarSpeedMeter = ini.GetBool("ToolbarSpeedMeter", false);
	m_bCloseToTray = ini.GetBool("CloseToTray",false);	
	m_bDetailsOnClick = ini.GetBool("DetailsOnClick",false);	
d1075 1
a1075 1
	m_nSrvConTimeout = ini.GetInt("SrvConTimeout",20000);		//Cax2 - bugfix for time out - ticks are in milliseconds!!!!!
d1081 2
a1082 2
	m_bSlowComplete = ini.GetBool("SlowComplete",false);	
	m_nSlowCompleteBlockSize = ini.GetInt("SlowCompleteBlockSize",32);
d1087 3
a1089 3
	m_bAutoConnectStaticOnly = ini.GetBool("AutoConnectStaticOnly",false); 
	prefs->globalsearch = ini.GetBool("GlobalSearch",true); 
	m_nDepth3D = ini.GetInt("3DDepth", 0);
d1092 2
a1093 2
	if (strPrefsVersion < "0.25a") // before 0.25a
		if (ini.GetBool("FlatStatusBar",false))
d1099 18
a1116 18
	m_bUseDownloadAddNotifier = ini.GetBool("NotifyOnDownloadAdd",false);
	m_bUseDownloadNotifier = ini.GetBool("NotifyOnDownload",false);
	m_bUseChatNotifier = ini.GetBool("NotifyOnChat",false);
	m_bUseLogNotifier = ini.GetBool("NotifyOnLog",false);
	m_bUseSoundInNotifier = ini.GetBool("NotifierUseSound",false);
	m_bNotifierPopsEveryChatMsg = ini.GetBool("NotifierPopEveryChatMessage",false);
	m_bNotifierImportantError = ini.GetBool("NotifyOnImportantError",false);
	m_sNotifierSoundFilePath.Put(ini.GetString("NotifierSoundPath","").GetBuffer(0));

	m_sIRCServer.Put(ini.GetString("IRCServer","irc.liquidirc.com").GetBuffer(0));
	m_sIRCNick.Put(ini.GetString("IRCNick","eMule Plus").GetBuffer(0));
	m_bIRCAddTimestamp = ini.GetBool("IRCAddTimestamp",true);
	m_sIRCChanNameFilter.Put(ini.GetString("IRCFilterName", "").GetBuffer(0));
	m_bIRCUseChanFilter = ini.GetBool("IRCUseFilter", false);
	m_nIRCChannelUserFilter = ini.GetInt("IRCFilterUser", 0);
	m_sIRCPerformString.Put(ini.GetString("IRCPerformString", "/join #emule").GetBuffer(0));
	m_bIRCUsePerform = ini.GetBool("IRCUsePerform", false);
	m_bIRCListOnConnect = ini.GetBool("IRCListOnConnect", true);
d1118 26
a1143 26
	m_bIRCIgnoreInfoMessage = ini.GetBool("IRCIgnoreInfoMessage", false);
	m_bIRCIgnoreEmuleProtoInfoMessage = ini.GetBool("IRCIgnoreEmuleProtoInfoMessage", true);
	m_bSmartIdCheck = ini.GetBool("SmartIdCheck",true);
	m_bVerbose = ini.GetBool("Verbose",false);
	prefs->m_bpreviewprio=ini.GetBool("PreviewPrio",false);
	m_bUpdateQueueList = ini.GetBool("UpdateQueueList",false);
	m_bManualHighPrio=ini.GetBool("ManualHighPrio",false);
	m_bShowOverhead = ini.GetBool("ShowOverhead",true);
	m_bBackupPreview = ini.GetBool("VideoPreviewBackupped",false);	//Cax2 string kept for compatibility with off client

	prefs->TxtEditor = ini.GetString("TxtEditor","notepad.exe");
	prefs->messageFilter=ini.GetString("MessageFilter","Your client has an infinite queue|http://www.chez.com/theworld/");
	m_sCommentFilter.Put(ini.GetString("CommentFilter","http://www.").GetBuffer(0));	//(SyruS) netwolf commentfilter
	m_bDisableRatingIcons=ini.GetBool("DisableRatingIcons",false);	//netwolf: disable icons

	m_bUseSort = ini.GetBool("UseSortingDefaults",true);
	m_bUseSrcSortCol2 = ini.GetBool("Use2ndSortSources",false);
	m_nServerSortCol = ini.GetInt("SortServersCode",0);
	m_nUploadSortCol = ini.GetInt("SortUploadsCode",12);
	m_nQueueSortCol = ini.GetInt("SortQueueCode",105);
	m_nSearchSortCol = ini.GetInt("SortSearchCode",12);
	m_nIRCSortCol = ini.GetInt("SortIrcCode",11);
	m_nFileSortCol = ini.GetInt("SortFilesCode",0);
	m_nDownloadSortCol = ini.GetInt("SortDownloadsCode",8);
	m_nSrcSortCol1 = ini.GetInt("1stSortSourcesCode",0);
	m_nSrcSortCol2 = ini.GetInt("2ndSortSourcesCode",255);
d1146 8
a1153 8
	m_bCommunityEnabled = ini.GetBool("CommunityEnabled", false);
	m_sCommunityString.Put(ini.GetString("CommunityString","").GetBuffer(0));
	m_bCommunityNoBan = ini.GetBool("CommunityNoBan", false);
	m_nNotificationDisplayTime = ini.GetInt("NotificationDisplayTime",4000);
	m_nNotificationFontSize = ini.GetInt("NotificationFontSize",70);
	m_nProfile = ini.GetInt("Profile",0);
	m_nPriorityHigh = ini.GetInt("PriorityHigh",100);
	m_nPriorityLow = ini.GetInt("PriorityLow",300);
d1161 6
a1166 6
	m_bRestartWaiting = ini.GetBool("RestartWaiting",true);
	m_bLogToFile = ini.GetBool("LogToFile",false);
	m_bTransferFullChunks = ini.GetBool("TransferFullChunks",true);
	prefs->BugReport = ini.GetBool("BugReport",false);
	m_bDisableXSUpTo = ini.GetBool("DisableXSUpTo",false);
	m_nXSUpTo = ini.GetInt("XSUpTo",GetMaxSourcePerFileSoft());
d1169 30
a1198 30
	m_sUsedFont.Put(ini.GetString("UsedFont", "MS Sans Serif").GetBuffer(0));
	m_nFontSize = ini.GetInt("FontSize",80);
	m_HashingPriority.Put((enHashPriority)ini.GetInt("HashingPriority",2));
	m_bUploadParts = ini.GetBool("UploadParts",false);
	m_bA4AFStringEnabled = ini.GetBool("A4AFStringEnabled", false);
	m_bBanMessageEnabled = ini.GetBool("BanMessageEnabled", false);
	m_nSearchMethod = ini.GetInt("SearchMethod",0);
	m_bAutoTakeLinks = ini.GetBool("AutoTakeED2KLinks",false);
	m_nFileBufferSize = ini.GetInt("FileBufferSizePref",16);
	m_nMainProcessPriority = ini.GetInt("MainProcessPriority",0);	// netwolf 05.05.03 (default: normal MainProcessPriority)
	m_bShowAverageDatarate = ini.GetBool("ShowAverageDatarate",false);

	m_bSCHEnabled = ini.GetBool("SCHEnabled", false);
	m_bSCHExceptMon = ini.GetBool("SCHExceptMon", false);
	m_bSCHExceptTue = ini.GetBool("SCHExceptTue", false);
	m_bSCHExceptWed = ini.GetBool("SCHExceptWed", false);
	m_bSCHExceptThu = ini.GetBool("SCHExceptThu", false);
	m_bSCHExceptFri = ini.GetBool("SCHExceptFri", false);
	m_bSCHExceptSat = ini.GetBool("SCHExceptSat", true);
	m_bSCHExceptSun = ini.GetBool("SCHExceptSun", true);
	m_nSCHShift1 = ini.GetInt("SCHShift1",64800);
	m_nSCHShift2 = ini.GetInt("SCHShift2",21600);
	m_nSCHShift1Upload = ini.GetInt("SCHShift1Up",UNLIMITED);
	m_nSCHShift1Download = ini.GetInt("SCHShift1Down",UNLIMITED);
	m_nSCHShift1conn = ini.GetInt("SCHShift1conn",512);
	m_nSCHShift15sec = ini.GetInt("SCHShift15sec",40);
	m_nSCHShift2Upload = ini.GetInt("SCHShift2Up",UNLIMITED);
	m_nSCHShift2Download = ini.GetInt("SCHShift2Down",UNLIMITED);
	m_nSCHShift2conn = ini.GetInt("SCHShift2conn",256);
	m_nSCHShift25sec = ini.GetInt("SCHShift25sec",20);
d1200 1
a1200 1
	m_bMultiple = ini.GetBool("MultipleInstances",false);
d1203 1
a1203 1
		ELEMENT_COUNT(prefs->downloadColumnWidths), "DownloadColumnWidths");
d1205 1
a1205 1
		ELEMENT_COUNT(prefs->downloadColumnHidden), "DownloadColumnHidden");
d1207 1
a1207 1
		ELEMENT_COUNT(prefs->downloadColumnOrder), "DownloadColumnOrder");
d1209 1
a1209 1
		ELEMENT_COUNT(prefs->uploadColumnWidths), "UploadColumnWidths");
d1211 1
a1211 1
		ELEMENT_COUNT(prefs->uploadColumnHidden), "UploadColumnHidden");
d1213 1
a1213 1
		ELEMENT_COUNT(prefs->uploadColumnOrder), "UploadColumnOrder");
d1215 1
a1215 1
		ELEMENT_COUNT(prefs->queueColumnWidths), "QueueColumnWidths");
d1217 1
a1217 1
		ELEMENT_COUNT(prefs->queueColumnHidden), "QueueColumnHidden");
d1219 1
a1219 1
		ELEMENT_COUNT(prefs->queueColumnOrder), "QueueColumnOrder");
d1221 1
a1221 1
		ELEMENT_COUNT(prefs->searchColumnWidths), "SearchColumnWidths");
d1223 1
a1223 1
		ELEMENT_COUNT(prefs->searchColumnHidden), "SearchColumnHidden");
d1225 1
a1225 1
		ELEMENT_COUNT(prefs->searchColumnOrder), "SearchColumnOrder");
d1227 1
a1227 1
		ELEMENT_COUNT(prefs->sharedColumnWidths), "SharedColumnWidths");
d1229 1
a1229 1
		ELEMENT_COUNT(prefs->sharedColumnHidden), "SharedColumnHidden");
d1231 1
a1231 1
		ELEMENT_COUNT(prefs->sharedColumnOrder), "SharedColumnOrder");
d1233 1
a1233 1
		ELEMENT_COUNT(prefs->serverColumnWidths), "ServerColumnWidths");
d1235 1
a1235 1
		ELEMENT_COUNT(prefs->serverColumnHidden), "ServerColumnHidden");
d1237 1
a1237 1
		ELEMENT_COUNT(prefs->serverColumnOrder), "ServerColumnOrder");
d1239 1
a1239 1
		ELEMENT_COUNT(prefs->ircColumnWidths), "IrcColumnWidths");
d1241 1
a1241 1
		ELEMENT_COUNT(prefs->ircColumnHidden), "IrcColumnHidden");
d1243 1
a1243 1
		ELEMENT_COUNT(prefs->ircColumnOrder), "IrcColumnOrder");
d1246 12
a1257 12
	prefs->tableSortItemDownload = ini.GetInt("TableSortItemDownload", 0);
	prefs->tableSortItemUpload = ini.GetInt("TableSortItemUpload", 0);
	prefs->tableSortItemQueue = ini.GetInt("TableSortItemQueue", 0);
	prefs->tableSortItemSearch = ini.GetInt("TableSortItemSearch", 0);
	prefs->tableSortItemShared = ini.GetInt("TableSortItemShared", 0);
	prefs->tableSortItemServer = ini.GetInt("TableSortItemServer", 0);
	prefs->tableSortAscendingDownload = ini.GetBool("TableSortAscendingDownload", true);
	prefs->tableSortAscendingUpload = ini.GetBool("TableSortAscendingUpload", true);
	prefs->tableSortAscendingQueue = ini.GetBool("TableSortAscendingQueue", true);
	prefs->tableSortAscendingSearch = ini.GetBool("TableSortAscendingSearch", true);
	prefs->tableSortAscendingShared = ini.GetBool("TableSortAscendingShared", true);
	prefs->tableSortAscendingServer = ini.GetBool("TableSortAscendingServer", true);
d1264 2
a1265 2
		buffer2.Format("StatColor%i",i);
		buffer.Format(ini.GetString(buffer2,"-1"));	//we can now have black as background
d1270 1
a1270 1
	m_nGraphRatio = ini.GetInt("ConnectionsGraphRatio",1);
d1272 1
a1272 1
	m_bMlDonkeyCM = ini.GetBool("MlDonkeyCM",true);
d1277 2
a1278 2
	CString A4AF_hash = ini.GetString("A4AFAutoFileHash", "00000000000000000000000000000000");
	if (A4AF_hash.GetLength() != 32) A4AF_hash = "00000000000000000000000000000000";
d1287 1
a1287 1
	buffer.Format(ini.GetString("TotalDownloadedBytes",0,"Statistics"));
d1290 1
a1290 1
	buffer.Format(ini.GetString("TotalUploadedBytes",0,"Statistics"));
d1293 2
a1294 2
	prefs->proxy.EnablePassword = ini.GetBool("EnablePassword",false,"Proxy");
	prefs->proxy.UseProxy = ini.GetBool("EnableProxy",false,"Proxy");
d1296 6
a1301 6
	prefs->proxy.name = ini.GetString("Name",buffer,"Proxy");
	prefs->proxy.password = ini.GetString("Password",buffer,"Proxy");
	prefs->proxy.user = ini.GetString("User",buffer,"Proxy");
	prefs->proxy.port = ini.GetInt("Port",1080,"Proxy");
	prefs->proxy.type = ini.GetInt("Type",PROXYTYPE_NOPROXY,"Proxy");
	m_bIsASCWOP = ini.GetBool("ConnectWithoutProxy",false,"Proxy");
d1305 7
a1311 7
	m_sWebPassword.Put(ini.GetString("Password", "mypass", "WebServer").GetBuffer(0));
	m_sLowWebPassword.Put(ini.GetString("PasswordLow", "mypass", "WebServer").GetBuffer(0));
	m_nWebPort = ini.GetInt("Port", 4711, "WebServer");
	m_bWebEnabled = ini.GetBool("Enabled", false, "WebServer");
	m_bWebLowEnabled = ini.GetBool("EnabledLow", false, "WebServer");
	m_bWebUseGzip = ini.GetBool("UseGzip", true, "WebServer");
	m_nWebPageRefresh = ini.GetInt("PageRefreshTime", 120, "WebServer");
d1313 3
a1315 3
	m_bWebIntruderDetection = ini.GetBool("IntruderDetection", true, "WebServer");
	m_nWebTempDisableLogin = ini.GetInt("TempDisableLogin", 30, "WebServer");
	m_nWebLoginAttemptsAllowed = ini.GetInt("LoginAttemptsAllowed", 3, "WebServer");
d1328 1
a1328 2
	char t_strdefaultip[17];
	strcpy(t_strdefaultip,inet_ntoa (*(struct in_addr*)*host->h_addr_list));
d1331 6
a1336 6
	m_LancastEnabled = ini.GetBool("Enabled",false,"Lancast");
	m_UseDefaultIP = ini.GetBool("UseDefaultIP",true,"Lancast");
	m_DefaultLancastIP = inet_addr(ini.GetString("IPAddress",t_strdefaultip,"Lancast"));
	m_LancastIP = inet_addr(ini.GetString("IPAddress",t_strdefaultip,"Lancast"));
	m_LancastSubnet = inet_addr(ini.GetString("Subnet","255.255.0.0","Lancast"));
	m_LancastPort = ini.GetInt("Port",5000,"Lancast");
d1341 1
a1341 1
	m_nAcceptMessagesFrom = ini.GetInt("AcceptMessageFrom",1);
d1343 1
a1343 1
	m_sAwayStateMessage.Put(ini.GetString("AwayStateMessage","").GetBuffer(0));
d1345 1
a1345 1
	prefs->maxmsgsessions=ini.GetInt("MaxMessageSessions",50);
d1348 4
a1351 4
	m_bAutoFilenameCleanup = ini.GetBool("AutoFilenameCleanup", false, "Cleanup");
	m_bFilenameCleanupTags = ini.GetBool("CleanupTags", false, "Cleanup");
	buffer2.SetString("http|www.|.com|sharereactor|sharelive|filedonkey|saugstube|eselfilme|eseldownloads|donkey-mania|emulemovies|spanishare|eselpsychos.de|saughilfe.de|goldesel.6x.to|goldesel.tk|freedivx.org|elitedivx|deviance|filenexus|ac3-guru");
	m_sFilenameCleanups.Put(ini.GetString("FilenameCleanups", buffer2, "Cleanup").GetBuffer(0));
d1521 1
a1521 1
			CString strLng2 = "";
d1562 1
a1562 1
			MessageBox(0, strMessage.GetBuffer(),"Language",64);
d1571 1
a1571 1
			if (IDNO==MessageBox(0, strQuestion.GetBuffer(),"eMule Plus",MB_YESNO | MB_DEFBUTTON2))	//SyruS make "no" the default for users
@


1.85
log
@Webserver intruder detection by Purity
@
text
@d723 1
d1179 1
@


1.84
log
@FEATURE: filter servers listed in ipfilter.dat and DynIP servers (for now)
@
text
@d851 5
d1310 5
@


1.83
log
@added 'Set manually added servers to High Priority' and 'Serverconnect w/o proxy' options and removed 'Accept ed2k links'
@
text
@d641 1
d1060 1
@


1.82
log
@minor changes (use md4... instead of mem...)
@
text
@d681 1
a681 1
	ini.WriteBool("IRCAcceptLinks", m_bIRCAcceptLinks);
d748 1
a748 1
	ini.WriteBool("ManualHighPrio", prefs->m_bmanualhighprio);
d834 1
d1109 1
a1109 1
	m_bIRCAcceptLinks = ini.GetBool("IRCAcceptLinks", false);
d1116 1
a1116 1
	prefs->m_bmanualhighprio=ini.GetBool("ManualHighPrio",false);
d1292 1
@


1.81
log
@unicode cleanup
@
text
@d65 1
a65 1
	memcpy(&prefs->userhash,&userhash,16);
d96 1
a96 1
				memcpy(&prefs->userhash,&prefsImport20b->userhash,16);
d114 1
a114 1
				memcpy(&prefs->userhash,&prefsImport20a->userhash,16);
d135 1
a135 1
					memcpy(&prefs->userhash,&userhash,16);
d142 1
a142 1
					memcpy(&prefs->userhash,&prefsImport19c->userhash,16);
d152 1
a152 1
			memcpy(&prefs->userhash,&prefsExt->userhash,16);
d160 1
a160 1
		memcpy(&userhash,&prefs->userhash,16);
d250 1
a250 1
	memcpy(&prefs->userhash,&userhash,16);
d287 1
a287 1
		memcpy(&prefsExt->userhash,&prefs->userhash,16);
@


1.80
log
@FEATURE: disable rating icons
@
text
@d1256 1
a1256 1
		m_nStatColors[i] = _atoi64(buffer);
d1278 1
a1278 1
	m_nTotalDownloadedBytes.Put(_atoi64(buffer));
d1281 1
a1281 1
	m_nTotalUploadedBytes.Put(_atoi64(buffer));
@


1.79
log
@memcpy() optimized for AMD (faster in 2-2.5 times). AMD only. Compile with tag AMD
@
text
@d671 2
a672 1
	ini.WriteString("IRCServer", m_sIRCServer.Get());
d1122 1
@


1.78
log
@unicode cleanup
@
text
@d29 1
d64 1
d66 3
d95 1
d97 3
d113 1
d115 3
d134 1
d136 10
a145 1
				} else {memcpy(&prefs->userhash,&prefsImport19c->userhash,16);}
d151 1
d153 3
d159 1
d161 3
d249 1
d251 3
d286 1
d288 3
d348 1
d350 3
d471 1
d497 27
@


1.77
log
@removed not needed Format usage
@
text
@d67 2
a68 2
	fullpath.Format("%spreferences.dat",appdir);
	FILE* preffile = fopen(fullpath,"rb");
d137 1
a137 1
	fullpath.Format("%sshareddir.dat",appdir);
d149 1
a149 1
	fullpath.Format("%stempdir.dat",appdir);
d189 1
a189 1
	CString fullpath = CString(appdir) + "adresses.dat" ;
d207 1
a207 1
	fullpath.Format("%suserhash.dat", appdir) ;
d209 1
a209 1
	FILE* hashfile = fopen(fullpath, "rb") ;
d243 1
a243 1
	fullpath.Format("%spreferences.dat",appdir);
d245 1
a245 1
	FILE* preffile = fopen(fullpath,"wb");
d260 1
a260 1
	fullpath.Format("%suserhash.dat", appdir) ;
d262 1
a262 1
	FILE* hashfile = fopen(fullpath, "wb") ;
d274 1
a274 1
	fullpath.Format("%sshareddir.dat",appdir);
d288 1
a288 1
	fullpath.Format("%stempdir.dat",appdir);
d478 1
a478 1
	fullpath.Format("%spreferences.ini",appdir);
@


1.76
log
@variables converted to CString to avoid converions
@
text
@d485 1
a485 1
	buffer.Format("%s",m_sNick.Get());
d488 1
a488 1
	buffer.Format("%s", m_sIncomingDir.Get());
d491 1
a491 1
	buffer.Format("%s", m_sTempDir.Get());
d494 1
a494 1
	//buffer.Format("%s", m_sVlcDir.Get());	//Cax2 we don't save this anymore. m_sVlcDir to be removed in 1b & above
d496 1
a496 1
	buffer.Format("%s", m_sVideoPlayer.Get());	//Cax2 - official mule code.
d555 1
a555 1
	buffer.Format("%s", m_sToolbarBitmap.Get());
d557 1
a557 1
	buffer.Format("%s", m_sToolbarBitmapFolder.Get());
@


1.75
log
@FEATURE: en/disable banning optional [DoubleT]
@
text
@d485 1
a485 1
	buffer.Format("%s",m_sNick.Get().c_str());
d488 1
a488 1
	buffer.Format("%s", m_sIncomingDir.Get().c_str());
d491 1
a491 1
	buffer.Format("%s", m_sTempDir.Get().c_str());
d494 1
a494 1
	//buffer.Format("%s", m_sVlcDir.Get().c_str());	//Cax2 we don't save this anymore. m_sVlcDir to be removed in 1b & above
d496 1
a496 1
	buffer.Format("%s", m_sVideoPlayer.Get().c_str());	//Cax2 - official mule code.
d523 1
a523 1
	ini.WriteString("StatsListExpanded", m_sStatsListExpanded.Get().c_str());
d554 2
a555 2
	ini.WriteString("ToolbarSettings", m_sToolbarSettings.Get().c_str()); // Added by reCDVst
	buffer.Format("%s", m_sToolbarBitmap.Get().c_str());
d557 1
a557 1
	buffer.Format("%s", m_sToolbarBitmapFolder.Get().c_str());
d595 1
a595 1
	ini.WriteString("NotifierSoundPath", CString(m_sNotifierSoundFilePath.Get().c_str()));
d598 1
a598 1
	ini.WriteString("CommentFilter", m_sCommentFilter.Get().c_str());	//(SyruS) netwolf commentfilter
d600 2
a601 2
	ini.WriteString("IRCServer", m_sIRCServer.Get().c_str());
	ini.WriteString("IRCNick", m_sIRCNick.Get().c_str());
d603 1
a603 1
	ini.WriteString("IRCFilterName", m_sIRCChanNameFilter.Get().c_str());
d606 1
a606 1
	ini.WriteString("IRCPerformString", m_sIRCPerformString.Get().c_str());
d628 1
a628 1
	ini.WriteString("CommunityString", m_sCommunityString.Get().c_str());
d641 1
a641 1
	ini.WriteString("UsedFont", m_sUsedFont.Get().c_str());
d770 2
a771 2
	ini.WriteString("Password", CString(m_sWebPassword.Get().c_str()), "WebServer");	
	ini.WriteString("PasswordLow", CString(m_sLowWebPassword.Get().c_str()), "WebServer");	
d797 1
a797 1
	ini.WriteString("AwayStateMessage", CString(m_sAwayStateMessage.Get().c_str()));
d803 1
a803 1
	ini.WriteString("FilenameCleanups", CString(m_sFilenameCleanups.Get().c_str()), "Cleanup");
@


1.74
log
@janes bong's filter addition
@
text
@d531 1
d535 3
a645 1
	ini.WriteBool("BanMessageEnabled", m_bBanMessageEnabled);
d944 2
a1093 1
	m_bBanMessageEnabled = ini.GetBool("BanMessageEnabled", false);
@


1.73
log
@removed CSecuredVar protection for simple variables
@
text
@d1043 1
a1043 1
	prefs->messageFilter=ini.GetString("MessageFilter","Your client has an infinite queue");
@


1.72
log
@code cleanup
@
text
@d46 1
a46 1
	m_bIsNTBased.Put(false);
d133 1
a133 1
		m_nSmartIdState.Put(0);
d174 2
a175 2
    m_bUseProxyListenPort.Put(false);
	m_nListenPort.Put(0);
d499 7
a505 7
	ini.WriteInt("MaxUpload", m_nMaxUpload.Get());
	ini.WriteInt("MaxDownload", m_nMaxDownload.Get());
	ini.WriteInt("MaxConnections", m_nMaxConnections.Get());
	ini.WriteInt("DeadServerAction", m_nDeadServer.Get());
	ini.WriteInt("Port", m_nPort.Get());
	ini.WriteInt("UDPPort", m_nUDPPort.Get());
	ini.WriteInt("MaxSourcesPerFile", m_nMaxSourcePerFile.Get());
d508 1
a508 1
	ini.WriteWORD("Language", m_nLanguageID.Get());
d511 3
a513 3
	ini.WriteBool("PartTrafficEnabled", m_bUsePartTraffic.Get());
	ini.WriteInt("UploadbarStyle", m_nUpbarPartTraffic.Get());
	ini.WriteInt("UploadbarColor", m_nUpbarColorPartTraffic.Get());
d515 2
a516 2
	ini.WriteInt("ToolTipDelay", m_nTooltipDelayTime.Get());
	ini.WriteInt("QueueSize", m_nQueueSize.Get());
d518 5
a522 5
	ini.WriteBool("UseRemoteQueueLimit", m_bUseRQlimit.Get());
	ini.WriteInt("StatGraphsInterval", m_nTrafficOMeterInterval.Get());
	ini.WriteInt("StatsInterval", m_nStatsInterval.Get());
	ini.WriteInt("StatsColumnWidth", m_nStatsColumnWidth.Get());
	ini.WriteInt("DetailColumnWidth", m_nDetailColumnWidth.Get());
d524 13
a536 13
	ini.WriteInt("DownloadCapacity", m_nMaxGraphDownloadRate.Get());
	ini.WriteInt("UploadCapacity", m_nMaxGraphUploadRate.Get());
	ini.WriteInt("DeadServerRetries", m_nDeadServerRetries.Get());
	ini.WriteInt("SplitterbarPosition", m_nSplitterBarPosition.Get());
	ini.WriteInt("VariousStatisticsMaxValue", m_nStatsMax.Get());
	ini.WriteInt("StatsAverageMinutes", m_nStatsAverageMinutes.Get());
	ini.WriteInt("MaxConnectionsPerFiveSeconds", m_nMaxConperFive.Get());
	ini.WriteInt("BadClientBanTime", m_nBadClientBanTime.Get());
	ini.WriteInt("BadClientMinRequestTime", m_nMinRequestTime.Get());
	ini.WriteInt("BadClientMinRequestNum", m_nBadClientBan.Get());
	ini.WriteInt("SLS_RestoreSourcesTime", m_nSLSRestoreSourcesTime.Get());
	ini.WriteInt("SLS_LoadQuantities", m_nSLSLoadQuantities.Get());
	ini.WriteInt("SLS_WhenSourcesOutdated", m_nSLSOutdated.Get());
d538 1
a538 1
	ini.WriteBool("SLS_Enable", m_bSLSEnable.Get());
d540 2
a541 2
	ini.WriteBool("Reconnect", m_bReconnect.Get());
	ini.WriteBool("Scoresystem", m_nScoreSystem.Get());
d543 6
a548 6
	ini.WriteBool("UAP", m_bUAP.Get());
	ini.WriteBool("DAP", m_bDAP.Get());
	ini.WriteBool("DisableXS", m_bDisableXS.Get());
	ini.WriteBool("StartDownloadPaused", m_bStartDownloadPaused.Get());
	ini.WriteBool("DownloadPausedOnComplete", m_bDownloadPausedOnComplete.Get());
	ini.WriteBool("RemoveNNS", m_bRemoveNNS.Get());
d555 21
a575 21
	ini.WriteInt("ToolbarLabels", m_nToolbarLabels.Get());
	ini.WriteBool("Serverlist", m_bAutoServerList.Get());
	ini.WriteBool("UpdateNotify", m_bUpdateNotify.Get());
	ini.WriteBool("MinimizeToTray", m_bMinToTray.Get());
	ini.WriteBool("AddServersFromConnections", m_bAddServersFromConn.Get());
	ini.WriteBool("Splashscreen", m_bSplashScreen.Get());
	ini.WriteBool("BringToFront", m_bBringToForeground.Get());
	ini.WriteBool("TransferDoubleClick", m_nTransferDoubleclick.Get());
	ini.WriteBool("BeepOnError", m_bBeepOnError.Get());
	ini.WriteBool("ConfirmExit", m_bConfirmExit.Get());
	ini.WriteBool("FilterBadIPs", m_bFilterBadIP.Get());
	ini.WriteBool("Autoconnect", m_bAutoConnect.Get());
	ini.WriteBool("OnlineSignature", m_bOnlineSig.Get());
	ini.WriteBool("StartupMinimized", m_bStartMinimized.Get());
	ini.WriteBool("SafeConnect", m_bSafeConnect.Get());
	ini.WriteBool("ToolbarSpeedMeter", m_bShowToolbarSpeedMeter.Get());
	ini.WriteBool("CloseToTray", m_bCloseToTray.Get());
	ini.WriteBool("DetailsOnClick", m_bDetailsOnClick.Get());
	ini.WriteInt("SrvConTimeout", m_nSrvConTimeout.Get());
	ini.WriteBool("SlowComplete", m_bSlowComplete.Get());
	ini.WriteInt("SlowCompleteBlockSize", m_nSlowCompleteBlockSize.Get());
d579 1
a579 1
    ini.WriteBool("AutoConnectStaticOnly", m_bAutoConnectStaticOnly.Get());  
d581 1
a581 1
    ini.WriteInt ("3DDepth", m_nDepth3D.Get()); 
d584 7
a590 7
	ini.WriteBool("NotifyOnDownload", m_bUseDownloadNotifier.Get());
	ini.WriteBool("NotifyOnDownloadAdd", m_bUseDownloadAddNotifier.Get());
	ini.WriteBool("NotifyOnChat", m_bUseChatNotifier.Get());		  
	ini.WriteBool("NotifyOnLog", m_bUseLogNotifier.Get());
	ini.WriteBool("NotifierUseSound", m_bUseSoundInNotifier.Get());
	ini.WriteBool("NotifierPopEveryChatMessage", m_bNotifierPopsEveryChatMsg.Get());
	ini.WriteBool("NotifyOnImportantError", m_bNotifierImportantError.Get());
d598 1
a598 1
	ini.WriteBool("IRCAddTimestamp", m_bIRCAddTimestamp.Get());
d600 2
a601 2
	ini.WriteInt("IRCFilterUser", m_nIRCChannelUserFilter.Get());
	ini.WriteBool("IRCUseFilter", m_bIRCUseChanFilter.Get());
d603 18
a620 18
	ini.WriteBool("IRCUsePerform", m_bIRCUsePerform.Get());
	ini.WriteBool("IRCListOnConnect", m_bIRCListOnConnect.Get());
	ini.WriteBool("IRCAcceptLinks", m_bIRCAcceptLinks.Get());
	ini.WriteBool("IRCIgnoreInfoMessage", m_bIRCIgnoreInfoMessage.Get());
	ini.WriteBool("IRCIgnoreEmuleProtoInfoMessage", m_bIRCIgnoreEmuleProtoInfoMessage.Get());
	ini.WriteBool("SmartIdCheck", m_bSmartIdCheck.Get());

	ini.WriteBool("UseSortingDefaults", m_bUseSort.Get());
	ini.WriteBool("Use2ndSortSources", m_bUseSrcSortCol2.Get());
	ini.WriteInt("SortServersCode", m_nServerSortCol.Get());	
	ini.WriteInt("SortUploadsCode", m_nUploadSortCol.Get());
	ini.WriteInt("SortQueueCode", m_nQueueSortCol.Get());
	ini.WriteInt("SortSearchCode", m_nSearchSortCol.Get());
	ini.WriteInt("SortIrcCode", m_nIRCSortCol.Get());
	ini.WriteInt("SortFilesCode", m_nFileSortCol.Get());
	ini.WriteInt("SortDownloadsCode", m_nDownloadSortCol.Get());
	ini.WriteInt("1stSortSourcesCode", m_nSrcSortCol1.Get());
	ini.WriteInt("2ndSortSourcesCode", m_nSrcSortCol2.Get());
d623 1
a623 1
	ini.WriteBool("CommunityEnabled", m_bCommunityEnabled.Get());
d625 9
a633 9
	ini.WriteBool("CommunityNoBan", m_bCommunityNoBan.Get());
	ini.WriteInt("NotificationDisplayTime", m_nNotificationDisplayTime.Get());
	ini.WriteInt("NotificationFontSize", m_nNotificationFontSize.Get());
	ini.WriteInt("Profile", m_nProfile.Get());
	ini.WriteInt("PriorityHigh", m_nPriorityHigh.Get());
	ini.WriteInt("PriorityLow", m_nPriorityLow.Get());
	ini.WriteBool("RestartWaiting", m_bRestartWaiting.Get());
	ini.WriteBool("LogToFile", m_bLogToFile.Get());
	ini.WriteBool("TransferFullChunks", m_bTransferFullChunks.Get());
d635 2
a636 2
	ini.WriteBool("DisableXSUpTo", m_bDisableXSUpTo.Get());
	ini.WriteInt("XSUpTo", m_nXSUpTo.Get());
d638 28
a665 28
	ini.WriteInt("FontSize", m_nFontSize.Get());
	ini.WriteInt("HashingPriority", m_HashingPriority.Get());
	ini.WriteBool("UploadParts", m_bUploadParts.Get());
	ini.WriteBool("A4AFStringEnabled", m_bA4AFStringEnabled.Get());
	ini.WriteBool("BanMessageEnabled", m_bBanMessageEnabled.Get());
	ini.WriteInt("SearchMethod", m_nSearchMethod.Get());
	ini.WriteBool("AutoTakeED2KLinks", m_bAutoTakeLinks.Get()); 
	ini.WriteInt("FileBufferSizePref", m_nFileBufferSize.Get());
	ini.WriteInt("MainProcessPriority", m_nMainProcessPriority.Get());

	ini.WriteBool("SCHEnabled", m_bSCHEnabled.Get());
	ini.WriteBool("SCHExceptMon", m_bSCHExceptMon.Get());
	ini.WriteBool("SCHExceptTue", m_bSCHExceptTue.Get());
	ini.WriteBool("SCHExceptWed", m_bSCHExceptWed.Get());
	ini.WriteBool("SCHExceptThu", m_bSCHExceptThu.Get());
	ini.WriteBool("SCHExceptFri", m_bSCHExceptFri.Get());
	ini.WriteBool("SCHExceptSat", m_bSCHExceptSat.Get());
	ini.WriteBool("SCHExceptSun", m_bSCHExceptSun.Get());
	ini.WriteInt("SCHShift1",m_nSCHShift1.Get());
	ini.WriteInt("SCHShift2",m_nSCHShift2.Get());
	ini.WriteInt("SCHShift1Up",m_nSCHShift1Upload.Get());
	ini.WriteInt("SCHShift1Down",m_nSCHShift1Download.Get());
	ini.WriteInt("SCHShift1Conn",m_nSCHShift1conn.Get());
	ini.WriteInt("SCHShift15sec",m_nSCHShift15sec.Get());
	ini.WriteInt("SCHShift2Up",m_nSCHShift2Upload.Get());
	ini.WriteInt("SCHShift2Down",m_nSCHShift2Download.Get());
	ini.WriteInt("SCHShift2Conn",m_nSCHShift2conn.Get());
	ini.WriteInt("SCHShift25sec",m_nSCHShift25sec.Get());
d668 1
a668 1
	ini.WriteBool("MultipleInstances", m_bMultiple.Get());
d670 1
a670 1
	ini.WriteBool("Verbose", m_bVerbose.Get());
d672 1
a672 1
	ini.WriteBool("UpdateQueueList", m_bUpdateQueueList.Get());
d675 2
a676 2
	ini.WriteBool("ShowOverhead", m_bShowOverhead.Get());	//Cax2 re-enabled this preference
	ini.WriteBool("VideoPreviewBackupped", m_bBackupPreview.Get());	//Cax2 string kept for compatibility with off client
d741 1
a741 1
	ini.WriteInt("ConnectionsGraphRatio", m_nGraphRatio.Get()); // propstats Cax2
d744 1
a744 1
	ini.WriteBool("MlDonkeyCM", m_bMlDonkeyCM.Get());
d769 5
a773 5
	ini.WriteInt("Port", m_nWebPort.Get(), "WebServer");
	ini.WriteBool("Enabled", m_bWebEnabled.Get(), "WebServer");
	ini.WriteBool("EnabledLow", m_bWebLowEnabled.Get(), "WebServer");
	ini.WriteBool("UseGzip", m_bWebUseGzip.Get(), "WebServer");
	ini.WriteInt("PageRefreshTime", m_nWebPageRefresh.Get(), "WebServer");
d779 1
a779 1
	t_strLanCastIP.Format("%i.%i.%i.%i",(uint8)m_LancastIP.Get(),(uint8)(m_LancastIP.Get()>>8),(uint8)(m_LancastIP.Get()>>16),(uint8)(m_LancastIP.Get()>>24));
d782 1
a782 1
	t_strLanCastSubnet.Format("%i.%i.%i.%i",(uint8)m_LancastSubnet.Get(),(uint8)(m_LancastSubnet.Get()>>8),(uint8)(m_LancastSubnet.Get()>>16),(uint8)(m_LancastSubnet.Get()>>24));
d784 2
a785 2
	ini.WriteBool("Enabled",m_LancastEnabled.Get(),"Lancast");
	ini.WriteBool("UseDefaultIP",m_UseDefaultIP.Get(),"Lancast");
d788 1
a788 1
	ini.WriteInt("Port",m_LancastPort.Get(),"Lancast");
d793 1
a793 1
	ini.WriteInt("AcceptMessageFrom",m_nAcceptMessagesFrom.Get());	
d798 2
a799 2
	ini.WriteBool("AutoFilenameCleanup", m_bAutoFilenameCleanup.Get(), "Cleanup");
	ini.WriteBool("CleanupTags", m_bFilenameCleanupTags.Get(), "Cleanup");
d877 13
a889 13
	m_nMaxGraphUploadRate.Put(ini.GetInt("UploadCapacity",16));
	m_nMaxGraphDownloadRate.Put(ini.GetInt("DownloadCapacity",96));
	m_nMaxUpload.Put(ini.GetInt("MaxUpload",UNLIMITED));		//Cax2 new limits enforced on old settings
	if (m_nMaxUpload.Get()>m_nMaxGraphUploadRate.Get())
		m_nMaxUpload.Put(m_nMaxGraphUploadRate.Get());
	m_nMaxDownload.Put(ini.GetInt("MaxDownload",UNLIMITED));
	if (m_nMaxDownload.Get()>m_nMaxGraphDownloadRate.Get())
		m_nMaxDownload.Put(m_nMaxGraphDownloadRate.Get());
	m_nMaxConnections.Put(ini.GetInt("MaxConnections",GetRecommendedMaxConnections()));
	m_nDeadServer.Put(ini.GetInt("DeadServerAction",2));
	m_nPort.Put(ini.GetInt("Port",4662));
	m_nUDPPort.Put(ini.GetInt("UDPPort",m_nPort.Get() + 10));
	m_nMaxSourcePerFile.Put(ini.GetInt("MaxSourcesPerFile",400));
d892 8
a899 8
	m_nQueueSize.Put(ini.GetInt("QueueSize", MIN_QUEUE*3));
	if(m_nQueueSize.Get() > MAX_QUEUE)
		m_nQueueSize.Put(MAX_QUEUE);
	else if(m_nQueueSize.Get() < MIN_QUEUE)
		m_nQueueSize.Put(MIN_QUEUE);
	m_nRQlimit.Put((m_nQueueSize.Get() >= 2000)? m_nQueueSize.Get() : 2000); //Cax2 - remote queue limit linked to queue size, but no lower than 2000
	m_bUseRQlimit.Put(ini.GetBool("UseRemoteQueueLimit"));
	m_nLanguageID.Put(ini.GetWORD("Language",0));
d902 3
a904 3
	m_bUsePartTraffic.Put(ini.GetBool("PartTrafficEnabled",false));
	m_nUpbarPartTraffic.Put(ini.GetInt("UploadbarStyle", 2));
	m_nUpbarColorPartTraffic.Put(ini.GetInt("UploadbarColor", 0));
d906 5
a910 5
	m_nTooltipDelayTime.Put(ini.GetInt("ToolTipDelay",1));
	m_nTrafficOMeterInterval.Put(ini.GetInt("StatGraphsInterval",3));
	m_nStatsInterval.Put(ini.GetInt("statsInterval",5));
	m_nStatsColumnWidth.Put(ini.GetInt("StatsColumnWidth", 150));
	m_nDetailColumnWidth.Put(ini.GetInt("DetailColumnWidth", 150));
d914 5
a918 5
	m_nDeadServerRetries.Put(ini.GetInt("DeadServerRetries",1));
	m_nSplitterBarPosition.Put(ini.GetInt("SplitterbarPosition",75));
	m_nStatsMax.Put(ini.GetInt("VariousStatisticsMaxValue",100));
	m_nStatsAverageMinutes.Put(ini.GetInt("StatsAverageMinutes",5));
	m_nMaxConperFive.Put(ini.GetInt("MaxConnectionsPerFiveSeconds",GetDefaultMaxConperFive()));
d923 2
a924 2
	if(m_nMaxConperFive.Get() > nMax) {
		m_nMaxConperFive.Put(nMax);
d926 2
a927 2
		if(m_nMaxConperFive.Get() < 5)
			m_nMaxConperFive.Put(5);
d930 3
a932 3
	m_nBadClientBanTime.Put(ini.GetInt("BadClientBanTime",3600000));
	if(m_nBadClientBanTime.Get() > 18000000)
		m_nBadClientBanTime.Put(18000000);
d934 3
a936 3
	m_nMinRequestTime.Put(ini.GetInt("BadClientMinRequestTime",590000));
	if(m_nMinRequestTime.Get() > 590000)
		m_nMinRequestTime.Put(590000);
d938 3
a940 3
	m_nBadClientBan.Put(ini.GetInt("BadClientMinRequestNum",3));
	if(m_nBadClientBan.Get() < 3)
		m_nBadClientBan.Put(3);
d943 23
a965 23
	m_nSLSRestoreSourcesTime.Put(ini.GetInt("SLS_RestoreSourcesTime",7200000));
	if(m_nSLSRestoreSourcesTime.Get() < 3600000)
		m_nSLSRestoreSourcesTime.Put(3600000);
	
	m_nSLSLoadQuantities.Put(ini.GetInt("SLS_LoadQuantities",20));
	if(m_nSLSLoadQuantities.Get() > 100)
		m_nSLSLoadQuantities.Put(100);

	m_nSLSOutdated.Put(ini.GetInt("SLS_WhenSourcesOutdated",2));
	if(m_nSLSOutdated.Get() > 10)
		m_nSLSOutdated.Put(10);
	
	m_bSLSEnable.Put(ini.GetBool("SLS_Enable",false));

	m_bReconnect.Put(ini.GetBool("Reconnect",true));
	m_nScoreSystem.Put(ini.GetBool("Scoresystem",true));
	
	m_bUAP.Put(ini.GetBool("UAP", true));
	m_bDAP.Put(ini.GetBool("DAP", true));
	m_bDisableXS.Put(ini.GetBool("DisableXS", false));
	m_bStartDownloadPaused.Put(ini.GetBool("StartDownloadPaused", false));
	m_bDownloadPausedOnComplete.Put(ini.GetBool("DownloadPausedOnComplete", false));
	m_bRemoveNNS.Put(ini.GetBool("RemoveNNS", false));
d970 29
a998 29
	m_nToolbarLabels.Put(ini.GetInt("ToolbarLabels",1));
	m_bAutoServerList.Put(ini.GetBool("Serverlist",false));
	m_bUpdateNotify.Put(ini.GetBool("UpdateNotify",true));
	m_bMinToTray.Put(ini.GetBool("MinimizeToTray",true));
	m_bAddServersFromConn.Put(ini.GetBool("AddServersFromConnections",true));
	m_bSplashScreen.Put(ini.GetBool("Splashscreen",true));
	m_bBringToForeground.Put(ini.GetBool("BringToFront",true));
	m_nTransferDoubleclick.Put(ini.GetBool("TransferDoubleClick",true));
	m_bBeepOnError.Put(ini.GetBool("BeepOnError",true));
	m_bConfirmExit.Put(ini.GetBool("ConfirmExit",true));
	m_bFilterBadIP.Put(ini.GetBool("FilterBadIPs",true));
	m_bAutoConnect.Put(ini.GetBool("Autoconnect",false));
	m_bOnlineSig.Put(ini.GetBool("OnlineSignature",false));
	m_bStartMinimized.Put(ini.GetBool("StartupMinimized",false));
	m_bSafeConnect.Put(ini.GetBool("SafeConnect",true));
	m_bShowToolbarSpeedMeter.Put(ini.GetBool("ToolbarSpeedMeter", false));
	m_bCloseToTray.Put(ini.GetBool("CloseToTray",false));	
	m_bDetailsOnClick.Put(ini.GetBool("DetailsOnClick",false));	

	m_nSrvConTimeout.Put(ini.GetInt("SrvConTimeout",20000));		//Cax2 - bugfix for time out - ticks are in milliseconds!!!!!
	if(m_nSrvConTimeout.Get() <10000)
		m_nSrvConTimeout.Put(10000);
	else if(m_nSrvConTimeout.Get() > 60000)
		m_nSrvConTimeout.Put(60000);
	
	m_bSlowComplete.Put(ini.GetBool("SlowComplete",false));	
	m_nSlowCompleteBlockSize.Put(ini.GetInt("SlowCompleteBlockSize",32));
	if(m_nSlowCompleteBlockSize.Get() > 1024)
		m_nSlowCompleteBlockSize.Put(1024);
d1001 1
a1001 1
	m_bAutoConnectStaticOnly.Put(ini.GetBool("AutoConnectStaticOnly",false)); 
d1003 1
a1003 1
	m_nDepth3D.Put(ini.GetInt("3DDepth", 0));
d1008 1
a1008 1
			m_nDepth3D.Put(0);
d1010 1
a1010 1
			m_nDepth3D.Put(5);
d1013 7
a1019 7
	m_bUseDownloadAddNotifier.Put(ini.GetBool("NotifyOnDownloadAdd",false));
	m_bUseDownloadNotifier.Put(ini.GetBool("NotifyOnDownload",false));
	m_bUseChatNotifier.Put(ini.GetBool("NotifyOnChat",false));
	m_bUseLogNotifier.Put(ini.GetBool("NotifyOnLog",false));
	m_bUseSoundInNotifier.Put(ini.GetBool("NotifierUseSound",false));
	m_bNotifierPopsEveryChatMsg.Put(ini.GetBool("NotifierPopEveryChatMessage",false));
	m_bNotifierImportantError.Put(ini.GetBool("NotifyOnImportantError",false));
d1024 1
a1024 1
	m_bIRCAddTimestamp.Put(ini.GetBool("IRCAddTimestamp",true));
d1026 2
a1027 2
	m_bIRCUseChanFilter.Put(ini.GetBool("IRCUseFilter", false));
	m_nIRCChannelUserFilter.Put(ini.GetInt("IRCFilterUser", 0));
d1029 7
a1035 7
	m_bIRCUsePerform.Put(ini.GetBool("IRCUsePerform", false));
	m_bIRCListOnConnect.Put(ini.GetBool("IRCListOnConnect", true));
	m_bIRCAcceptLinks.Put(ini.GetBool("IRCAcceptLinks", false));
	m_bIRCIgnoreInfoMessage.Put(ini.GetBool("IRCIgnoreInfoMessage", false));
	m_bIRCIgnoreEmuleProtoInfoMessage.Put(ini.GetBool("IRCIgnoreEmuleProtoInfoMessage", true));
	m_bSmartIdCheck.Put(ini.GetBool("SmartIdCheck",true));
	m_bVerbose.Put(ini.GetBool("Verbose",false));
d1037 1
a1037 1
	m_bUpdateQueueList.Put(ini.GetBool("UpdateQueueList",false));
d1039 2
a1040 2
	m_bShowOverhead.Put(ini.GetBool("ShowOverhead",true));
	m_bBackupPreview.Put(ini.GetBool("VideoPreviewBackupped",false));	//Cax2 string kept for compatibility with off client
d1046 11
a1056 11
	m_bUseSort.Put(ini.GetBool("UseSortingDefaults",true));
	m_bUseSrcSortCol2.Put(ini.GetBool("Use2ndSortSources",false));
	m_nServerSortCol.Put(ini.GetInt("SortServersCode",0));
	m_nUploadSortCol.Put(ini.GetInt("SortUploadsCode",12));
	m_nQueueSortCol.Put(ini.GetInt("SortQueueCode",105));
	m_nSearchSortCol.Put(ini.GetInt("SortSearchCode",12));
	m_nIRCSortCol.Put(ini.GetInt("SortIrcCode",11));
	m_nFileSortCol.Put(ini.GetInt("SortFilesCode",0));
	m_nDownloadSortCol.Put(ini.GetInt("SortDownloadsCode",8));
	m_nSrcSortCol1.Put(ini.GetInt("1stSortSourcesCode",0));
	m_nSrcSortCol2.Put(ini.GetInt("2ndSortSourcesCode",255));
d1059 1
a1059 1
	m_bCommunityEnabled.Put(ini.GetBool("CommunityEnabled", false));
d1061 9
a1069 9
	m_bCommunityNoBan.Put(ini.GetBool("CommunityNoBan", false));
	m_nNotificationDisplayTime.Put(ini.GetInt("NotificationDisplayTime",4000));
	m_nNotificationFontSize.Put(ini.GetInt("NotificationFontSize",70));
	m_nProfile.Put(ini.GetInt("Profile",0));
	m_nPriorityHigh.Put(ini.GetInt("PriorityHigh",100));
	m_nPriorityLow.Put(ini.GetInt("PriorityLow",300));
	if(m_nPriorityLow.Get() != 0){
		if(m_nPriorityLow.Get() < m_nPriorityHigh.Get())
			m_nPriorityLow.Put(m_nPriorityHigh.Get() * 2);
d1071 2
a1072 2
		m_nPriorityLow.Put(300);
		m_nPriorityHigh.Put(100);
d1074 3
a1076 3
	m_bRestartWaiting.Put(ini.GetBool("RestartWaiting",true));
	m_bLogToFile.Put(ini.GetBool("LogToFile",false));
	m_bTransferFullChunks.Put(ini.GetBool("TransferFullChunks",true));
d1078 4
a1081 4
	m_bDisableXSUpTo.Put(ini.GetBool("DisableXSUpTo",false));
	m_nXSUpTo.Put(ini.GetInt("XSUpTo",GetMaxSourcePerFileSoft()));
	if(m_nXSUpTo.Get() > GetMaxSourcePerFileSoft())
		m_nXSUpTo.Put(GetMaxSourcePerFileSoft());
d1083 1
a1083 1
	m_nFontSize.Put(ini.GetInt("FontSize",80));
d1085 27
a1111 27
	m_bUploadParts.Put(ini.GetBool("UploadParts",false));
	m_bA4AFStringEnabled.Put(ini.GetBool("A4AFStringEnabled", false));
	m_bBanMessageEnabled.Put(ini.GetBool("BanMessageEnabled", false));
	m_nSearchMethod.Put(ini.GetInt("SearchMethod",0));
	m_bBanMessageEnabled.Put(ini.GetBool("BanMessageEnabled", false));
	m_bAutoTakeLinks.Put(ini.GetBool("AutoTakeED2KLinks",false));
	m_nFileBufferSize.Put(ini.GetInt("FileBufferSizePref",16));
	m_nMainProcessPriority.Put(ini.GetInt("MainProcessPriority",0));	// netwolf 05.05.03 (default: normal MainProcessPriority)

	m_bSCHEnabled.Put(ini.GetBool("SCHEnabled", false));
	m_bSCHExceptMon.Put(ini.GetBool("SCHExceptMon", false));
	m_bSCHExceptTue.Put(ini.GetBool("SCHExceptTue", false));
	m_bSCHExceptWed.Put(ini.GetBool("SCHExceptWed", false));
	m_bSCHExceptThu.Put(ini.GetBool("SCHExceptThu", false));
	m_bSCHExceptFri.Put(ini.GetBool("SCHExceptFri", false));
	m_bSCHExceptSat.Put(ini.GetBool("SCHExceptSat", true));
	m_bSCHExceptSun.Put(ini.GetBool("SCHExceptSun", true));
	m_nSCHShift1.Put(ini.GetInt("SCHShift1",64800));
	m_nSCHShift2.Put(ini.GetInt("SCHShift2",21600));
	m_nSCHShift1Upload.Put(ini.GetInt("SCHShift1Up",UNLIMITED));
	m_nSCHShift1Download.Put(ini.GetInt("SCHShift1Down",UNLIMITED));
	m_nSCHShift1conn.Put(ini.GetInt("SCHShift1conn",512));
	m_nSCHShift15sec.Put(ini.GetInt("SCHShift15sec",40));
	m_nSCHShift2Upload.Put(ini.GetInt("SCHShift2Up",UNLIMITED));
	m_nSCHShift2Download.Put(ini.GetInt("SCHShift2Down",UNLIMITED));
	m_nSCHShift2conn.Put(ini.GetInt("SCHShift2conn",256));
	m_nSCHShift25sec.Put(ini.GetInt("SCHShift25sec",20));
d1113 1
a1113 1
	m_bMultiple.Put(ini.GetBool("MultipleInstances",false));
d1172 2
a1173 2
	if (m_nStatsAverageMinutes.Get() < 1)
		m_nStatsAverageMinutes.Put(5);
d1179 3
a1181 3
		m_nStatColors[i].Put(_atoi64(buffer));
		if (m_nStatColors[i].Get() == -1) 
			m_nStatColors[i].Put(DefaultStatsColor(i));
d1183 1
a1183 1
	m_nGraphRatio.Put(ini.GetInt("ConnectionsGraphRatio",1));
d1185 1
a1185 1
	m_bMlDonkeyCM.Put(ini.GetBool("MlDonkeyCM",true));
d1219 5
a1223 5
	m_nWebPort.Put(ini.GetInt("Port", 4711, "WebServer"));
	m_bWebEnabled.Put(ini.GetBool("Enabled", false, "WebServer"));
	m_bWebLowEnabled.Put(ini.GetBool("EnabledLow", false, "WebServer"));
	m_bWebUseGzip.Put(ini.GetBool("UseGzip", true, "WebServer"));
	m_nWebPageRefresh.Put(ini.GetInt("PageRefreshTime", 120, "WebServer"));
d1239 6
a1244 6
	m_LancastEnabled.Put(ini.GetBool("Enabled",false,"Lancast"));
	m_UseDefaultIP.Put(ini.GetBool("UseDefaultIP",true,"Lancast"));
	m_DefaultLancastIP.Put(inet_addr(ini.GetString("IPAddress",t_strdefaultip,"Lancast")));
	m_LancastIP.Put(inet_addr(ini.GetString("IPAddress",t_strdefaultip,"Lancast")));
	m_LancastSubnet.Put(inet_addr(ini.GetString("Subnet","255.255.0.0","Lancast")));
	m_LancastPort.Put(ini.GetInt("Port",5000,"Lancast"));
d1249 2
a1250 2
	m_nAcceptMessagesFrom.Put(ini.GetInt("AcceptMessageFrom",1));
	m_nAwayState.Put(false);
d1256 2
a1257 2
	m_bAutoFilenameCleanup.Put(ini.GetBool("AutoFilenameCleanup", false, "Cleanup"));
	m_bFilenameCleanupTags.Put(ini.GetBool("CleanupTags", false, "Cleanup"));
d1268 1
a1268 1
		return m_DefaultLancastIP.Get();
d1270 1
a1270 1
		return m_LancastIP.Get();
d1279 1
a1279 1
		m_bIsNTBased.Put(bIsNTNBased);
d1287 1
a1287 1
			if ( m_bIsNTBased.Get() )
d1402 1
a1402 1
	switch(m_nLanguageID.Get()) {
d1452 1
a1452 1
					m_nLanguageID.Put(MAKELANGID(nLocalLang,SUBLANG_DEFAULT));
d1454 1
a1454 1
					strLng1 = GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID.Get());//Cax2 fix
d1458 1
a1458 1
					m_nLanguageID.Put(MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT));
d1460 1
a1460 1
			if ( m_bIsNTBased.Get() )
d1462 1
a1462 1
				SetThreadLocale(m_nLanguageID.Get()); // THIS FUNCTION DOEN NOT WORK ON WIN9X !!!!!!!!1
d1475 1
a1475 1
				strQuestion = CString("\xbf") + GetResString(IDS_MULTIPLE, m_nLanguageID.Get()) + CString("?");
d1477 1
a1477 1
				strQuestion = GetResString(IDS_MULTIPLE, m_nLanguageID.Get()) + CString("?");
d1482 1
a1482 1
				m_bMultiple.Put(true);
d1485 1
a1485 1
	if ( m_bIsNTBased.Get() )
d1487 1
a1487 1
		SetThreadLocale(m_nLanguageID.Get());
d1491 2
a1492 2
	if (GetResString(IDS_MB_LANGUAGEINFO, m_nLanguageID.Get()).GetLength()==0) {
		m_nLanguageID.Put(MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT));
d1495 1
a1495 1
			SetThreadLocale(m_nLanguageID.Get());
d1502 1
a1502 1
	m_nMainProcessPriority.Put(Value);
d1508 1
a1508 1
	return (m_bIsNTBased.Get());
@


1.71
log
@code cleanup
@
text
@d778 2
a779 2
	char t_strLanCastIP[17];
	sprintf(t_strLanCastIP,"%i.%i.%i.%i",(uint8)m_LancastIP.Get(),(uint8)(m_LancastIP.Get()>>8),(uint8)(m_LancastIP.Get()>>16),(uint8)(m_LancastIP.Get()>>24));
d781 2
a782 2
	char t_strLanCastSubnet[17];
	sprintf(t_strLanCastSubnet,"%i.%i.%i.%i",(uint8)m_LancastSubnet.Get(),(uint8)(m_LancastSubnet.Get()>>8),(uint8)(m_LancastSubnet.Get()>>16),(uint8)(m_LancastSubnet.Get()>>24));
d826 1
a826 2
	char buffer[200];

d859 2
d862 2
a863 2
		buffer[i] = rand() % ('z' - 'a') + 'a';
	buffer[i] = '\0';
d867 1
a867 1
	sprintf(buffer,"%sIncoming",appdir);
d870 1
a870 1
	sprintf(buffer,"%sTemp",appdir);
d873 1
a873 1
	sprintf(buffer,"%sVLC",appdir);
d875 1
a875 1
	sprintf(buffer,"%s\\vlc.exe",GetVlcDir());		//Cax2 - for backward compatibility
d1042 1
a1042 1
	sprintf(prefs->TxtEditor,"%s",ini.GetString("TxtEditor","notepad.exe"));
d1178 1
a1178 1
		sprintf(buffer,ini.GetString(buffer2,"-1"));	//we can now have black as background
d1200 1
a1200 1
	sprintf(buffer,ini.GetString("TotalDownloadedBytes",0,"Statistics"));
d1203 1
a1203 1
	sprintf(buffer,ini.GetString("TotalUploadedBytes",0,"Statistics"));
d1208 4
a1211 4
	sprintf(buffer,"");
	sprintf(prefs->proxy.name,"%s",ini.GetString("Name",buffer,"Proxy"));
	sprintf(prefs->proxy.password,"%s",ini.GetString("Password",buffer,"Proxy"));
	sprintf(prefs->proxy.user,"%s",ini.GetString("User",buffer,"Proxy"));
@


1.70
log
@SyruS: implemented netwolf's commentfilter (partly from 0.28b)
changed default button of "allow multiple instances" to "no"
@
text
@d747 3
a749 5
	char hex_hash[33];
	hex_hash[0] = '\0';
	for (uint16 i = 0; i < 16; i++) // hmm I wonder if there is a standart function for this
		sprintf(hex_hash, "%s%02X", hex_hash, prefs->A4AF_file_hash[i]);
	ini.WriteString("A4AFAutoFileHash", CString(hex_hash));	
@


1.69
log
@windows server 2003 detection support
@
text
@d594 1
d1045 1
d1480 1
a1480 1
			if (IDNO==MessageBox(0, strQuestion.GetBuffer(),"eMule Plus",MB_YESNO))
@


1.68
log
@SyruS: customizable cleanup of filenames
@
text
@d906 1
a906 1
	m_nTooltipDelayTime.Put(ini.GetInt("ToolTipDelay",3));
d1298 2
@


1.67
log
@*** empty log message ***
@
text
@d797 6
d1254 5
@


1.66
log
@Saving preferences on first start of new eMule version
@
text
@d1085 1
a1085 1
	m_nMainProcessPriority.Put(ini.GetInt("MainProcessPriority",1));
@


1.65
log
@code cleanup
@
text
@d833 2
d846 2
d1247 4
@


1.64
log
@Added Turkish Language
@
text
@d53 9
a61 5
	char buffer[490];
	::GetModuleFileName(0, buffer, 490);
	LPTSTR pszFileName = _tcsrchr(buffer, '\\') + 1;
	*pszFileName = '\0';
	appdir = nstrdup(buffer);
d454 1
a454 2
CPreferences::~CPreferences(){
	delete[] appdir;
@


1.63
log
@Increased min queue size
@
text
@d1399 1
d1425 1
@


1.62
log
@SecuredVars improvement
@
text
@d879 1
a879 1
	m_nQueueSize.Put(ini.GetInt("QueueSize", MIN_QUEUE*2));
@


1.61
log
@Webserver from official 0.27c
@
text
@d30 4
@


1.60
log
@Added Basque Language
@
text
@d762 1
d765 1
d1200 1
d1203 1
@


1.59
log
@Fixed bug #166
@
text
@d1390 1
d1415 1
@


1.58
log
@Corrected scheduler
@
text
@d1231 1
@


1.58.2.1
log
@27a partial merge
@
text
@a569 1
	ini.WriteBool("WatchClipboard4ED2kFilelinks",prefs->watchclipboard);
a584 3
	buffer.Format("%s",prefs->notifierConfiguration);		      // Added by enkeyDEV
	ini.WriteString("NotifierConfiguration",buffer);			  // Added by enkeyDEV
	ini.WriteString("DateTimeFormat",GetDateTimeFormat());
d849 1
a849 1
	SetIncomingDir(ini.GetString("IncomingDir",buffer));
d852 1
a852 1
	SetTempDir(ini.GetString("TempDir",buffer));
a1001 2
	prefs->notifierConfiguration=ini.GetString("NotifierConfiguration",""); // Added by enkeyDEV
	prefs->datetimeformat=ini.GetString("DateTimeFormat","%A, %x, %X");
a1021 1
	prefs->watchclipboard=ini.GetBool("WatchClipboard4ED2kFilelinks",false);
@


1.58.2.2
log
@final touches on 27a stuff, i hope...
@
text
@d570 1
a570 1
	ini.WriteBool("WatchClipboard4ED2kFilelinks",m_bwatchclipboard.Get());
d586 3
a588 2
	ini.WriteString("NotifierConfiguration",m_snotifierConfiguration.Get().c_str());			  // Added by enkeyDEV
	ini.WriteString("DateTimeFormat",m_sdatetimeformat.Get().c_str());
d1006 2
a1007 2
	m_snotifierConfiguration=ini.GetString("NotifierConfiguration","").GetBuffer(0); // Added by enkeyDEV
	m_sdatetimeformat=ini.GetString("DateTimeFormat","%A, %x, %X").GetBuffer(0);
d1028 1
a1028 1
	m_bwatchclipboard=ini.GetBool("WatchClipboard4ED2kFilelinks",false);
@


1.58.2.3
log
@27c
@
text
@a171 3

	if (((int*)prefs->userhash[0]) == 0 && ((int*)prefs->userhash[1]) == 0 && ((int*)prefs->userhash[2]) == 0 && ((int*)prefs->userhash[3]) == 0)
		CreateUserHash();
a1236 2
	prefs->dontcompressavi=ini.GetBool("DontCompressAvi",false);
	prefs->maxmsgsessions=ini.GetInt("MaxMessageSessions",50);
@


1.57
log
@Updated Night Shift to Scheduller (needs more testing and a new icon from DrSiRiUs... coming!)
@
text
@d652 2
a653 2
	ini.WriteInt("SCHShift1Conn",m_nSCHShift2conn.Get());
	ini.WriteInt("SCHShift15sec",m_nSCHShift25sec.Get());
d1082 2
a1083 2
	m_nSCHShift1.Put(ini.GetInt("SCHShift1",21600));
	m_nSCHShift2.Put(ini.GetInt("SCHShift2",64800));
d1086 2
a1087 2
	m_nSCHShift1conn.Put(ini.GetInt("SCHShift2conn",512));
	m_nSCHShift15sec.Put(ini.GetInt("SCHShift25sec",40));
@


1.56
log
@small code optimizations
@
text
@d640 18
a657 9
	ini.WriteBool("NSEnabled", m_bNSEnabled.Get());
	ini.WriteBool("NSExceptSat", m_bNSExceptSat.Get());
	ini.WriteBool("NSExceptSun", m_bNSExceptSun.Get());
	ini.WriteInt("NSStart",m_nNSStart.Get());
	ini.WriteInt("NSEnd",m_nNSEnd.Get());
	ini.WriteInt("NSDayUp",m_nNSDayUpload.Get());
	ini.WriteInt("NSDayDown",m_nNSDayDownload.Get());
	ini.WriteInt("NSNightUp",m_nNSNightUpload.Get());
	ini.WriteInt("NSNightDown",m_nNSNightDownload.Get());
d1074 18
a1091 9
	m_bNSEnabled.Put(ini.GetBool("NSEnabled", false));
	m_bNSExceptSat.Put(ini.GetBool("NSExceptSat", true));
	m_bNSExceptSun.Put(ini.GetBool("NSExceptSun", true));
	m_nNSStart.Put(ini.GetInt("NSStart",64800));
	m_nNSEnd.Put(ini.GetInt("NSEnd",21600));
	m_nNSDayUpload.Put(ini.GetInt("NSDayUp",UNLIMITED));
	m_nNSDayDownload.Put(ini.GetInt("NSDayDown",UNLIMITED));
	m_nNSNightUpload.Put(ini.GetInt("NSNightUp",UNLIMITED));
	m_nNSNightDownload.Put(ini.GetInt("NSNightDown",UNLIMITED));
@


1.55
log
@minor bugfixes, plus bugfix for bug #34
@
text
@d57 3
a59 3
	// load preferences.dat or set standart values
	char* fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%spreferences.dat",appdir);
a60 1
	delete[] fullpath;
d128 4
a131 5
	// shared directories
	fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%sshareddir.dat",appdir);
	CStdioFile* sdirfile = new CStdioFile();
	if(sdirfile->Open(fullpath,CFile::modeRead))
d134 1
a134 1
		while (sdirfile->ReadString(toadd))
d136 1
a136 1
		sdirfile->Close();
a137 1
	delete sdirfile;
d140 4
a143 5
	// temp directories
	//fullpath = new char[strlen(appdir)+MAX_PATH]; [FoRcHa] (we already have one)
	sprintf(fullpath,"%stempdir.dat",appdir);
	CStdioFile* tdirfile = new CStdioFile();
	if (tdirfile->Open(fullpath,CFile::modeRead)){
d145 1
a145 1
		while (tdirfile->ReadString(toadd)){
d152 1
a152 1
		tdirfile->Close();
d154 1
a154 1
	delete tdirfile;
d157 1
a157 1
	delete[] fullpath;
d182 2
a183 2
	CStdioFile* sdirfile = new CStdioFile() ;
	if (sdirfile->Open(fullpath, CFile::modeRead)) {
d185 1
a185 1
		while (sdirfile->ReadString(toadd)) {
d191 2
a192 3
		sdirfile->Close() ;
	}
	delete sdirfile ;
d198 2
a199 2
	char* fullpath = new char[strlen(appdir)+MAX_PATH] ;
	sprintf(fullpath, "%suserhash.dat", appdir) ;
d202 1
a202 2

	delete[] fullpath ;
d234 2
a235 2
	char* fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%spreferences.dat",appdir);
d239 1
a239 2

	delete[] fullpath;
d251 2
a252 3
	// Saving HashID 
	fullpath = new char[strlen(appdir)+MAX_PATH] ;
	sprintf(fullpath, "%suserhash.dat", appdir) ;
d255 1
a255 2

	delete[] fullpath ;
d265 2
a266 3

	fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%sshareddir.dat",appdir);
d279 2
a280 3
	// start added by InterCeptor (multiple tempdirs) 19.11.02
	//fullpath = new char[strlen(appdir)+MAX_PATH]; [FoRcHa] (we already have one)
	sprintf(fullpath,"%stempdir.dat",appdir);
d291 1
a291 2
	// end added by InterCeptor (multiple tempdirs) 19.11.02
	delete[] fullpath;
d470 2
a471 2
	char* fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%spreferences.ini",appdir);
a473 2

	delete[] fullpath;
@


1.54
log
@*** empty log message ***
@
text
@d866 2
a867 2
	if (m_nMaxUpload.Get()!=UNLIMITED && m_nMaxUpload.Get()>m_nMaxGraphUploadRate.Get())
		m_nMaxUpload.Put(m_nMaxGraphDownloadRate.Get());
d869 1
a869 1
	if (m_nMaxDownload.Get()!=UNLIMITED && m_nMaxDownload.Get()>m_nMaxGraphDownloadRate.Get())
@


1.53
log
@*** empty log message ***
@
text
@d953 1
a953 1
	m_sToolbarSettings.Put(ini.GetString("ToolbarSettings", "0099010203040506079908").GetBuffer(0));
@


1.52
log
@*** empty log message ***
@
text
@d42 1
a42 1

d1443 1
a1443 1
	if ( theApp.glob_prefs->IsNTBased() )
d1465 2
a1466 5
	if ( !bWinVerAlreadyDetected )
	{
		GetWindowsVersion();
	}
	return m_bIsNTBased.Get();
@


1.51
log
@sETtHREADlOCALE DOES NOT WORK ON NON-nt (WIN9X) BASED SYSTEMS
@
text
@d38 2
a1237 1
	static bWinVerAlreadyDetected = false;
d1465 4
@


1.50
log
@*** empty log message ***
@
text
@d1442 4
a1445 1
	SetThreadLocale(m_nLanguageID.Get());
d1450 4
a1453 1
		SetThreadLocale(m_nLanguageID.Get());
d1460 5
@


1.49
log
@eMule priority set higher by default
@
text
@d1240 3
a1242 1
		m_wWinVer = DetectWinVersion();	
d1249 5
a1253 1
		case _WINVER_98_:
a1409 1
					SetThreadLocale(m_nLanguageID.Get());
d1416 8
a1423 1
					SetThreadLocale(m_nLanguageID.Get());
@


1.48
log
@bugfix: server connect timeout, averaged file rating
@
text
@d1075 1
a1075 1
	m_nMainProcessPriority.Put(ini.GetInt("MainProcessPriority",0));
@


1.47
log
@Added Romanian Language
@
text
@d973 5
a977 5
	m_nSrvConTimeout.Put(ini.GetInt("SrvConTimeout",30000));
	if(m_nSrvConTimeout.Get() < 30000)
		m_nSrvConTimeout.Put(30000);
	else if(m_nSrvConTimeout.Get() > 360000)
		m_nSrvConTimeout.Put(360000);
@


1.46
log
@Continuing to convert variables to CSecuredVar template
@
text
@d1377 1
d1401 1
@


1.45
log
@Continuing to convert variables to CSecuredVar template
@
text
@d123 2
a124 2
	memcpy(&userhash,&prefs->userhash,16);
	prefs->smartidstate=0;
d476 3
a478 1
void CPreferences::SavePreferences(){
d516 3
a518 3
	ini.WriteBool("PartTrafficEnabled",prefs->m_pt_useit);
	ini.WriteInt("UploadbarStyle",prefs->m_upbar_st);
	ini.WriteInt("UploadbarColor",prefs->m_upbar_cl);
d520 1
a520 1
	ini.WriteInt("ToolTipDelay",prefs->m_iToolDelayTime);
d531 5
a535 8
	ini.WriteInt("DeadServerRetries",prefs->deadserverretries);
	ini.WriteInt("SplitterbarPosition",prefs->splitterbarPosition);
	ini.WriteInt("VariousStatisticsMaxValue",prefs->statsMax);
	ini.WriteInt("StatsAverageMinutes",prefs->statsAverageMinutes);
	ini.WriteInt("MaxConnectionsPerFiveSeconds",prefs->MaxConperFive);
	ini.WriteInt("MaximumUploadClients", m_nMaxUpClientsAllowed.Get());
	ini.WriteInt("MinimumUploadClients", m_nMinUpClientsAllowed.Get());
	ini.WriteInt("UploadClientDatarate", m_nUploadClientDatarate.Get());
d566 1
a566 1
	ini.WriteBool("BringToFront",prefs->bringtoforeground);
d573 8
a580 8
	ini.WriteBool("StartupMinimized",prefs->startMinimized);
	ini.WriteBool("SafeConnect",prefs->SafeConnect);
	ini.WriteBool("ToolbarSpeedMeter",prefs->showToolbarSpeedMeter);
	ini.WriteBool("CloseToTray",prefs->closeToTray);
	ini.WriteBool("DetailsOnClick",prefs->DetailsOnClick);
	ini.WriteInt("SrvConTimeout", prefs->SrvConTimeout);
	ini.WriteBool("SlowComplete",prefs->SlowComplete);
	ini.WriteInt("SlowCompleteBlockSize", prefs->SlowCompleteBlockSize);
d589 8
a596 9
	ini.WriteBool("NotifyOnDownload",prefs->useDownloadNotifier);
	ini.WriteBool("NotifyOnDownloadAdd",prefs->useDownloadAddNotifier);
	ini.WriteBool("NotifyOnChat",prefs->useChatNotifier);		  
	ini.WriteBool("NotifyOnLog",prefs->useLogNotifier);
	ini.WriteBool("NotifierUseSound",prefs->useSoundInNotifier);
	ini.WriteBool("NotifierPopEveryChatMessage",prefs->notifierPopsEveryChatMsg);
	ini.WriteBool("NotifyOnImportantError", prefs->notifierImportantError);
	buffer.Format("%s",prefs->notifierSoundFilePath);
	ini.WriteString("NotifierSoundPath",buffer);
d600 25
a624 25
	ini.WriteString("IRCServer",prefs->m_sircserver);
	ini.WriteString("IRCNick",prefs->m_sircnick);
	ini.WriteBool("IRCAddTimestamp", prefs->m_bircaddtimestamp);
	ini.WriteString("IRCFilterName", prefs->m_sircchannamefilter);
	ini.WriteInt("IRCFilterUser", prefs->m_iircchanneluserfilter);
	ini.WriteBool("IRCUseFilter", prefs->m_bircusechanfilter);
	ini.WriteString("IRCPerformString", prefs->m_sircperformstring);
	ini.WriteBool("IRCUsePerform", prefs->m_bircuseperform);
	ini.WriteBool("IRCListOnConnect", prefs->m_birclistonconnect);
	ini.WriteBool("IRCAcceptLinks", prefs->m_bircacceptlinks);
	ini.WriteBool("IRCIgnoreInfoMessage", prefs->m_bircignoreinfomessage);
	ini.WriteBool("IRCIgnoreEmuleProtoInfoMessage", prefs->m_bircignoreemuleprotoinfomessage);
	ini.WriteBool("SmartIdCheck", prefs->smartidcheck);

	ini.WriteBool("UseSortingDefaults",prefs->useSort);  	//sortprefs Cax2
	ini.WriteBool("Use2ndSortSources",prefs->useSrcSortCol2);
	ini.WriteInt("SortServersCode",prefs->serverSortCol);	
	ini.WriteInt("SortUploadsCode",prefs->uploadSortCol);
	ini.WriteInt("SortQueueCode",prefs->queueSortCol);
	ini.WriteInt("SortSearchCode",prefs->searchSortCol);
	ini.WriteInt("SortIrcCode",prefs->ircSortCol);
	ini.WriteInt("SortFilesCode",prefs->fileSortCol);
	ini.WriteInt("SortDownloadsCode",prefs->downloadSortCol);
	ini.WriteInt("1stSortSourcesCode",prefs->srcSortCol1);
	ini.WriteInt("2ndSortSourcesCode",prefs->srcSortCol2);
d627 5
a631 5
	ini.WriteBool("CommunityEnabled", prefs->CommunityEnabled);
	ini.WriteString("CommunityString", prefs->CommunityString);
	ini.WriteBool("CommunityNoBan", prefs->CommunityNoBan);
	ini.WriteInt("NotificationDisplayTime",prefs->NotificationDisplayTime);
	ini.WriteInt("NotificationFontSize",prefs->NotificationFontSize);
d633 5
a637 5
	ini.WriteInt("PriorityHigh", prefs->PriorityHigh);
	ini.WriteInt("PriorityLow", prefs->PriorityLow);
	ini.WriteBool("RestartWaiting", prefs->RestartWaiting);
	ini.WriteBool("LogToFile", prefs->LogToFile);
	ini.WriteBool("TransferFullChunks", prefs->TransferFullChunks);
d639 6
a644 6
	ini.WriteBool("DisableXSUpTo", prefs->DisableXSUpTo);
	ini.WriteInt("XSUpTo", prefs->XSUpTo);
	ini.WriteString("UsedFont", prefs->UsedFont);
	ini.WriteInt("FontSize",prefs->FontSize);
	ini.WriteInt("HashingPriority",prefs->HashingPriority);
	ini.WriteBool("UploadParts", prefs->UploadParts);
d663 1
a663 1
	ini.WriteBool("MultipleInstances", prefs->m_multiple);
d665 1
a665 1
	ini.WriteBool("Verbose", prefs->m_bVerbose);
d667 1
a667 1
	ini.WriteBool("UpdateQueueList", prefs->m_bupdatequeuelist);
d739 1
a739 1
	ini.WriteBool("MlDonkeyCM",prefs->MlDonkeyCM);
d791 1
d886 3
a888 3
	prefs->m_pt_useit=ini.GetBool("PartTrafficEnabled",false);	//Cax2
	prefs->m_upbar_st=ini.GetInt("UploadbarStyle", 2);
	prefs->m_upbar_cl=ini.GetInt("UploadbarColor", 0);
d890 1
a890 1
	prefs->m_iToolDelayTime=ini.GetInt("ToolTipDelay",3);
d898 5
a902 5
	prefs->deadserverretries=ini.GetInt("DeadServerRetries",1);
	prefs->splitterbarPosition=ini.GetInt("SplitterbarPosition",75);
	prefs->statsMax=ini.GetInt("VariousStatisticsMaxValue",100);
	prefs->statsAverageMinutes=ini.GetInt("StatsAverageMinutes",5);
	prefs->MaxConperFive=ini.GetInt("MaxConnectionsPerFiveSeconds",GetDefaultMaxConperFive());
d907 2
a908 2
	if(prefs->MaxConperFive > nMax) {
		prefs->MaxConperFive = nMax;
d910 2
a911 2
		if(prefs->MaxConperFive < 5)
			prefs->MaxConperFive = 5;
d960 1
a960 1
	prefs->bringtoforeground=ini.GetBool("BringToFront",true);
d967 11
a977 11
	prefs->startMinimized=ini.GetBool("StartupMinimized",false);
	prefs->SafeConnect =ini.GetBool("SafeConnect",true);
	prefs->showToolbarSpeedMeter = ini.GetBool("ToolbarSpeedMeter", false);
	prefs->closeToTray=ini.GetBool("CloseToTray",false);	
	prefs->DetailsOnClick=ini.GetBool("DetailsOnClick",false);	

	prefs->SrvConTimeout=ini.GetInt("SrvConTimeout",30000);
	if(prefs->SrvConTimeout < 30000)
		prefs->SrvConTimeout = 30000;
	else if(prefs->SrvConTimeout > 360000)
		prefs->SrvConTimeout = 360000;
d979 4
a982 4
	prefs->SlowComplete=ini.GetBool("SlowComplete",false);	
	prefs->SlowCompleteBlockSize=ini.GetInt("SlowCompleteBlockSize",32);
	if(prefs->SlowCompleteBlockSize > 1024)
		prefs->SlowCompleteBlockSize = 1024;
d997 23
a1019 23
	prefs->useDownloadAddNotifier=ini.GetBool("NotifyOnDownloadAdd",false);
	prefs->useDownloadNotifier=ini.GetBool("NotifyOnDownload",false);
	prefs->useChatNotifier=ini.GetBool("NotifyOnChat",false);
	prefs->useLogNotifier=ini.GetBool("NotifyOnLog",false);
	prefs->useSoundInNotifier=ini.GetBool("NotifierUseSound",false);
	prefs->notifierPopsEveryChatMsg=ini.GetBool("NotifierPopEveryChatMessage",false);
	prefs->notifierImportantError=ini.GetBool("NotifyOnImportantError",false);
	sprintf(prefs->notifierSoundFilePath,"%s",ini.GetString("NotifierSoundPath",""));

	sprintf(prefs->m_sircserver,"%s",ini.GetString("IRCServer","irc.liquidirc.com"));
	sprintf(prefs->m_sircnick,"%s",ini.GetString("IRCNick","eMule Plus"));
	prefs->m_bircaddtimestamp=ini.GetBool("IRCAddTimestamp",true);
	sprintf(prefs->m_sircchannamefilter,"%s",ini.GetString("IRCFilterName", "" ));
	prefs->m_bircusechanfilter=ini.GetBool("IRCUseFilter", false);
	prefs->m_iircchanneluserfilter=ini.GetInt("IRCFilterUser", 0);
	sprintf(prefs->m_sircperformstring,"%s",ini.GetString("IRCPerformString", "/join #emule" ));
	prefs->m_bircuseperform=ini.GetBool("IRCUsePerform", false);
	prefs->m_birclistonconnect=ini.GetBool("IRCListOnConnect", true);
	prefs->m_bircacceptlinks=ini.GetBool("IRCAcceptLinks", false);
	prefs->m_bircignoreinfomessage=ini.GetBool("IRCIgnoreInfoMessage", false);
	prefs->m_bircignoreemuleprotoinfomessage=ini.GetBool("IRCIgnoreEmuleProtoInfoMessage", true);
	prefs->smartidcheck=ini.GetBool("SmartIdCheck",true);
	prefs->m_bVerbose=ini.GetBool("Verbose",false);
d1021 1
a1021 1
	prefs->m_bupdatequeuelist=ini.GetBool("UpdateQueueList",false);
d1029 11
a1039 11
	prefs->useSort= ini.GetBool("UseSortingDefaults",true);  	//sortprefs Cax2
	prefs->useSrcSortCol2= ini.GetBool("Use2ndSortSources",false);
	prefs->serverSortCol = ini.GetInt("SortServersCode",0);	
	prefs->uploadSortCol = ini.GetInt("SortUploadsCode",12);
	prefs->queueSortCol = ini.GetInt("SortQueueCode",105);		//Cax2 changed 16/01/03
	prefs->searchSortCol = ini.GetInt("SortSearchCode",12);
	prefs->ircSortCol = ini.GetInt("SortIrcCode",11);
	prefs->fileSortCol = ini.GetInt("SortFilesCode",0);
	prefs->downloadSortCol = ini.GetInt("SortDownloadsCode",8);
	prefs->srcSortCol1 = ini.GetInt("1stSortSourcesCode",0);
	prefs->srcSortCol2 = ini.GetInt("2ndSortSourcesCode",255);
d1042 5
a1046 5
	prefs->CommunityEnabled=ini.GetBool("CommunityEnabled", false);
	sprintf(prefs->CommunityString,"%s",ini.GetString("CommunityString",""));
	prefs->CommunityNoBan=ini.GetBool("CommunityNoBan", false);
	prefs->NotificationDisplayTime=ini.GetInt("NotificationDisplayTime",4000);
	prefs->NotificationFontSize=ini.GetInt("NotificationFontSize",70);
d1048 5
a1052 5
	prefs->PriorityHigh=ini.GetInt("PriorityHigh",100);
	prefs->PriorityLow=ini.GetInt("PriorityLow",300);
	if(prefs->PriorityLow != 0){
		if(prefs->PriorityLow < prefs->PriorityHigh)
			prefs->PriorityLow = prefs->PriorityHigh*2;
d1054 2
a1055 2
		prefs->PriorityLow = 300;
		prefs->PriorityHigh = 100;
d1057 3
a1059 3
	prefs->RestartWaiting = ini.GetBool("RestartWaiting",true);
	prefs->LogToFile = ini.GetBool("LogToFile",false);
	prefs->TransferFullChunks = ini.GetBool("TransferFullChunks",true);
d1061 8
a1068 8
	prefs->DisableXSUpTo = ini.GetBool("DisableXSUpTo",false);
	prefs->XSUpTo=ini.GetInt("XSUpTo",GetMaxSourcePerFileSoft());
	if(prefs->XSUpTo > GetMaxSourcePerFileSoft())
		prefs->XSUpTo = GetMaxSourcePerFileSoft();
	sprintf(prefs->UsedFont,"%s",ini.GetString("UsedFont", "MS Sans Serif"));
	prefs->FontSize=ini.GetInt("FontSize",80);
	prefs->HashingPriority=ini.GetInt("HashingPriority",2);
	prefs->UploadParts = ini.GetBool("UploadParts",false);
d1087 1
a1087 2
	// EpicStruggle
	prefs->m_multiple = ini.GetBool("MultipleInstances",false);
d1146 2
a1147 1
	if (prefs->statsAverageMinutes<1) prefs->statsAverageMinutes=5;
d1153 3
a1155 2
		prefs->statcolors[i]=_atoi64(buffer);
		if (prefs->statcolors[i]==-1) {prefs->statcolors[i]=DefaultStatsColor(i);}
d1157 1
a1157 1
	m_nGraphRatio.Put(ini.GetInt("ConnectionsGraphRatio",1)); // propstats Cax2
d1159 1
a1159 2
	// Added By Maverick
	prefs->MlDonkeyCM = ini.GetBool("MlDonkeyCM",true);
a1244 5
uint16 CPreferences::GetMaxConperFive(){
	CSingleLock PrefLock(&m_Pref_Mutex_MaxConPer5,TRUE);
	return prefs->MaxConperFive;
}

d1425 1
a1425 1
				prefs->m_multiple = 1;
@


1.44
log
@Continuing to convert variables to CSecuredVar template
@
text
@d519 1
a519 1
	ini.WriteInt("QueueSize", prefs->queuesize) ; // SeeWen QUEUESIZE
d534 3
a536 3
	ini.WriteInt("MaximumUploadClients",prefs->maxupclientsallowed);
	ini.WriteInt("MinimumUploadClients",prefs->minupclientsallowed);
	ini.WriteInt("UploadClientDatarate",prefs->uploadclientdatarate);
d540 3
a542 3
	ini.WriteInt("SLS_RestoreSourcesTime",prefs->slsrestoresourcestime); // reCDVst
	ini.WriteInt("SLS_LoadQuantities",prefs->slsloadquantities); // DonGato
	ini.WriteInt("SLS_WhenSourcesOutdated",prefs->slsoutdated); // reCDVst
d544 1
a544 1
	ini.WriteInt("SLS_Enable",prefs->slsenable); // DonGato
d877 6
a882 6
	prefs->queuesize=ini.GetInt("QueueSize", MIN_QUEUE*2); // SeeWen QUEUESIZE
	if(prefs->queuesize > MAX_QUEUE)
		prefs->queuesize = MAX_QUEUE;
	else if(prefs->queuesize < MIN_QUEUE)
		prefs->queuesize = MIN_QUEUE;
	m_nRQlimit.Put((prefs->queuesize >= 2000)?prefs->queuesize:2000); //Cax2 - remote queue limit linked to queue size, but no lower than 2000
d928 3
a930 3
	prefs->slsrestoresourcestime=ini.GetInt("SLS_RestoreSourcesTime",7200000);
	if(prefs->slsrestoresourcestime < 3600000)
		prefs->slsrestoresourcestime = 3600000;
d932 7
a938 7
	prefs->slsloadquantities=ini.GetInt("SLS_LoadQuantities",20);
	if(prefs->slsloadquantities > 100)
		prefs->slsloadquantities = 100;

	prefs->slsoutdated=ini.GetInt("SLS_WhenSourcesOutdated",2);
	if(prefs->slsoutdated > 10)
		prefs->slsoutdated = 10;
d940 1
a940 1
	prefs->slsenable = ini.GetBool("SLS_Enable",false);
@


1.43
log
@Bugfix when temp folder appears twice or more in tempdir.dat
@
text
@d168 2
a169 2
    m_UseProxyListenPort = false;
	ListenPort = 0;
d537 3
a539 3
	ini.WriteInt("BadClientBanTime",prefs->badclientbantime);
	ini.WriteInt("BadClientMinRequestTime",prefs->minrequesttime);
	ini.WriteInt("BadClientMinRequestNum",prefs->badclientban);
d549 6
a554 7
	// Added by Tarod
	ini.WriteBool("UAP", prefs->UAP);
	ini.WriteBool("DAP", prefs->DAP);
	ini.WriteBool("DisableXS", prefs->disablexs);
	ini.WriteBool("StartDownloadPaused", prefs->startdownloadpaused);
	ini.WriteBool("DownloadPausedOnComplete", prefs->downloadpausedonclomplete);
	ini.WriteBool("RemoveNNS", prefs->remove_nns);
d556 1
a556 1
	ini.WriteString("ToolbarSettings", prefs->toolbarsettings); // Added by reCDVst
d634 1
a634 1
	ini.WriteInt("Profile", prefs->Profile);
d915 11
a925 11
	prefs->badclientbantime=ini.GetInt("BadClientBanTime",3600000);
	if(prefs->badclientbantime > 18000000)
		prefs->badclientbantime = 18000000;
	
	prefs->minrequesttime=ini.GetInt("BadClientMinRequestTime",590000);
	if(prefs->minrequesttime > 590000)
		prefs->minrequesttime = 590000;
	
	prefs->badclientban=ini.GetInt("BadClientMinRequestNum",3);
	if(prefs->badclientban < 3)
		prefs->badclientban = 3;
d945 6
a950 7
	// Added by Tarod
	prefs->UAP = ini.GetBool("UAP", true);
	prefs->DAP = ini.GetBool("DAP", true);
	prefs->disablexs = ini.GetBool("DisableXS", false);
	prefs->startdownloadpaused = ini.GetBool("StartDownloadPaused", false);
	prefs->downloadpausedonclomplete = ini.GetBool("DownloadPausedOnComplete", false);
	prefs->remove_nns = ini.GetBool("RemoveNNS", false);
d952 1
a952 1
	sprintf(prefs->toolbarsettings,"%s",ini.GetString("ToolbarSettings", "0099010203040506079908")); // Added by reCDVst
d1048 1
a1048 1
	prefs->Profile=ini.GetInt("Profile",0);
@


1.42
log
@*** empty log message ***
@
text
@d148 5
a152 2
			tempdir_list.AddHead(toadd);
			::CreateDirectory(toadd,0);
@


1.41
log
@Added Lithuanian Language
@
text
@d1073 1
a1073 1
	m_bAutoTakeLinks.Put(ini.GetBool("AutoTakeED2KLinks",true));
@


1.40
log
@all my stable changes and some minor fixes (refer to changelog)
@
text
@d1381 1
d1404 1
@


1.39
log
@Disabled RemoveNNS by default.
@
text
@d580 1
d598 1
d787 4
d902 1
d1027 1
d1220 5
@


1.38
log
@Lancast : Help other emules on your lan complete/download files quicker, saving bandwith.

1) UDP broadcasts your hashs over your lan
2) Listens for other clients sending broadcasts and adds them as sources
3) Clients on your lan bypass the queue, and have unlimited upload (download rate is still limited by emule downlaod speed)
@
text
@d942 1
a942 1
	prefs->remove_nns = ini.GetBool("RemoveNNS", true);
@


1.37
log
@Changed weekend except to take in account sat/sun shifts exception. :-(
@
text
@d767 18
d1188 32
@


1.36
log
@Weekend exclusion interface code.
@
text
@d651 2
a652 1
	ini.WriteBool("NSExceptWeekend", m_bNSExceptWeekend.Get());
d1052 2
a1053 1
	m_bNSExceptWeekend.Put(ini.GetBool("NSExceptWeekend", true));
@


1.35
log
@Night Shift (in cooperation with obaldin :P)
@
text
@d651 1
d1051 1
d1378 1
a1378 1
}@


1.34
log
@Priority control
@
text
@a17 1

a35 1

d568 1
a568 1
	ini.WriteBool("ConfirmExit", m_confirmExit.Get());
d643 14
a656 6
	ini.WriteBool("A4AFStringEnabled", m_A4AFStringEnabled.Get());
	ini.WriteBool("BanMessageEnabled", m_BanMessageEnabled.Get());
	ini.WriteInt("SearchMethod", m_SearchMethod.Get());
	ini.WriteBool("AutoTakeED2KLinks", m_AutoTakeLinks.Get()); 
	ini.WriteInt("FileBufferSizePref", m_iFileBufferSize.Get());
	ini.WriteInt("MainProcessPriority",m_MainProcessPriority.Get());
d936 1
a936 1
	m_confirmExit.Put(ini.GetBool("ConfirmExit",true));
d1041 15
a1055 7
	m_A4AFStringEnabled.Put(ini.GetBool("A4AFStringEnabled", false));
	m_BanMessageEnabled.Put(ini.GetBool("BanMessageEnabled", false));
	m_SearchMethod.Put(ini.GetInt("SearchMethod",0));
	m_BanMessageEnabled.Put(ini.GetBool("BanMessageEnabled", false));
	m_AutoTakeLinks.Put(ini.GetBool("AutoTakeED2KLinks",true));
	m_iFileBufferSize.Put(ini.GetInt("FileBufferSizePref",16));
	m_MainProcessPriority.Put(ini.GetInt("MainProcessPriority",0));
d1373 1
a1373 1
void	CPreferences::SetMainProcessPriority(int Value) 			
d1375 1
a1375 1
	m_MainProcessPriority.Put(Value);
@


1.33
log
@Main process priority settings (needs more coding)
@
text
@d1358 5
@


1.32
log
@changed default value
@
text
@d650 1
d1041 2
a1042 1
	
@


1.31
log
@Toolbar Enhancements (preliminary)
@
text
@d920 1
a920 1
	m_nToolbarLabels.Put(ini.GetInt("ToolbarLabels",0));
@


1.30
log
@file buffer size, autotake ed2k links and some preferences reorganization.
@
text
@d557 5
d918 3
@


1.29
log
@AutoTakeED2KLinks
@
text
@d644 1
a656 1

d1031 1
@


1.28
log
@simplified control panel,added remote queue limit as an otpion
@
text
@d643 1
d1029 3
a1031 1

@


1.27
log
@Paused files shown in grey and Selected search methos stored between sessions.
@
text
@d508 2
a509 2
	ini.WriteInt("MaxSourcesPerFileSoft",prefs->maxsourceperfilesoft);
	ini.WriteInt("MaxSourcesPerFileUDP",prefs->maxsourceperfileudp );
d834 2
a835 2
	prefs->maxsourceperfilesoft=ini.GetInt("MaxSourcesPerFileSoft",360);
	prefs->maxsourceperfileudp=ini.GetInt("MaxSourcesPerFileUDP",100);
d841 1
a841 1
	prefs->remotequeuelimit = prefs->queuesize; //Cax2 - remote queue limit now linked to queue size
d1018 3
a1020 3
	prefs->XSUpTo=ini.GetInt("XSUpTo",prefs->maxsourceperfilesoft);
	if(prefs->XSUpTo > prefs->maxsourceperfilesoft)
		prefs->XSUpTo = prefs->maxsourceperfilesoft;
@


1.26
log
@minor graphic details bugfixed, now preview player selection same as official
@
text
@d642 1
a872 40
	// Original by SeeWeb updated by [DonGato]
	prefs->maxupclientsallowed=ini.GetInt("MaximumUploadClients",100);
	prefs->uploadclientdatarate=ini.GetInt("UploadClientDatarate",3000);
	prefs->minupclientsallowed=ini.GetInt("MinimumUploadClients",3);

	if(prefs->maxupclientsallowed < 100)
		prefs->maxupclientsallowed = 100;

	if(prefs->minupclientsallowed > 6)
	{
		if(prefs->uploadclientdatarate < 2000)
			prefs->uploadclientdatarate = 2000;
	}
	else if (prefs->minupclientsallowed > 3)
	{
		if(prefs->uploadclientdatarate < 2500)
			prefs->uploadclientdatarate = 2500;
	}
	else
	{
		if(prefs->uploadclientdatarate < 3000)
			prefs->uploadclientdatarate = 3000;
	}

	if(prefs->minupclientsallowed < 3) {
		prefs->minupclientsallowed = 3;
	}
	else 
	{
		if(m_nMaxGraphUploadRate.Get() != UNLIMITED && prefs->minupclientsallowed >=3) {
			if (prefs->minupclientsallowed > (uint32)ROUND((m_nMaxGraphUploadRate.Get()*1024)/prefs->uploadclientdatarate))
				prefs->minupclientsallowed = (uint32)ROUND((m_nMaxGraphUploadRate.Get()*1024)/prefs->uploadclientdatarate);
		}
		else {
			prefs->minupclientsallowed = 3;
		}		
	}
	if(prefs->minupclientsallowed>prefs->maxupclientsallowed)	//Cax2 - just in case
		prefs->minupclientsallowed=prefs->maxupclientsallowed;

a897 7
	prefs->slsmaxsourcesperfile=ini.GetInt("SLS_MaxSourcesPerFile",500);
	if(prefs->slsmaxsourcesperfile > prefs->maxsourceperfilesoft) {
		prefs->slsmaxsourcesperfile = prefs->maxsourceperfilesoft;
	} else {
		if(prefs->slsmaxsourcesperfile > 500)
			prefs->slsmaxsourcesperfile = 500;
	}
a952 1

a982 1
	
d1027 1
a1030 2


@


1.25
log
@Added again Confirm on exit. :-)
@
text
@d172 1
a172 1
	CreateDirectory(GetVlcDir(),0);
d301 3
a303 3
	::CreateDirectory(GetIncomingDir(),0);
	::CreateDirectory(GetTempDir(),0);
	::CreateDirectory(GetVlcDir(),0);
d496 4
a499 2
	buffer.Format("%s", m_sVlcDir.Get().c_str());
	ini.WriteString("VLCDir",buffer);
d818 2
@


1.24
log
@Banning Message, A4AF customization, AutoPriority fix, Static Servers fix, .dat/.bin Preview
@
text
@d563 1
a563 1
//	ini.WriteBool("ConfirmExit",prefs->confirmExit);
d962 1
@


1.24.2.1
log
@v1a upgrade
@
text
@d172 1
a172 1
	//CreateDirectory(GetVlcDir(),0);		//Cax2 not needed anymore
d301 3
a303 3
	CreateDirectory(GetIncomingDir(),0);
	CreateDirectory(GetTempDir(),0);
	//CreateDirectory(GetVlcDir(),0);		//Cax2 - not needed anymore with official video player
d496 2
a497 4
	//buffer.Format("%s", m_sVlcDir.Get().c_str());	//Cax2 we don't save this anymore. m_sVlcDir to be removed in 1b & above
	//ini.WriteString("VLCDir",buffer);
	buffer.Format("%s", m_sVideoPlayer.Get().c_str());	//Cax2 - official mule code.
	ini.WriteString("VideoPlayer",buffer );
d563 1
a563 1
	ini.WriteBool("ConfirmExit", m_confirmExit.Get());
a815 2
	sprintf(buffer,"%s\\vlc.exe",GetVlcDir());		//Cax2 - for backward compatibility
	m_sVideoPlayer.Put(ini.GetString("VideoPlayer",buffer).GetBuffer(0));		//Cax2 - replace buffer with "" in later (non b-compatible) versions
a961 1
	m_confirmExit.Put(ini.GetBool("ConfirmExit",true));
@


1.24.2.2
log
@keeping in sync with the main cvs line
@
text
@d508 2
a509 2
	//ini.WriteInt("MaxSourcesPerFileSoft",prefs->maxsourceperfilesoft);
	//ini.WriteInt("MaxSourcesPerFileUDP",prefs->maxsourceperfileudp );
a641 3
	ini.WriteInt("SearchMethod", m_SearchMethod.Get());
	ini.WriteBool("AutoTakeED2KLinks", m_AutoTakeLinks.Get()); 
	ini.WriteInt("FileBufferSizePref", m_iFileBufferSize.Get());
d654 1
d833 2
a834 2
	//prefs->maxsourceperfilesoft=ini.GetInt("MaxSourcesPerFileSoft",360);
	//prefs->maxsourceperfileudp=ini.GetInt("MaxSourcesPerFileUDP",100);
d840 1
a840 1
	m_nRQlimit.Put((prefs->queuesize >= 2000)?prefs->queuesize:2000); //Cax2 - remote queue limit linked to queue size, but no lower than 2000
d872 40
d937 7
d999 1
d1030 1
d1066 3
a1068 3
	prefs->XSUpTo=ini.GetInt("XSUpTo",GetMaxSourcePerFileSoft());
	if(prefs->XSUpTo > GetMaxSourcePerFileSoft())
		prefs->XSUpTo = GetMaxSourcePerFileSoft();
d1075 1
a1075 5
	m_SearchMethod.Put(ini.GetInt("SearchMethod",0));
	m_BanMessageEnabled.Put(ini.GetBool("BanMessageEnabled", false));
	m_AutoTakeLinks.Put(ini.GetBool("AutoTakeED2KLinks",true));
	m_iFileBufferSize.Put(ini.GetInt("FileBufferSizePref",16));
	
d1078 2
@


1.23
log
@control panel limits, optimizations, bugfixes
@
text
@d638 2
d1068 2
@


1.22
log
@minor updates & bugfixes
@
text
@d517 2
a518 1
	ini.WriteInt("RemoteQueueLimit", prefs->remotequeuelimit); //remote QR 
d814 5
a818 2

	m_nMaxUpload.Put(ini.GetInt("MaxUpload",UNLIMITED));
d820 2
d834 2
a835 1
	prefs->remotequeuelimit = ini.GetInt("RemoteQueueLimit", 2000);
d850 1
a850 2
	m_nMaxGraphDownloadRate.Put(ini.GetInt("DownloadCapacity",96));
	m_nMaxGraphUploadRate.Put(ini.GetInt("UploadCapacity",16));
d873 1
a873 1
	
d903 2
@


1.21
log
@Removed FLMC as a preferences option.
@
text
@d647 2
d1013 2
@


1.20
log
@Little fixes and Static Servers additions from 26d
@
text
@a547 1
	ini.WriteBool("FLMC", prefs->firstlastmoviechunks);
a935 1
	prefs->firstlastmoviechunks = ini.GetBool("FLMC", false);
@


1.19
log
@Added instrumentation for debugging memory leaks :
#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

To all .cpp files (I hope I didn't miss any one)
@
text
@a577 1
//    ini.WriteBool("AddNewFilesPaused", prefs->addnewfilespaused);  
a951 1
//	prefs->confirmExit=ini.GetBool("ConfirmExit",true);
a970 1
 
a973 2
	//prefs->autotakeed2klinks = ini.GetBool("AutoTakeED2KLinks",true);			//not needed/buggy
//	prefs->addnewfilespaused = ini.GetBool("AddNewFilesPaused",false); 
@


1.18
log
@overhead can be set in preferences now
@
text
@d31 7
@


1.17
log
@minor preferences update...
@
text
@d641 1
a641 1
	//ini.WriteBool("ShowOverhead", prefs->m_bshowoverhead);// we always show overhead in the tooltip
d1010 1
a1010 1
	prefs->m_bshowoverhead=ini.GetBool("ShowOverhead",false);
@


1.16
log
@control panel improvements...
@
text
@d514 1
d833 2
@


1.15
log
@Saving web server settings
@
text
@d815 5
a819 5
	prefs->queuesize=ini.GetInt("QueueSize", 400); // SeeWen QUEUESIZE
	if(prefs->queuesize > 2000)
		prefs->queuesize = 2000;
	else if(prefs->queuesize < 200)
		prefs->queuesize = 200;
@


1.14
log
@Imroving continues...
@
text
@a491 6
	//Apfelteig Patch
	buffer.Format("%s",prefs->httppassword);	
	ini.WriteString("httpdpassword",buffer);	
	ini.WriteInt("httpport",prefs->httpport);
	ini.WriteBool("httpenabled",prefs->httpenabled);

d731 7
a805 5
	//Apfelteig patch
	sprintf(prefs->httppassword,"%s",ini.GetString("httpdpassword","mypass"));  
	prefs->httpport=ini.GetInt("httpport",4711);
	prefs->httpenabled=ini.GetBool("httpenabled",false);  

d1156 7
@


1.13
log
@Improving
@
text
@d81 2
a82 2
				prefs->totalDownloadedBytes=prefsImport20b->totalDownloadedBytes;
				prefs->totalUploadedBytes=prefsImport20b->totalUploadedBytes;
d95 2
a96 2
				prefs->totalDownloadedBytes=prefsImport20a->totalDownloaded;
				prefs->totalUploadedBytes=prefsImport20a->totalUploaded;
d220 5
a224 3
	if( GetMaxUpload() < 4 )
		return (( (GetMaxUpload() < 10) && (GetMaxUpload()*3 < m_nMaxDownload.Get()) )? GetMaxUpload()*3 : m_nMaxDownload.Get());
	return (( (GetMaxUpload() < 10) && (GetMaxUpload()*4 < m_nMaxDownload.Get()) )? GetMaxUpload()*4 : m_nMaxDownload.Get());
d507 2
a508 2
	ini.WriteWORD("Language",prefs->languageID);
	ini.WriteInt("SeeShare",prefs->m_iSeeShares);
d517 6
a522 6
	ini.WriteInt("StatGraphsInterval",prefs->trafficOMeterInterval);
	ini.WriteInt("StatsInterval",prefs->statsInterval);
	ini.WriteInt("StatsColumnWidth",prefs->statsColumnWidth);	// FoRcHa
	ini.WriteString("StatsListExpanded",prefs->statsListExpanded);
	ini.WriteInt("DownloadCapacity",prefs->maxGraphDownloadRate);
	ini.WriteInt("UploadCapacity",prefs->maxGraphUploadRate);
d557 1
a557 1
	ini.WriteBool("Splashscreen",prefs->splashscreen);
d559 4
a562 4
	ini.WriteBool("TransferDoubleClick",prefs->transferDoubleclick);
	ini.WriteBool("BeepOnError",prefs->beepOnError);
	ini.WriteBool("ConfirmExit",prefs->confirmExit);
	ini.WriteBool("FilterBadIPs",prefs->filerBadIP);
d564 1
a564 1
	ini.WriteBool("OnlineSignature",prefs->onlineSig);
d711 1
a711 1
	ini.WriteInt("ConnectionsGraphRatio",prefs->GraphRatio); // propstats Cax2
d732 1
a732 1
	buffer.Format("%I64Lu",prefs->totalDownloadedBytes);
d735 1
a735 1
	buffer.Format("%I64Lu",prefs->totalUploadedBytes);
d825 2
a826 2
	prefs->languageID=ini.GetWORD("Language",0);
	prefs->m_iSeeShares=ini.GetInt("SeeShare",0);
d833 6
a838 6
	prefs->trafficOMeterInterval=ini.GetInt("StatGraphsInterval",3);
	prefs->statsInterval=ini.GetInt("statsInterval",5);
	prefs->statsColumnWidth=ini.GetInt("StatsColumnWidth", 150);	// FoRcHa
	sprintf(prefs->statsListExpanded, "%s", ini.GetString("StatsListExpanded", "")); // missing entrys get expanded ("" = all expanded)
	prefs->maxGraphDownloadRate=ini.GetInt("DownloadCapacity",96);
	prefs->maxGraphUploadRate=ini.GetInt("UploadCapacity",16);
d883 3
a885 3
		if(prefs->maxGraphUploadRate != UNLIMITED && prefs->minupclientsallowed >=3) {
			if (prefs->minupclientsallowed > (uint32)ROUND((prefs->maxGraphUploadRate*1024)/prefs->uploadclientdatarate))
				prefs->minupclientsallowed = (uint32)ROUND((prefs->maxGraphUploadRate*1024)/prefs->uploadclientdatarate);
d943 1
a943 1
	prefs->splashscreen=ini.GetBool("Splashscreen",true);
d945 4
a948 4
	prefs->transferDoubleclick=ini.GetBool("TransferDoubleClick",true);
	prefs->beepOnError=ini.GetBool("BeepOnError",true);
	prefs->confirmExit=ini.GetBool("ConfirmExit",true);
	prefs->filerBadIP=ini.GetBool("FilterBadIPs",true);
d950 1
a950 1
	prefs->onlineSig=ini.GetBool("OnlineSignature",false);
d1127 1
a1127 1
	prefs->GraphRatio = ini.GetInt("ConnectionsGraphRatio",1); // propstats Cax2
d1146 1
a1146 1
	prefs->totalDownloadedBytes=_atoi64(buffer);
d1149 1
a1149 1
	prefs->totalUploadedBytes=_atoi64(buffer);
d1289 1
a1289 1
	switch(prefs->languageID) {
d1331 2
a1332 2
					prefs->languageID =  MAKELANGID(nLocalLang,SUBLANG_DEFAULT);
					SetThreadLocale(prefs->languageID);
d1334 1
a1334 1
					strLng1 = GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID);//Cax2 fix
d1338 2
a1339 2
					prefs->languageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
					SetThreadLocale(prefs->languageID);
d1348 1
a1348 1
				strQuestion = CString("\xbf") + GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
d1350 1
a1350 1
				strQuestion = GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
d1358 1
a1358 1
	SetThreadLocale(prefs->languageID);
d1361 3
a1363 3
	if (GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID).GetLength()==0) {
		prefs->languageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
		SetThreadLocale(prefs->languageID);
@


1.12
log
@Every variable now has its own lock
@
text
@d36 2
a37 2
	prefs = new Preferences_Struct;
	memset(prefs,0,sizeof(Preferences_Struct));
d77 3
a79 3
				memcpy(&prefs->incomingdir,&prefsImport20b->incomingdir,510);
				memcpy(&prefs->tempdir,&prefsImport20b->tempdir,510);
				sprintf(prefs->nick,prefsImport20b->nick);
d91 3
a93 3
				memcpy(&prefs->incomingdir,&prefsImport20a->incomingdir,510);
				memcpy(&prefs->tempdir,&prefsImport20a->tempdir,510);
				sprintf(prefs->nick,prefsImport20a->nick);
d109 3
a111 2
				memcpy(&prefs->incomingdir,&prefsImport19c->incomingdir,510);memcpy(&prefs->tempdir,&prefsImport19c->tempdir,510);
				sprintf(prefs->nick,prefsImport19c->nick);
a219 1
	CSingleLock PrefLock(&m_Pref_Mutex_MaxDownload,TRUE);
d221 2
a222 2
		return (( (GetMaxUpload() < 10) && (GetMaxUpload()*3 < prefs->maxdownload) )? GetMaxUpload()*3 : prefs->maxdownload);
	return (( (GetMaxUpload() < 10) && (GetMaxUpload()*4 < prefs->maxdownload) )? GetMaxUpload()*4 : prefs->maxdownload);
d478 1
a478 1
	buffer.Format("%s",prefs->nick);
d481 1
a481 1
	buffer.Format("%s",prefs->incomingdir);
d484 1
a484 1
	buffer.Format("%s",prefs->tempdir);
d487 1
a487 1
	buffer.Format("%s",prefs->vlcdir);
d496 7
a502 7
	ini.WriteInt("MaxUpload",prefs->maxupload);
	ini.WriteInt("MaxDownload",prefs->maxdownload);
	ini.WriteInt("MaxConnections",prefs->maxconnections);
	ini.WriteInt("DeadServerAction",prefs->deadserver);
	ini.WriteInt("Port",prefs->port);
	ini.WriteInt("UDPPort",prefs->udpport);
	ini.WriteInt("MaxSourcesPerFile",prefs->maxsourceperfile );
d538 2
a539 2
	ini.WriteBool("Reconnect",prefs->reconnect);
	ini.WriteBool("Scoresystem",prefs->scorsystem);
d551 4
a554 4
	ini.WriteBool("Serverlist",prefs->autoserverlist);
	ini.WriteBool("UpdateNotify",prefs->updatenotify);
	ini.WriteBool("MinimizeToTray",prefs->mintotray);
	ini.WriteBool("AddServersFromConnections",prefs->addServersFromConn);
d561 1
a561 1
	ini.WriteBool("Autoconnect",prefs->autoconnect);
d573 2
a574 2
    ini.WriteBool("AutoConnectStaticOnly", prefs->autoconnectstaticonly);  
    ini.WriteBool("AddNewFilesPaused", prefs->addnewfilespaused);  
d576 1
a576 1
    ini.WriteInt ("3DDepth", prefs->depth3D); 
d792 1
a792 1
	sprintf(prefs->nick,"%s",ini.GetString("Nick",strDefNick));
d795 1
a795 1
	sprintf(prefs->incomingdir,"%s",ini.GetString("IncomingDir",buffer));
d798 1
a798 1
	sprintf(prefs->tempdir,"%s",ini.GetString("TempDir",buffer));
d801 1
a801 1
	sprintf(prefs->vlcdir,"%s",ini.GetString("VLCDir",buffer));
d808 7
a814 7
	prefs->maxupload=ini.GetInt("MaxUpload",UNLIMITED);
	prefs->maxdownload=ini.GetInt("MaxDownload",UNLIMITED);
	prefs->maxconnections=ini.GetInt("MaxConnections",GetRecommendedMaxConnections());
	prefs->deadserver=ini.GetInt("DeadServerAction",2);
	prefs->port=ini.GetInt("Port",4662);
	prefs->udpport=ini.GetInt("UDPPort",prefs->port+10);
	prefs->maxsourceperfile=ini.GetInt("MaxSourcesPerFile",400);
d924 2
a925 2
	prefs->reconnect=ini.GetBool("Reconnect",true);
	prefs->scorsystem=ini.GetBool("Scoresystem",true);
d937 4
a940 4
	prefs->autoserverlist=ini.GetBool("Serverlist",false);
	prefs->updatenotify=ini.GetBool("UpdateNotify",true);
	prefs->mintotray=ini.GetBool("MinimizeToTray",true);
	prefs->addServersFromConn=ini.GetBool("AddServersFromConnections",true);
d947 1
a947 1
	prefs->autoconnect=ini.GetBool("Autoconnect",false);
d968 1
a968 1
	prefs->autoconnectstaticonly = ini.GetBool("AutoConnectStaticOnly",false); 
d970 1
a970 1
	prefs->addnewfilespaused = ini.GetBool("AddNewFilesPaused",false); 
d972 1
a972 1
	prefs->depth3D = ini.GetInt("3DDepth", 0);
d977 1
a977 1
			prefs->depth3D = 0;
d979 1
a979 1
			prefs->depth3D = 5;
@


1.11
log
@bugfixes & control panel updates
@
text
@d219 1
a219 1
	CSingleLock PrefLock(&m_Pref_Mutex,TRUE);
d757 1
a757 1
	CSingleLock PrefLock(&m_Pref_Mutex,TRUE);
d1171 1
a1171 1
	CSingleLock PrefLock(&m_Pref_Mutex,TRUE);
@


1.10
log
@Updates to Preferences (and enabling/disabling options in code because of that)
@
text
@d322 2
d348 3
d368 2
d394 3
d414 2
d440 3
d554 1
a554 2
	ini.WriteBool("AddServersFromServer",prefs->addserversfromserver);
	ini.WriteBool("AddServersFromClient",prefs->addserversfromclient);
a573 1
	ini.WriteBool("AutoTakeED2KLinks", prefs->autotakeed2klinks);  
d627 1
d632 1
d682 6
d844 3
a846 2
	if(prefs->MaxConperFive > 200) {
		prefs->MaxConperFive = 200;
d940 1
a940 2
	prefs->addserversfromserver=ini.GetBool("AddServersFromServer",true);
	prefs->addserversfromclient=ini.GetBool("AddServersFromClient",true);
d969 1
a969 1
	prefs->autotakeed2klinks = ini.GetBool("AutoTakeED2KLinks",true); 
d1043 1
d1050 1
d1095 6
@


1.9
log
@bugfix: column size & settings remembered, removed 'punishments'
@
text
@a524 1
	ini.WriteBool("ICH",prefs->ICH);
a530 1
	ini.WriteBool("ThrottleUpload", prefs->throttleupload);
a613 1
	ini.WriteBool("TransferFullChunks", prefs->TransferFullChunks);
a627 1
	ini.WriteBool("FullChunkTransfers", prefs->m_btransferfullchunks);
d691 1
a691 1
	ini.WriteInt("MlDonkeyBehavior",prefs->MlDonkeyBehavior);
d821 1
d823 2
a824 2
	if(prefs->MaxConperFive > 100) {
		prefs->MaxConperFive = 100;
a903 1
	prefs->ICH=ini.GetBool("ICH",true);
a909 1
	prefs->throttleupload = ini.GetBool("ThrottleUpload", false);
a987 1
	prefs->m_btransferfullchunks=ini.GetBool("FullChunkTransfers",true);
a1021 1
	prefs->TransferFullChunks = ini.GetBool("TransferFullChunks",true);
d1099 1
a1099 1
	prefs->MlDonkeyBehavior = (TMlDonkeyBehavior) ini.GetInt("MlDonkeyBehavior",eEmulateEDonkey);
@


1.8
log
@merge bugfixes
@
text
@a56 1
	
d633 1
a633 1
	ini.WriteBool("ShowOverhead", prefs->m_bshowoverhead);
d841 2
a842 1
	if(prefs->minupclientsallowed >= 6) {
d846 2
a847 1
	else if ((prefs->minupclientsallowed < 6) && (prefs->minupclientsallowed > 3)){
d852 1
d855 2
a856 1
	
d860 2
a861 1
	else {
d1041 1
a1041 9
	// Maverick
	prefs->proxy.EnablePassword = ini.GetBool("EnablePassword",false,"Proxy");
	prefs->proxy.UseProxy = ini.GetBool("EnableProxy",false,"Proxy");
	sprintf(buffer,"");
	sprintf(prefs->proxy.name,"%s",ini.GetString("Name",buffer,"Proxy"));
	sprintf(prefs->proxy.password,"%s",ini.GetString("Password",buffer,"Proxy"));
	sprintf(prefs->proxy.user,"%s",ini.GetString("User",buffer,"Proxy"));
	prefs->proxy.port = ini.GetInt("Port",1080,"Proxy");
	prefs->proxy.type = ini.GetInt("Type",PROXYTYPE_NOPROXY,"Proxy");
d1126 9
a1134 1

@


1.8.2.1
log
@merge fixes
@
text
@@


1.8.2.2
log
@merge cleanup!
@
text
@d57 1
@


1.8.2.3
log
@removed punishments & bugfixed load column positions
@
text
@d633 1
a633 1
	//ini.WriteBool("ShowOverhead", prefs->m_bshowoverhead);// we always show overhead in the tooltip
d841 1
a841 2
	if(prefs->minupclientsallowed > 6)
	{
d845 1
a845 2
	else if (prefs->minupclientsallowed > 3)
	{
a849 1
	{
d852 1
a852 2
	}

d856 1
a856 2
	else 
	{
d1036 9
a1044 1

d1129 1
a1129 9
	// Maverick
	prefs->proxy.EnablePassword = ini.GetBool("EnablePassword",false,"Proxy");
	prefs->proxy.UseProxy = ini.GetBool("EnableProxy",false,"Proxy");
	sprintf(buffer,"");
	sprintf(prefs->proxy.name,"%s",ini.GetString("Name",buffer,"Proxy"));
	sprintf(prefs->proxy.password,"%s",ini.GetString("Password",buffer,"Proxy"));
	sprintf(prefs->proxy.user,"%s",ini.GetString("User",buffer,"Proxy"));
	prefs->proxy.port = ini.GetInt("Port",1080,"Proxy");
	prefs->proxy.type = ini.GetInt("Type",PROXYTYPE_NOPROXY,"Proxy");
@


1.8.2.4
log
@updated control panes, and assorted bugfixes
@
text
@a321 2
	case tableIrc:
		return prefs->ircColumnWidths[index];
a345 3
	case tableIrc:
		prefs->ircColumnWidths[index] = width;
		break;
a362 2
	case tableIrc:
		return prefs->ircColumnHidden[index];
a386 3
	case tableIrc:
		prefs->ircColumnHidden[index] = bHidden;
		break;
a403 2
	case tableIrc:
		return prefs->ircColumnOrder[index];
a427 3
	case tableIrc:
		memcpy(prefs->ircColumnOrder, piOrder, sizeof(prefs->ircColumnOrder));
		break;
d525 1
d532 1
d541 2
a542 1
	ini.WriteBool("AddServersFromConnections",prefs->addServersFromConn);
d562 1
a620 1
	ini.WriteInt("FontSize",prefs->FontSize);
d631 1
a670 6
	ini.SerGet(false, prefs->ircColumnWidths,
		ELEMENT_COUNT(prefs->ircColumnWidths), "IrcColumnWidths");
	ini.SerGet(false, prefs->ircColumnHidden,
		ELEMENT_COUNT(prefs->ircColumnHidden), "IrcColumnHidden");
	ini.SerGet(false, prefs->ircColumnOrder,
		ELEMENT_COUNT(prefs->ircColumnOrder), "IrcColumnOrder");
d695 1
a695 1
	ini.WriteBool("MlDonkeyCM",prefs->MlDonkeyCM);
a824 1

d826 2
a827 3
	int nMax = (LOBYTE(GetWindowsVersion()) == 0x04)?100:200;
	if(prefs->MaxConperFive > nMax) {
		prefs->MaxConperFive = nMax;
d907 1
d914 1
d923 2
a924 1
	prefs->addServersFromConn=ini.GetBool("AddServersFromConnections",true);
d953 1
a953 1
	//prefs->autotakeed2klinks = ini.GetBool("AutoTakeED2KLinks",true);			//not needed/buggy
d993 1
a1034 1
	prefs->FontSize=ini.GetInt("FontSize",80);
a1078 6
	ini.SerGet(true, prefs->ircColumnWidths,
		ELEMENT_COUNT(prefs->ircColumnWidths), "IrcColumnWidths");
	ini.SerGet(true, prefs->ircColumnHidden,
		ELEMENT_COUNT(prefs->ircColumnHidden), "IrcColumnHidden");
	ini.SerGet(true, prefs->ircColumnOrder,
		ELEMENT_COUNT(prefs->ircColumnOrder), "IrcColumnOrder");
d1106 1
a1106 1
	prefs->MlDonkeyCM = ini.GetBool("MlDonkeyCM",true);
@


1.7
log
@3D Depth selection for progress bar from 25b
@
text
@d633 1
a633 1
	ini.WriteBool("StartNextFile", prefs->m_bstartnextfile);
a989 1
	prefs->m_bstartnextfile=ini.GetBool("StartNextFile",false);
@


1.6
log
@Fixed to compile properly in CJK environment.
@
text
@a550 1
	ini.WriteBool("FlatStatusBar",prefs->flatbar);
a742 3
	char* fullpath = new char[strlen(appdir)+MAX_PATH]; // i_a
	sprintf(fullpath,"%spreferences.ini",appdir);

a769 1

a927 1
	prefs->flatbar = ini.GetBool("FlatStatusBar",false);
@


1.5
log
@updated to .25b codebase
@
text
@d1327 1
a1327 1
				strQuestion = CString("") + GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
@


1.4
log
@*** empty log message ***
@
text
@d201 1
a201 1
	CreateUserHash();
d580 1
d826 1
a826 1
	prefs->deadserverretries=ini.GetInt("DeadServerRetries",3);
d928 1
a928 1
	prefs->transferDoubleclick=ini.GetBool("TransferDoubleClick",false);
d1138 1
a1138 78
	switch(prefs->languageID) {
		// read from ini and supported by the program?
		case MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "english");break;
		case MAKELANGID(LANG_GERMAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "german");break;
		case MAKELANGID(LANG_FRENCH,SUBLANG_DEFAULT):setlocale( LC_ALL, "french");break;
		case MAKELANGID(LANG_DANISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "danish");break;
		case MAKELANGID(LANG_SPANISH,SUBLANG_SPANISH):setlocale( LC_ALL, "spanish");break;
		case MAKELANGID(LANG_DUTCH,SUBLANG_DEFAULT):setlocale( LC_ALL, "dutch");break;
		case MAKELANGID(LANG_RUSSIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "russian");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_SIMPLIFIED):setlocale( LC_ALL, "chs");break;
		case MAKELANGID(LANG_CHINESE,SUBLANG_CHINESE_TRADITIONAL):setlocale( LC_ALL, "cht");break;
		case MAKELANGID(LANG_KOREAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "korean");break;
		case MAKELANGID(LANG_POLISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "polish");break;
		case MAKELANGID(LANG_PORTUGUESE,SUBLANG_PORTUGUESE_BRAZILIAN):setlocale( LC_ALL, "ptb");break;
		case MAKELANGID(LANG_FINNISH,SUBLANG_DEFAULT):setlocale( LC_ALL, "finnish");break;
		case MAKELANGID(LANG_ITALIAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "italian");break;
		case MAKELANGID(LANG_CATALAN,SUBLANG_DEFAULT):setlocale( LC_ALL, "esp");break;
		case MAKELANGID(LANG_GREEK,SUBLANG_DEFAULT):setlocale( LC_ALL, "greek");break;
		case MAKELANGID(LANG_HEBREW,SUBLANG_DEFAULT):setlocale( LC_ALL, "hebrew");break;
		default:{
			uint8 nLocalLang = ::GetThreadLocale();
			
            CString strLng1 = GetResString(IDS_MB_LANGUAGEINFO,MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT));
			CString strLng2 = "";
			switch(nLocalLang) {
				case	LANG_ENGLISH:
				case	LANG_GREEK:
				case 	LANG_GERMAN:
				case 	LANG_FRENCH:
				case 	LANG_DANISH:
				case 	LANG_SPANISH:
				case 	LANG_DUTCH:
				case 	LANG_RUSSIAN:
				case 	LANG_CHINESE:
				case 	LANG_KOREAN:
				case 	LANG_POLISH:
				case 	LANG_PORTUGUESE:
				case	LANG_FINNISH:
				case	LANG_ITALIAN:
				case	LANG_CATALAN:
				case	LANG_HEBREW:
				{
					prefs->languageID =  MAKELANGID(nLocalLang,SUBLANG_DEFAULT);
					SetThreadLocale(prefs->languageID);
					//strLng2 = GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID);
					strLng1 = GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID);//Cax2 fix
					break;
				}
				default:
					prefs->languageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
					SetThreadLocale(prefs->languageID);
			}

			CString strMessage = strLng1 + CString("\n\n") + strLng2;;
			MessageBox(0, strMessage.GetBuffer(),"Language",64);
			
			// DonGato
			CString strQuestion;
			if (nLocalLang == LANG_SPANISH)
//				strQuestion = CString("") + GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
			    strQuestion = CString("\xbf") + GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
			else
				strQuestion = GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
			
			if (IDNO==MessageBox(0, strQuestion.GetBuffer(),"eMule Plus",MB_YESNO))
				return;
			else
				prefs->m_multiple = 1;
		}
	}
	SetThreadLocale(prefs->languageID);

	// if loading a string fails, set language to English
	if (GetResString(IDS_MB_LANGUAGEINFO,prefs->languageID).GetLength()==0) {
		prefs->languageID = MAKELANGID(LANG_ENGLISH,SUBLANG_DEFAULT);
		SetThreadLocale(prefs->languageID);
	}

d1267 78
@


1.3
log
@final port to .25b!
@
text
@d1196 2
a1197 1
				strQuestion = CString("") + GetResString(IDS_MULTIPLE,prefs->languageID) + CString("?");
@


1.2
log
@*** empty log message ***
@
text
@d163 3
a165 3
	::CreateDirectory(GetIncomingDir(),0);
	::CreateDirectory(GetTempDir(),0);
	::CreateDirectory(GetVlcDir(),0);
d461 3
d500 1
d562 7
d628 8
d673 14
a745 1
	CIni ini( fullpath, "eMule" );
d747 26
a772 1
	delete[] fullpath;
d810 1
d951 16
d990 9
d1090 13
d1245 94
@


1.1
log
@*** empty log message ***
@
text
@d159 4
d672 9
d959 10
@

