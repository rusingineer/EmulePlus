head	1.7;
access;
symbols
	PublicRelease_1_2e:1.6
	Interim_Release_1-2e_RC1:1.6
	PublicRelease_1_2d:1.6
	Interim_Release_1-2d_RC1:1.5
	Interim_Release_1-2d_beta1:1.5
	PublicRelease_1_2c:1.4
	Interim_Release_1-2c_RC1:1.4
	Interim_Release_1-2c_beta1:1.3
	PublicRelease_1_2b:1.3
	Interim_Release_1-2b_RC1:1.3
	PublicRelease_1_2a:1.3
	Interim_Release_1-2a_RC1:1.3
	Interim_Release_1-2a_beta2:1.3
	Interim_Release_1-2a_beta1:1.3
	PublicRelease_1_2:1.3
	Interim_Release_1-2_RC1:1.3
	Interim_Release_1-2_beta1:1.3
	PublicRelease_1_1g:1.3
	Interim_Release_1-1g_RC3:1.3
	Interim_Release_1-1g_RC2:1.3
	Interim_Release_1-1g_RC1:1.3
	Interim_Release_1-1g_beta2:1.2
	Interim_Release_1-1g_beta1:1.2
	PublicRelease_1_1f:1.2
	Interim_Release_1-1f_RC1:1.2
	PublicRelease_1_1e:1.2
	Interim_Release_1-1e_RC2:1.2
	Interim_Release_1-1e_RC1:1.2
	Interim_Release_1-1e_beta1:1.2
	PublicRelease_1_1d:1.2
	Interim_Release_1-1d_RC1:1.2
	PublicRelease_1_1c:1.2
	Interim_Release_1-1c_RC1:1.2
	Interim_Release_1-1c_beta2:1.2
	Interim_Release_1-1c_beta1:1.2
	PublicRelease_1_1b:1.2
	Interim_Release_1-1b_RC1:1.2
	PublicRelease_1_1a:1.2
	Interim_Release_1-1a_RC2:1.2
	Interim_Release_1-1a_RC1:1.2
	Interim_Release_1-1a_beta2:1.2
	Interim_Release_1-1a_beta1:1.2
	PublicRelease_1_1:1.2
	Interim_Release_1-1_beta1:1.2
	PublicRelease_1o:1.2
	Interim_Release_1o_RC1:1.2
	Interim_Release_1o_beta1:1.2
	PublicRelease_1n:1.2
	Interim_Release_1n_RC2:1.2
	Interim_Release_1n_RC1:1.2
	Interim_Release_1n_beta2:1.2
	Interim_Release_1n_beta1:1.2
	PublicRelease_1m:1.2
	Interim_Release_1m_beta1:1.2
	PublicRelease_1l:1.1
	Interim_Release_1l_RC3:1.1
	Interim_Release_1l_RC2:1.1
	Interim_Release_1l_RC1:1.1
	Interim_Release_1l_beta2:1.1
	Interim_Release_1l_beta1:1.1;
locks; strict;
comment	@// @;


1.7
date	2009.05.14.03.11.58;	author aw3;	state Exp;
branches;
next	1.6;

1.6
date	2008.04.30.05.06.04;	author aw3;	state Exp;
branches;
next	1.5;

1.5
date	2007.12.30.06.07.27;	author aw3;	state Exp;
branches;
next	1.4;

1.4
date	2007.04.02.23.14.14;	author kush_eplus;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.27.20.31.05;	author eklmn;	state Exp;
branches;
next	1.2;

1.2
date	2004.06.19.05.34.24;	author aw3;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.25.02.33.04;	author dongato;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Unified list column definitions.
@
text
@//	This file is part of eMule Plus
//
//	This program is free software; you can redistribute it and/or
//	modify it under the terms of the GNU General Public License
//	as published by the Free Software Foundation; either
//	version 2 of the License, or (at your option) any later version.
//
//	This program is distributed in the hope that it will be useful,
//	but WITHOUT ANY WARRANTY; without even the implied warranty of
//	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//	GNU General Public License for more details.
//
//	You should have received a copy of the GNU General Public License
//	along with this program; if not, write to the Free Software
//	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include "stdafx.h"
#include "emule.h"
#include "PPgPartTraffic.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

IMPLEMENT_DYNAMIC(CPPgPartTraffic, CPropertyPage)

CPPgPartTraffic::CPPgPartTraffic()
	: CPropertyPage(CPPgPartTraffic::IDD)
	, m_iUploadBarStyle(0)
	, m_iUploadBarColor(0)
	, m_bDisplayPartTraffic(FALSE)
{
}

CPPgPartTraffic::~CPPgPartTraffic()
{
}

void CPPgPartTraffic::DoDataExchange(CDataExchange* pDX)
{
	CPropertyPage::DoDataExchange(pDX);
	DDX_Radio(pDX, IDC_UPBARST1, m_iUploadBarStyle);
	DDX_Radio(pDX, IDC_UPBARCL1, m_iUploadBarColor);
	DDX_Check(pDX, IDC_PT_USEIT, m_bDisplayPartTraffic);
}

BEGIN_MESSAGE_MAP(CPPgPartTraffic, CPropertyPage)
	ON_BN_CLICKED(IDC_UPBARST1, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARST2, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARST3, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARST4, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARCL1, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARCL2, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARCL3, OnSettingsChange)
	ON_BN_CLICKED(IDC_UPBARCL4, OnSettingsChange)
	ON_BN_CLICKED(IDC_PT_USEIT, OnBnClickedPtUseit)
END_MESSAGE_MAP()

BOOL CPPgPartTraffic::OnInitDialog()
{
	CPropertyPage::OnInitDialog();

	LoadSettings();
	Localize();

	return TRUE;
}

void CPPgPartTraffic::LoadSettings(void)
{
	if(::IsWindow(m_hWnd))
	{
		m_bDisplayPartTraffic = m_pPrefs->DoUsePT();

		m_iUploadBarStyle = m_pPrefs->GetUpbarStyle();
		m_iUploadBarColor = m_pPrefs->GetUpbarColor();

		UpdateData(FALSE);

		OnBnClickedPtUseit();

		SetModified(FALSE);
	}
}

BOOL CPPgPartTraffic::OnApply()
{
	if(m_bModified)
	{
		UpdateData(TRUE);

		if (!m_bDisplayPartTraffic == m_pPrefs->DoUsePT())
		{
			m_pPrefs->SetUsePT(B2b(m_bDisplayPartTraffic));
			if(m_pPrefs->DoUsePT())
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.ShowColumn(SFLCOL_PARTTRAFFIC);
			else
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.HideColumn(SFLCOL_PARTTRAFFIC);
		}

		m_pPrefs->SetUpbarStyle(static_cast<byte>(m_iUploadBarStyle));
		m_pPrefs->SetUpbarColor(static_cast<byte>(m_iUploadBarColor));
		
		g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.SetDisplay(m_pPrefs->GetUpbarStyle(), true);
		g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.SetColoring(m_pPrefs->GetUpbarColor());

		SetModified(FALSE);
	}
	return CPropertyPage::OnApply();
}

void CPPgPartTraffic::Localize(void)
{	
	static const uint16 s_auResTbl[][2] =
	{
		{ IDC_PT_USEIT, IDS_PT_USEIT },
		{ IDC_UPBARST, IDS_UPBARST },
		{ IDC_UPBARST1, IDS_UPBARST1 },
		{ IDC_UPBARST2, IDS_UPBARST2 },
		{ IDC_UPBARST3, IDS_UPBARST3 },
		{ IDC_UPBARCL, IDS_UPBARCL },
		{ IDC_UPBARCL1, IDS_UPBARCL1 },
		{ IDC_UPBARCL2, IDS_UPBARCL2 },
		{ IDC_UPBARCL3, IDS_UPBARCL3 },
		{ IDC_UPBARCL4, IDS_UPBARCL4 }
	};

	if (::IsWindow(m_hWnd))
	{
		CString	strRes;

		for (uint32 i = 0; i < ARRSIZE(s_auResTbl); i++)
		{
			::GetResString(&strRes, static_cast<UINT>(s_auResTbl[i][1]));
			SetDlgItemText(s_auResTbl[i][0], strRes);
		}
	}
}

void CPPgPartTraffic::OnBnClickedPtUseit()
{
	UpdateData(TRUE);

	GetDlgItem(IDC_UPBARST1)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARST2)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARST3)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARST4)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARCL1)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARCL2)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARCL3)->EnableWindow(m_bDisplayPartTraffic);
	GetDlgItem(IDC_UPBARCL4)->EnableWindow(m_bDisplayPartTraffic);

	SetModified();
}
@


1.6
log
@Removed unrequired GUI update and data reloading on Apply.
@
text
@d98 1
a98 1
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.ShowColumn(SFL_COLUMN_PARTTRAFFIC);
d100 1
a100 1
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.HideColumn(SFL_COLUMN_PARTTRAFFIC);
@


1.5
log
@Optimized dialog regarding required memory and speed;
Suppressed compiler warnings; Formatting.
@
text
@a105 2
		OnBnClickedPtUseit();
		
a108 1
		LoadSettings();
@


1.4
log
@Removed unneeded CString initializations.
@
text
@d1 1
a1 1
// PPgPartTraffic.cpp : implementation file
d3 13
a26 3

// CPPgPartTraffic dialog

d31 3
a33 3
	, uploadBarStyle(0)
	, uploadBarColor(0)
	, displayPartTraffic(FALSE)
d44 3
a46 14
	DDX_Radio(pDX, IDC_UPBARST1, uploadBarStyle);
	DDX_Radio(pDX, IDC_UPBARCL1, uploadBarColor);
	DDX_Check(pDX, IDC_PT_USEIT, displayPartTraffic);
	DDX_Control(pDX, IDC_PT_USEIT, displayPartTrafficCheck);
	DDX_Control(pDX, IDC_UPBARST1, upBarSt1Radio);
	DDX_Control(pDX, IDC_UPBARST2, upBarSt2Radio);
	DDX_Control(pDX, IDC_UPBARST3, upBarSt3Radio);	
	DDX_Control(pDX, IDC_UPBARST4, upBarSt4Radio);
	DDX_Control(pDX, IDC_UPBARCL1, upBarCl1Radio);
	DDX_Control(pDX, IDC_UPBARCL2, upBarCl2Radio);
	DDX_Control(pDX, IDC_UPBARCL3, upBarCl3Radio);
	DDX_Control(pDX, IDC_UPBARCL4, upBarCl4Radio);
	DDX_Text(pDX, IDC_UPBARST, upBarStDesc);
	DDX_Text(pDX, IDC_UPBARCL, upBarClDesc);
d50 8
a57 8
	ON_BN_CLICKED(IDC_UPBARST1, OnBnClickedUpbarst1)
	ON_BN_CLICKED(IDC_UPBARST2, OnBnClickedUpbarst2)
	ON_BN_CLICKED(IDC_UPBARST3, OnBnClickedUpbarst3)
	ON_BN_CLICKED(IDC_UPBARST4, OnBnClickedUpbarst4)
	ON_BN_CLICKED(IDC_UPBARCL1, OnBnClickedUpbarcl1)
	ON_BN_CLICKED(IDC_UPBARCL2, OnBnClickedUpbarcl2)
	ON_BN_CLICKED(IDC_UPBARCL3, OnBnClickedUpbarcl3)
	ON_BN_CLICKED(IDC_UPBARCL4, OnBnClickedUpbarcl4)
d75 1
a75 1
		displayPartTraffic = m_pPrefs->DoUsePT();
d77 2
a78 2
		uploadBarStyle = m_pPrefs->GetUpbarStyle();
		uploadBarColor = m_pPrefs->GetUpbarColor();
d94 1
a94 1
		if(!displayPartTraffic==m_pPrefs->DoUsePT())
d96 1
a96 1
			m_pPrefs->SetUsePT(displayPartTraffic);
d98 1
a98 1
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.ShowColumn(9);
d100 1
a100 1
				g_App.m_pMDlg->m_wndSharedFiles.m_ctlSharedFilesList.HideColumn(9);
d103 2
a104 2
		m_pPrefs->SetUpbarStyle(uploadBarStyle);
		m_pPrefs->SetUpbarColor(uploadBarColor);
d119 15
a133 1
	if(::IsWindow(m_hWnd))
d135 1
a135 10
		displayPartTrafficCheck.SetWindowText(GetResString(IDS_PT_USEIT));
		GetResString(&upBarStDesc, IDS_UPBARST);
		upBarSt1Radio.SetWindowText(GetResString(IDS_UPBARST1));
		upBarSt2Radio.SetWindowText(GetResString(IDS_UPBARST2));
		upBarSt3Radio.SetWindowText(GetResString(IDS_UPBARST3));		
		GetResString(&upBarClDesc, IDS_UPBARCL);
		upBarCl1Radio.SetWindowText(GetResString(IDS_UPBARCL1));
		upBarCl2Radio.SetWindowText(GetResString(IDS_UPBARCL2));
		upBarCl3Radio.SetWindowText(GetResString(IDS_UPBARCL3));
		upBarCl4Radio.SetWindowText(GetResString(IDS_UPBARCL4));
d137 5
a141 1
		UpdateData(FALSE);
d149 8
a156 8
	upBarSt1Radio.EnableWindow(displayPartTraffic);
	upBarSt2Radio.EnableWindow(displayPartTraffic);
	upBarSt3Radio.EnableWindow(displayPartTraffic);
	upBarSt4Radio.EnableWindow(displayPartTraffic);
	upBarCl1Radio.EnableWindow(displayPartTraffic);
	upBarCl2Radio.EnableWindow(displayPartTraffic);
	upBarCl3Radio.EnableWindow(displayPartTraffic);
	upBarCl4Radio.EnableWindow(displayPartTraffic);
@


1.3
log
@renamed 3 variables
@
text
@a23 2
	, upBarStDesc(_T(""))
	, upBarClDesc(_T(""))
@


1.2
log
@Improved preferences localization.
@
text
@d101 1
a101 1
				g_eMuleApp.m_pdlgEmule->m_wndSharedFiles.m_ctlSharedFilesList.ShowColumn(9);
d103 1
a103 1
				g_eMuleApp.m_pdlgEmule->m_wndSharedFiles.m_ctlSharedFilesList.HideColumn(9);
d111 2
a112 2
		g_eMuleApp.m_pdlgEmule->m_wndSharedFiles.m_ctlSharedFilesList.SetDisplay(m_pPrefs->GetUpbarStyle(), true);
		g_eMuleApp.m_pdlgEmule->m_wndSharedFiles.m_ctlSharedFilesList.SetColoring(m_pPrefs->GetUpbarColor());
@


1.1
log
@Preferences reorganization
@
text
@d125 1
a125 1
		upBarStDesc = GetResString(IDS_UPBARST);
d129 1
a129 1
		upBarClDesc = GetResString(IDS_UPBARCL);
@

