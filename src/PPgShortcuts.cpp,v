head	1.42;
access;
symbols
	PublicRelease_1_2e:1.42
	Interim_Release_1-2e_RC1:1.42
	PublicRelease_1_2d:1.42
	Interim_Release_1-2d_RC1:1.42
	Interim_Release_1-2d_beta1:1.42
	PublicRelease_1_2c:1.39
	Interim_Release_1-2c_RC1:1.39
	Interim_Release_1-2c_beta1:1.39
	PublicRelease_1_2b:1.39
	Interim_Release_1-2b_RC1:1.38
	PublicRelease_1_2a:1.38
	Interim_Release_1-2a_RC1:1.38
	Interim_Release_1-2a_beta2:1.37
	Interim_Release_1-2a_beta1:1.37
	PublicRelease_1_2:1.35
	Interim_Release_1-2_RC1:1.35
	Interim_Release_1-2_beta1:1.35
	PublicRelease_1_1g:1.34
	Interim_Release_1-1g_RC3:1.34
	Interim_Release_1-1g_RC2:1.34
	Interim_Release_1-1g_RC1:1.34
	Interim_Release_1-1g_beta2:1.33
	Interim_Release_1-1g_beta1:1.32
	PublicRelease_1_1f:1.21
	Interim_Release_1-1f_RC1:1.21
	PublicRelease_1_1e:1.21
	Interim_Release_1-1e_RC2:1.21
	Interim_Release_1-1e_RC1:1.21
	Interim_Release_1-1e_beta1:1.17
	PublicRelease_1_1d:1.17
	Interim_Release_1-1d_RC1:1.17
	PublicRelease_1_1c:1.17
	Interim_Release_1-1c_RC1:1.17
	Interim_Release_1-1c_beta2:1.17
	Interim_Release_1-1c_beta1:1.17
	PublicRelease_1_1b:1.16
	Interim_Release_1-1b_RC1:1.16
	PublicRelease_1_1a:1.16
	Interim_Release_1-1a_RC2:1.16
	Interim_Release_1-1a_RC1:1.16
	Interim_Release_1-1a_beta2:1.16
	Interim_Release_1-1a_beta1:1.16
	PublicRelease_1_1:1.16
	Interim_Release_1-1_beta1:1.16
	PublicRelease_1o:1.15
	Interim_Release_1o_RC1:1.15
	Interim_Release_1o_beta1:1.15
	PublicRelease_1n:1.15
	Interim_Release_1n_RC2:1.15
	Interim_Release_1n_RC1:1.15
	Interim_Release_1n_beta2:1.15
	Interim_Release_1n_beta1:1.13
	PublicRelease_1m:1.13
	Interim_Release_1m_beta1:1.13
	PublicRelease_1l:1.13
	Interim_Release_1l_RC3:1.13
	Interim_Release_1l_RC2:1.13
	Interim_Release_1l_RC1:1.13
	Interim_Release_1l_beta2:1.13
	Interim_Release_1l_beta1:1.13
	PublicRelease_1k:1.8
	Interim_Release_1k_RC4:1.8
	Interim_1k_RC3:1.8
	Interim_1k_RC2:1.8
	Interim_Release_1k_RC1:1.8
	Interim_Release_1k_beta5:1.8
	Intrerim_Release_1k_beta4:1.8
	Interim_Release_1k_beta1:1.8
	PublicRelease_1j:1.6
	Interim_Release_1J_RC3:1.6
	Interim_Release_1j_RC3:1.6
	Interim_Release_1j_RC2:1.5
	Interim_Release_1j_RC1:1.4
	Interim_Release_1j_beta2:1.4
	Interim_Release_1j_beta1:1.4
	PublicRelease_1i:1.4
	Interim_Release_1i_RC6:1.4
	Interim_Release_1i_RC3:1.3
	Interim_Release_1i_RC2:1.3
	Interim_Release_1i_RC1:1.1
	Interim_Release_1i_beta3:1.1;
locks; strict;
comment	@// @;


1.42
date	2008.02.20.05.09.52;	author aw3;	state Exp;
branches;
next	1.41;

1.41
date	2007.12.29.05.52.07;	author aw3;	state Exp;
branches;
next	1.40;

1.40
date	2007.10.31.18.18.56;	author fuxie-dk;	state Exp;
branches;
next	1.39;

1.39
date	2007.01.24.14.32.23;	author aw3;	state Exp;
branches;
next	1.38;

1.38
date	2006.09.18.13.23.11;	author aw3;	state Exp;
branches;
next	1.37;

1.37
date	2006.03.19.18.54.24;	author aw3;	state Exp;
branches;
next	1.36;

1.36
date	2006.03.18.04.44.41;	author aw3;	state Exp;
branches;
next	1.35;

1.35
date	2006.01.06.20.05.54;	author kush_eplus;	state Exp;
branches;
next	1.34;

1.34
date	2005.11.27.20.31.05;	author eklmn;	state Exp;
branches;
next	1.33;

1.33
date	2005.11.18.05.39.22;	author aw3;	state Exp;
branches;
next	1.32;

1.32
date	2005.08.22.01.35.41;	author aw3;	state Exp;
branches;
next	1.31;

1.31
date	2005.08.21.17.56.47;	author aw3;	state Exp;
branches;
next	1.30;

1.30
date	2005.08.21.03.09.52;	author aw3;	state Exp;
branches;
next	1.29;

1.29
date	2005.08.20.18.55.15;	author aw3;	state Exp;
branches;
next	1.28;

1.28
date	2005.08.20.04.37.42;	author aw3;	state Exp;
branches;
next	1.27;

1.27
date	2005.08.19.11.37.11;	author aw3;	state Exp;
branches;
next	1.26;

1.26
date	2005.08.15.02.27.56;	author aw3;	state Exp;
branches;
next	1.25;

1.25
date	2005.08.14.19.03.05;	author aw3;	state Exp;
branches;
next	1.24;

1.24
date	2005.08.14.03.12.38;	author aw3;	state Exp;
branches;
next	1.23;

1.23
date	2005.08.12.03.41.20;	author aw3;	state Exp;
branches;
next	1.22;

1.22
date	2005.08.11.03.47.23;	author aw3;	state Exp;
branches;
next	1.21;

1.21
date	2005.06.12.04.47.08;	author aw3;	state Exp;
branches;
next	1.20;

1.20
date	2005.06.11.14.38.37;	author aw3;	state Exp;
branches;
next	1.19;

1.19
date	2005.06.08.05.02.59;	author aw3;	state Exp;
branches;
next	1.18;

1.18
date	2005.06.07.03.33.53;	author aw3;	state Exp;
branches;
next	1.17;

1.17
date	2005.01.19.21.10.47;	author netwolf1;	state Exp;
branches;
next	1.16;

1.16
date	2004.10.01.17.16.23;	author aw3;	state Exp;
branches;
next	1.15;

1.15
date	2004.08.04.04.17.05;	author aw3;	state Exp;
branches;
next	1.14;

1.14
date	2004.07.29.18.00.50;	author aw3;	state Exp;
branches;
next	1.13;

1.13
date	2004.05.02.03.17.52;	author aw3;	state Exp;
branches;
next	1.12;

1.12
date	2004.04.29.14.10.31;	author netwolf1;	state Exp;
branches;
next	1.11;

1.11
date	2004.04.29.11.59.45;	author netwolf1;	state Exp;
branches;
next	1.10;

1.10
date	2004.04.27.02.03.24;	author aw3;	state Exp;
branches;
next	1.9;

1.9
date	2004.04.12.18.59.01;	author dongato;	state Exp;
branches;
next	1.8;

1.8
date	2004.02.02.11.43.13;	author netwolf1;	state Exp;
branches;
next	1.7;

1.7
date	2004.02.01.16.33.45;	author netwolf1;	state Exp;
branches;
next	1.6;

1.6
date	2004.01.17.14.46.18;	author dongato;	state Exp;
branches;
next	1.5;

1.5
date	2004.01.11.14.13.09;	author dongato;	state Exp;
branches;
next	1.4;

1.4
date	2003.11.30.17.52.44;	author eklmn;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.12.15.59.03;	author dropf;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.11.21.36.56;	author dropf;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.29.22.13.36;	author dropf;	state Exp;
branches;
next	;


desc
@@


1.42
log
@Optimized dialog regarding required memory and speed;
Removed old not used localization; Suppressed compiler warnings; Formatting.
@
text
@//	This file is part of eMule Plus
//
//	This program is free software; you can redistribute it and/or
//	modify it under the terms of the GNU General Public License
//	as published by the Free Software Foundation; either
//	version 2 of the License, or (at your option) any later version.
//
//	This program is distributed in the hope that it will be useful,
//	but WITHOUT ANY WARRANTY; without even the implied warranty of
//	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//	GNU General Public License for more details.
//
//	You should have received a copy of the GNU General Public License
//	along with this program; if not, write to the Free Software
//	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include "stdafx.h"
#include "emule.h"
#include "PPgShortcuts.h"

IMPLEMENT_DYNAMIC(CPPgShortcuts, CPropertyPage)
CPPgShortcuts::CPPgShortcuts()
	: CPropertyPage(CPPgShortcuts::IDD)
	, m_bShortcutsEnable(FALSE)
	, m_bShortcutsAlt(FALSE)
	, m_bShortcutsCtrl(FALSE)
	, m_bShortcutsShift(FALSE)
	, m_bShortcutsWin(FALSE)
{
}

CPPgShortcuts::~CPPgShortcuts()
{
}

void CPPgShortcuts::DoDataExchange(CDataExchange* pDX)
{
	CPropertyPage::DoDataExchange(pDX);
	DDX_Control(pDX, IDC_SHORTCUTS_TREE, m_ShortcutsTree);
	DDX_Check(pDX, IDC_SHORTCUTS_ENABLE, m_bShortcutsEnable);
	DDX_Check(pDX, IDC_SHORTCUTS_ALT, m_bShortcutsAlt);
	DDX_Check(pDX, IDC_SHORTCUTS_CTRL, m_bShortcutsCtrl);
	DDX_Check(pDX, IDC_SHORTCUTS_SHIFT, m_bShortcutsShift);
	DDX_Check(pDX, IDC_SHORTCUTS_WIN, m_bShortcutsWin);
	DDX_Control(pDX, IDC_SHORTCUTS_COMBO, m_ShortcutsKeyCombo);
}

BEGIN_MESSAGE_MAP(CPPgShortcuts, CPropertyPage)
	ON_BN_CLICKED(IDC_SHORTCUTS_ENABLE, OnEnableShortcutClick)
	ON_BN_CLICKED(IDC_SHORTCUTS_ALT, OnSettingsChange)
	ON_BN_CLICKED(IDC_SHORTCUTS_CTRL, OnSettingsChange)
	ON_BN_CLICKED(IDC_SHORTCUTS_SHIFT, OnSettingsChange)
	ON_BN_CLICKED(IDC_SHORTCUTS_WIN, OnSettingsChange)
	ON_CBN_SELCHANGE(IDC_SHORTCUTS_COMBO, OnSettingsChange)
	ON_NOTIFY(TVN_SELCHANGING, IDC_SHORTCUTS_TREE, OnTvnSelchangingShortcutsTree)
	ON_WM_DESTROY()
END_MESSAGE_MAP()


BOOL CPPgShortcuts::OnInitDialog()
{
	CPropertyPage::OnInitDialog();

	CreateShortcutsTree();	// WARNING : shortcuts tree
	RefreshKeyCombo();		//           and key combo must have been created
	LoadSettings();			//           before calling LoadSettings function!
	Localize();

	return TRUE;
}

void CPPgShortcuts::OnDestroy()
{
//	Free resources on close not to keep them until next creation of this page
	m_ImagelistShortcutsTree.DeleteImageList();
	m_ShortcutsTree.DeleteAllItems();

	CPropertyPage::OnDestroy();
}

BOOL CPPgShortcuts::OnApply()
{
	for (int i = 0; i < SCUT_COUNT; i++)
		m_pPrefs->SetShortcutCode(m_ShortcutTreeItem[i].Shortcut.GetCode(), i);

	RefreshShortcutsTree();

	return CPropertyPage::OnApply();
}

void CPPgShortcuts::OnSettingsChange(void)
{
	SetModified();
	SaveShortcut(m_ShortcutsTree.GetSelectedItem());
}

void CPPgShortcuts::OnEnableShortcutClick(void)
{
	OnSettingsChange();
	UpdateCheckBoxesState();
}

void CPPgShortcuts::CreateShortcutsTree(void)
{
	static const uint16 s_auIconResID[] =
	{
	//	Generic icon
		IDI_TVI_GENERIC,	// 0 - items
	//	Main category icons
		IDI_TRAYICON,		// 1 - General
		IDI_DIRECTDOWNLOAD,	// 2 - Download list
		IDI_USERS,			// 3 - Sources
		IDI_PREF_FILES,		// 4 - Share list
	//	Sub-category icons
		IDI_PREF_WINDOW,	// 5 - General > Show window
		IDI_PREF_ADVANCED,	// 6 - General > Adanved
		IDI_GLOBAL,			// 7 - UL & Share > ED2K Links
		IDI_PREF_FOLDERS	// 8 - General Files/Folders
	};

	m_ImagelistShortcutsTree.Create(16, 16, g_App.m_iDfltImageListColorFlags | ILC_MASK, ARRSIZE(s_auIconResID), 0);
	FillImgLstWith16x16Icons(&m_ImagelistShortcutsTree, s_auIconResID, ARRSIZE(s_auIconResID));
	m_ShortcutsTree.SetImageList(&m_ImagelistShortcutsTree, TVSIL_NORMAL);

	m_ahTree[SCUT_NODE_GEN] = m_ShortcutsTree.InsertItem(_T(""), 1, 1);
	m_ahTree[SCUT_NODE_DL] = m_ShortcutsTree.InsertItem(_T(""), 2, 2);
	m_ahTree[SCUT_NODE_SRC] = m_ShortcutsTree.InsertItem(_T(""), 3, 3);
	m_ahTree[SCUT_NODE_SHARED] = m_ShortcutsTree.InsertItem(_T(""), 4, 4);
	m_ShortcutTreeItem[SCUT_WIN_MINIMIZE].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_WIN_SWITCH].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN]);
	m_ahTree[SCUT_NODE_GEN_WIN] = m_ShortcutsTree.InsertItem(_T(""), 5, 5, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_WIN_SRV].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_TRANSFER].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_SEARCH].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_SHAREDFILES].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_CHAT].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_IRC].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_STATS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_PREFS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ahTree[SCUT_NODE_GEN_LINK] = m_ShortcutsTree.InsertItem(_T(""), 7, 7, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_LINK].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ShortcutTreeItem[SCUT_LINK_HTML].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ShortcutTreeItem[SCUT_LINK_SOURCE].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ahTree[SCUT_NODE_GEN_FILES] = m_ShortcutsTree.InsertItem(_T(""), 8, 8, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_FILE_OPENDIR].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_FILES]);
	m_ShortcutTreeItem[SCUT_DL_CANCEL].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_STOP].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_PAUSE].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_RESUME].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_OPEN].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_PREVIEW].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_RENAME].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_COMMENTS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_DETAILS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_FD_SOURCES].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_CLEAR].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_CLEARALL].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_SHOWALL].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_DEFSORT].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ahTree[SCUT_NODE_DL_ADV] = m_ShortcutsTree.InsertItem(_T(""), 6, 6, m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_NAMECLEANUP].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_PREALLOC].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AF].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFSAMECAT].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFAUTO].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFOTHER].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_SRC_DETAILS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_FRIEND].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_MSG].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_SHAREDFILES].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_FILE_EDITCOMMENTS].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SHARED]);
	m_ShortcutTreeItem[SCUT_LINK_HASH].hHnd = m_ShortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);

	for (unsigned ui = 0; ui < SCUT_NODES; ui++)
		m_ShortcutsTree.SetItemState(m_ahTree[ui], TVIS_BOLD, TVIS_BOLD);

	m_ShortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN], TVE_EXPAND);
	m_ShortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_WIN], TVE_EXPAND);
	m_ShortcutsTree.Expand(m_ahTree[SCUT_NODE_DL_ADV], TVE_EXPAND);
	m_ShortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_LINK], TVE_EXPAND);
	m_ShortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_FILES], TVE_EXPAND);

	m_ShortcutsTree.Select(m_ShortcutTreeItem[0].hHnd, TVGN_CARET);
}

void CPPgShortcuts::RefreshShortcutsTree(void)
{
	static const uint16 s_auResTbl[] =
	{
		IDS_PW_GENERAL,				//SCUT_NODE_GEN
		IDS_TREE_GENERAL_SHOW_WND,	//SCUT_NODE_GEN_WIN
		IDS_ED2KLINKFIX,			//SCUT_NODE_GEN_LINK
		IDS_FILES,					//SCUT_NODE_GEN_FILES
		IDS_TREE_DL,				//SCUT_NODE_DL
		IDS_PW_ADVANCED,			//SCUT_NODE_DL_ADV
		IDS_DL_SOURCES,				//SCUT_NODE_SRC
		IDS_SHAREDFILES				//SCUT_NODE_SHARED
	};
	static const uint16 s_auResTbl2[] =
	{
		IDS_MINIMIZE_TO_SYSTRAY,			//SCUT_WIN_MINIMIZE
		IDS_TREE_GENERAL_SWITCH_WND,		//SCUT_WIN_SWITCH
		IDS_SERVERS,						//SCUT_WIN_SRV
		IDS_EM_TRANS,						//SCUT_WIN_TRANSFER
		IDS_SEARCH_NOUN,					//SCUT_WIN_SEARCH
		IDS_EM_FILES,						//SCUT_WIN_SHAREDFILES
		IDS_MESSAGES,						//SCUT_WIN_CHAT
		IDS_IRC,							//SCUT_WIN_IRC
		IDS_STATISTICS,						//SCUT_WIN_STATS
		IDS_PREFERENCES,					//SCUT_WIN_PREFS
		IDS_CANCEL,							//SCUT_DL_CANCEL
		IDS_STOP_VERB,						//SCUT_DL_STOP
		IDS_PAUSE_VERB,						//SCUT_DL_PAUSE
		IDS_RESUME,							//SCUT_DL_RESUME
		IDS_OPENFILE,						//SCUT_FILE_OPEN
		IDS_OPENFOLDER,						//SCUT_FILE_OPENDIR
		IDS_PREVIEW_VERB,					//SCUT_DL_PREVIEW
		IDS_RENAME,							//SCUT_FILE_RENAME
		IDS_CMT_SHOWALL,					//SCUT_FILE_COMMENTS
		IDS_DL_INFO,						//SCUT_FILE_DETAILS
		IDS_SHOW_FILEDETAILS_SOURCES,		//SCUT_DL_FD_SOURCES
		IDS_TREE_DL_CLEAR_COMPLETED,		//SCUT_DL_CLEAR
		IDS_TREE_DL_CLEAR_ALL_COMPLETED,	//SCUT_DL_CLEARALL
		IDS_TREE_DL_SHOW_ALLUP,				//SCUT_DL_SHOWALL
		IDS_TREE_DL_USE_SORT,				//SCUT_DL_DEFSORT
		IDS_DL_PREALLOCATE,					//SCUT_DL_PREALLOC
		IDS_ALL_A4AF_TO_HERE,				//SCUT_DL_A4AF
		IDS_TREE_DL_A4AF_AUTO,				//SCUT_DL_A4AFAUTO
		IDS_ALL_A4AF_TO_OTHER,				//SCUT_DL_A4AFOTHER
		IDS_ALL_A4AF_SAMECAT,				//SCUT_DL_A4AFSAMECAT
		IDS_DL_LINK1,						//SCUT_LINK
		IDS_DL_LINK2,						//SCUT_LINK_HTML
		IDS_CREATESOURCELINK,				//SCUT_LINK_SOURCE
		IDS_SHOWDETAILS,					//SCUT_SRC_DETAILS
		IDS_ADDREMOVE_FRIEND,				//SCUT_SRC_FRIEND
		IDS_SEND_MSG,						//SCUT_SRC_MSG
		IDS_VIEWFILES,						//SCUT_SRC_SHAREDFILES
		IDS_EDIT_FILE_COMMENT,				//SCUT_FILE_EDITCOMMENTS
		IDS_COPYHASH,						//SCUT_LINK_HASH
		IDS_DOCLEANUP						//SCUT_FILE_NAMECLEANUP
	};
	CString	strTmp;

	for (unsigned ui = 0; ui < SCUT_NODES; ui++)
	{
		::GetResString(&strTmp, s_auResTbl[ui]);
		m_ShortcutsTree.SetItemText(m_ahTree[ui], strTmp);
	}
	for (unsigned ui = 0; ui < SCUT_COUNT; ui++)
	{
		m_ShortcutsTree.SetItemText( m_ShortcutTreeItem[ui].hHnd,
			GetStringFromShortcutCode(s_auResTbl2[ui], ui, SSP_SPACE_PREFIX | SSP_RETNONE) );
	}
}

void CPPgShortcuts::RefreshKeyCombo(void)
{
	static const uint16 s_auResTbl[] =
	{
		IDS_SHORTCUTS_ENTER_KEY,	//  0
		IDS_SHORTCUTS_SPACE_KEY,	//  1
		IDS_SHORTCUTS_TAB_KEY,		//  2
		IDS_SHORTCUTS_BACK_KEY,		//  3
		IDS_SHORTCUTS_INSERT_KEY,	//  4
		IDS_SHORTCUTS_DELETE_KEY,	//  5
		IDS_SHORTCUTS_HOME_KEY,		//  6
		IDS_SHORTCUTS_END_KEY,		//  7
		IDS_SHORTCUTS_PAGEUP_KEY,	//  8
		IDS_SHORTCUTS_PAGEDOWN_KEY	//  9
	};
	static const TCHAR s_auResTbl2[][4] =
	{
		_T("F1"),	// 10
		_T("F2"),	// 11
		_T("F3"),	// 12
		_T("F4"),	// 13
		_T("F5"),	// 14
		_T("F6"),	// 15
		_T("F7"),	// 16
		_T("F8"),	// 17
		_T("F9"),	// 18
		_T("F10"),	// 19
		_T("F11"),	// 20
		_T("F12"),	// 21
		_T("A"),	// 22 - letters start
		_T("B"),	// 23
		_T("C"),	// 24
		_T("D"),	// 25
		_T("E"),	// 26
		_T("F"),	// 27
		_T("G"),	// 28
		_T("H"),	// 29
		_T("I"),	// 30
		_T("J"),	// 31
		_T("K"),	// 32
		_T("L"),	// 33
		_T("M"),	// 34
		_T("N"),	// 35
		_T("O"),	// 36
		_T("P"),	// 37
		_T("Q"),	// 38
		_T("R"),	// 39
		_T("S"),	// 40
		_T("T"),	// 41
		_T("U"),	// 42
		_T("V"),	// 43
		_T("W"),	// 44
		_T("X"),	// 45
		_T("Y"),	// 46
		_T("Z"),	// 47 - letters end
		_T("0"),	// 48 - numbers start
		_T("1"),	// 49
		_T("2"),	// 50
		_T("3"),	// 51
		_T("4"),	// 52
		_T("5"),	// 53
		_T("6"),	// 54
		_T("7"),	// 55
		_T("8"),	// 56
		_T("9")		// 57 - numbers end
	};
	m_ShortcutsKeyCombo.ResetContent();

	for (unsigned ui = 0; ui < ARRSIZE(s_auResTbl); ui++)
		m_ShortcutsKeyCombo.AddString(GetResString(s_auResTbl[ui]));
	for (unsigned ui = 0; ui < ARRSIZE(s_auResTbl2); ui++)
		m_ShortcutsKeyCombo.AddString(reinterpret_cast<const TCHAR*>(&s_auResTbl2[ui]));

	int iIndex = GetShortcutTreeItemIndexFromItem(m_ShortcutsTree.GetSelectedItem());
	if (iIndex >= 0)
		m_ShortcutsKeyCombo.SetCurSel(GetKeyComboIndexFromShortcutKey(m_ShortcutTreeItem[iIndex].Shortcut.GetKey()));
}

void CPPgShortcuts::LoadSettings(void)
{
	for (int i = 0; i < SCUT_COUNT; i++)
		m_ShortcutTreeItem[i].Shortcut.SetCode(m_pPrefs->GetShortcutCode(i));

	LoadShortcut(m_ShortcutsTree.GetSelectedItem());

	SetModified(FALSE);
}

void CPPgShortcuts::Localize(void)
{
	static const uint16 s_auResTbl[][2] =
	{
		{ IDC_SHORTCUTS_STATIC, IDS_SHORTCUTS_STATIC }
	};

	if (::IsWindow(m_hWnd))
	{
		CString	strRes(_T("      "));

		strRes += GetResString(IDS_SHORTCUTS_ENABLE); // the spaces let a blank space to display the IDC_SHORTCUTS_ENABLE checkbox
		SetDlgItemText(IDC_SHORTCUTS_GROUPBOX, strRes);

		for (uint32 i = 0; i < ARRSIZE(s_auResTbl); i++)
		{
			::GetResString(&strRes, static_cast<UINT>(s_auResTbl[i][1]));
			SetDlgItemText(s_auResTbl[i][0], strRes);
		}
		RefreshShortcutsTree();
		RefreshKeyCombo();
	}
}

int CPPgShortcuts::GetShortcutTreeItemIndexFromItem(HTREEITEM hItem)
{
	for (int i = 0; i < SCUT_COUNT; i++)
		if (m_ShortcutTreeItem[i].hHnd == hItem)
			return i;

	return -1;
}

void CPPgShortcuts::LoadShortcut(HTREEITEM hItem)
{
	int i = GetShortcutTreeItemIndexFromItem(hItem);

	if (i >= 0)
	{
		m_bShortcutsEnable = m_ShortcutTreeItem[i].Shortcut.IsEnabled();
		m_bShortcutsAlt = m_ShortcutTreeItem[i].Shortcut.IsAlt();
		m_bShortcutsCtrl = m_ShortcutTreeItem[i].Shortcut.IsCtrl();
		m_bShortcutsShift = m_ShortcutTreeItem[i].Shortcut.IsShift();
		m_bShortcutsWin = m_ShortcutTreeItem[i].Shortcut.IsWin();
		m_ShortcutsKeyCombo.SetCurSel(GetKeyComboIndexFromShortcutKey(m_ShortcutTreeItem[i].Shortcut.GetKey()));
		UpdateData(FALSE);
		UpdateCheckBoxesState();
	}
}

void CPPgShortcuts::SaveShortcut(HTREEITEM hItem)
{
	int i = GetShortcutTreeItemIndexFromItem(hItem);

	if (i >= 0)
	{
		UpdateData();
		m_ShortcutTreeItem[i].Shortcut.SetEnabled(B2b(m_bShortcutsEnable));
		m_ShortcutTreeItem[i].Shortcut.SetAlt(B2b(m_bShortcutsAlt));
		m_ShortcutTreeItem[i].Shortcut.SetCtrl(B2b(m_bShortcutsCtrl));
		m_ShortcutTreeItem[i].Shortcut.SetShift(B2b(m_bShortcutsShift));
		m_ShortcutTreeItem[i].Shortcut.SetWin(B2b(m_bShortcutsWin));
		m_ShortcutTreeItem[i].Shortcut.SetKey(GetShortcutKeyFromKeyComboIndex(m_ShortcutsKeyCombo.GetCurSel()));
	}
}

int CPPgShortcuts::GetKeyComboIndexFromShortcutKey(byte byteKey) const
{
	if (byteKey == VK_RETURN) // Enter key
		return 0;
	else if (byteKey == VK_SPACE) // Spacebar
		return 1;
	else if (byteKey == VK_TAB) // Tab key
		return 2;
	else if (byteKey == VK_BACK) // Backspace key
		return 3;
	else if (byteKey == VK_INSERT) // Insert key
		return 4;
	else if (byteKey == VK_DELETE) // Delete key
		return 5;
	else if (byteKey == VK_HOME) // Home key
		return 6;
	else if (byteKey == VK_END) // End key
		return 7;
	else if (byteKey == VK_PRIOR) // Page Up key
		return 8;
	else if (byteKey == VK_NEXT) // Page Down key
		return 9;
	else if ((byteKey >= VK_F1) && (byteKey <= VK_F12)) // function keys
		return (byteKey - VK_F1) + 10;
	else if ((byteKey >= 'A') && (byteKey <= 'Z')) // letter keys
		return (byteKey - 'A') + 22;
	else if ((byteKey >= '0') && (byteKey <= '9')) // number keys
		return (byteKey - '0') + 48;
	else /*** should never happen ***/
	{
		AfxMessageBox(_T("Error in key code. 'Enter' key was set to default."), MB_OK | MB_ICONERROR);
		return 0; // return Enter key index by default
	}
}

byte CPPgShortcuts::GetShortcutKeyFromKeyComboIndex(int iIndex) const
{
	if (iIndex == 0) // Enter key
		return VK_RETURN;
	else if (iIndex == 1) // Spacebar
		return VK_SPACE;
	else if (iIndex == 2) // Tab key
		return VK_TAB;
	else if (iIndex == 3) // Backspace key
		return VK_BACK;
	else if (iIndex == 4) // Insert key
		return VK_INSERT;
	else if (iIndex == 5) // Delete key
		return VK_DELETE;
	else if (iIndex == 6) // Home key
		return VK_HOME;
	else if (iIndex == 7) // End key
		return VK_END;
	else if (iIndex == 8) // Page Up key
		return VK_PRIOR;
	else if (iIndex == 9) // Page Down key
		return VK_NEXT;
	else if ((iIndex >= 10) && (iIndex <= 21)) // function keys
		return static_cast<byte>(VK_F1 + (iIndex - 10));
	else if ((iIndex >= 22) && (iIndex <= 47)) // letter keys
		return static_cast<byte>('A' + (iIndex - 22));
	else if ((iIndex >= 48) && (iIndex <= 57)) // number keys
		return static_cast<byte>('0' + (iIndex - 48));
	else /*** should never happen ***/
	{
		AfxMessageBox(_T("Error in key combo index. 'Enter' key was set to default."), MB_OK | MB_ICONERROR);
		return VK_RETURN;
	}
}

void CPPgShortcuts::UpdateCheckBoxesState(void)
{
	UpdateData();
	GetDlgItem(IDC_SHORTCUTS_ALT)->EnableWindow(m_bShortcutsEnable);
	GetDlgItem(IDC_SHORTCUTS_CTRL)->EnableWindow(m_bShortcutsEnable);
	GetDlgItem(IDC_SHORTCUTS_SHIFT)->EnableWindow(m_bShortcutsEnable);
	GetDlgItem(IDC_SHORTCUTS_WIN)->EnableWindow(m_bShortcutsEnable);
	GetDlgItem(IDC_SHORTCUTS_STATIC)->EnableWindow(m_bShortcutsEnable);
	m_ShortcutsKeyCombo.EnableWindow(m_bShortcutsEnable);
}

// This function will prevent the user to select root items
void CPPgShortcuts::OnTvnSelchangingShortcutsTree(NMHDR *pNMHDR, LRESULT *pResult)
{
	LPNMTREEVIEW pNMTreeView = reinterpret_cast<LPNMTREEVIEW>(pNMHDR);
	
	if (m_ShortcutsTree.ItemHasChildren(pNMTreeView->itemNew.hItem))
		*pResult = TRUE;
	else
	{
		LoadShortcut(pNMTreeView->itemNew.hItem);
		*pResult = FALSE;
	}
}
@


1.41
log
@Review and slightly modified interface to comply with Unicode; Optimized string shortcut representation.
@
text
@a20 1

d24 5
d39 7
a45 13
	DDX_Control(pDX, IDC_SHORTCUTS_TREE, shortcutsTree);
	DDX_Check(pDX, IDC_SHORTCUTS_ENABLE, shortcutsEnable);
	DDX_Check(pDX, IDC_SHORTCUTS_ALT, shortcutsAlt);
	DDX_Check(pDX, IDC_SHORTCUTS_CTRL, shortcutsCtrl);
	DDX_Check(pDX, IDC_SHORTCUTS_SHIFT, shortcutsShift);
	DDX_Check(pDX, IDC_SHORTCUTS_WIN, shortcutsWin);
	DDX_Control(pDX, IDC_SHORTCUTS_ALT, shortcutsAltCheck);
	DDX_Control(pDX, IDC_SHORTCUTS_CTRL, shortcutsCtrlCheck);
	DDX_Control(pDX, IDC_SHORTCUTS_SHIFT, shortcutsShiftCheck);
	DDX_Control(pDX, IDC_SHORTCUTS_WIN, shortcutsWinCheck);
	DDX_Control(pDX, IDC_SHORTCUTS_STATIC, shortcutsStaticLbl);
	DDX_Control(pDX, IDC_SHORTCUTS_COMBO, shortcutsKeyCombo);
	DDX_Control(pDX, IDC_SHORTCUTS_GROUPBOX, shortcutsGroupBox);
d75 2
a76 2
	imagelistShortcutsTree.DeleteImageList();
	shortcutsTree.DeleteAllItems();
d94 1
a94 1
	SaveShortcut(shortcutsTree.GetSelectedItem());
d121 52
a172 52
	imagelistShortcutsTree.Create(16, 16, g_App.m_iDfltImageListColorFlags | ILC_MASK, ARRSIZE(s_auIconResID), 0);
	FillImgLstWith16x16Icons(&imagelistShortcutsTree, s_auIconResID, ARRSIZE(s_auIconResID));
	shortcutsTree.SetImageList(&imagelistShortcutsTree, TVSIL_NORMAL);

	m_ahTree[SCUT_NODE_GEN] = shortcutsTree.InsertItem(_T(""), 1, 1);
	m_ahTree[SCUT_NODE_DL] = shortcutsTree.InsertItem(_T(""), 2, 2);
	m_ahTree[SCUT_NODE_SRC] = shortcutsTree.InsertItem(_T(""), 3, 3);
	m_ahTree[SCUT_NODE_SHARED] = shortcutsTree.InsertItem(_T(""), 4, 4);
	m_ShortcutTreeItem[SCUT_WIN_MINIMIZE].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_WIN_SWITCH].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN]);
	m_ahTree[SCUT_NODE_GEN_WIN] = shortcutsTree.InsertItem(_T(""), 5, 5, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_WIN_SRV].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_TRANSFER].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_SEARCH].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_SHAREDFILES].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_CHAT].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_IRC].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_STATS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ShortcutTreeItem[SCUT_WIN_PREFS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_WIN]);
	m_ahTree[SCUT_NODE_GEN_LINK] = shortcutsTree.InsertItem(_T(""), 7, 7, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_LINK].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ShortcutTreeItem[SCUT_LINK_HTML].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ShortcutTreeItem[SCUT_LINK_SOURCE].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
	m_ahTree[SCUT_NODE_GEN_FILES] = shortcutsTree.InsertItem(_T(""), 8, 8, m_ahTree[SCUT_NODE_GEN]);
	m_ShortcutTreeItem[SCUT_FILE_OPENDIR].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_FILES]);
	m_ShortcutTreeItem[SCUT_DL_CANCEL].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_STOP].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_PAUSE].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_RESUME].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_OPEN].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_PREVIEW].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_RENAME].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_COMMENTS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_DETAILS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_FD_SOURCES].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_CLEAR].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_CLEARALL].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_SHOWALL].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_DL_DEFSORT].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL]);
	m_ahTree[SCUT_NODE_DL_ADV] = shortcutsTree.InsertItem(_T(""), 6, 6, m_ahTree[SCUT_NODE_DL]);
	m_ShortcutTreeItem[SCUT_FILE_NAMECLEANUP].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_PREALLOC].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AF].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFSAMECAT].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFAUTO].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_DL_A4AFOTHER].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
	m_ShortcutTreeItem[SCUT_SRC_DETAILS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_FRIEND].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_MSG].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_SRC_SHAREDFILES].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SRC]);
	m_ShortcutTreeItem[SCUT_FILE_EDITCOMMENTS].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_SHARED]);
	m_ShortcutTreeItem[SCUT_LINK_HASH].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_GEN_LINK]);
d175 1
a175 1
		shortcutsTree.SetItemState(m_ahTree[ui], TVIS_BOLD, TVIS_BOLD);
d177 5
a181 5
	shortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN], TVE_EXPAND);
	shortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_WIN], TVE_EXPAND);
	shortcutsTree.Expand(m_ahTree[SCUT_NODE_DL_ADV], TVE_EXPAND);
	shortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_LINK], TVE_EXPAND);
	shortcutsTree.Expand(m_ahTree[SCUT_NODE_GEN_FILES], TVE_EXPAND);
d183 1
a183 1
	shortcutsTree.Select(m_ShortcutTreeItem[0].hHnd, TVGN_CARET);
d247 1
a247 1
		shortcutsTree.SetItemText(m_ahTree[ui], strTmp);
d251 1
a251 1
		shortcutsTree.SetItemText( m_ShortcutTreeItem[ui].hHnd,
d322 1
a322 1
	shortcutsKeyCombo.ResetContent();
d325 1
a325 1
		shortcutsKeyCombo.AddString(GetResString(s_auResTbl[ui]));
d327 1
a327 1
		shortcutsKeyCombo.AddString(reinterpret_cast<const TCHAR*>(&s_auResTbl2[ui]));
d329 1
a329 1
	int iIndex = GetShortcutTreeItemIndexFromItem(shortcutsTree.GetSelectedItem());
d331 1
a331 1
		shortcutsKeyCombo.SetCurSel(GetKeyComboIndexFromShortcutKey(m_ShortcutTreeItem[iIndex].Shortcut.GetKey()));
d339 1
a339 1
	LoadShortcut(shortcutsTree.GetSelectedItem());
d346 6
a351 1
	if(::IsWindow(m_hWnd))
d353 10
a362 3
		SetWindowText(GetResString(IDS_PW_SHORTCUTS));
		shortcutsGroupBox.SetWindowText(_T("      ") + GetResString(IDS_SHORTCUTS_ENABLE)); // the spaces let a blank space to display the IDC_SHORTCUTS_ENABLE checkbox
		shortcutsStaticLbl.SetWindowText(GetResString(IDS_SHORTCUTS_STATIC));
d383 6
a388 6
		shortcutsEnable	= m_ShortcutTreeItem[i].Shortcut.IsEnabled();
		shortcutsAlt	= m_ShortcutTreeItem[i].Shortcut.IsAlt();
		shortcutsCtrl	= m_ShortcutTreeItem[i].Shortcut.IsCtrl();
		shortcutsShift	= m_ShortcutTreeItem[i].Shortcut.IsShift();
		shortcutsWin	= m_ShortcutTreeItem[i].Shortcut.IsWin();
		shortcutsKeyCombo.SetCurSel(GetKeyComboIndexFromShortcutKey(m_ShortcutTreeItem[i].Shortcut.GetKey()));
d401 6
a406 6
		m_ShortcutTreeItem[i].Shortcut.SetEnabled(B2b(shortcutsEnable));
		m_ShortcutTreeItem[i].Shortcut.SetAlt(B2b(shortcutsAlt));
		m_ShortcutTreeItem[i].Shortcut.SetCtrl(B2b(shortcutsCtrl));
		m_ShortcutTreeItem[i].Shortcut.SetShift(B2b(shortcutsShift));
		m_ShortcutTreeItem[i].Shortcut.SetWin(B2b(shortcutsWin));
		m_ShortcutTreeItem[i].Shortcut.SetKey(GetShortcutKeyFromKeyComboIndex(shortcutsKeyCombo.GetCurSel()));
d483 6
a488 6
	shortcutsAltCheck.EnableWindow(shortcutsEnable);
	shortcutsCtrlCheck.EnableWindow(shortcutsEnable);
	shortcutsShiftCheck.EnableWindow(shortcutsEnable);
	shortcutsWinCheck.EnableWindow(shortcutsEnable);
	shortcutsStaticLbl.EnableWindow(shortcutsEnable);
	shortcutsKeyCombo.EnableWindow(shortcutsEnable);
d496 1
a496 1
	if (shortcutsTree.ItemHasChildren(pNMTreeView->itemNew.hItem))
@


1.40
log
@Suppressed compiler warnings [Aw3].
@
text
@d253 2
a254 3
		::GetResString(&strTmp, s_auResTbl2[ui]);
		strTmp += GetStringFromShortcutCode(ui, SSP_SPACE_PREFIX, TRUE);
		shortcutsTree.SetItemText(m_ShortcutTreeItem[ui].hHnd, strTmp);
d400 1
a400 1
int CPPgShortcuts::GetKeyComboIndexFromShortcutKey(char cKey) const
d402 1
a402 1
	if (cKey == VK_RETURN) // Enter key
d404 1
a404 1
	else if (cKey == VK_SPACE) // Spacebar
d406 1
a406 1
	else if (cKey == VK_TAB) // Tab key
d408 1
a408 1
	else if (cKey == VK_BACK) // Backspace key
d410 1
a410 1
	else if (cKey == VK_INSERT) // Insert key
d412 1
a412 1
	else if (cKey == VK_DELETE) // Delete key
d414 1
a414 1
	else if (cKey == VK_HOME) // Home key
d416 1
a416 1
	else if (cKey == VK_END) // End key
d418 1
a418 1
	else if (cKey == VK_PRIOR) // Page Up key
d420 1
a420 1
	else if (cKey == VK_NEXT) // Page Down key
d422 6
a427 6
	else if ((cKey >= VK_F1) && (cKey <= VK_F12)) // function keys
		return (cKey - VK_F1) + 10;
	else if ((cKey >= 'A') && (cKey <= 'Z')) // letter keys
		return (cKey - 'A') + 22;
	else if ((cKey >= '0') && (cKey <= '9')) // number keys
		return (cKey - '0') + 48;
d435 1
a435 1
char CPPgShortcuts::GetShortcutKeyFromKeyComboIndex(int iIndex) const
d458 1
a458 1
		return static_cast<char>(VK_F1 + (iIndex - 10));
d460 1
a460 1
		return static_cast<char>('A' + (iIndex - 22));
d462 1
a462 1
		return static_cast<char>('0' + (iIndex - 48));
@


1.39
log
@String unification -- IDS_TREE_DL_PREALLOCATE was substituted by IDS_DL_PREALLOCATE.
@
text
@d1 1
a1 1
// PPgShortcuts.cpp : implementation file
d3 13
a21 2
// CPPgShortcuts dialog

d123 2
a124 2
	imagelistShortcutsTree.Create(16, 16, g_App.m_iDfltImageListColorFlags | ILC_MASK, ELEMENT_COUNT(s_auIconResID), 0);
	FillImgLstWith16x16Icons(&imagelistShortcutsTree, s_auIconResID, ELEMENT_COUNT(s_auIconResID));
d327 1
a327 1
	for (unsigned ui = 0; ui < ELEMENT_COUNT(s_auResTbl); ui++)
d329 1
a329 1
	for (unsigned ui = 0; ui < ELEMENT_COUNT(s_auResTbl2); ui++)
d392 5
a396 5
		m_ShortcutTreeItem[i].Shortcut.SetEnabled(shortcutsEnable);
		m_ShortcutTreeItem[i].Shortcut.SetAlt(shortcutsAlt);
		m_ShortcutTreeItem[i].Shortcut.SetCtrl(shortcutsCtrl);
		m_ShortcutTreeItem[i].Shortcut.SetShift(shortcutsShift);
		m_ShortcutTreeItem[i].Shortcut.SetWin(shortcutsWin);
d459 1
a459 1
		return VK_F1 + (iIndex - 10);
d461 1
a461 1
		return 'A' + (iIndex - 22);
d463 1
a463 1
		return '0' + (iIndex - 48);
@


1.38
log
@Added filename cleanup shortcut {Towelie}.
@
text
@d217 1
a217 1
		IDS_TREE_DL_PREALLOCATE,			//SCUT_DL_PREALLOC
@


1.37
log
@Change the place of the new shortcut.
@
text
@d152 1
d230 2
a231 1
		IDS_COPYHASH						//SCUT_LINK_HASH
@


1.36
log
@Added shortcut for "Download from all A4AF sources (same category)" {Fuxie - DK}.
@
text
@d154 1
a156 1
	m_ShortcutTreeItem[SCUT_DL_A4AFSAMECAT].hHnd = shortcutsTree.InsertItem(_T(""), m_ahTree[SCUT_NODE_DL_ADV]);
@


1.35
log
@UNICODE preparation (first shot)
@
text
@d156 1
d220 1
@


1.34
log
@renamed 3 variables
@
text
@d416 1
a416 1
		AfxMessageBox("Error in key code. 'Enter' key was set to default.", MB_OK | MB_ICONERROR);
d451 1
a451 1
		AfxMessageBox("Error in key combo index. 'Enter' key was set to default.", MB_OK | MB_ICONERROR);
@


1.33
log
@Some clean-up.
@
text
@d112 1
a112 1
	imagelistShortcutsTree.Create(16, 16, g_eMuleApp.m_iDfltImageListColorFlags | ILC_MASK, ELEMENT_COUNT(s_auIconResID), 0);
@


1.32
log
@IDS_SHAREDFILES substitutes IDS_SF_FILES and IDS_TREE_SHARE.
@
text
@a38 1

d40 1
a40 1
	ON_BN_CLICKED(IDC_SHORTCUTS_ENABLE, /*OnSettingsChange*/OnEnableShortcutClick)
a50 2
// Gestionnaires de messages CPPgShortcuts

@


1.31
log
@IDS_STATISTICS substitutes IDS_TREE_GENERAL_SHOW_STATISTICS, IDS_EM_STATISTIC, IDS_STATSSETUPINFO;
IDS_EM_FILES substitutes IDS_TREE_GENERAL_SHOW_SHAREDFILES;
IDS_EM_TRANS substitutes IDS_TREE_GENERAL_SHOW_TRANSFER;
IDS_SEARCH_NOUN substitutes IDS_TREE_GENERAL_SHOW_SEARCH.
@
text
@d189 1
a189 1
		IDS_TREE_SHARE				//SCUT_NODE_SHARED
@


1.30
log
@IDS_DL_INFO substitutes IDS_TREE_DL_VIEW_DETAILS;
IDS_STOP_VERB substitutes IDS_TREE_DL_STOP;
IDS_PAUSE_VERB substitutes IDS_TREE_DL_PAUSE;
IDS_RESUME substitutes IDS_TREE_DL_RESUME;
IDS_RENAME substitutes IDS_TREE_DL_RENAME;
IDS_PREVIEW_VERB substitutes IDS_TREE_DL_PREVIEW.
@
text
@d196 3
a198 3
		IDS_TREE_GENERAL_SHOW_TRANSFER,		//SCUT_WIN_TRANSFER
		IDS_TREE_GENERAL_SHOW_SEARCH,		//SCUT_WIN_SEARCH
		IDS_TREE_GENERAL_SHOW_SHAREDFILES,	//SCUT_WIN_SHAREDFILES
d201 1
a201 1
		IDS_TREE_GENERAL_SHOW_STATISTICS,	//SCUT_WIN_STATS
@


1.29
log
@IDS_TREE_DL_VIEW_DETAILSSOURCES renamed into IDS_SHOW_FILEDETAILS_SOURCES;
IDS_TREE_GENERAL_MINIMIZE renamed into IDS_MINIMIZE_TO_SYSTRAY.
@
text
@d204 3
a206 3
		IDS_TREE_DL_STOP,					//SCUT_DL_STOP
		IDS_TREE_DL_PAUSE,					//SCUT_DL_PAUSE
		IDS_TREE_DL_RESUME,					//SCUT_DL_RESUME
d209 2
a210 2
		IDS_TREE_DL_PREVIEW,				//SCUT_DL_PREVIEW
		IDS_TREE_DL_RENAME,					//SCUT_FILE_RENAME
d212 1
a212 1
		IDS_TREE_DL_VIEW_DETAILS,			//SCUT_FILE_DETAILS
@


1.28
log
@IDS_MESSAGES substitutes IDS_EM_MESSAGES and IDS_TREE_GENERAL_SHOW_CHAT;
IDS_PREFERENCES substitutes IDS_TREE_GENERAL_SHOW_PREFERENCES;
IDS_OPENFILE substitutes IDS_TREE_DL_OPEN;
IDS_CMT_SHOWALL substitutes IDS_TREE_DL_VIEW_COMMENTS;
IDS_SERVERS substitutes IDS_FSTAT_SERVERS and IDS_TREE_GENERAL_SHOW_SERVER.
@
text
@d193 1
a193 1
		IDS_TREE_GENERAL_MINIMIZE,			//SCUT_WIN_MINIMIZE
d195 1
a195 1
		IDS_SERVERS,					//SCUT_WIN_SRV
d213 1
a213 1
		IDS_TREE_DL_VIEW_DETAILSSOURCES,	//SCUT_DL_FD_SOURCES
@


1.27
log
@IDS_IRC substitutes IDS_TREE_GENERAL_SHOW_IRC.
@
text
@d195 1
a195 1
		IDS_TREE_GENERAL_SHOW_SERVER,		//SCUT_WIN_SRV
d199 1
a199 1
		IDS_TREE_GENERAL_SHOW_CHAT,			//SCUT_WIN_CHAT
d202 1
a202 1
		IDS_TREE_GENERAL_SHOW_PREFERENCES,	//SCUT_WIN_PREFS
d207 1
a207 1
		IDS_TREE_DL_OPEN,					//SCUT_FILE_OPEN
d211 1
a211 1
		IDS_TREE_DL_VIEW_COMMENTS,			//SCUT_FILE_COMMENTS
@


1.26
log
@IDS_ALL_A4AF_TO_HERE is used instead of IDS_TREE_DL_A4AF for shortcut tree.
@
text
@d200 1
a200 1
		IDS_TREE_GENERAL_SHOW_IRC,			//SCUT_WIN_IRC
@


1.25
log
@IDS_SHOWDETAILS is used instead of IDS_TREE_UL_VIEW_DETAILS for shortcut tree;
IDS_SEND_MSG is used instead of IDS_TREE_UL_SEND_MESSAGE for shortcut tree;
IDS_VIEWFILES is used instead of IDS_TREE_UL_VIEW_FILES for shortcut tree.
@
text
@d219 1
a219 1
		IDS_TREE_DL_A4AF,					//SCUT_DL_A4AF
@


1.24
log
@IDS_EDIT_FILE_COMMENT substitutes IDS_TREE_SHARE_EDIT_COMMENTS;
Added new string IDS_ADDREMOVE_FRIEND.
@
text
@d225 1
a225 1
		IDS_TREE_UL_VIEW_DETAILS,			//SCUT_SRC_DETAILS
d227 2
a228 2
		IDS_TREE_UL_SEND_MESSAGE,			//SCUT_SRC_MSG
		IDS_TREE_UL_VIEW_FILES,				//SCUT_SRC_SHAREDFILES
@


1.23
log
@Removed double resource strings with colons from shortcuts tree:
IDS_DL_LINK1, IDS_DL_LINK2 and IDS_OPENFOLDER are used instead of removed strings
IDS_TREE_DL_ED2KLINK, IDS_TREE_DL_ED2KLINK_HTML and IDS_TREE_SHARE_OPENFOLDER.
@
text
@d203 1
a203 1
		IDS_TREE_DL_CANCEL,					//SCUT_DL_CANCEL
d226 1
a226 1
		IDS_TREE_UL_ADD_FRIEND,				//SCUT_SRC_FRIEND
d229 1
a229 1
		IDS_TREE_SHARE_EDIT_COMMENTS,		//SCUT_FILE_EDITCOMMENTS
@


1.22
log
@Shortcut to copy file hash to clipboard;
Some reorganization to remove double resource strings with colons (still in progress).
@
text
@d208 1
a208 1
		IDS_TREE_SHARE_OPENFOLDER,			//SCUT_FILE_OPENDIR
d222 2
a223 2
		IDS_TREE_DL_ED2KLINK,				//SCUT_LINK
		IDS_TREE_DL_ED2KLINK_HTML,			//SCUT_LINK_HTML
@


1.21
log
@Improved string processing; Unified way to fill keys combobox;
Some Unicode preparations.
@
text
@d164 1
d224 1
a224 1
		IDS_TREE_DL_ED2KLINK_SOURCE,		//SCUT_LINK_SOURCE
d229 2
a230 1
		IDS_TREE_SHARE_EDIT_COMMENTS		//SCUT_FILE_EDITCOMMENTS
@


1.20
log
@Unified and regrouped shortcuts.
@
text
@d165 2
a166 2
	for (unsigned i = 0; i < SCUT_NODES; i++)
		shortcutsTree.SetItemState(m_ahTree[i], TVIS_BOLD, TVIS_BOLD);
d232 1
a232 1
	for (unsigned i = 0; i < SCUT_NODES; i++)
d234 2
a235 2
		::GetResString(&strTmp, s_auResTbl[i]);
		shortcutsTree.SetItemText(m_ahTree[i], strTmp);
d237 1
a237 1
	for (unsigned i = 0; i < SCUT_COUNT; i++)
d239 3
a241 3
		::GetResString(&strTmp, s_auResTbl2[i]);
		strTmp += GetStringFromShortcutCode(i, SSP_SPACE_PREFIX, TRUE);
		shortcutsTree.SetItemText(m_ShortcutTreeItem[i].hHnd, strTmp);
d247 64
d312 6
a317 58
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_ENTER_KEY));	//  0
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_SPACE_KEY));	//  1
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_TAB_KEY));	//  2
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_BACK_KEY));	//  3
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_INSERT_KEY));//  4
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_DELETE_KEY));//  5
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_HOME_KEY));  //  6
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_END_KEY));	//  7
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_PAGEUP_KEY));//  8
	shortcutsKeyCombo.AddString(GetResString(IDS_SHORTCUTS_PAGEDOWN_KEY));//9
	shortcutsKeyCombo.AddString("F1");		// 10
	shortcutsKeyCombo.AddString("F2");		// 11
	shortcutsKeyCombo.AddString("F3");		// 12
	shortcutsKeyCombo.AddString("F4");		// 13
	shortcutsKeyCombo.AddString("F5");		// 14
	shortcutsKeyCombo.AddString("F6");		// 15
	shortcutsKeyCombo.AddString("F7");		// 16
	shortcutsKeyCombo.AddString("F8");		// 17
	shortcutsKeyCombo.AddString("F9");		// 18
	shortcutsKeyCombo.AddString("F10");		// 19
	shortcutsKeyCombo.AddString("F11");		// 20
	shortcutsKeyCombo.AddString("F12");		// 21
	shortcutsKeyCombo.AddString("A");		// 22 - letters start
	shortcutsKeyCombo.AddString("B");		// 23
	shortcutsKeyCombo.AddString("C");		// 24
	shortcutsKeyCombo.AddString("D");		// 25
	shortcutsKeyCombo.AddString("E");		// 26
	shortcutsKeyCombo.AddString("F");		// 27
	shortcutsKeyCombo.AddString("G");		// 28
	shortcutsKeyCombo.AddString("H");		// 29
	shortcutsKeyCombo.AddString("I");		// 30
	shortcutsKeyCombo.AddString("J");		// 31
	shortcutsKeyCombo.AddString("K");		// 32
	shortcutsKeyCombo.AddString("L");		// 33
	shortcutsKeyCombo.AddString("M");		// 34
	shortcutsKeyCombo.AddString("N");		// 35
	shortcutsKeyCombo.AddString("O");		// 36
	shortcutsKeyCombo.AddString("P");		// 37
	shortcutsKeyCombo.AddString("Q");		// 38
	shortcutsKeyCombo.AddString("R");		// 39
	shortcutsKeyCombo.AddString("S");		// 40
	shortcutsKeyCombo.AddString("T");		// 41
	shortcutsKeyCombo.AddString("U");		// 42
	shortcutsKeyCombo.AddString("V");		// 43
	shortcutsKeyCombo.AddString("W");		// 44
	shortcutsKeyCombo.AddString("X");		// 45
	shortcutsKeyCombo.AddString("Y");		// 46
	shortcutsKeyCombo.AddString("Z");		// 47 - letters end
	shortcutsKeyCombo.AddString("0");		// 48 - numbers start
	shortcutsKeyCombo.AddString("1");		// 49
	shortcutsKeyCombo.AddString("2");		// 50
	shortcutsKeyCombo.AddString("3");		// 51
	shortcutsKeyCombo.AddString("4");		// 52
	shortcutsKeyCombo.AddString("5");		// 53
	shortcutsKeyCombo.AddString("6");		// 54
	shortcutsKeyCombo.AddString("7");		// 55
	shortcutsKeyCombo.AddString("8");		// 56
	shortcutsKeyCombo.AddString("9");		// 57 - numbers end
@


1.19
log
@Changed icon for Sources branch in shortcuts tree;
Improved string processing (unified localization).
@
text
@d77 1
a77 1
	for (int i = 0; i < NUMBER_OF_ACTIONS; i++)
d111 2
a112 1
		IDI_GLOBAL			// 7 - UL & Share > ED2K Links
d119 54
a172 64
	h_general = shortcutsTree.InsertItem(_T(""), 1, 1);
	h_download = shortcutsTree.InsertItem(_T(""), 2, 2);
	h_upload = shortcutsTree.InsertItem(_T(""), 3, 3);
	h_share = shortcutsTree.InsertItem(_T(""), 4, 4);
	m_ShortcutTreeItem[IndexGalMinimize].h_Handle		= shortcutsTree.InsertItem(_T(""), h_general);
	m_ShortcutTreeItem[IndexGalSwitchWindow].h_Handle	= shortcutsTree.InsertItem(_T(""), h_general);
	h_generalShowWindow = shortcutsTree.InsertItem(_T(""), 5, 5, h_general);
	m_ShortcutTreeItem[IndexGalShowServer].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowTransfer].h_Handle	= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowSearch].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowShare].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowChat].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowIRC].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowStats].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowPrefs].h_Handle		= shortcutsTree.InsertItem(_T(""), h_generalShowWindow);
	m_ShortcutTreeItem[IndexDLCancel].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLStop].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLPause].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLResume].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLOpen].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLOpenFolder].h_Handle		= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLPreview].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLRename].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLComments].h_Handle		= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLDetails].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLDetailsSources].h_Handle	= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLClear].h_Handle			= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLClearAll].h_Handle		= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLShowAllUp].h_Handle		= shortcutsTree.InsertItem(_T(""), h_download);
	m_ShortcutTreeItem[IndexDLUseDefaultSort].h_Handle	= shortcutsTree.InsertItem(_T(""), h_download);
	h_downloadAdvanced = shortcutsTree.InsertItem(_T(""), 6, 6, h_download);
	m_ShortcutTreeItem[IndexDLPreallocate].h_Handle		= shortcutsTree.InsertItem(_T(""), h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AF].h_Handle			= shortcutsTree.InsertItem(_T(""), h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AFAuto].h_Handle		= shortcutsTree.InsertItem(_T(""), h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AFOther].h_Handle		= shortcutsTree.InsertItem(_T(""), h_downloadAdvanced);
	h_downloadED2KLinks = shortcutsTree.InsertItem(_T(""), 7, 7, h_download);
	m_ShortcutTreeItem[IndexDLED2KLink].h_Handle		= shortcutsTree.InsertItem(_T(""), h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexDLED2kLinkHtml].h_Handle	= shortcutsTree.InsertItem(_T(""), h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexDLED2kLinkSource].h_Handle	= shortcutsTree.InsertItem(_T(""), h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexULDetails].h_Handle			= shortcutsTree.InsertItem(_T(""), h_upload);
	m_ShortcutTreeItem[IndexULFriend].h_Handle			= shortcutsTree.InsertItem(_T(""), h_upload);
	m_ShortcutTreeItem[IndexULMessage].h_Handle			= shortcutsTree.InsertItem(_T(""), h_upload);
	m_ShortcutTreeItem[IndexULFiles].h_Handle			= shortcutsTree.InsertItem(_T(""), h_upload);
	m_ShortcutTreeItem[IndexShOpenFolder].h_Handle		= shortcutsTree.InsertItem(_T(""), h_share);
	m_ShortcutTreeItem[IndexShComments].h_Handle		= shortcutsTree.InsertItem(_T(""), h_share);
	h_shareED2KLinks = shortcutsTree.InsertItem(_T(""), 7, 7, h_share);
	m_ShortcutTreeItem[IndexShED2KLink].h_Handle		= shortcutsTree.InsertItem(_T(""), h_shareED2KLinks);
	m_ShortcutTreeItem[IndexShED2kLinkHtml].h_Handle	= shortcutsTree.InsertItem(_T(""), h_shareED2KLinks);
	m_ShortcutTreeItem[IndexShED2kLinkSource].h_Handle	= shortcutsTree.InsertItem(_T(""), h_shareED2KLinks);

	shortcutsTree.SetItemState(h_general, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_generalShowWindow, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_download, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_downloadAdvanced, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_downloadED2KLinks, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_upload, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_share, TVIS_BOLD, TVIS_BOLD);
	shortcutsTree.SetItemState(h_shareED2KLinks, TVIS_BOLD, TVIS_BOLD);

	shortcutsTree.Expand(h_general, TVE_EXPAND);
	shortcutsTree.Expand(h_generalShowWindow, TVE_EXPAND);
	shortcutsTree.Expand(h_downloadAdvanced, TVE_EXPAND);
	shortcutsTree.Expand(h_downloadED2KLinks, TVE_EXPAND);
	shortcutsTree.Expand(h_shareED2KLinks, TVE_EXPAND);
d174 1
a174 1
	shortcutsTree.Select(m_ShortcutTreeItem[0].h_Handle, TVGN_CARET);
d179 11
d192 37
a228 41
		IDS_TREE_GENERAL_MINIMIZE,			//IndexGalMinimize
		IDS_TREE_GENERAL_SWITCH_WND,		//IndexGalSwitchWindow
		IDS_TREE_GENERAL_SHOW_SERVER,		//IndexGalShowServer
		IDS_TREE_GENERAL_SHOW_TRANSFER,		//IndexGalShowTransfer
		IDS_TREE_GENERAL_SHOW_SEARCH,		//IndexGalShowSearch
		IDS_TREE_GENERAL_SHOW_SHAREDFILES,	//IndexGalShowShare
		IDS_TREE_GENERAL_SHOW_CHAT,			//IndexGalShowChat
		IDS_TREE_GENERAL_SHOW_IRC,			//IndexGalShowIRC
		IDS_TREE_GENERAL_SHOW_STATISTICS,	//IndexGalShowStats
		IDS_TREE_GENERAL_SHOW_PREFERENCES,	//IndexGalShowPrefs
		IDS_TREE_DL_CANCEL,					//IndexDLCancel
		IDS_TREE_DL_STOP,					//IndexDLStop
		IDS_TREE_DL_PAUSE,					//IndexDLPause
		IDS_TREE_DL_RESUME,					//IndexDLResume
		IDS_TREE_DL_OPEN,					//IndexDLOpen
		IDS_TREE_SHARE_OPENFOLDER,			//IndexDLOpenFolder
		IDS_TREE_DL_PREVIEW,				//IndexDLPreview
		IDS_TREE_DL_RENAME,					//IndexDLRename
		IDS_TREE_DL_VIEW_COMMENTS,			//IndexDLComments
		IDS_TREE_DL_VIEW_DETAILS,			//IndexDLDetails
		IDS_TREE_DL_VIEW_DETAILSSOURCES,	//IndexDLDetailsSources
		IDS_TREE_DL_CLEAR_COMPLETED,		//IndexDLClear
		IDS_TREE_DL_CLEAR_ALL_COMPLETED,	//IndexDLClearAll
		IDS_TREE_DL_SHOW_ALLUP,				//IndexDLShowAllUp
		IDS_TREE_DL_USE_SORT,				//IndexDLUseDefaultSort
		IDS_TREE_DL_PREALLOCATE,			//IndexDLPreallocate
		IDS_TREE_DL_A4AF,					//IndexDLA4AF
		IDS_TREE_DL_A4AF_AUTO,				//IndexDLA4AFAuto
		IDS_ALL_A4AF_TO_OTHER,				//IndexDLA4AFOther
		IDS_TREE_DL_ED2KLINK,				//IndexDLED2KLink
		IDS_TREE_DL_ED2KLINK_HTML,			//IndexDLED2kLinkHtml
		IDS_TREE_DL_ED2KLINK_SOURCE,		//IndexDLED2kLinkSource
		IDS_TREE_UL_VIEW_DETAILS,			//IndexULDetails
		IDS_TREE_UL_ADD_FRIEND,				//IndexULFriend
		IDS_TREE_UL_SEND_MESSAGE,			//IndexULMessage
		IDS_TREE_UL_VIEW_FILES,				//IndexULFiles
		IDS_TREE_SHARE_OPENFOLDER,			//IndexShOpenFolder
		IDS_TREE_SHARE_EDIT_COMMENTS,		//IndexShComments
		IDS_TREE_DL_ED2KLINK,				//IndexShED2KLink
		IDS_TREE_DL_ED2KLINK_HTML,			//IndexShED2kLinkHtml
		IDS_TREE_DL_ED2KLINK_SOURCE			//IndexShED2kLinkSource
d232 6
a237 10
	shortcutsTree.SetItemText(h_general, GetResString(IDS_PW_GENERAL));
	shortcutsTree.SetItemText(h_generalShowWindow, GetResString(IDS_TREE_GENERAL_SHOW_WND));
	shortcutsTree.SetItemText(h_download, GetResString(IDS_TREE_DL));
	shortcutsTree.SetItemText(h_downloadAdvanced, GetResString(IDS_PW_ADVANCED));
	shortcutsTree.SetItemText(h_downloadED2KLinks, GetResString(IDS_ED2KLINKFIX));
	shortcutsTree.SetItemText(h_upload, GetResString(IDS_DL_SOURCES));
	shortcutsTree.SetItemText(h_share, GetResString(IDS_TREE_SHARE));
	shortcutsTree.SetItemText(h_shareED2KLinks, GetResString(IDS_ED2KLINKFIX));

	for (int i = 0; i < NUMBER_OF_ACTIONS; i++)
d241 1
a241 1
		shortcutsTree.SetItemText(m_ShortcutTreeItem[i].h_Handle, strTmp);
d313 1
a313 1
	for (int i = 0; i < NUMBER_OF_ACTIONS; i++)
d335 2
a336 2
	for (int i = 0; i < NUMBER_OF_ACTIONS; i++)
		if (m_ShortcutTreeItem[i].h_Handle == hItem)
@


1.18
log
@Shortcuts branch "Uploading Files and File Sources" is renamed into "Sources".
@
text
@d106 1
a106 1
		IDI_UPLOAD,			// 3 - Upload list
d118 49
a166 49
	h_general = shortcutsTree.InsertItem(GetResString(IDS_PW_GENERAL), 1, 1);
	h_download = shortcutsTree.InsertItem(GetResString(IDS_TREE_DL), 2, 2);
	h_upload = shortcutsTree.InsertItem(GetResString(IDS_DL_SOURCES), 3, 3);
	h_share = shortcutsTree.InsertItem(GetResString(IDS_TREE_SHARE), 4, 4);
	m_ShortcutTreeItem[IndexGalMinimize].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalMinimize].uStringID		= IDS_TREE_GENERAL_MINIMIZE),			h_general);
	m_ShortcutTreeItem[IndexGalSwitchWindow].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalSwitchWindow].uStringID	= IDS_TREE_GENERAL_SWITCH_WND),			h_general);
	h_generalShowWindow = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_WND), 5, 5, h_general);
	m_ShortcutTreeItem[IndexGalShowServer].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowServer].uStringID	= IDS_TREE_GENERAL_SHOW_SERVER),		h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowTransfer].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowTransfer].uStringID	= IDS_TREE_GENERAL_SHOW_TRANSFER),		h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowSearch].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowSearch].uStringID	= IDS_TREE_GENERAL_SHOW_SEARCH),		h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowShare].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowShare].uStringID		= IDS_TREE_GENERAL_SHOW_SHAREDFILES),	h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowChat].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowChat].uStringID		= IDS_TREE_GENERAL_SHOW_CHAT),			h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowIRC].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowIRC].uStringID		= IDS_TREE_GENERAL_SHOW_IRC),			h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowStats].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowStats].uStringID		= IDS_TREE_GENERAL_SHOW_STATISTICS),	h_generalShowWindow);
	m_ShortcutTreeItem[IndexGalShowPrefs].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexGalShowPrefs].uStringID		= IDS_TREE_GENERAL_SHOW_PREFERENCES),	h_generalShowWindow);
	m_ShortcutTreeItem[IndexDLCancel].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLCancel].uStringID			= IDS_TREE_DL_CANCEL),					h_download);
	m_ShortcutTreeItem[IndexDLStop].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLStop].uStringID			= IDS_TREE_DL_STOP),					h_download);
	m_ShortcutTreeItem[IndexDLPause].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLPause].uStringID			= IDS_TREE_DL_PAUSE),					h_download);
	m_ShortcutTreeItem[IndexDLResume].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLResume].uStringID			= IDS_TREE_DL_RESUME),					h_download);
	m_ShortcutTreeItem[IndexDLOpen].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLOpen].uStringID			= IDS_TREE_DL_OPEN),					h_download);
	m_ShortcutTreeItem[IndexDLOpenFolder].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLOpenFolder].uStringID		= IDS_TREE_SHARE_OPENFOLDER),			h_download);
	m_ShortcutTreeItem[IndexDLPreview].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLPreview].uStringID		= IDS_TREE_DL_PREVIEW),					h_download);
	m_ShortcutTreeItem[IndexDLRename].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLRename].uStringID			= IDS_TREE_DL_RENAME),					h_download);
	m_ShortcutTreeItem[IndexDLComments].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLComments].uStringID		= IDS_TREE_DL_VIEW_COMMENTS),			h_download);
	m_ShortcutTreeItem[IndexDLDetails].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLDetails].uStringID		= IDS_TREE_DL_VIEW_DETAILS),			h_download);
	m_ShortcutTreeItem[IndexDLDetailsSources].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLDetailsSources].uStringID	= IDS_TREE_DL_VIEW_DETAILSSOURCES),		h_download);
	m_ShortcutTreeItem[IndexDLClear].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLClear].uStringID			= IDS_TREE_DL_CLEAR_COMPLETED),			h_download);
	m_ShortcutTreeItem[IndexDLClearAll].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLClearAll].uStringID		= IDS_TREE_DL_CLEAR_ALL_COMPLETED),		h_download);
	m_ShortcutTreeItem[IndexDLShowAllUp].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLShowAllUp].uStringID		= IDS_TREE_DL_SHOW_ALLUP),				h_download);
	m_ShortcutTreeItem[IndexDLUseDefaultSort].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLUseDefaultSort].uStringID	= IDS_TREE_DL_USE_SORT),				h_download);
	h_downloadAdvanced = shortcutsTree.InsertItem(GetResString(IDS_PW_ADVANCED), 6, 6, h_download);
	m_ShortcutTreeItem[IndexDLPreallocate].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLPreallocate].uStringID	= IDS_TREE_DL_PREALLOCATE),				h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AF].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLA4AF].uStringID			= IDS_TREE_DL_A4AF),					h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AFAuto].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLA4AFAuto].uStringID		= IDS_TREE_DL_A4AF_AUTO),				h_downloadAdvanced);
	m_ShortcutTreeItem[IndexDLA4AFOther].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLA4AFOther].uStringID		= IDS_ALL_A4AF_TO_OTHER),				h_downloadAdvanced);
	h_downloadED2KLinks = shortcutsTree.InsertItem(GetResString(IDS_ED2KLINKFIX), 7, 7, h_download);
	m_ShortcutTreeItem[IndexDLED2KLink].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLED2KLink].uStringID		= IDS_TREE_DL_ED2KLINK),				h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexDLED2kLinkHtml].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLED2kLinkHtml].uStringID	= IDS_TREE_DL_ED2KLINK_HTML),			h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexDLED2kLinkSource].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLED2kLinkSource].uStringID	= IDS_TREE_DL_ED2KLINK_SOURCE),			h_downloadED2KLinks);
	m_ShortcutTreeItem[IndexULDetails].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexULDetails].uStringID		= IDS_TREE_UL_VIEW_DETAILS),			h_upload);
	m_ShortcutTreeItem[IndexULFriend].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexULFriend].uStringID			= IDS_TREE_UL_ADD_FRIEND),				h_upload);
	m_ShortcutTreeItem[IndexULMessage].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexULMessage].uStringID		= IDS_TREE_UL_SEND_MESSAGE),			h_upload);
	m_ShortcutTreeItem[IndexULFiles].h_Handle			= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexULFiles].uStringID			= IDS_TREE_UL_VIEW_FILES),				h_upload);
	m_ShortcutTreeItem[IndexShOpenFolder].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexShOpenFolder].uStringID		= IDS_TREE_SHARE_OPENFOLDER),			h_share);
	m_ShortcutTreeItem[IndexShComments].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexShComments].uStringID		= IDS_TREE_SHARE_EDIT_COMMENTS),		h_share);
	h_shareED2KLinks = shortcutsTree.InsertItem(GetResString(IDS_ED2KLINKFIX), 7, 7, h_share);
	m_ShortcutTreeItem[IndexShED2KLink].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexShED2KLink].uStringID		= IDS_TREE_DL_ED2KLINK),				h_shareED2KLinks);
	m_ShortcutTreeItem[IndexShED2kLinkHtml].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexShED2kLinkHtml].uStringID	= IDS_TREE_DL_ED2KLINK_HTML),			h_shareED2KLinks);
	m_ShortcutTreeItem[IndexShED2kLinkSource].h_Handle	= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexShED2kLinkSource].uStringID	= IDS_TREE_DL_ED2KLINK_SOURCE),			h_shareED2KLinks);
d188 46
d244 5
a248 1
		shortcutsTree.SetItemText(m_ShortcutTreeItem[i].h_Handle, GetResString(m_ShortcutTreeItem[i].uStringID) + GetStringFromShortcutCode(i, SSP_SPACE_PREFIX, TRUE));
d332 1
a332 1
		shortcutsGroupBox.SetWindowText("      " + GetResString(IDS_SHORTCUTS_ENABLE)); // the spaces let a blank space to display the IDC_SHORTCUTS_ENABLE checkbox
@


1.17
log
@Don't use 32 bit color resources if OS/comctl32.dll doesn't support it and some other minor changes/optimizations.
@
text
@d120 1
a120 1
	h_upload = shortcutsTree.InsertItem(GetResString(IDS_TREE_UL), 3, 3);
d193 1
a193 1
	shortcutsTree.SetItemText(h_upload, GetResString(IDS_TREE_UL));
@


1.16
log
@Unified string usage for IDS_PW_GENERAL, IDS_STATS_GENERAL, IDS_TREE_GENERAL.
@
text
@d114 1
a114 1
	imagelistShortcutsTree.Create(16, 16, ILC_COLOR32 | ILC_MASK, ELEMENT_COUNT(s_auIconResID), 0);
@


1.15
log
@Faster shortcuts handling.
@
text
@d118 1
a118 1
	h_general = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL), 1, 1);
d188 1
a188 1
	shortcutsTree.SetItemText(h_general, GetResString(IDS_TREE_GENERAL));
@


1.14
log
@Reduced resources used by Preferences->Shortcuts; Corrected image list creation.
@
text
@d198 1
a198 1
		shortcutsTree.SetItemText(m_ShortcutTreeItem[i].h_Handle, GetResString(m_ShortcutTreeItem[i].uStringID) + GetStringFromShortcutCode(m_ShortcutTreeItem[i].Shortcut.GetCode(),SSP_SPACE_PREFIX, TRUE));
@


1.13
log
@Fixed GDI resource unloading in Shortcut Preferences page.
@
text
@d5 1
a5 1
#include "eMule.h"
a18 4
	if (imagelistShortcutsTree)
		imagelistShortcutsTree.DeleteImageList();
	if (shortcutsTree)
		shortcutsTree.DeleteAllItems();
d48 1
d66 9
d114 1
a114 6
	if (imagelistShortcutsTree)
		imagelistShortcutsTree.DeleteImageList();
	if (shortcutsTree)
		shortcutsTree.DeleteAllItems();

	imagelistShortcutsTree.Create(16, 16, ILC_COLOR32 | ILC_MASK, 3, 0);
@


1.12
log
@use already existing string instead of a new one (thx aw3)
@
text
@d93 15
d114 1
a114 11
	// Generic icon
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_TVI_GENERIC),16,16));		// 0 - items
	// Main category icons
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_TRAYICON),16,16));		// 1 - General
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_DIRECTDOWNLOAD),16,16));	// 2 - Download list
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_UPLOAD),16,16));			// 3 - Upload list
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_PREF_FILES),16,16));		// 4 - Share list
	// Sub-category icons
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_PREF_WINDOW),16,16));		// 5 - General > Show window
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_PREF_ADVANCED),16,16));	// 6 - General > Adanved
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_GLOBAL),16,16));			// 7 - UL & Share > ED2K Links
@


1.11
log
@'Open containing folder' added to download list context menu + minor changes
@
text
@d132 1
a132 1
	m_ShortcutTreeItem[IndexDLOpenFolder].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLOpenFolder].uStringID		= IDS_TREE_DL_OPENFOLDER),				h_download);
@


1.10
log
@Double #include removal.
@
text
@d132 1
@


1.9
log
@Modified Clear Completed
@
text
@d1 1
a1 1
// PPgShortcuts.cpp : fichier d'implmentation
a6 1
#include ".\ppgshortcuts.h"
@


1.8
log
@removed separate shortcuts tree string
@
text
@d139 1
@


1.7
log
@added 'Swap all A4AF sources to other files' by right-click menu or shortcut + minor changes
@
text
@d145 1
a145 1
	m_ShortcutTreeItem[IndexDLA4AFOther].h_Handle		= shortcutsTree.InsertItem(GetResString(m_ShortcutTreeItem[IndexDLA4AFOther].uStringID		= IDS_TREE_DL_A4AF_OTHER),				h_downloadAdvanced);
@


1.6
log
@Changed an Icon
@
text
@d145 1
@


1.5
log
@Updated shortcut management
@
text
@d110 1
a110 1
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_SCH_GLOBAL),16,16));		// 7 - UL & Share > ED2K Links
@


1.4
log
@fixed crash  due context menu, shortcut optimiation & update to UNICODE
@
text
@d134 1
d137 1
d139 2
@


1.3
log
@Correction of 1 icon in the shortcut tree of the preference dialog
@
text
@d186 1
a186 1
		shortcutsTree.SetItemText(m_ShortcutTreeItem[i].h_Handle, GetResString(m_ShortcutTreeItem[i].uStringID) + " " + GetStringFromShortcutCode(m_ShortcutTreeItem[i].Shortcut.GetCode(), TRUE));
@


1.2
log
@Change to shortcut management code (it's easier to add an action now) / Added a lot of actions to shortcut management / Added some keys to shortcut management
@
text
@d109 1
a109 1
	imagelistShortcutsTree.Add(LoadImgLstIcon(MAKEINTRESOURCE(IDI_PREF_ADVANCED),16,16));	// 6 - General > Show window
d151 1
a151 1
	h_shareED2KLinks = shortcutsTree.InsertItem(GetResString(IDS_ED2KLINKFIX), 6, 6, h_share);
@


1.1
log
@*** empty log message ***
@
text
@a45 2
	ON_NOTIFY(TVN_ITEMEXPANDING, IDC_SHORTCUTS_TREE, OnTvnItemexpandingShortcutsTree)
	ON_NOTIFY(TVN_SELCHANGING, IDC_SHORTCUTS_TREE, OnTvnSelchangingShortcutsTree)
d52 1
d63 1
a63 1
	CreateKeyCombo();		//           and key combo must have been created
d72 3
a74 17
	m_pPrefs->SetGeneralMinimizeWindowToTrayShortcutCode(m_GeneralMinimizeWindowToTray.GetCode());
	m_pPrefs->SetGeneralShowServerWndShortcutCode(m_GeneralShowServerWnd.GetCode());
	m_pPrefs->SetGeneralShowTransferWndShortcutCode(m_GeneralShowTransferWnd.GetCode());
	m_pPrefs->SetGeneralShowSearchWndShortcutCode(m_GeneralShowSearchWnd.GetCode());
	m_pPrefs->SetGeneralShowSharedFilesWndShortcutCode(m_GeneralShowSharedFilesWnd.GetCode());
	m_pPrefs->SetGeneralShowChatWndShortcutCode(m_GeneralShowChatWnd.GetCode());
	m_pPrefs->SetGeneralShowIRCWndShortcutCode(m_GeneralShowIRCWnd.GetCode());
	m_pPrefs->SetGeneralShowStatisticsWndShortcutCode(m_GeneralShowStatisticsWnd.GetCode());
	m_pPrefs->SetGeneralShowPreferencesWndShortcutCode(m_GeneralShowPreferencesWnd.GetCode());
	m_pPrefs->SetDownloadViewFileCommentsShortcutCode(m_DownloadViewFileComments.GetCode());
	m_pPrefs->SetDownloadViewFileDetailsShortcutCode(m_DownloadViewFileDetails.GetCode());
	m_pPrefs->SetDownloadClearCompletedFilesShortcutCode(m_DownloadClearCompletedFiles.GetCode());
	m_pPrefs->SetUploadViewClientDetailsShortcutCode(m_UploadViewClientDetails.GetCode());
	m_pPrefs->SetUploadAddClientToFriendsShortcutCode(m_UploadAddClientToFriends.GetCode());
	m_pPrefs->SetUploadSendMessageClientShortcutCode(m_UploadSendMessageClient.GetCode());
	m_pPrefs->SetUploadViewClientFilesShortcutCode(m_UploadViewClientFiles.GetCode());
	m_pPrefs->SetShareEditFileCommentsShortcutCode(m_ShareEditFileComments.GetCode());
d100 1
d102 1
d107 4
a112 1
	// General
a113 10
	h_generalMinimizeWindowToTray = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_MINIMIZE), h_general);
	h_generalShowServerWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_SERVER), h_general);
	h_generalShowTransferWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_TRANSFER), h_general);
	h_generalShowSearchWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_SEARCH), h_general);
	h_generalShowSharedFilesWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_SHAREDFILES), h_general);
	h_generalShowChatWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_CHAT), h_general);
	h_generalShowIRCWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_IRC), h_general);
	h_generalShowStatisticsWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_STATISTICS), h_general);
	h_generalShowPreferencesWnd = shortcutsTree.InsertItem(GetResString(IDS_TREE_GENERAL_SHOW_PREFERENCES), h_general);
	// Download list
a114 4
	h_downloadViewFileComments = shortcutsTree.InsertItem(GetResString(IDS_TREE_DL_VIEW_COMMENTS), h_download);
	h_downloadViewFileDetails = shortcutsTree.InsertItem(GetResString(IDS_TREE_DL_VIEW_DETAILS), h_download);
	h_downloadClearCompletedFiles = shortcutsTree.InsertItem(GetResString(IDS_TREE_DL_CLEAR_COMPLETED), h_download);
	// Upload list
a115 5
	h_uploadViewClientDetails = shortcutsTree.InsertItem(GetResString(IDS_TREE_UL_VIEW_DETAILS), h_upload);
	h_uploadAddClientToFriends = shortcutsTree.InsertItem(GetResString(IDS_TREE_UL_ADD_FRIEND), h_upload);
	h_uploadSendMessageClient = shortcutsTree.InsertItem(GetResString(IDS_TREE_UL_SEND_MESSAGE), h_upload);
	h_uploadViewClientFiles = shortcutsTree.InsertItem(GetResString(IDS_TREE_UL_VIEW_FILES), h_upload);
	// Share list
d117 38
a154 1
	h_shareEditFileComments = shortcutsTree.InsertItem(GetResString(IDS_TREE_SHARE_EDIT_COMMENTS), h_share);
d157 1
d159 2
d163 1
d166 4
a169 3
	shortcutsTree.Expand(h_download, TVE_EXPAND);
	shortcutsTree.Expand(h_upload, TVE_EXPAND);
	shortcutsTree.Expand(h_share, TVE_EXPAND);
d171 1
a171 1
	shortcutsTree.Select(h_generalMinimizeWindowToTray, TVGN_CARET);
d177 1
a177 9
	shortcutsTree.SetItemText(h_generalMinimizeWindowToTray, GetResString(IDS_TREE_GENERAL_MINIMIZE) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalMinimizeWindowToTray)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowServerWnd, GetResString(IDS_TREE_GENERAL_SHOW_SERVER) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowServerWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowTransferWnd, GetResString(IDS_TREE_GENERAL_SHOW_TRANSFER) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowTransferWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowSearchWnd, GetResString(IDS_TREE_GENERAL_SHOW_SEARCH) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowSearchWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowSharedFilesWnd, GetResString(IDS_TREE_GENERAL_SHOW_SHAREDFILES) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowSharedFilesWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowChatWnd, GetResString(IDS_TREE_GENERAL_SHOW_CHAT) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowChatWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowIRCWnd, GetResString(IDS_TREE_GENERAL_SHOW_IRC) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowIRCWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowStatisticsWnd, GetResString(IDS_TREE_GENERAL_SHOW_STATISTICS) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowStatisticsWnd)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_generalShowPreferencesWnd, GetResString(IDS_TREE_GENERAL_SHOW_PREFERENCES) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_generalShowPreferencesWnd)->GetCode(), TRUE));
d179 2
a180 3
	shortcutsTree.SetItemText(h_downloadViewFileComments, GetResString(IDS_TREE_DL_VIEW_COMMENTS) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_downloadViewFileComments)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_downloadViewFileDetails, GetResString(IDS_TREE_DL_VIEW_DETAILS) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_downloadViewFileDetails)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_downloadClearCompletedFiles, GetResString(IDS_TREE_DL_CLEAR_COMPLETED) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_downloadClearCompletedFiles)->GetCode(), TRUE));
a181 4
	shortcutsTree.SetItemText(h_uploadViewClientDetails, GetResString(IDS_TREE_UL_VIEW_DETAILS) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_uploadViewClientDetails)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_uploadAddClientToFriends, GetResString(IDS_TREE_UL_ADD_FRIEND) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_uploadAddClientToFriends)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_uploadSendMessageClient, GetResString(IDS_TREE_UL_SEND_MESSAGE) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_uploadSendMessageClient)->GetCode(), TRUE));
	shortcutsTree.SetItemText(h_uploadViewClientFiles, GetResString(IDS_TREE_UL_VIEW_FILES) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_uploadViewClientFiles)->GetCode(), TRUE));
d183 4
a186 1
	shortcutsTree.SetItemText(h_shareEditFileComments, GetResString(IDS_TREE_SHARE_EDIT_COMMENTS) + " " + GetStringFromShortcutCode(GetKeyboardShortcutFromItem(h_shareEditFileComments)->GetCode(), TRUE));
d189 1
a189 1
void CPPgShortcuts::CreateKeyCombo(void)
d191 62
a252 50
	shortcutsKeyCombo.AddString("Enter");	//  0
	shortcutsKeyCombo.AddString("Space");	//  1
	shortcutsKeyCombo.AddString("F1");		//  2
	shortcutsKeyCombo.AddString("F2");		//  3
	shortcutsKeyCombo.AddString("F3");		//  4
	shortcutsKeyCombo.AddString("F4");		//  5
	shortcutsKeyCombo.AddString("F5");		//  6
	shortcutsKeyCombo.AddString("F6");		//  7
	shortcutsKeyCombo.AddString("F7");		//  8
	shortcutsKeyCombo.AddString("F8");		//  9
	shortcutsKeyCombo.AddString("F9");		// 10
	shortcutsKeyCombo.AddString("F10");		// 11
	shortcutsKeyCombo.AddString("F11");		// 12
	shortcutsKeyCombo.AddString("F12");		// 13
	shortcutsKeyCombo.AddString("A");		// 14 - letters start
	shortcutsKeyCombo.AddString("B");		// 15
	shortcutsKeyCombo.AddString("C");		// 16
	shortcutsKeyCombo.AddString("D");		// 17
	shortcutsKeyCombo.AddString("E");		// 18
	shortcutsKeyCombo.AddString("F");		// 19
	shortcutsKeyCombo.AddString("G");		// 20
	shortcutsKeyCombo.AddString("H");		// 21
	shortcutsKeyCombo.AddString("I");		// 22
	shortcutsKeyCombo.AddString("J");		// 23
	shortcutsKeyCombo.AddString("K");		// 24
	shortcutsKeyCombo.AddString("L");		// 25
	shortcutsKeyCombo.AddString("M");		// 26
	shortcutsKeyCombo.AddString("N");		// 27
	shortcutsKeyCombo.AddString("O");		// 28
	shortcutsKeyCombo.AddString("P");		// 29
	shortcutsKeyCombo.AddString("Q");		// 30
	shortcutsKeyCombo.AddString("R");		// 31
	shortcutsKeyCombo.AddString("S");		// 32
	shortcutsKeyCombo.AddString("T");		// 33
	shortcutsKeyCombo.AddString("U");		// 34
	shortcutsKeyCombo.AddString("V");		// 35
	shortcutsKeyCombo.AddString("W");		// 36
	shortcutsKeyCombo.AddString("X");		// 37
	shortcutsKeyCombo.AddString("Y");		// 38
	shortcutsKeyCombo.AddString("Z");		// 39 - letters end
	shortcutsKeyCombo.AddString("0");		// 40 - numbers start
	shortcutsKeyCombo.AddString("1");		// 41
	shortcutsKeyCombo.AddString("2");		// 42
	shortcutsKeyCombo.AddString("3");		// 43
	shortcutsKeyCombo.AddString("4");		// 44
	shortcutsKeyCombo.AddString("5");		// 45
	shortcutsKeyCombo.AddString("6");		// 46
	shortcutsKeyCombo.AddString("7");		// 47
	shortcutsKeyCombo.AddString("8");		// 48
	shortcutsKeyCombo.AddString("9");		// 49 - numbers end
d257 2
a258 17
	m_GeneralMinimizeWindowToTray.SetCode(m_pPrefs->GetGeneralMinimizeWindowToTrayShortcutCode());
	m_GeneralShowServerWnd.SetCode(m_pPrefs->GetGeneralShowServerWndShortcutCode());
	m_GeneralShowTransferWnd.SetCode(m_pPrefs->GetGeneralShowTransferWndShortcutCode());
	m_GeneralShowSearchWnd.SetCode(m_pPrefs->GetGeneralShowSearchWndShortcutCode());
	m_GeneralShowSharedFilesWnd.SetCode(m_pPrefs->GetGeneralShowSharedFilesWndShortcutCode());
	m_GeneralShowChatWnd.SetCode(m_pPrefs->GetGeneralShowChatWndShortcutCode());
	m_GeneralShowIRCWnd.SetCode(m_pPrefs->GetGeneralShowIRCWndShortcutCode());
	m_GeneralShowStatisticsWnd.SetCode(m_pPrefs->GetGeneralShowStatisticsWndShortcutCode());
	m_GeneralShowPreferencesWnd.SetCode(m_pPrefs->GetGeneralShowPreferencesWndShortcutCode());
	m_DownloadViewFileComments.SetCode(m_pPrefs->GetDownloadViewFileCommentsShortcutCode());
	m_DownloadViewFileDetails.SetCode(m_pPrefs->GetDownloadViewFileDetailsShortcutCode());
	m_DownloadClearCompletedFiles.SetCode(m_pPrefs->GetDownloadClearCompletedFilesShortcutCode());
	m_UploadViewClientDetails.SetCode(m_pPrefs->GetUploadViewClientDetailsShortcutCode());
	m_UploadAddClientToFriends.SetCode(m_pPrefs->GetUploadAddClientToFriendsShortcutCode());
	m_UploadSendMessageClient.SetCode(m_pPrefs->GetUploadSendMessageClientShortcutCode());
	m_UploadViewClientFiles.SetCode(m_pPrefs->GetUploadViewClientFilesShortcutCode());
	m_ShareEditFileComments.SetCode(m_pPrefs->GetShareEditFileCommentsShortcutCode());
a270 4
		//shortcutsAltCheck.SetWindowText(GetResString(IDS_SHORTCUTS_ALT));
		//shortcutsCtrlCheck.SetWindowText(GetResString(IDS_SHORTCUTS_CTRL));
		//shortcutsShiftCheck.SetWindowText(GetResString(IDS_SHORTCUTS_SHIFT));
		//shortcutsWinCheck.SetWindowText(GetResString(IDS_SHORTCUTS_WIN));
d273 1
d277 1
a277 1
CKeyboardShortcut* CPPgShortcuts::GetKeyboardShortcutFromItem(HTREEITEM hItem)
d279 5
a283 36
	if (hItem == h_generalMinimizeWindowToTray)
		return &m_GeneralMinimizeWindowToTray;
	else if (hItem == h_generalShowServerWnd)
		return &m_GeneralShowServerWnd;
	else if (hItem == h_generalShowTransferWnd)
		return &m_GeneralShowTransferWnd;
	else if (hItem == h_generalShowSearchWnd)
		return &m_GeneralShowSearchWnd;
	else if (hItem == h_generalShowSharedFilesWnd)
		return &m_GeneralShowSharedFilesWnd;
	else if (hItem == h_generalShowChatWnd)
		return &m_GeneralShowChatWnd;
	else if (hItem == h_generalShowIRCWnd)
		return &m_GeneralShowIRCWnd;
	else if (hItem == h_generalShowStatisticsWnd)
		return &m_GeneralShowStatisticsWnd;
	else if (hItem == h_generalShowPreferencesWnd)
		return &m_GeneralShowPreferencesWnd;
	else if (hItem == h_downloadViewFileComments)
		return &m_DownloadViewFileComments;
	else if (hItem == h_downloadViewFileDetails)
		return &m_DownloadViewFileDetails;
	else if (hItem == h_downloadClearCompletedFiles)
		return &m_DownloadClearCompletedFiles;
	else if (hItem == h_uploadViewClientDetails)
		return &m_UploadViewClientDetails;
	else if (hItem == h_uploadAddClientToFriends)
		return &m_UploadAddClientToFriends;
	else if (hItem == h_uploadSendMessageClient)
		return &m_UploadSendMessageClient;
	else if (hItem == h_uploadViewClientFiles)
		return &m_UploadViewClientFiles;
	else if (hItem == h_shareEditFileComments)
		return &m_ShareEditFileComments;
	else
		return NULL;
d288 1
a288 2
	CKeyboardShortcut* pShortcut;
	pShortcut = GetKeyboardShortcutFromItem(hItem);
d290 1
a290 1
	if (pShortcut != NULL)
d292 6
a297 6
		shortcutsEnable	= pShortcut->IsEnabled();
		shortcutsAlt	= pShortcut->IsAlt();
		shortcutsCtrl	= pShortcut->IsCtrl();
		shortcutsShift	= pShortcut->IsShift();
		shortcutsWin	= pShortcut->IsWin();
		shortcutsKeyCombo.SetCurSel(GetKeyComboIndexFromShortcutKey(pShortcut->GetKey()));
d305 1
a305 2
	CKeyboardShortcut* pShortcut;
	pShortcut = GetKeyboardShortcutFromItem(hItem);
d307 1
a307 1
	if (pShortcut != NULL)
d310 6
a315 6
		pShortcut->SetEnabled(shortcutsEnable);
		pShortcut->SetAlt(shortcutsAlt);
		pShortcut->SetCtrl(shortcutsCtrl);
		pShortcut->SetShift(shortcutsShift);
		pShortcut->SetWin(shortcutsWin);
		pShortcut->SetKey(GetShortcutKeyFromKeyComboIndex(shortcutsKeyCombo.GetCurSel()));
d321 1
a321 1
	if (cKey == VK_RETURN)	// Enter key
d323 1
a323 1
	else if (cKey == VK_SPACE) // Space key
d325 16
d342 1
a342 1
		return (cKey - VK_F1) + 2;
d344 1
a344 1
		return (cKey - 'A') + 14;
d346 1
a346 1
		return (cKey - '0') + 40;
d356 1
a356 1
	if (iIndex == 0)	// Enter key
d358 1
a358 1
	else if (iIndex == 1) // Space key
d360 22
a381 6
	else if ((iIndex >= 2) && (iIndex <= 13)) // function keys
		return VK_F1 + (iIndex - 2);
	else if ((iIndex >= 14) && (iIndex <= 39)) // letter keys
		return 'A' + (iIndex - 14);
	else if ((iIndex >= 40) && (iIndex <= 49)) // number keys
		return '0' + (iIndex - 40);
a399 11
// This function will prevent the user to collapse root items
void CPPgShortcuts::OnTvnItemexpandingShortcutsTree(NMHDR *pNMHDR, LRESULT *pResult)
{
	LPNMTREEVIEW pNMTreeView = reinterpret_cast<LPNMTREEVIEW>(pNMHDR);

	if (pNMTreeView->action == 1)	// action = 1 = collapsing, action = 2 = expanding
		*pResult = TRUE;
	else
		*pResult = 0;
}

d404 2
a405 2

	if (IsRootItem(pNMTreeView->itemNew.hItem))
d410 1
a410 1
		*pResult = 0;
@

