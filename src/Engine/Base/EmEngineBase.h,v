head	1.3;
access;
symbols
	PublicRelease_1_2e:1.3
	Interim_Release_1-2e_RC1:1.3
	PublicRelease_1_2d:1.3
	Interim_Release_1-2d_RC1:1.3
	Interim_Release_1-2d_beta1:1.3
	PublicRelease_1_2c:1.3
	Interim_Release_1-2c_RC1:1.3
	Interim_Release_1-2c_beta1:1.3
	PublicRelease_1_2b:1.3
	Interim_Release_1-2b_RC1:1.3
	PublicRelease_1_2a:1.3
	Interim_Release_1-2a_RC1:1.3
	Interim_Release_1-2a_beta2:1.3
	Interim_Release_1-2a_beta1:1.3
	PublicRelease_1_2:1.3
	Interim_Release_1-2_RC1:1.3
	Interim_Release_1-2_beta1:1.3
	PublicRelease_1_1g:1.3
	Interim_Release_1-1g_RC3:1.3
	Interim_Release_1-1g_RC2:1.3
	Interim_Release_1-1g_RC1:1.3
	Interim_Release_1-1g_beta2:1.3
	Interim_Release_1-1g_beta1:1.3
	PublicRelease_1_1f:1.3
	Interim_Release_1-1f_RC1:1.3
	PublicRelease_1_1e:1.3
	Interim_Release_1-1e_RC2:1.3
	Interim_Release_1-1e_RC1:1.3
	Interim_Release_1-1e_beta1:1.3;
locks; strict;
comment	@ * @;


1.3
date	2005.04.16.00.04.59;	author kuchin;	state Exp;
branches;
next	1.2;

1.2
date	2005.04.08.14.16.35;	author kuchin;	state Exp;
branches;
next	1.1;

1.1
date	2005.04.08.11.09.35;	author kuchin;	state Exp;
branches;
next	;


desc
@@


1.3
log
@v2 - Xml events and other improvements
@
text
@// EmEngineBase.h: interface for the CEmEngineBase class.
//
//////////////////////////////////////////////////////////////////////

#pragma once


#include <vector>
#include <map>
#include <queue>

#include "../Other/Time.h"
#include "../Other/Loggable2.h"

// Client types
enum T_CLIENT_TYPE {
	T_CLIENT_PEER,
	T_CLIENT_SERVER,
	T_CLIENT_PEER_SERVER,
	T_CLIENT_WEB,
	T_CLIENT_XML
};

using namespace std;


#define PCVOID LPCVOID
#ifndef _countof
#	define _countof(string) (sizeof((string)) / sizeof((string)[0]))
#endif // _countof
#pragma warning (disable : 4200)
#pragma warning (disable : 4355)


// Queue priorities
enum EnumQueuePriority
{
	QUE_IMMEDIATE	= 0,
	QUE_HIGH		= 1,
	QUE_NORMAL		= 2,
	QUE_LOW			= 3
};
const UINT QUEUE_SIZE = 4;

class CTcpEngine;
class CTaskProcessor_Sockets;
struct CEmClient_Peer;

class CEmEngineBase : public CLoggable2
{
public:
	CEmEngineBase();
	virtual ~CEmEngineBase() { Uninit(); }

	virtual bool Init();
	virtual void Uninit();
	virtual void UninitMiddle(){ }
	virtual void UninitFinal(){ }

	inline bool IsShuttingDown() 
	{
		return WAIT_TIMEOUT != WaitForSingleObject(m_hStop, 0); 
	}

	virtual void ProcessSocketsTimeout(){ }

	virtual bool AlertOnErrors() const	{ return true; }

	__declspec(property(get=_GetSocketsProcessor))	CTaskProcessor_Sockets&	Sockets;
	CTaskProcessor_Sockets&	_GetSocketsProcessor()	const { if(!m_pSocketsProcessor)throw;return *m_pSocketsProcessor; }

	virtual CTcpEngine*		GetTcpEngine()			const { if(!m_pTcpEngine) throw;	return reinterpret_cast<CTcpEngine*>(m_pTcpEngine); }

protected:
	CTaskProcessor_Sockets*	m_pSocketsProcessor;
	CTcpEngine*				m_pTcpEngine;
	HANDLE					m_hStop; // termination event
};
@


1.2
log
@v2 - more abstraction + logic
@
text
@d77 1
a77 1
	HANDLE	m_hStop; // termination event
@


1.1
log
@v2 - increased level of abstraction + minor improvements
@
text
@d8 27
d45 1
d47 1
d70 3
a72 1
	CTaskProcessor_Sockets&	_GetSocketsProcessor()	{ if(!m_pSocketsProcessor)throw;return *m_pSocketsProcessor; }
d76 1
d78 1
a78 1
};@

