head	1.32;
access;
symbols
	Interim_Release_1i_beta1:1.30
	PublicRelease_1h:1.26
	Interim_Release_1h_rc2:1.26
	Interim_Release_1h_RC1:1.25
	Interim_Release_1h_beta2:1.25
	Interim_Release_1h_beta1_now:1.25
	Interim_Release_1h_beta1:1.25
	PublicRelease_1g:1.24
	Interim_Release_1g_RC6_Final:1.24
	Interim_Release_1g_RC6:1.23
	Interim_Release_1g_RC5:1.23
	Interim_Release_1g_RC4:1.23
	Interim_Release_1g_RC3:1.23
	Interim_Release_1g_beta2:1.19
	Interim_Release_1g_beta1:1.19
	Interim_Release_1f_RC4:1.17
	Interim_Release_1f_RC3:1.16
	Interim_Release_1f_RC2:1.14
	Interim_Release_1f_RC:1.14
	Interim_Release_1f_beta2:1.14
	Interim_Release_1f_beta1:1.13
	PublicRelease_1e:1.11
	Interim_Release_1e_RC2:1.11
	Interim_Release_1e_RC:1.11
	Interim_Release_1e_beta3:1.9
	Interim_Release_1e_beta2:1.9
	Interim_Release_1e_beta2_before_kuchin:1.9
	Interim_Release_1e_beta1:1.9
	PublicRelease_1c:1.8
	featurestest:1.8.0.4
	Interim_Release_1c_RC:1.8
	Interim_Release_1c_beta2:1.8
	Interim_Release_1c_beta1:1.8
	threaded_downloadqueue:1.8.0.2
	PublicRelease_1b:1.8
	Interim_Release_1b_beta2:1.8
	Interim_Release_1b_beta1:1.7
	proxydeadlake:1.7.0.4
	PublicRelease_1a:1.7
	Interim_Release_1a_beta2:1.7
	BerkeleyDb:1.7.0.2
	Interim_Release_1a_beta1:1.7
	PublicRelease_1:1.7
	goldfish:1.7
	eMulePlus_1_RC2:1.6
	eMulePlus_26b_1RC1:1.6
	PreRelease_26b_i0e:1.6
	before_26d_merge:1.6
	Interim_Release_26b_i0d:1.5
	Interim_Release_26b_i0c:1.5
	Interim_Release_26b_i0b:1.5
	Interim_Release_26b_i0a:1.5
	systraydlg:1.3.0.6
	plus26based:1.3.0.4
	Interim_Release_25b_i0b:1.3
	Proxy_Dev:1.3
	Interim_Release_25b_i0a:1.3.2.1
	proxytest:1.3.2.1.0.2
	official_sockets:1.3.0.2
	eMulePlus_024b_5b:1.1.0.2;
locks; strict;
comment	@// @;


1.32
date	2003.10.10.04.12.21;	author dongato;	state dead;
branches;
next	1.31;

1.31
date	2003.10.05.17.53.56;	author morevit;	state Exp;
branches;
next	1.30;

1.30
date	2003.10.03.13.04.36;	author morevit;	state Exp;
branches;
next	1.29;

1.29
date	2003.09.24.16.47.56;	author morevit;	state Exp;
branches;
next	1.28;

1.28
date	2003.09.20.15.39.30;	author morevit;	state Exp;
branches;
next	1.27;

1.27
date	2003.09.19.00.13.37;	author morevit;	state Exp;
branches;
next	1.26;

1.26
date	2003.09.12.16.05.53;	author dongato;	state Exp;
branches;
next	1.25;

1.25
date	2003.07.30.00.35.15;	author netwolf1;	state Exp;
branches;
next	1.24;

1.24
date	2003.07.23.22.05.22;	author netwolf1;	state Exp;
branches;
next	1.23;

1.23
date	2003.06.30.16.17.39;	author eklmn;	state Exp;
branches;
next	1.22;

1.22
date	2003.06.19.18.22.24;	author eklmn;	state Exp;
branches;
next	1.21;

1.21
date	2003.06.16.04.44.44;	author partyckip;	state Exp;
branches;
next	1.20;

1.20
date	2003.06.15.09.10.04;	author partyckip;	state Exp;
branches;
next	1.19;

1.19
date	2003.05.30.17.11.45;	author syrus77;	state Exp;
branches;
next	1.18;

1.18
date	2003.05.27.23.43.12;	author netwolf1;	state Exp;
branches;
next	1.17;

1.17
date	2003.05.25.14.30.19;	author syrus77;	state Exp;
branches;
next	1.16;

1.16
date	2003.05.16.19.58.46;	author netwolf1;	state Exp;
branches;
next	1.15;

1.15
date	2003.05.15.22.03.54;	author syrus77;	state Exp;
branches;
next	1.14;

1.14
date	2003.05.08.21.01.18;	author syrus77;	state Exp;
branches;
next	1.13;

1.13
date	2003.05.04.14.13.24;	author kuchin;	state Exp;
branches;
next	1.12;

1.12
date	2003.05.04.10.05.33;	author kuchin;	state Exp;
branches;
next	1.11;

1.11
date	2003.04.26.18.16.23;	author lord_kiron;	state Exp;
branches;
next	1.10;

1.10
date	2003.04.26.17.39.15;	author lord_kiron;	state Exp;
branches;
next	1.9;

1.9
date	2003.03.30.12.10.20;	author moosetea;	state Exp;
branches;
next	1.8;

1.8
date	2003.03.08.12.09.42;	author recdvst;	state Exp;
branches
	1.8.4.1;
next	1.7;

1.7
date	2003.02.20.14.29.00;	author dongato;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.16.22.01.46;	author lord_kiron;	state Exp;
branches;
next	1.5;

1.5
date	2003.02.10.19.24.48;	author cax2;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.09.18.39.41;	author kuchin;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.24.22.07.48;	author maverick65;	state Exp;
branches
	1.3.2.1
	1.3.4.1;
next	1.2;

1.2
date	2003.01.23.12.49.06;	author cax2;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.21.18.21.17;	author cax2;	state Exp;
branches;
next	;

1.3.2.1
date	2003.01.28.16.54.05;	author cax2;	state Exp;
branches;
next	;

1.3.4.1
date	2003.02.05.01.58.41;	author obaldin;	state Exp;
branches;
next	;

1.8.4.1
date	2003.03.23.06.22.02;	author recdvst;	state Exp;
branches;
next	1.8.4.2;

1.8.4.2
date	2003.03.23.09.12.47;	author recdvst;	state Exp;
branches;
next	1.8.4.3;

1.8.4.3
date	2003.03.24.09.39.42;	author recdvst;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Removed old details code, added more keyboard shortcuts (now with only Ctrl instead of all three keys)
@
text
@//this file is part of eMule
//Copyright (C)2002 Merkur ( merkur-@@users.sourceforge.net / http://www.emule-project.net )
//
//This program is free software; you can redistribute it and/or
//modify it under the terms of the GNU General Public License
//as published by the Free Software Foundation; either
//version 2 of the License, or (at your option) any later version.
//
//This program is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//GNU General Public License for more details.
//
//You should have received a copy of the GNU General Public License
//along with this program; if not, write to the Free Software
//Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

// FileDetailDialog.cpp : implementation file
//

#include "stdafx.h"
#include "emule.h"
#include "FileDetailDialog.h"
#include "otherfunctions.h"
#include "FileInfoDialog.h"
#include "commentdialoglst.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif



// CFileDetailDialog dialog

IMPLEMENT_DYNAMIC(CFileDetailDialog, CDialog)
CFileDetailDialog::CFileDetailDialog(CPartFile* file)
	: CDialog(CFileDetailDialog::IDD, 0)
{
	m_file = file;
}

CFileDetailDialog::~CFileDetailDialog()
{
}

void CFileDetailDialog::OnTimer(UINT nIDEvent) {
	UpdateData();
}

void CFileDetailDialog::DoDataExchange(CDataExchange* pDX)
{
	CDialog::DoDataExchange(pDX);
}

BOOL CFileDetailDialog::OnInitDialog(){
	CDialog::OnInitDialog();
	Localize();
	m_timer=SetTimer(301, 5000, 0);
	UpdateData();

	return true;
}

void CFileDetailDialog::UpdateData(){
	CString bufferS;

	GetDlgItem(IDC_FNAME)->SetWindowText(MakeStringEscaped(m_file->GetFileName()));
	GetDlgItem(IDC_METFILE)->SetWindowText(m_file->GetFullName());
    GetDlgItem(IDC_FILENAME)->GetWindowText(bufferS);
	if (bufferS.GetLength()<3)
		GetDlgItem(IDC_FILENAME)->SetWindowText(m_file->GetFileName());
	GetDlgItem(IDC_OUTFOLDER)->SetWindowText(m_file->GetOutputDir() + CString("\\"));

	GetDlgItem(IDC_FHASH)->SetWindowText(EncodeBase16(m_file->GetFileHash(), 16));

	GetDlgItem(IDC_FSIZE)->SetWindowText(CastItoXBytes(m_file->GetFileSize()));

	GetDlgItem(IDC_PFSTATUS)->SetWindowText(m_file->GetPartfileStatus());
	
	bufferS.Format(_T("%i(%i)"),m_file->GetPartCount(),m_file->GetHashCount());
	GetDlgItem(IDC_PARTCOUNT)->SetWindowText(bufferS);

	GetDlgItem(IDC_TRANSFERRED)->SetWindowText(CastItoXBytes(m_file->GetTransferred()));

	bufferS.Format(GetResString(IDS_FD_STATS),CastItoXBytes(m_file->GetLostDueToCorruption()), CastItoXBytes(m_file->GetGainDueToCompression()), m_file->TotalPacketsSavedDueToICH() );
	GetDlgItem(IDC_FD_STATS)->SetWindowText(bufferS);

	GetDlgItem(IDC_COMPLSIZE)->SetWindowText(CastItoXBytes(m_file->GetCompletedSize()));

	if ( m_file->GetPercentCompleted() >= 0.f )
	{
		bufferS.Format(_T("%.2f "),m_file->GetPercentCompleted());
	}
	else
	{
		bufferS.Format(_T("?"));
	}
	GetDlgItem(IDC_PROCCOMPL)->SetWindowText(bufferS+GetResString(IDS_PROCDONE));

	if ( m_file->GetDataRate() != (uint32)-1 )
	{
		bufferS.Format(_T("%.2f %s"),(float)m_file->GetDataRate()/1024,GetResString(IDS_KBYTESEC));
	}
	else
	{
		bufferS.Format(_T("? %s"),GetResString(IDS_KBYTESEC));
	}
	GetDlgItem(IDC_DATARATE)->SetWindowText(bufferS);

	bufferS.Format(_T("%i"),m_file->GetSourceCount());
	GetDlgItem(IDC_SOURCECOUNT)->SetWindowText(bufferS);
	bufferS.Format(_T("%i"),m_file->GetTransferringSrcCount());
	GetDlgItem(IDC_SOURCECOUNT2)->SetWindowText(bufferS);

	float partspercent = 0.f;
	if ( m_file->GetPartCount() > 0.f )
	{
		partspercent	=	(float) ((m_file->GetAvailablePartCount()*100)/ m_file->GetPartCount());
	}
	bufferS.Format(_T("%i (%.1f%%)"),m_file->GetAvailablePartCount(),partspercent);
	GetDlgItem(IDC_PARTAVAILABLE)->SetWindowText(bufferS);

	if (m_file->lastseencomplete==NULL) 
		bufferS.Format(GetResString(IDS_NEVER)); 
	else
		bufferS.Format( _T("%s"),m_file->LocalizeLastSeenComplete());

	GetDlgItem(IDC_LASTSEENCOMPL)->SetWindowText(bufferS);
	GetDlgItem(IDC_BUTTONRENAME)->EnableWindow((m_file->GetStatus() == PS_COMPLETE || m_file->GetStatus() == PS_COMPLETING) ? false:true);//add by CML 
	GetDlgItem(IDC_FILEINFO)->EnableWindow(m_file->IsMovie()); // added by quekky
	GetDlgItem(IDC_BUTTONSTRIP)->EnableWindow((m_file->GetStatus() == PS_COMPLETE || m_file->GetStatus() == PS_COMPLETING) ? false:true);	//	netwolf 16.05.03
	GetDlgItem(IDC_TAKEOVER)->EnableWindow((m_file->GetStatus() == PS_COMPLETE || m_file->GetStatus() == PS_COMPLETING) ? false:true);	//	netwolf 16.05.03

	//SyruS last progress info
	if (m_file->GetTransferred()==0)
		bufferS.Format(_T("%s"), GetResString(IDS_NEVER));
	else
		bufferS.Format(_T("%s"), m_file->LocalizeLastDownTransfer());
	GetDlgItem(IDC_LASTPROGRESS)->SetWindowText(bufferS);
}

void CFileDetailDialog::OnDestroy() {
	 if (m_timer) KillTimer(m_timer);
}

BEGIN_MESSAGE_MAP(CFileDetailDialog, CDialog)
	ON_WM_TIMER()
	ON_WM_DESTROY()
	ON_BN_CLICKED(IDC_BUTTONSTRIP, OnBnClickedButtonStrip)
	ON_BN_CLICKED(IDC_TAKEOVER, TakeOver)	
	ON_BN_CLICKED(IDC_FILEINFO, OnBnClickedFileinfo)
	ON_NOTIFY(LVN_COLUMNCLICK, IDC_LISTCTRLFILENAMES, OnLvnColumnclick)
	ON_NOTIFY(NM_DBLCLK, IDC_LISTCTRLFILENAMES, OnNMDblclkList)
	ON_NOTIFY(NM_RCLICK, IDC_LISTCTRLFILENAMES, OnNMRclickList)
	ON_BN_CLICKED(IDC_CMTBT, OnBnClickedShowComment) //for comment
	ON_BN_CLICKED(IDC_BUTTONRENAME, Rename) // Added by Tarod [Juanjo]
END_MESSAGE_MAP()


// CFileDetailDialog message handlers

void CFileDetailDialog::Localize(){
	GetDlgItem(IDC_FD_X0)->SetWindowText(GetResString(IDS_FD_GENERAL));
	GetDlgItem(IDC_FD_X1)->SetWindowText(GetResString(IDS_FD_NAME));
	GetDlgItem(IDC_FD_X2)->SetWindowText(GetResString(IDS_FD_MET));
	GetDlgItem(IDC_FD_X3)->SetWindowText(GetResString(IDS_FD_HASH));
	GetDlgItem(IDC_FD_X4)->SetWindowText(GetResString(IDS_FD_SIZE));
	GetDlgItem(IDC_FD_X5)->SetWindowText(GetResString(IDS_FD_STATUS));
	GetDlgItem(IDC_FD_X6)->SetWindowText(GetResString(IDS_FD_TRANSFER));
	GetDlgItem(IDC_FD_X7)->SetWindowText(GetResString(IDS_FD_SOURCES));
	GetDlgItem(IDC_FD_X8)->SetWindowText(GetResString(IDS_FD_OUTPUT)); // output folder
	GetDlgItem(IDC_FD_X10)->SetWindowText(GetResString(IDS_FD_TRANSI));
	GetDlgItem(IDC_FD_X9)->SetWindowText(GetResString(IDS_FD_PARTS));
	GetDlgItem(IDC_FD_X14)->SetWindowText(GetResString(IDS_FD_TRANS));
	GetDlgItem(IDC_FD_X12)->SetWindowText(GetResString(IDS_FD_COMPSIZE));
	GetDlgItem(IDC_FD_X13)->SetWindowText(GetResString(IDS_FD_DATARATE));
	GetDlgItem(IDC_FD_X11)->SetWindowText(GetResString(IDS_AVAIL)+_T(":"));
	GetDlgItem(IDC_FD_X15)->SetWindowText(GetResString(IDS_LASTSEENCOMPL));
	GetDlgItem(IDC_FD_X16)->SetWindowText(GetResString(IDS_FD_LASTCHANGE));	//SyruS last progress info
	GetDlgItem(IDC_TAKEOVER)->SetWindowText(GetResString(IDS_TAKEOVER));
	GetDlgItem(IDC_BUTTONSTRIP)->SetWindowText(GetResString(IDS_CLEANUP));
	GetDlgItem(IDC_BUTTONRENAME)->SetWindowText(GetResString(IDS_RENAME));
	GetDlgItem(IDC_FD_SN)->SetWindowText(GetResString(IDS_SOURCENAMES));
	GetDlgItem(IDC_FILEINFO)->SetWindowText(GetResString(IDS_FILEINFO));
	GetDlgItem(IDC_CMTBT)->SetWindowText(GetResString(IDS_CMT_SHOWALL));//For Comment 		

	GetDlgItem(IDOK)->SetWindowText(GetResString(IDS_FD_CLOSE));
	SetWindowText(GetResString(IDS_FD_TITLE));
	FillSourcenameList();
}

// by Juanjo
void CFileDetailDialog::FillSourcenameList() {

	CUpDownClient* cur_src;
	CListCtrl* pmyListCtrl; 
	LVFINDINFO info; 
	info.flags = LVFI_STRING; 
	int itempos; 
	int namecount;

	CString nameCountStr;
	pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES); 
	if (pmyListCtrl->GetHeaderCtrl()->GetItemCount() < 2) {
		pmyListCtrl->DeleteColumn(0); 
		pmyListCtrl->InsertColumn(0, GetResString(IDS_DL_FILENAME), LVCFMT_LEFT, 340, -1); 
		pmyListCtrl->InsertColumn(1, GetResString(IDS_DL_SOURCES), LVCFMT_LEFT, 60, 1); 
	}
	
	//v- eklmn: bugfix(16): don't show empty string in FileDetails
	CString strFileName; 
	POSITION pos1, pos2;
	pmyListCtrl->DeleteAllItems(); 
	for (int sl=0;sl<SOURCESSLOTS;sl++) 
		if (!m_file->m_srcLists[sl].IsEmpty())
			for (pos1 = m_file->m_srcLists[sl].GetHeadPosition();( pos2 = pos1 ) != NULL;) 
			{
				m_file->m_srcLists[sl].GetNext(pos1);
				cur_src = m_file->m_srcLists[sl].GetAt(pos2);

				strFileName = cur_src->GetClientFilename(); 
				if (strFileName.GetLength() != 0) { 
					info.psz = strFileName;
					if ((itempos=pmyListCtrl->FindItem(&info, -1)) == -1) { 
						pmyListCtrl->InsertItem(0, strFileName); 
						pmyListCtrl->SetItemText(0, 1, _T("1")); 
						pmyListCtrl->SetItemData(0, 1); 
					} 
					else { 
						namecount = _tstoi(pmyListCtrl->GetItemText(itempos, 1)); 
						namecount ++; 
						nameCountStr.Format(_T("%i"), namecount); 
						pmyListCtrl->SetItemText(itempos, 1, nameCountStr.GetString());
						pmyListCtrl->SetItemData(itempos, namecount); 
					} 
					pmyListCtrl->SortItems(CompareListNameItems, 11); 
					m_bSortAscending[0] =true;
					m_bSortAscending[1] =false;
				} 
			} 
	//^- eklmn: bugfix(16): don't show empty string in FileDetails
 }
 // End by Juanjo
 
void CFileDetailDialog::TakeOver() {
   CListCtrl* pmyListCtrl; 
   int itemPosition; 

   pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES);
   if (pmyListCtrl->GetSelectedCount() > 0) {
      POSITION pos = pmyListCtrl->GetFirstSelectedItemPosition(); 
      itemPosition = pmyListCtrl->GetNextSelectedItem(pos); 
	  GetDlgItem(IDC_FILENAME)->SetWindowText(pmyListCtrl->GetItemText(itemPosition,0));
   } 
}

void CFileDetailDialog::OnBnClickedButtonStrip() {
	//SyruS: cleanup
	CString filename("");
	GetDlgItem(IDC_FILENAME)->SendMessage(EM_REPLACESEL, (WPARAM) false, (LPARAM) filename.GetBuffer());	//SyruS: delete seleted text before cleanup
	GetDlgItem(IDC_FILENAME)->GetWindowText(filename);
	GetDlgItem(IDC_FILENAME)->SetWindowText(CleanupFilename(filename));
}

// added by quekky
void CFileDetailDialog::OnBnClickedFileinfo()
{
	CFileInfoDialog dialog(m_file);
	dialog.DoModal();
}

void CFileDetailDialog::OnLvnColumnclick(NMHDR *pNMHDR, LRESULT *pResult)
{
	LPNMLISTVIEW pNMLV = reinterpret_cast<LPNMLISTVIEW>(pNMHDR);
	
	m_bSortAscending[pNMLV->iSubItem] = !m_bSortAscending[pNMLV->iSubItem];
	//SetSortArrow(pNMLV->iSubItem, m_bSortAscending[pNMLV->iSubItem]);

	CListCtrl* pmyListCtrl; 
	pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES);

	pmyListCtrl->SortItems(&CompareListNameItems,pNMLV->iSubItem+((m_bSortAscending[pNMLV->iSubItem])? 0:10));

	*pResult = 0;
}

int CALLBACK CFileDetailDialog::CompareListNameItems(LPARAM lParam1, LPARAM lParam2, LPARAM lParamSort){ 
	switch (lParamSort){
		case 1: return (lParam1 - lParam2); break;
		case 11: return (lParam2 - lParam1); break;
		
		default: return 0;
	}
} 

void CFileDetailDialog::OnNMDblclkList(NMHDR *pNMHDR, LRESULT *pResult)
{
	TakeOver();
	*pResult = 0;
}

void CFileDetailDialog::OnNMRclickList(NMHDR *pNMHDR, LRESULT *pResult)
{
	CListCtrl* pmyListCtrl; 
	pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES);
	POINT point;
	::GetCursorPos(&point);
	CTitleMenu	popupMenu;


	UINT flag;
	flag=MF_STRING;
	if (pmyListCtrl->GetSelectionMark() == (-1)) flag=MF_GRAYED;

	popupMenu.CreatePopupMenu();
	popupMenu.AppendMenu(flag,MP_MESSAGE, GetResString(IDS_TAKEOVER));
	popupMenu.AppendMenu(MF_STRING,MP_RESTORE, GetResString(IDS_SV_UPDATE));
	popupMenu.TrackPopupMenu(TPM_LEFTALIGN |TPM_RIGHTBUTTON, point.x, point.y, this);
	popupMenu.DestroyMenu();

	*pResult = 0;
}

BOOL CFileDetailDialog::OnCommand(WPARAM wParam,LPARAM lParam ){
	CListCtrl* pmyListCtrl; 
	pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES);
	if (pmyListCtrl->GetSelectionMark() != (-1)){

		switch (wParam)
		{
			case MP_MESSAGE:
			{
				TakeOver();
				return true;
			}
			case MP_RESTORE: {
				FillSourcenameList();
				return true;
			}
		}
	}
	if (wParam==2)
	{
		CDialog::OnOK();
		return TRUE;
	}

	return CDialog::OnCommand(wParam, lParam);
}

//For Comment// 
void CFileDetailDialog::OnBnClickedShowComment() 
{ 
   CCommentDialogLst dialog(m_file); 
   dialog.DoModal(); 
} 
//End for  comment// 

void CFileDetailDialog::Rename() 
{ 
   CString NewFileName; 
   GetDlgItem(IDC_FILENAME)->GetWindowText(NewFileName);

   m_file->SetFileName(NewFileName.GetBuffer()); 
   m_file->SavePartFile(); 

   GetDlgItem(IDC_FNAME)->SetWindowText(m_file->GetFileName());
   GetDlgItem(IDC_METFILE)->SetWindowText(m_file->GetFullName());
   GetDlgItem(IDC_FILENAME)->SetWindowText(m_file->GetFileName());

   g_eMuleApp.m_pSharedFilesList->Reload(false);
} 
@


1.31
log
@Formatting, comments, and name changes.
@
text
@@


1.30
log
@Formatting, comments, and name changes.
@
text
@d218 2
a219 2
		if (!m_file->srclists[sl].IsEmpty())
			for (pos1 = m_file->srclists[sl].GetHeadPosition();( pos2 = pos1 ) != NULL;) 
d221 2
a222 2
				m_file->srclists[sl].GetNext(pos1);
				cur_src = m_file->srclists[sl].GetAt(pos2);
@


1.29
log
@Formatting, comments, and name changes.
@
text
@d240 2
a241 2
					m_SortAscending[0] =true;
					m_SortAscending[1] =false;
d279 2
a280 2
	m_SortAscending[pNMLV->iSubItem] = !m_SortAscending[pNMLV->iSubItem];
	//SetSortArrow(pNMLV->iSubItem, m_SortAscending[pNMLV->iSubItem]);
d285 1
a285 1
	pmyListCtrl->SortItems(&CompareListNameItems,pNMLV->iSubItem+((m_SortAscending[pNMLV->iSubItem])? 0:10));
@


1.28
log
@More name changes, reinstated CMuleCtrlItem class, moved srcsarevisible from CPartFile to CMuleCtrlItem (where it belongs), added "Show Full Status Icons" and "Show Gray Paused" features with corresponding preferences, modified "SmartOpen" code to make it sticky and to make it work with sources with changing states.
@
text
@d129 1
a129 1
		bufferS.Format( _T("%s"),m_file->localelastseencomplete());
d141 1
a141 1
		bufferS.Format(_T("%s"), m_file->localelastdowntransfer());
@


1.27
log
@First batch of the threatened name changes. Shouldn't be any logic changes here.
@
text
@d374 1
a374 1
   theApp.sharedfiles->Reload(false);
@


1.26
log
@Fixed HTMLExport, update SharedList when name is changed, minor fix (not propper) to FileTypeIcon disable in search.
@
text
@d86 1
a86 1
	GetDlgItem(IDC_TRANSFERED)->SetWindowText(CastItoXBytes(m_file->GetTransfered()));
d103 1
a103 1
	if ( m_file->GetDatarate() != (uint32)-1 )
d105 1
a105 1
		bufferS.Format(_T("%.2f %s"),(float)m_file->GetDatarate()/1024,GetResString(IDS_KBYTESEC));
d115 1
a115 1
	bufferS.Format(_T("%i"),m_file->GetTransferingSrcCount());
d138 1
a138 1
	if (m_file->GetTransfered()==0)
@


1.25
log
@CHANGE: now showing "never" instead of "unknown" for Last Reception [Andrerib]
@
text
@d373 2
@


1.24
log
@CHANGE: now showing "never" instead of "unknown" in Last Seen Complete column [Andrerib]
@
text
@d139 1
a139 1
		bufferS.Format(_T("%s"), GetResString(IDS_UNKNOWN));
@


1.23
log
@fixed possible exception during a scan of srclist
@
text
@d126 3
a128 1
	if (m_file->lastseencomplete==NULL) bufferS.Format(GetResString(IDS_UNKNOWN)); else
a129 1
		//bufferS.Format( "%s",m_file->lastseencomplete.Format( "%A, %x, %X"));
@


1.22
log
@don't show empty string in FileDetails
@
text
@a196 1
	POSITION pos;
d214 1
d218 5
a222 2
			for (pos = m_file->srclists[sl].GetHeadPosition(); pos != 0; m_file->srclists[sl].GetNext(pos)) {
				cur_src = m_file->srclists[sl].GetAt(pos);
@


1.21
log
@unicode cleanup
@
text
@d194 1
a195 42
   // by Juanjo
   POSITION pos1,pos2; 
   CUpDownClient* cur_src; 
   CListCtrl* pmyListCtrl; 
   LVFINDINFO info; 
   info.flags = LVFI_STRING; 
   int itempos; 
   int namecount; 
   
   CString nameCountStr; 
   pmyListCtrl = (CListCtrl*)GetDlgItem(IDC_LISTCTRLFILENAMES); 
   if (pmyListCtrl->GetHeaderCtrl()->GetItemCount() < 2) { 
      pmyListCtrl->DeleteColumn(0); 
	  pmyListCtrl->InsertColumn(0, GetResString(IDS_DL_FILENAME), LVCFMT_LEFT, 340, -1); 
	  pmyListCtrl->InsertColumn(1, GetResString(IDS_DL_SOURCES), LVCFMT_LEFT, 60, 1); 
   }
   
   CString strText; 
   pmyListCtrl->DeleteAllItems(); 
   for (int sl=0;sl<SOURCESSLOTS;sl++) if (!m_file->srclists[sl].IsEmpty())
   for (pos1 = m_file->srclists[sl].GetHeadPosition(); (pos2 = pos1) != NULL;) { 
      m_file->srclists[sl].GetNext(pos1); 
      cur_src = m_file->srclists[sl].GetAt(pos2); 
      info.psz = cur_src->GetClientFilename(); 
      if (info.psz != 0) { 
         if ((itempos=pmyListCtrl->FindItem(&info, -1)) == -1) { 
            pmyListCtrl->InsertItem(0, cur_src->GetClientFilename()); 
            pmyListCtrl->SetItemText(0, 1, _T("1")); 
            pmyListCtrl->SetItemData(0, 1); 
         } else { 
            namecount = _tstoi(pmyListCtrl->GetItemText(itempos, 1)); 
            namecount ++; 
            nameCountStr.Format(_T("%i"), namecount); 
            pmyListCtrl->SetItemText(itempos, 1, nameCountStr.GetString()); 
            pmyListCtrl->SetItemData(itempos, namecount); 
         } 
        pmyListCtrl->SortItems(CompareListNameItems, 11); 
		m_SortAscending[0] =true;m_SortAscending[1] =false;
      } 
   } 
   // End by Juanjo
}
d197 47
@


1.20
log
@unicode cleanup
@
text
@d83 1
a83 1
	bufferS.Format("%i(%i)",m_file->GetPartCount(),m_file->GetHashCount());
d95 1
a95 1
		bufferS.Format("%.2f ",m_file->GetPercentCompleted());
d99 1
a99 1
		bufferS.Format("?");
d105 1
a105 1
		bufferS.Format("%.2f %s",(float)m_file->GetDatarate()/1024,GetResString(IDS_KBYTESEC));
d109 1
a109 1
		bufferS.Format("? %s",GetResString(IDS_KBYTESEC));
d113 1
a113 1
	bufferS.Format("%i",m_file->GetSourceCount());
d115 1
a115 1
	bufferS.Format("%i",m_file->GetTransferingSrcCount());
d123 1
a123 1
	bufferS.Format("%i (%.1f%%)",m_file->GetAvailablePartCount(),partspercent);
d127 1
a127 1
		bufferS.Format( "%s",m_file->localelastseencomplete());
d138 1
a138 1
		bufferS.Format("%s", GetResString(IDS_UNKNOWN));
d140 1
a140 1
		bufferS.Format("%s", m_file->localelastdowntransfer());
d179 1
a179 1
	GetDlgItem(IDC_FD_X11)->SetWindowText(GetResString(IDS_AVAIL)+":");
d222 1
a222 1
            pmyListCtrl->SetItemText(0, 1, "1"); 
d227 1
a227 1
            nameCountStr.Format("%i", namecount); 
@


1.19
log
@added "last reception" to filedetail-dialog and infolist [SyruS]
@
text
@d225 1
a225 1
            namecount = atoi(pmyListCtrl->GetItemText(itempos, 1)); 
@


1.18
log
@localized 'Output folder' in filedetails dialog
@
text
@d126 1
a126 1
	if (m_file->lastseencomplete==NULL) bufferS.Format(GetResString(IDS_UNKNOWN).MakeLower()); else
d135 7
d181 1
@


1.17
log
@SyruS: the selected text will be deleted if u click on cleanup
@
text
@d166 1
@


1.16
log
@little filedetails buttons refinement (only Show comments is always available now)
@
text
@d243 2
a244 1
	CString filename;
@


1.15
log
@SyruS: customizable cleanup of filenames
@
text
@d133 2
@


1.14
log
@little better cleanup
@
text
@d240 2
a241 3
	CString filename,tempStr;
	char c;

d243 1
a243 132
	
	// Replace Space-holders with Spaces
	filename.Replace("_"," ");
	filename.Replace("%20"," ");
	//SyruS: replacements for jigle
	filename.Replace("+"," ");
	filename.Replace("%28","(");
	filename.Replace("%29",")");
	filename.Replace("%5B","[");
	filename.Replace("%5D","]");
	filename.Replace("%7B","{");
	filename.Replace("%7D","}");

	// Barry - Some additional formatting
	filename.MakeLower();
	filename.Replace("sharereactor", "");
	filename.Replace("deviance", "");
	filename.Replace("-ftv", "");
	filename.Replace("flt", "");
	//SyruS: additional cleanup
	// invalid for filenames
	filename.Replace("\\", "");
	filename.Replace("\"", "");
	filename.Replace("/", "");
	filename.Replace(":", "");
	filename.Replace("*", "");
	filename.Replace("?", "");
	filename.Replace("<", "");
	filename.Replace(">", "");
	filename.Replace("|", "");
	// other (un)common nonsense (u can use dots here!)
	filename.Replace("=", "");
	filename.Replace("^", "");
	filename.Replace("§", "");
	filename.Replace("~", "");
	filename.Replace("!", "");
	filename.Replace("http", "");
	filename.Replace("www.", "");
	filename.Replace(".com", "");
	filename.Replace("sharelive", "");
	filename.Replace("filedonkey", "");
	filename.Replace("saugstube", "");
	filename.Replace("eselfilme", "");
	filename.Replace("eseldownloads", "");
	filename.Replace("emulemovies", "");
	filename.Replace("spanishare", "");
	filename.Replace("donkey-mania", "");
	filename.Replace("eselpsychos.de", "");
	filename.Replace("saughilfe.de", "");
	filename.Replace("goldesel.6x.to", "");
	filename.Replace("freedivx.org", "");
	filename.Replace("elitedivx", "");
	filename.Replace("filenexus", "");
	filename.Replace("ac3-guru", "");
	filename.Replace("goldesel.tk", "");

	//SyruS cuts off extension before further process
	CString extension("");
	int extpos = filename.ReverseFind('.');
	if( extpos >= 1 )
	{
		extension = filename.Right(filename.GetLength()-extpos);	//copy extension with dot
		extension.Replace(" ","");
		filename = filename.Left(extpos);	//cut to filename without dot
	}

	CString numbers("0123456789");		// numberchars where not to clear dots between
	CString special(" .,;-+#%&()[]{}");	// repeated chars get reduced to one and the following uppercased

	// Make leading Caps ...and more by SyruS
	if( filename.GetLength() > 0 )
	{
		tempStr=filename.GetAt(0);
		tempStr.MakeUpper();
		c = tempStr.GetAt(0);
		filename.SetAt(0, c);
		
		int maxpos, foundpos;
		for (int ix=0; ix <= filename.GetLength()-1; ix++)
		{
		    maxpos = filename.GetLength()-1; //may change caused by deletion of doubles!
		    if( filename.GetAt(ix) == '.' )
		    {
				//replace dot at beginning and end of filename
		   		if( ix == 0 || ix == maxpos )
			    filename.SetAt(ix, ' ');
				//replace dot only if not between 2 numbers (versions and dates)
			    else if( numbers.Find(filename.GetAt(ix-1)) < 0 || numbers.Find(filename.GetAt(ix+1)) < 0)
				    filename.SetAt(ix, ' ');
		    }

			foundpos = special.Find(filename.GetAt(ix));
			if( foundpos >= 0 && ix < maxpos )	// need a char at ix+1
			{
				if( foundpos == special.Find(filename.GetAt(ix+1)) )	//delete one doubled char
		    {
					filename.Delete(ix--);	//attention! ix has to be decremented after deletion!
				}
				else	//uppercase following char
			    {
				    tempStr=filename.GetAt(ix+1);
				    tempStr.MakeUpper();
				    c=tempStr.GetAt(0);
				    filename.SetAt(ix+1,c);
			    }
		    }
		}
	}
	filename.Trim();
	//special replacements which can't be done before or in loop
	//cause not knowing begin/end of word which is now uppercase/space ;)
	filename.Replace("Cd","CD");	//netwolf: personal favor; IMO that disc is called CD, not Cd :)
	filename.Replace("Shared By ", "");
	filename.Replace("Shared For ", "");
	filename.Replace("Found Via ", "");
	filename.Replace("Link By ", "");
	filename.Replace("Linked By ", "");
	filename.Replace("Powered By ", "");
	filename.Replace("Sponsored For ", "");
	//clear spaces inside brackets and then empty brackets
	filename.Replace("( ", "(");
	filename.Replace(" )", ")");
	filename.Replace("()", "");
	filename.Replace("[ ", "[");
	filename.Replace(" ]", "]");
	filename.Replace("[]", "");
	filename.Replace("{ ", "{");
	filename.Replace(" }", "}");
	filename.Replace("{}", "");
	filename.Append(extension);	//add precut extension again
	//&-bug in MakeStringEscaped: GetDlgItem(IDC_FILENAME)->SetWindowText(MakeStringEscaped(filename));
	GetDlgItem(IDC_FILENAME)->SetWindowText(filename); //&-bugfix2
@


1.13
log
@More netwolf's changes
@
text
@a244 1

d248 8
a255 1
	filename.Replace("+"," ");	//SyruS for Jigle
d263 1
a263 1
	//SyruS additional cleanup
d274 1
a274 1
	// other common nonsense (u can use dots here!)
a282 3
	filename.Replace("shared", "");
	filename.Replace("powered", "");
	filename.Replace("sponsored", "");
d290 1
d298 1
a298 1
	filename.Replace("southside", "");
d353 11
d373 1
a373 3
	filename.Replace("Cd","CD");	//netwolf: personal favor; IMO that disc is called CD, not Cd :)
	filename.Append(extension);	//SyruS adds precut extension again

@


1.12
log
@netwolf/SyruS/katsyonak changes - see changelog+
@
text
@a244 8
/*SyruS moved replacing of dots into forloop
	// Replace . with Spaces - except the last one (extention-dot)
	int extpos=filename.ReverseFind('.');
	if (extpos>=0) {
		filename.Replace('.',' ');
		filename.SetAt(extpos,'.');
	}
SyruS*/
d247 1
a247 1
	filename.Replace('_',' ');
d249 1
a256 3
	filename.Replace("[]", "");
	filename.Replace("()", "");
	filename.Replace("  ", " ");
d259 1
a259 1
	filename.Replace("\\", ""); //[edit: oops, one \ was missing]
d270 4
d292 3
a294 1
	filename.Replace("&&","&");		//netwolf: otherwise & becomes &&
d301 3
a303 5
	//SyruS copy and cleanup extension
	extension = filename.Right(filename.GetLength()-extpos); //with dot
	extension.Replace(" ","");
	extension.MakeLower();
	filename = filename.Left(extpos);
a304 5
	CString preupper(" -+#()[]."); // valid chars where we upper the following char
	CString numbers("0123456789"); // numberchars where not to clear dots between
	CString dblstrip(" .");	// the first char of any combination will be removed
	// Make leading Caps 
	//SyruS includes onechar-names// if (filename.GetLength()>1)
d306 4
d317 1
a317 2
		int maxpos;
		//SyruS walks to end// for (int ix=0; ix<filename.GetLength()-1; ix++)
d320 5
a324 6
		maxpos = filename.GetLength()-1; //may change caused by deletion of doubles!
		//SyruS replaces dots inside forloop
		if( filename.GetAt(ix) == '.' )
		{
		    //SyruS replaces dot at beginning and end of filename
		    if( ix == 0 || ix == maxpos )
d326 1
a326 1
		    //SyruS replaces dot only if not between 2 numbers (versions and dates)
d330 5
a334 1
		    if( ix < maxpos )	// need a char at ix+1
d336 3
a338 2
			    //SyruS uppers after several chars defined by preupper// if (filename.GetAt(ix) == ' ')
			    if( preupper.Find(filename.GetAt(ix)) >= 0 )
a344 3
			    //SyruS deletes any combination of doubled spaces and dots
			    if( dblstrip.Find(filename.GetAt(ix)) >= 0 && dblstrip.Find(filename.GetAt(ix+1)) >= 0 )
				    filename.Delete(ix--); //attention! ix has to be decremented after deletion!
a358 1
	filename.Replace("&","and");	//netwolf: otherwise & becomes &&; now & and && become 'and', and I don´t like '&' anyway
d361 2
a362 1
	GetDlgItem(IDC_FILENAME)->SetWindowText(MakeStringEscaped(filename));
@


1.11
log
@Small fix to prev. fix :)
@
text
@d245 1
d252 1
d267 32
d300 14
d315 3
a317 1
	if (filename.GetLength()>1)
d324 3
a326 1
		for (int ix=0; ix<filename.GetLength()-1; ix++)
d328 25
a352 7
			if (filename.GetAt(ix) == ' ') 
			{
				tempStr=filename.GetAt(ix+1);
				tempStr.MakeUpper();
				c=tempStr.GetAt(0);
				filename.SetAt(ix+1,c);
			}
d355 13
@


1.10
log
@Corrective solution for 0 size file proble in addition ti Ultra's "Preventive solution"
@
text
@d93 1
a93 1
	if ( m_file->GetPercentCompleted() > 0.f )
@


1.9
log
@last seen complete and last downloaded are displayed under locale settings
@
text
@d93 8
a100 1
	bufferS.Format("%.2f ",m_file->GetPercentCompleted());
d103 8
a110 1
	bufferS.Format("%.2f %s",(float)m_file->GetDatarate()/1024,GetResString(IDS_KBYTESEC));
d118 6
a123 1
	bufferS.Format("%i (%.1f%%)",m_file->GetAvailablePartCount(),(float) ((m_file->GetAvailablePartCount()*100)/ m_file->GetPartCount()));
@


1.8
log
@all my stable changes and some minor fixes (refer to changelog)
@
text
@d108 2
a109 1
		bufferS.Format( "%s",m_file->lastseencomplete.Format( "%A, %x, %X"));
@


1.8.4.1
log
@27a partial merge
@
text
@d108 2
a109 1
		bufferS.Format( "%s",m_file->lastseencomplete.Format( theApp.glob_prefs->GetDateTimeFormat()));
a110 5

	if (m_file->GetLastChangeDatetime(true)!=NULL) bufferS.Format( "%s",m_file->GetLastChangeDatetime().Format( theApp.glob_prefs->GetDateTimeFormat()));
		else bufferS=GetResString(IDS_UNKNOWN);
	GetDlgItem(IDC_LASTRECEIVED)->SetWindowText(bufferS);

d157 1
a157 1
	GetDlgItem(IDC_FD_LASTCHANGE)->SetWindowText(GetResString(IDS_FD_LASTCHANGE));
a235 7
	int pos1,pos2;
	while (true) {
		pos1=filename.Find('[');
		pos2=filename.Find(']');
		if (pos1>-1 && pos2>pos1) filename=filename.Left(pos1)+filename.Right(filename.GetLength()-pos2-1); else break;
	}

d266 1
a266 1
	GetDlgItem(IDC_FILENAME)->SetWindowText(filename);
@


1.8.4.2
log
@uncompleted stuff...
@
text
@d161 1
a161 1
	GetDlgItem(IDC_FD_LASTCHANGE)->SetWindowText(GetResString(IDS_LAST_FILE_PROGRESS));
@


1.8.4.3
log
@27c
@
text
@d111 1
a111 1
	if (m_file->GetFileDate()!=NULL) bufferS.Format( "%s",m_file->GetCFileDate().Format( theApp.glob_prefs->GetDateTimeFormat()));
@


1.7
log
@Code clean up and double check wit official code.
@
text
@d75 1
@


1.6
log
@Added instrumentation for debugging memory leaks :
#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

To all .cpp files (I hope I didn't miss any one)
@
text
@a75 3
//	buffer[0] = 0;
//	for (uint16 i = 0;i != 16;i++) // hmm I wonder if there is a standart function for this
//		sprintf(buffer,"%s%02X",buffer,m_file->GetFileHash()[i]);
d82 1
a82 1
	bufferS.Format("%i",m_file->GetPartCount());
@


1.5
log
@.26b port
@
text
@d28 8
@


1.4
log
@Merge from plus26based branch (without new sockets code yet)
@
text
@a59 3
	char buffer[100];
	char buffer2[100];
	char buffer3[100];
d73 1
a73 3
	CastItoXBytes(m_file->GetFileSize(),buffer);
	sprintf(buffer,"%s",buffer);
	GetDlgItem(IDC_FSIZE)->SetWindowText(buffer);
d77 2
a78 2
	sprintf(buffer,"%i",m_file->GetPartCount());
	GetDlgItem(IDC_PARTCOUNT)->SetWindowText(buffer);
d80 1
a80 2
	CastItoXBytes(m_file->GetTransfered(),buffer);
	GetDlgItem(IDC_TRANSFERED)->SetWindowText(buffer);
d82 1
a82 3
	CastItoXBytes(m_file->GetLostDueToCorruption(), buffer2);
	CastItoXBytes(m_file->GetGainDueToCompression(), buffer3);
	bufferS.Format(GetResString(IDS_FD_STATS),buffer2, buffer3, m_file->TotalPacketsSavedDueToICH() );
d85 1
a85 2
	CastItoXBytes(m_file->GetCompletedSize(),buffer);
	GetDlgItem(IDC_COMPLSIZE)->SetWindowText(buffer);
d87 2
a88 2
	sprintf(buffer,"%.2f ",m_file->GetPercentCompleted());
	GetDlgItem(IDC_PROCCOMPL)->SetWindowText(buffer+GetResString(IDS_PROCDONE));
d90 2
a91 2
	sprintf(buffer,"%.2f %s",(float)m_file->GetDatarate()/1024,GetResString(IDS_KBYTESEC));
	GetDlgItem(IDC_DATARATE)->SetWindowText(buffer);
d93 4
a96 4
	sprintf(buffer,"%i",m_file->GetSourceCount());
	GetDlgItem(IDC_SOURCECOUNT)->SetWindowText(buffer);
	sprintf(buffer,"%i",m_file->GetTransferingSrcCount());
	GetDlgItem(IDC_SOURCECOUNT2)->SetWindowText(buffer);
d98 2
a99 2
	sprintf(buffer,"%i (%.1f%%)",m_file->GetAvailablePartCount(),(float) ((m_file->GetAvailablePartCount()*100)/ m_file->GetPartCount()));
	GetDlgItem(IDC_PARTAVAILABLE)->SetWindowText(buffer);
d101 2
a102 2
	if (m_file->lastseencomplete==NULL) sprintf(buffer,GetResString(IDS_UNKNOWN).MakeLower()); else
	sprintf(buffer,m_file->lastseencomplete.Format( "%A, %x, %X"));
d104 1
a104 1
	GetDlgItem(IDC_LASTSEENCOMPL)->SetWindowText(buffer);
@


1.3
log
@updated to .25b codebase
@
text
@d71 4
a74 4
	buffer[0] = 0;
	for (uint16 i = 0;i != 16;i++) // hmm I wonder if there is a standart function for this
		sprintf(buffer,"%s%02X",buffer,m_file->GetFileHash()[i]);
	GetDlgItem(IDC_FHASH)->SetWindowText(buffer);
d186 4
a189 3
   for (pos1 = m_file->srclist.GetHeadPosition(); (pos2 = pos1) != NULL;) { 
      m_file->srclist.GetNext(pos1); 
      cur_src = m_file->srclist.GetAt(pos2); 
@


1.3.4.1
log
@initial upgrade to .26
@
text
@d71 4
a74 3
//	for (uint16 i = 0;i != 16;i++) // hmm I wonder if there is a standart function for this
//		sprintf(buffer,"%s%02X",buffer,m_file->GetFileHash()[i]);
	GetDlgItem(IDC_FHASH)->SetWindowText(EncodeBase16(m_file->GetFileHash(), 16));
d186 3
a188 4
   for (int sl=0;sl<SOURCESSLOTS;sl++) if (!m_file->srclists[sl].IsEmpty())
   for (pos1 = m_file->srclists[sl].GetHeadPosition(); (pos2 = pos1) != NULL;) { 
      m_file->srclists[sl].GetNext(pos1); 
      cur_src = m_file->srclists[sl].GetAt(pos2); 
@


1.3.2.1
log
@updating this branch...
@
text
@@


1.2
log
@port to .25 b codebase...
@
text
@a124 1
	ON_BN_CLICKED(IDC_BUTTONRENAME, OnBnClickedButtonrename) // Added by Tarod [Juanjo]
d132 1
d164 1
a164 1
   }
a208 13
void CFileDetailDialog::OnBnClickedButtonrename() 
{ 
   CString NewFileName; 
   GetDlgItem(IDC_FILENAME)->GetWindowText(NewFileName);

   m_file->SetFileName(NewFileName.GetBuffer()); 
   m_file->SavePartFile(); 

   GetDlgItem(IDC_FNAME)->SetWindowText(m_file->GetFileName());
   GetDlgItem(IDC_METFILE)->SetWindowText(m_file->GetFullName());
   GetDlgItem(IDC_FILENAME)->SetWindowText(m_file->GetFileName());
} 

d256 1
a256 1
		for (int ix=0;ix<filename.GetLength()-1;ix++)
d353 1
a353 1
	
d362 15
a376 1
}
@


1.1
log
@*** empty log message ***
@
text
@d61 2
d65 1
a65 1
	GetDlgItem(IDC_FNAME)->SetWindowText(m_file->GetFileName());
d88 5
d251 10
d262 6
a267 2
	if (filename.GetLength()>1){
		tempStr=filename.GetAt(0);tempStr.MakeUpper();c=tempStr.GetAt(0);filename.SetAt(0,c);
d270 8
a277 5
		if (filename.GetAt(ix)==' ') {
			tempStr=filename.GetAt(ix+1);
			tempStr.MakeUpper();
			c=tempStr.GetAt(0);
			filename.SetAt(ix+1,c);
d281 1
a281 1
	GetDlgItem(IDC_FILENAME)->SetWindowText(filename);
d361 5
d370 1
@

